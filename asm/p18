*             REGS                                                      00010000
         AGO   .INCOM                                             J52   00011000
OPERWORK      DATASECT                                                  00020000
#OPR          DC     H'0'                                               00030000
OPR           DC     CL8' '                                             00040000
*                                                                       00050000
OP1TYPE       DC     C'0'                                               00060000
*                    /* 0 = Numeric            */                       00070000
*                    /* 1 = Special Character      */                   00080000
*                    /* 2 = Identifier         */                       00090000
*                    /* 3 = Quoted String          */                   00100000
*                    /* 16= Error              */                       00110000
*                    /* 20= Matrix Entry Number    */                   00120000
*                    /* 21= Parameter          */                       00130000
*                    /* 23= Token Number of 'lit'  */                   00140000
*                    /* 33= X(array) for temp 'lit'*/                   00150000
#OP1          DC     H'0'                                               00160000
OP1           DC     CL253' '          /* For Character Opns */         00170000
         ENTRY #OP1                                                     00180000
OP1BIT        DC     F'0'                  /* For Logical Opns   */     00190000
         ENTRY OP1BIT                                                   00200000
OP1BIN        DC     F'0'                  /* For Logical Opns   */     00210000
OP1DEC        DC     PL8'0'            /* For Arithmetic Ops */         00220000
*                                                                       00230000
OP2TYPE       DC     C'0'                                               00240000
#OP2          DC     H'0'                                               00250000
OP2           DC     CL253' '          /* For Character Opns */         00260000
         ENTRY #OP2                                                     00270000
OP2BIT        DC     F'0'                  /* For Logical Opns   */     00280000
         ENTRY OP2BIT                                                   00290000
OP2BIN        DC     F'0'                  /* For Logical Opns   */     00300000
OP2DEC        DC     PL8'0'            /* For Arithmetic Ops */         00310000
*                                                                       00320000
QUOTEFND      DC     X'0'                                               00330000
P18LEVEL      DC     H'0'                                               00340000
         ENTRY P18LEVEL                                                 00350000
P18NEST       DC     X'0'                                               00360000
         ENTRY P18NEST                                                  00370000
DUMDUM        DC     X'0'                                               00380000
THISISIF      DC     X'0'                                               00390000
*TOOHIIND      DC     X'0'                                              00400000
CONVTNUM      DC     F'0'                                               00410000
PARSEDEP      DC     H'10'                                              00420000
OPRL2         DC     CL2' '                                             00430000
P85WASFN DS      H        SET TO 0 IF FOUND, ELSE 4               87150 00440000
P85TBLPS DS      H        TABLE POSITION TO INSERT AT OR OVERRIDE 87150 00450000
*                                                                       00460000
*FUNCSECT      DATASECT         /* Used to detect Function end */       00461000
*      2 Function_last_name  char(8), /* Should save nests of names*/   00462000
FUNCLAST      DC    CL8' '   /* Should save nests of names*/            00463000
FUNCLEVS      DC (10)H'0'           bin fixed,                          00464000
FUNCCNTL      DC   H'0'        bin fixed;                               00465000
FNRTNADR      DC   A(0)                                                 00466000
FNPARMS       DC   H'0'                                                 00467000
*                                                                       00468000
SETDONE       DC   X'0'                                                 00469000
BITANS        DC   F'0'                                                 00469100
DEBUG         DC   H'1'                                                 00469200
*                                                                       00469300
*X1           DSECT                                                     00470000
*PARSWORK      DATASECT                                                 00480000
*     2 Parameter_Fields,                                               00490000
PARMCNTL      DC    H'0'  bin fixed(15),                                00500000
         ENTRY PARMCNTL                                                 00510000
*       3 Parm_Str(3)         char(253) var,                            00520000
#PARMST1      DC    H'0'                                                00530000
PARMST1       DC    CL254' '          /* For Character Opns */          00540000
         ENTRY #PARMST1                                                 00550000
#PARMST2      DC    H'0'                                                00560000
PARMST2       DC    CL254' '          /* For Character Opns */          00570000
         ENTRY #PARMST2                                                 00580000
#PARMST3      DC    H'0'                                                00590000
PARMST3       DC    CL254' '          /* For Character Opns */          00600000
         ENTRY #PARMST3                                                 00610000
*       3 Parm_Bin(3)         bin fixed,                                00620000
PARMBIN1      DC    F'0'                                                00630000
         ENTRY PARMBIN1                                                 00640000
PARMBIN2      DC    F'0'                                                00650000
PARMBIN3      DC    F'0'                                                00660000
*       3 Parm_type(3)        bin fixed(7); /* 0=num, else char string  00670000
PARMTYP1      DC    X'0'                                                00680000
*        ENTRY PARMTYP1                                                 00690000
PARMTYP2      DC    X'0'                                                00700000
PARMTYP3      DC    X'0'                                                00710000
*                                                                       00720000
TKNPRTY       DC    X'0'                                                00730000
*        ENTRY TKNPRTY                                                  00740000
TNUMBER       DC    H'0'                                                00750000
TEMP1         DC    F'0'                                                00760000
TEMP2         DC    F'0'                                                00770000
TEMPBIN       DC    F'0'                                                00780000
* cvcvcvcvcvc IN JOLCOM                                                 00790000
*#TKN          DC    H'0'                                               00800000
*TKN           DC    CL254' '                                           00810000
*TKNTYPE       DC    X'0'                                               00820000
*TKNCURR       DC    H'0'                                               00830000
*ICOMMAND      DC    CL8'  '                                            00840000
*ZERO          DC    F'0'                                               00850000
*SYMBOLIC      DC    CL8'  '                                            00860000
*#OP           DC     H'0'                                              00870000
*OP            DC     CL253' '          /* For Character Opns */        00880000
I             DC     H'0'                                               00890000
J             DC     H'0'                                               00900000
K             DC     X'0'                                               00910000
*BLANKS        DC    CL250' '                                           00920000
*#WORK         DC     H'0'                                              00930000
*WORK          DC     CL253' '          /* For Character Opns */        00940000
*DBL           DC     D'0'                                              00950000
*PSTMT         DC     CL4' '                                            00960000
*SYSUID        DC     CL8' '                                            00970000
*P85NO1        DC     PL8'0'                                            00980000
*P85NO2        DC     PL8'0'                                            00990000
*                                                                       01000000
*                                                                       01010000
*                                                                       01020000
*    2 Rators,                                                          01030000
RATORCNT      DC    H'0'                                                01040000
         ENTRY RATORCNT                                                 01050000
*      3 Rator(parse_depth)   char(10) var,                             01060000
#RATOR        DC    H'0'                                                01070000
RATOR         DC    CL14' '          /* For Character Opns */           01080000
         ENTRY #RATOR                                                   01090000
RATOR1        EQU   RATOR                                               01100000
#RATOR2       DC    H'0'                                                01110000
RATOR2        DC    CL14' '          /* For Character Opns */           01120000
         ENTRY #RATOR2                                                  01130000
              DC    25CL16' '      SPACE FOR 25 MORE                    01140000
RATORPRT      DC    27X'0'                                              01150000
         ENTRY RATORPRT                                                 01160000
*    2 Rands,                                                           01170000
RANDCNTL      DC    H'0'                                                01180000
*      3 Rand_Type(parse_depth) bin fixed(7),  /* See TKNTYPE */        01190000
RANDTYPE      DC    27H'0'                                              01200000
         ENTRY RANDTYPE                                                 01210000
*                                                                       01220000
*      3 Rand(parse_depth)    char(253) var,                            01230000
#RAND         DC    H'0'                                                01240000
RAND          DC    CL253' '         /* For Character Opns */           01250000
         ENTRY #RAND                                                    01260000
#RAND2        DC    H'0'                                                01270000
RAND2         DC    CL253' '         /* For Character Opns */           01280000
         ENTRY #RAND2                                                   01290000
              DC    25CL255' '      SPACE FOR 25 MORE                   01300000
.INCOM   ANOP                                                     J52   01301000
         PRINT OFF                                                J50   01310000
       COPY     JOLCOM                                                  01320000
         PRINT ON                                                 J50   01330000
*                                                                       01340000
*                                                                       01350000
*                                                                       01360000
*X2           DSECT                                                     01370000
*       genfunc (ABS,1)                                                 01500000
*       genfunc (BITAND,2)                                              01510000
*       genfunc (BITOR,2)                                               01520000
*       genfunc (BITXOR,2)                                              01530000
*                                                                       01540000
*                                                                       01550000
*X3           DSECT                                                     01560000
UJP18PAR JOLSAVE CSECT=UJP18PAR                                         01570000
*                                                                       01580000
*                                                                       01590000
*       WTO     'PARSE Entered'                                         01600000
         B     P85NOER           ************* remove next *****  J52   01610000
          $CALL UJS20REP,#TKNSTRG                 REPLACE SYMBOLICJ52   01620000
*                                                 PARAMETERS      J52   01630000
           MVC #TKNSTRG(256),#WORK                                J52   01640000
           MVC #TKNSTRG+256(256),#WORK+256                        J52   01650000
           MVC #TKNSTRG+512(256),#WORK+512                        J52   01660000
           MVC #TKNSTRG+768(232),#WORK+768                        J52   01670000
           SPACE 2                                                      01680000
          $CALL UJSPLIT        SPLIT INTO TOKENS                  J52   01690000
         LTR   R15,R15        DID STMT SPLIT UP OK INTO TOKENS ?  J52   01700000
         BZ    P85NOER                                            J52   01710000
         JOLERR 477,'ERROR AFTER SYMBOLICS REPLACED ''',#TKNSTRG, J52  *01720000
               ''''                                               J52   01730000
*85NOER L       R7,=V(OPERWORK)      CSECT                              01740000
*85NOER L       R7,=V(OPERWORK)      CSECT                              01741000
P85NOER L       R7,AP18WRK           Address OPERWORK in Jolcom         01742000
        USING   OPERWORK,R7                                             01750000
*       L       R7,=V(FUNCSECT)      CSECT                              01760000
*       USING   FUNCSECT,R7                                             01770000
*       L       R6,=V(PARSWORK)      CSECT                              01780000
*       USING   PARSWORK,R6                                             01790000
        MVI     QUOTEFND,0                                              01800000
*                                                                       01810000
*                                                                       01820000
        MVC     P18LEVEL,=H'0'                                          01830000
        MVC     RATORCNT,=H'1'                                          01840000
        MVC     RANDCNTL,=H'1'                                          01850000
        MVI     RATOR1,C' '                                             01860000
        MVC     RATOR1(L'RATOR1-1),RATOR                                01870000
*       CLEAR   RATOR1                                                  01880000
        MVI     RATORPRT,0                                              01890000
*                                                                       01900000
*       CLEAR   RND1                                                    01910000
        MVC     #RAND,=H'0'                                             01920000
        MVI     RAND,C' '                                               01930000
        MVC     RAND(L'RAND-1),RAND                                     01940000
*       };                                                              01950000
*                                                                       01960000
*       FUNCCNTL = 1;                                                   01970000
*                                                                       01980000
        MVC     FUNCCNTL,=H'1'                                          01990000
*                                                                       02000000
*       Function_LevelsÝFunction_Cntl¨ = -1;                            02010000
*                                                                       02020000
        LH      R1,FUNCCNTL                                             02030000
        SLL     R1,1                                                    02040000
        LH      R0,=H'-1'                                               02050000
        STH     R0,FUNCLEVS(R1)                                         02060000
*       MVC     FUNCLEVS+2,=H'-1'                                       02070000
*                                                                       02080000
*                                                                       02090000
*       Tnumber = 0;                                                    02100000
*                                                                       02110000
*       MVI     Tnumber,0                                               02120000
*                                                                       02130000
        MVC     TKNCURR,=H'1'                                           02140000
*                                                                       02150000
*       i = gettkn(TKNcurr);                                            02160000
*                                                                       02170000
        GETTKN  TKNCURR                                                 02180000
        STH     R1,TKNCURR                                              02190000
*       WTO     'GOT TOKEN'                                             02200000
*       WTO     TKN,20                                                  02210000
*                                                                       02220000
*                                                                       02230000
*       CLEAR    ICOMMAND                                               02240000
        MVC      ICOMMAND,BLANKS                                        02250000
*                                                                       02260000
*                                                                       02270000
        MVC     ICOMMAND,TKN                                            02280000
*                                                                       02290000
        MVI     SETDONE,0                                               02300000
*                                                                       02310000
*   if (this_is_an_if) {                                                02320000
*                                                                       02330000
        CLI     THISIF,0                                                02340000
        BE      P18T#SET                                                02350000
*                                                                       02360000
        MVI     SETDONE,1                                               02370000
        B       P18SKP01               Skip IF or SET                   02380000
*    else                                                               02390000
*    if (icommandÝ0¨ == "SET     "                                      02400000
*                                                                       02410000
P18T#SET CLC     =C'SET ',ICOMMAND                                      02420000
        BNE     P18NOSKP                                                02430000
*       i = gettkn(TKNcurr);                                            02440000
*                                                                       02450000
P18SKP01 DS     0H                                                      02460000
*       GETTKN  TKNCURR                Skip IF or SET                   02470000
         B     *+4                                                J51   02480000
         B     *+4                                                J51   02490000
        STH     R1,TKNCURR                                              02500000
*       WTO     'GOT TOKEN'                                             02510000
*       WTO     TKN,20                                                  02520000
P18NOSKP DS     0H                                                      02530000
*                                                                       02540000
*       while (*TKN != '\0')                                            02550000
*       {                                                               02560000
        B       GOTNEXT                go to dowhile start              02570000
STARTWHL  DS     0H                    if do is true, we come here      02580000
*                                                                       02590000
*       if (TKNÝ0¨ == '(') goto  topr;                                  02600000
*                                                                       02610000
        CLI     TKN,C'('               A=(8+7) type                     02620000
        BE      TOPR                                                    02630000
*                                                                       02640000
*       if ((TKNÝ0¨ == '+')                                             02650000
*       ||      (TKNÝ0¨ == '-')                                         02660000
*       ||      (TKNÝ0¨ == '¬'))                                        02670000
*                                                                       02680000
        CLI     TKN,C'+'                                                02690000
        BE      ISINFIX                                                 02700000
        CLI     TKN,C'-'                                                02710000
        BE      ISINFIX                                                 02720000
        CLI     TKN,C'^'                                                02730001
        BNE     NOTINFIX                                                02740000
ISINFIX DS     0H                                                       02750000
*                                                                       02760000
*       B       #15#1274                                                02770000
*       MVC     #OP(3),=H'1',C'0'                                       02780000
        MVC     #OP,=H'1'                370 Sim Bug                    02790000
        MVC     OP(2),=C'0 '                                            02800000
*                                                                       02810000
#15#1274  DS     0H                                                     02820000
*                                                                       02830000
*       WTO     'Pushing Infix Rand'                                    02840000
*       WTO     OP,5                                                    02850000
        LA      R0,0                                                    02860000
        LA      R1,#OP                                                  02870000
        L       R15,=V(PUSHRAND)                                        02880000
        BALR    R14,R15                                                 02890000
*       goto topr;                                                      02900000
*                                                                       02910000
        B       TOPR                                                    02920000
NOTINFIX  DS     0H                                                     02930000
*                                                                       02940000
*       }                                                               02950000
*                                                                       02960000
*       if ((TKNtype == 0)                Number ?                      02970000
*       || (TKNtype == 2)                 Name   ?                      02980000
*       || (TKNtype == 3))                Literal?                      02990000
*                                                                       03000000
        CLI     TKNTYPE,0                                               03010000
        BE      P18OK1                                                  03020000
        CLI     TKNTYPE,2                                               03030000
        BE      P18OK1                                                  03040000
        CLI     TKNTYPE,3                                               03050000
        BE      P18OK1                                                  03060000
        B       P18NUMEX                                                03070000
P18OK1  DS     0H                                                       03080000
*                                                                       03090000
*       {                                                               03100000
*       if (TKNtype == 3)                 Literal ?                     03110000
*                                                                       03120000
*cvc    CLI     TKNTYPE,3                                               03130000
*cvc    BNE     #15#1418                                                03140000
*fix - where is it going to?                                            03150000
#15#1418  DS     0H                                                     03160000
*                                                                       03170000
*       {                                                               03180000
         MVC    #OP(L'OP),#TKN                                          03190000
*       PUSHRAND(op, dv_op.curr_len, TKNtype);                          03200000
*       WTO     'Pushing Rand'                                          03210000
*       WTO     OP,79                                                   03220000
        IC      R0,TKNTYPE                                              03230000
        LA      R1,#OP                                                  03240000
        L       R15,=V(PUSHRAND)                                        03250000
        BALR    R14,R15                                                 03260000
*                                                                       03270000
*                                                                       03280000
*       if (TKNtype == 2) {               /* Identifier ? */            03290000
*                                                                       03300000
        CLI     TKNTYPE,2                                               03310000
        BNE     #15#1706                                                03320000
*                                                                       03330000
*       {                                                               03340000
         MVC    #OP(L'OP),#TKN                                          03350000
*        };                                                             03360000
*       i = gettkn(TKNcurr);                                            03370000
*                                                                       03380000
        GETTKN  TKNCURR                   Yes, get next token           03390000
        STH     R1,TKNCURR                                              03400000
        STH     R1,I                                                    03410000
         CLI   TKN,C'%'                                           J52   03420000
         BNE   NOPC1                                              J52   03430000
         MVC   TKN,TKN+1                                          J52   03440000
         LH    R15,#TKN                                           J52   03450000
         BCTR  R15,0                                              J52   03460000
         STH   R15,#TKN                                           J52   03470000
NOPC1    DS    0H                                                 J52   03480000
*       WTO     'GOT TOKEN'                                             03490000
*       WTO     TKN,20                                                  03500000
*                                                                       03510000
*                                                                       03520000
*       if (TKNÝ0¨ == '(') {                                            03530000
*                                                                       03540000
        CLI     TKN,C'('                  Function or array start ?     03550000
        BNE     #15#1682                                                03560000
*                                                                       03570000
         MVC    FUNCLAST,OP               Save name for errors          03580000
*        WTO    'FUNCTION Found'                                        03590000
*                                                                       03600000
*       Function_Cntl = Function_Cntl + 1;                              03610000
*                                                                       03620000
        LH      R15,FUNCCNTL                                            03630000
        LA      R15,1(R15)                                              03640000
        STH     R15,FUNCCNTL                                            03650000
*                                                                       03660000
*       Function_LevelsÝFunction_Cntl¨ = p18level;                      03670000
*                                                                       03680000
        SLL     R15,1                                                   03690000
        LH      R1,P18LEVEL                                             03700000
        STH     R1,FUNCLEVS(R15)                                        03710000
*                                                                       03720000
*       p18level = p18level + 1;                                        03730000
*                                                                       03740000
        LA      R1,1(R1)                                                03750000
        STH     R1,P18LEVEL                                             03760000
*       WTO 'Incrementing P18LEVEL'                                     03770000
*                                                                       03780000
*       i = PUSHRATR(TKN, dv_TKN.curr_len);                             03790000
*                                                                       03800000
*       WTO     'Pushing Rator'                                         03810000
*       WTO     TKN,79                                                  03820000
        LA      R1,#TKN                                                 03830000
        CALL    PUSHRATR                                                03840000
*                                                                       03850000
*       TKNPRTY = p18level * 10 + 1;                                    03860000
*                                                                       03870000
        LH      R1,P18LEVEL                                             03880000
        MH      R1,=H'10'                                               03890000
        LA      R1,1(R1)                                                03900000
        STC     R1,TKNPRTY                                              03910000
*       WTO     'TKNPRTY  level*10+1'                                   03920000
*                                                                       03930000
*       i = PUSHRATR(",",1);                                            03940000
*                                                                       03950000
*       WTO     'Pushing Rator'                                         03960000
*       WTO     'COMMA'                                                 03970000
*       LA      R1,=H'1',C','                 370 simulator bug         03980000
        LA      R1,=X'00026B40'                                         03990000
        CALL    PUSHRATR                                                04000000
*                                                                       04010000
*       i = gettkn(TKNcurr);                                            04020000
*                                                                       04030000
        GETTKN  TKNCURR                                                 04040000
        STH     R1,TKNCURR                                              04050000
        STH     R1,I                                                    04060000
         CLI   TKN,C'%'                                           J52   04070000
         BNE   NOPC2                                              J52   04080000
         MVC   TKN,TKN+1                                          J52   04090000
         LH    R15,#TKN                                           J52   04100000
         BCTR  R15,0                                              J52   04110000
         STH   R15,#TKN                                           J52   04120000
NOPC2    DS    0H                                                 J52   04130000
*       WTO     'GOT TOKEN'                                             04140000
*       WTO     TKN,20                                                  04150000
*                                                                       04160000
*       if (TKNÝ0¨ == ')')                                              04170000
*                                                                       04180000
        CLI     TKN,C')'                                                04190000
        BNE     P18NCLS1                                                04200000
*                                                                       04210000
*       {                                                               04220000
*       PushRand("", 0, 0);                                             04230000
*                                                                       04240000
*       WTO     'Pushing Rand'                                          04250000
*       WTO     'Pushing BLANK'                                         04260000
        LA      R1,=X'000040'                                           04270000
        LA      R0,0                                                    04280000
        CALL    PUSHRAND                                                04290000
*                                                                       04300000
*       goto no_parms;                                                  04310000
*                                                                       04320000
        B       NOPARMS                                                 04330000
P18NCLS1  DS     0H                                                     04340000
*                                                                       04350000
*       }                                                               04360000
*       goto Got_next;                                                  04370000
*                                                                       04380000
        B       GOTNEXT                                                 04390000
#15#1682  DS     0H                                                     04400000
*                                                                       04410000
*       }                                                               04420000
*                                                                       04430000
*       goto topr;                                                      04440000
*                                                                       04450000
        B       TOPR                                                    04460000
#15#1706  DS     0H                                                     04470000
*                                                                       04480000
*       }                                                               04490000
*       i = gettkn(TKNcurr);                                            04500000
*                                                                       04510000
        GETTKN  TKNCURR                                                 04520000
        STH     R1,TKNCURR                                              04530000
        STH     R1,I                                                    04540000
         CLI   TKN,C'%'                                           J52   04550000
         BNE   NOPC3                                              J52   04560000
         MVC   TKN,TKN+1                                          J52   04570000
         LH    R15,#TKN                                           J52   04580000
         BCTR  R15,0                                              J52   04590000
         STH   R15,#TKN                                           J52   04600000
NOPC3    DS    0H                                                 J52   04610000
*       WTO     'GOT TOKEN'                                             04620000
*       WTO     TKN,20                                                  04630000
*                                                                       04640000
*       }                                                               04650000
*                                                                       04660000
        B       TOPR                                                    04670000
P18NUMEX  DS     0H                                                     04680000
*                                                                       04690000
*                                                                       04700000
        JOLERR  300,'*** Expected Name or Number not:- ''',#TKN,''''    04710000
*       WTO     TKN,50                                                  04720000
        JOLRETN RC=4                                                    04730000
TOPR      DS     0H                                                     04740000
*                                                                       04750000
*       }                                                               04760000
*       topr:                                                           04770000
*                                                                       04780000
*       if ((TKNtype != 1)                                              04790000
*       &&  (*TKN != '\0'))                                             04800000
*                                                                       04810000
        CLI     TKNTYPE,1                                               04820000
        BE      #15#2090                                                04830000
        CLI     TKN,C' '                                                04840000
        BE      #15#2090                                                04850000
*                                                                       04860000
        JOLERR  301,'*** Expected Operator not:-''',#TKN,''''           04870000
*       WTO     TKN,80                                                  04880000
        JOLRETN RC=4                                                    04890000
*#15#2090  DS     0H                                                    04900000
        B GOTNEXT                                                       04910000
*                                                                       04920000
*                                                                       04930000
*       else {                                                          04940000
*loop1:                                                                 04950000
LOOP1   DS    0H                                                        04960000
#15#2090  DS     0H                                                     04970000
*                                                                       04980000
*       p18nest = 0;                                                    04990000
*                                                                       05000000
        MVI     P18NEST,0                                               05010000
*                                                                       05020000
*       if (TKNÝ0¨ == '=')                                              05030000
*                                                                       05040000
        CLI     TKN,C'='                                                05050000
        BNE     #15#2258                                                05060000
*                                                                       05070000
*       {                                                               05080000
*       if (SETDONE) p18nest = 5;                                       05090000
*                                                                       05100000
        CLI     SETDONE,0                                               05110000
        BE      #15#2162                                                05120000
        MVI     P18NEST,5                                               05130000
        B       #15#2234                                                05140000
#15#2162  DS     0H                                                     05150000
*                                                                       05160000
*                                                                       05170000
*       else                                                            05180000
*          MVC   #TKN(4),=H'2',C':='     370 Sim Bug                    05190000
           MVC   #TKN(2),=H'2'                                          05200000
           MVC    TKN(2),=C':='                                         05210000
*       p18nest = 1;                                                    05220000
*                                                                       05230000
        MVI     P18NEST,1                                               05240000
*                                                                       05250000
*       SETDONE = 1;                                                    05260000
*                                                                       05270000
        MVI      SETDONE,1                                              05280000
#15#2234  DS     0H                                                     05290000
*                                                                       05300000
*       }                                                               05310000
*       goto Got_Prioritity;                                            05320000
*                                                                       05330000
        B       GOTPRTY1                                                05340000
#15#2258  DS     0H                                                     05350000
*                                                                       05360000
*       }                                                               05370000
*                                                                       05380000
*       if (TKNÝ0¨ == ',')                                              05390000
*                                                                       05400000
        CLI     TKN,C','                                                05410000
        BNE     FINDPREC                                                05420000
*                                                                       05430000
*       {                                                               05440000
*                                                                       05450000
*       if ((*RatorÝRator_Cntl¨ == ',')                                 05460000
*       || (*RatorÝRator_Cntl¨ == '('))                                 05470000
*                                                                       05480000
        LH      R1,RATORCNT                                             05490000
        MH      R1,=AL2(L'RATOR+L'#RATOR)                               05500000
        LA      R15,RATOR(R1)                                           05510000
        CLI     0(R15),C','                                             05520000
        BE      PUSHCOM1                                                05530000
        CLI     0(R15),C'('                                             05540000
        BNE     #15#2354                                                05550000
PUSHCOM1  DS     0H                                                     05560000
*                                                                       05570000
*       {                                                               05580000
*Push_Comma:                                                            05590000
*       i = PUSHRATR(",",1);                                            05600000
*                                                                       05610000
*       WTO     'Pushing Rator'                                         05620000
*       WTO     'COMMA'                                                 05630000
        LA      R1,=X'00016B40'         a ','                           05640000
        CALL    PUSHRATR                                                05650000
*                                                                       05660000
*       goto Get_next;                                                  05670000
*                                                                       05680000
        B       GETNEXT1                                                05690000
#15#2354  DS     0H                                                     05700000
*                                                                       05710000
*       }                                                               05720000
*                                                                       05730000
*       TKN_prty = p18level * 10 + 1;                                   05740000
*                                                                       05750000
        LH      R1,P18LEVEL                                             05760000
        MH      R1,=H'10'                                               05770000
        LA      R1,1(R1)                                                05780000
        STC     R1,TKNPRTY                                              05790000
*                                                                       05800000
        CALL    TUNSTACK                                                05810000
*                                                                       05820000
*       goto Push_Comma;                                                05830000
*                                                                       05840000
        B       PUSHCOM1                                                05850000
*                                                                       05860000
*       else {                                                          05870000
*                                                                       05880000
         PRINT DATA                                               J51   05890000
XPRTY    DC C'**/ * - + ||&& ->. : , : = >=<=> < | && ^<^>^=^ '         05900000
         DS    0H                                                 J51   05910000
NUM#PRTY DC C' 9 8 8 7 7 6 4 9 8 8 1 1 5 5 5 5 5 3 4 5 5 5 2 '          05920000
         FIX ' ABOVE TABLE'                                       J50   05930000
*                                                                       05940000
*                                                                       05950000
*       static char  *temp_posn;                                        05960000
*       static char   temp_TKNÝ3¨;                                      05970000
*                                                                       05980000
FINDPREC  DS     0H                                                     05990000
        MVI     P18NEST,0                                               06000000
*                                                                       06010000
*       if (TKNÝ0¨!=0)                                                  06020000
*                                                                       06030000
        CLI     TKN,C' '                                                06040000
        BE      #15#2522                                                06050000
        LH      R1,TKN                                                  06060000
        LA      R14,XPRTY                                               06070000
FINDOP  CH      R1,0(R14)                                               06080000
        BE      GOTPRTY                                                 06090000
        LA      R14,2(R14)                                              06100000
        C       R14,=A(NUM#PRTY)                                        06110000
        BH      #15#2522                ; Hmm, didn't find Operator     06120000
        B       FINDOP                                                  06130000
*                                                                       06140000
*       {   p18nest=temp_posn-Prty;                                     06150000
*                                                                       06160000
GOTPRTY S       R14,=A(XPRTY)                                           06170000
        STC     R14,P18NEST                                             06180000
*                                                                       06190000
*       temp_posn=&num_PrtyÝp18nest¨;                                   06200000
*                                                                       06210000
        LH      R1,NUM#PRTY(R14)                                        06220000
*                                                                       06230000
*       p18nest=*temp_posn -'0';                                        06240000
*                                                                       06250000
        SH      R1,=C' 0'               Convert to Number               06260000
        STC     R1,P18NEST                                              06270000
#15#2522  DS     0H                                                     06280000
*                                                                       06290000
*       }                                                               06300000
*                                                                       06310000
*       if (p18nest != 0) goto Got_Prioritity;                          06320000
*                                                                       06330000
        CLI     P18NEST,0                                               06340000
        BNE     GOTPRTY1                                                06350000
*                                                                       06360000
*       if (TKNÝ0¨ == '(') {                                            06370000
*                                                                       06380000
        CLI     TKN,C'('                                                06390000
        BNE     #15#2618                                                06400000
*                                                                       06410000
*       p18level = p18level + 1;                                        06420000
*                                                                       06430000
        LH      R1,P18LEVEL                                             06440000
        LA      R1,1(R1)                                                06450000
        STH     R1,P18LEVEL                                             06460000
*       WTO 'Incrementing P18LEVEL'                                     06470000
*                                                                       06480000
*       goto Get_next;                                                  06490000
*                                                                       06500000
        B       GETNEXT1                                                06510000
#15#2618  DS     0H                                                     06520000
*                                                                       06530000
*       }                                                               06540000
*                                                                       06550000
*       if (TKNÝ0¨ == ')')                                              06560000
*                                                                       06570000
        CLI     TKN,C')'                                                06580000
        BNE     #15#2930                                                06590000
*       WTO    'FOUND BRACKET'                                          06600000
        LH      R1,FUNCCNTL                                             06610000
        LH      R0,P18LEVEL                                             06620000
        LH      R14,FUNCLEVS(R1)                                        06630000
*       HALT                                                            06640000
NOPARMS   DS     0H                                                     06650000
*                                                                       06660000
*       {                                                               06670000
*no_parms:                                                              06680000
*                                                                       06690000
*       p18level = p18level - 1;                                        06700000
*                                                                       06710000
        LH      R1,P18LEVEL                                             06720000
        SH      R1,=H'1'                                                06730000
        STH     R1,P18LEVEL                                             06740000
*                                                                       06750000
*       if (p18level < 0) {                                             06760000
*                                                                       06770000
        LTR     R1,R1                                                   06780000
        BNM     #15#2714                                          J52   06790000
*                                                                       06800000
        JOLERR  332,'Too Many '')'''                                    06810000
        JOLRETN RC=4                                                    06820000
#15#2714  DS     0H                                                     06830000
*                                                                       06840000
*       }                                                               06850000
*                                                                       06860000
*       if (Function_LevelsÝFunction_Cntl¨ == p18level) {               06870000
*                                                                       06880000
        LH      R1,FUNCCNTL                                             06890000
        SLL     R1,1                                                    06900000
        LH      R14,FUNCLEVS(R1)                                        06910000
        CH      R14,P18LEVEL                                            06920000
        BNE     #15#2906                                                06930000
*                                                                       06940000
*       Function_Cntl = Function_Cntl - 1;                              06950000
*                                                                       06960000
        LH      R1,FUNCCNTL                                             06970000
        SH      R1,=H'1'                                                06980000
        STH     R1,FUNCCNTL                                             06990000
*                                                                       07000000
*       TKN_prty = 0;                                                   07010000
*                                                                       07020000
        MVI     TKNPRTY,0                                               07030000
*                                                                       07040000
*       Parm_Cntl = 0;                                                  07050000
*                                                                       07060000
        MVC     PARMCNTL,ZERO                                           07070000
*                                                                       07080000
*       TUNSTACK();                                                     07090000
*                                                                       07100000
        CALL    TUNSTACK                                                07110000
*                                                                       07120000
*Unstack_Parms:                                                         07130000
*                                                                       07140000
P18UNSTK  DS     0H                                                     07150000
*       i = PopRator();                                                 07160000
*                                                                       07170000
        CALL    POPRATOR                                                07180000
        LTR     R15,R15                                                 07190000
        BNZ     P18RET4                                                 07200000
*                                                                       07210000
*       i = PopRand1();                                                 07220000
*                                                                       07230000
        CALL    POPRAND1                                                07240000
        LTR     R15,R15                                                 07250000
        BNZ     P18RET4                                                 07260000
*                                                                       07270000
*       op2=',';                                                        07280000
*                                                                       07290000
*       MVC     #OP2(3),=H'1',C','        370 Sim Bug                   07300000
        MVC     #OP2(2),=H'1'                                           07310000
        MVC      OP2,=C', '                                             07320000
*                                                                       07330000
*       op2type = 21;                                                   07340000
*                                                                       07350000
        MVI     OP2TYPE,21                                              07360000
*                                                                       07370000
*                                                                       07380000
*       Add_triple();                                                   07390000
*                                                                       07400000
        CALL    ADDTRIPL                                                07410000
        LTR     R15,R15                                                 07420000
        BNZ     P18RET4                                                 07430000
*                                                                       07440000
*                                                                       07450000
*       if (*opr != '(') goto Unstack_Parms;                            07460000
*                                                                       07470000
        CLI     OPR,C'('                                                07480000
        BNE     P18UNSTK                                                07490000
#15#2906  DS     0H                                                     07500000
*                                                                       07510000
*       }                                                               07520000
*       i = gettkn(TKNcurr);                                            07530000
*                                                                       07540000
        GETTKN  TKNCURR                                                 07550000
        STH     R1,TKNCURR                                              07560000
        STH     R15,I                                                   07570000
         CLI   TKN,C'%'                                           J52   07580000
         BNE   NOPC4                                              J52   07590000
         MVC   TKN,TKN+1                                          J52   07600000
         LH    R15,#TKN                                           J52   07610000
         BCTR  R15,0                                              J52   07620000
         STH   R15,#TKN                                           J52   07630000
NOPC4    DS    0H                                                 J52   07640000
*       WTO     'GOT TOKEN'                                             07650000
*       WTO     TKN,20                                                  07660000
*                                                                       07670000
*       goto topr;                                                      07680000
*                                                                       07690000
        B       TOPR                                                    07700000
#15#2930  DS     0H                                                     07710000
*                                                                       07720000
*       if (*TKN != '\0')                                               07730000
*                                                                       07740000
        CLI     TKN,C' '                                                07750000
        BE      GOTPRTY1                                                07760000
*                                                                       07770000
        JOLERR  334,'Invalid Operator:- ''',#TKN,''''                   07780000
*       HALT                                                            07790000
        JOLRETN RC=4                                                    07800000
*       }                                                               07810000
*                                                                       07820000
* Got_Prioritity:                                                       07830000
GOTPRTY1  DS     0H                                                     07840000
*       TKN_prty = p18level * 10 + p18nest;                             07850000
*                                                                       07860000
*       WTO     'TKNPRTY  level*10+1'                                   07870000
        LH      R1,P18LEVEL                                             07880000
        MH      R1,=H'10'                                               07890000
        SR      R15,R15                                                 07900000
        IC      R15,P18NEST                                             07910000
        AR      R1,R15                                                  07920000
        STC     R1,TKNPRTY                                              07930000
*                                                                       07940000
* Unstack:                                                              07950000
*       TUNSTACK();                                                     07960000
*                                                                       07970000
        CALL    TUNSTACK                                                07980000
        LTR     R15,R15                                                 07990000
        BNZ     P18RET4                                                 08000000
*                                                                       08010000
*       if (*TKN != '\0')                                               08020000
*                                                                       08030000
        CLI     TKN,C' '                                                08040000
        BE      GOTNEXT                                                 08050000
*                                                                       08060000
*       {                                                               08070000
*       i = PUSHRATR(TKN, dv_TKN.curr_len);                             08080000
*                                                                       08090000
*       WTO     'Pushing Rator'                                         08100000
*       WTO     TKN,70                                                  08110000
        LA      R1,#TKN                                                 08120000
        CALL    PUSHRATR                                                08130000
        LTR     R15,R15                                                 08140000
        BNZ     P18RET4                                                 08150000
GETNEXT1  DS     0H                                                     08160000
*                                                                       08170000
*       Get_next:                                                       08180000
*       i = gettkn(TKNcurr);                                            08190000
*                                                                       08200000
        GETTKN  TKNCURR                                                 08210000
        STH     R1,TKNCURR                                              08220000
        STH     R1,I                                                    08230000
         CLI   TKN,C'%'                                           J52   08240000
         BNE   NOPC5                                              J52   08250000
         MVC   TKN,TKN+1                                          J52   08260000
         LH    R15,#TKN                                           J52   08270000
         BCTR  R15,0                                              J52   08280000
         STH   R15,#TKN                                           J52   08290000
NOPC5    DS    0H                                                 J52   08300000
*       WTO     'GOT TOKEN'                                             08310000
*       WTO     TKN,20                                                  08320000
GOTNEXT   DS     0H                                                     08330000
TESTWHL   DS     0H                                                     08340000
        CLI     TKN,C' '                                                08350000
        BE      ##18                                                    08360000
        B       STARTWHL                                                08370000
##18  DS     0H                                                         08380000
*                                                                       08390000
*       Got_next:*                                                      08400000
*       }                                                               08410000
*                                                                       08420000
*       if (p18level > 0) {                                             08430000
*                                                                       08440000
        CLC     P18LEVEL,=H'0'                                          08450000
        BNH     #15#3266                                                08460000
*                                                                       08470000
        JOLERR  305,'Too Many ''('''                                    08480000
        JOLRETN RC=4                                                    08490000
#15#3266  DS     0H                                                     08500000
*                                                                       08510000
*       }                                                               08520000
*                                                                       08530000
*       if ((Rator_Cntl != 1)                                           08540000
*       || (RANDCNTL != 2)) {                                           08550000
*                                                                       08560000
        CLC     RATORCNT,=H'1'                                          08570000
        BE      P18TCNTL                                                08580000
        JOLERR  307,'Too Many Operators'                                08590000
P18TCNTL CLC     RANDCNTL,=H'2'                                         08600000
        BE      #15#3386                                                08610000
        JOLERR  306,'Too Many Operands'                                 08620000
*       HALT                                                            08630000
*                                                                       08640000
*       }                                                               08650000
*bad_return:;                                                           08660000
*       return 4;                                                       08670000
*                                                                       08680000
P18RET4   DS     0H                                                     08690000
#15#3362  DS     0H                                                     08700000
        JOLRETN  RC=4                                                   08710000
#15#3386  DS     0H                                                     08720000
*                                                                       08730000
        JOLRETN  RC=0                                                   08740000
        LTORG                                                           08750000
*                                                                       08760000
*                                                                       08770000
*                                                                       08780000
*                                                                       08790000
XX4           DSECT                                                     08800000
         JOLSAVE    CSECT=UJP18GP1                                      08810000
         ORG   UJP18GP1                                           J50   08820000
GETPARM1 EQU        *                                                   08830000
         ENTRY GETPARM1                                           J50   08840000
         ORG                                                            08850000
*                                                                       08860000
* NOTE: On entry, R1 = 1 if a NUMBER needed                             08870000
*                                                                       08880000
        LR      R9,R1              Save the number required indictor    08890000
*                                                                       08900000
*       if (*Parm_StrÝ1¨ == '\'')                                       08910000
*                                                                       08920000
        CLI     PARMST1,C''''                                           08930000
        BNE     NQU1                                                    08940000
*                                                                       08950000
        DROPQUSR  #PARMST1                                              08960000
        JOLRETN   RC=0                                                  08970000
NQU1    DS      0H                                                      08980000
*                                                                       08990000
*  Try for a number.                                                    09000000
*                                                                       09010000
*  We might be trying to get a number for this type of statement:       09020000
*                                                                       09030000
*       no=1;                                                           09040000
*       a=substr(day,no,4);                                             09050000
*                                                                       09060000
*  So, if the parameter 'num' is set, it means that we really           09070000
*   need a number.                                                J50   09080000
*  In this case, if is is numberic, we convert and return.              09090000
*                                                                       09100000
*  If the parameter is a symbolic, we try to find it, and then convert  09110000
*  to a number.                                                         09120000
*                                                                       09130000
*  Clear.  I hope so - to me too!                                       09140000
*                                                                       09150000
*                                                                       09160000
*                                                                       09170000
*  if (isdigit(Parm_StrÝ1¨Ý0¨)  || Parm_StrÝ1¨Ý0¨ == '-')               09180000
*                                                                       09190000
        TNUM    #PARMST1                                                09200000
        LTR     R15,R15                                                 09210000
        BZ      ISNUM1                                                  09220000
*                                                                       09230000
*       getsym(Parm_StrÝ1¨);                                            09240000
*                                                                       09250000
        LA      R1,#PARMST1                                             09260000
        CALL    GETSYM                                                  09270000
        FIX     '#PARMST1'                                              09280000
        MVC     #PARMST1(L'PARMST1),#OP                                 09290000
*  if (isdigit(Parm_StrÝ1¨Ý0¨)  || Parm_StrÝ1¨Ý0¨ == '-')               09300000
        TNUM    #PARMST1                                                09310000
        LTR     R15,R15                                                 09320000
        BZ      ISNUM1                                                  09330000
        LTR     R9,R9        Is a NUMBER PARAMETER NEEDED ?             09340000
        BZ      ISNUM1                                                  09350000
   JOLERR  337,'Characters Found Instead of NUMBERs in Expression'      09360000
        JOLRETN RC=0                                                    09370000
*                                                                       09380000
ISNUM1  DS      0H                                                      09390000
*                                                                       09400000
        ST      R1,CONVTNUM                                             09410000
        ST      R1,PARMBIN1                                             09420000
        JOLRETN RC=0                                                    09430000
        LTORG                                                           09440000
*                                                                       09450000
*       void         get_parm2(int num)                                 09460000
*                                                                       09470000
*                                                                       09480000
XX5           DSECT                                                     09490000
         JOLSAVE    CSECT=UJP18GP2                                      09500000
         ORG   UJP18GP2                                           J50   09510000
GETPARM2 EQU        *                                                   09520000
         ENTRY GETPARM2                                           J50   09530000
         ORG                                                            09540000
*                                                                       09550000
* NOTE: On entry, R1 = 1 if a NUMBER needed                             09560000
*                                                                       09570000
        LR      R9,R1              Save the number required indictor    09580000
*                                                                       09590000
*void         get_parm2(int num)   /* Function Get Function Parameter 2 09600000
*{  char *conv_code;                                                    09610000
*  long      converted_num;                                             09620000
*  char     *errpos;                                                    09630000
*  int       i;                                                         09640000
*                                                                       09650000
*   if (*Parm_StrÝ2¨ == '\'')                                           09660000
*   {                                                                   09670000
*       dropquotes(Parm_StrÝ2¨);                                        09680000
*       return ;                                                        09690000
*   }                                                                   09700000
*                                                                       09710000
*  Try for a number.                                                    09720000
*                                                                       09730000
*  We might be trying to get a number for this type of statement:       09740000
*                                                                       09750000
*       no=2;                                                           09760000
*       a=substr(day,no,4);                                             09770000
*                                                                       09780000
*  So, if the parameter "num" is set, it means that we really need a no 09790000
*  In this case, if is is numberic, we convert and return.              09800000
*                                                                       09810000
*  If the parameter is a symbolic, we try to find ir, and then convert  09820000
*  to a number.                                                         09830000
*                                                                       09840000
*  Clear.  I hope so - to me too!                                       09850000
*                                                                       09860000
*/                                                                      09870000
*                                                                       09880000
*  if (isdigit(Parm_StrÝ2¨Ý0¨)  || Parm_StrÝ2¨Ý0¨ == '-')               09890000
*      goto isnum;                                                      09900000
*                                                                       09910000
** Not a number, so get the symbolic. */                                09920000
*                                                                       09930000
*  getsym(Parm_StrÝ2¨);                                                 09940000
*  cpy(Parm_StrÝ2¨ , op);                                               09950000
*                                                                       09960000
*  if (isdigit(Parm_StrÝ2¨Ý0¨)  || Parm_StrÝ2¨Ý0¨ == '-')               09970000
*      goto isnum;                                                      09980000
*                                                                       09990000
*  if (num !=0)                                                         10000000
*  {   conv_err();                                                      10010000
*      return;                                                          10020000
*  }                                                                    10030000
*                                                                       10040000
*isnum:                                                                 10050000
*  converted_num=strtol(Parm_StrÝ2¨, &errpos,10);                       10060000
*  if (*errpos == NULL)                              /*  numeric  */    10070000
*  {                                                                    10080000
*     Parm_BinÝ2¨=converted_num;                                        10090000
*     return;                                                           10100000
*  }                                                                    10110000
*                                                                       10120000
** Not numeric, and maybe it should be.  */                             10130000
*                                                                       10140000
*  if (num!=0)                                                          10150000
*  {                                                                    10160000
*      conv_err();                                                      10170000
*      Parm_BinÝ2¨=0;                                                   10180000
*  }                                                                    10190000
*                                                                       10200000
* /* not lit, or number, so get the value of the symbolic */            10210000
*}                                                                      10220000
*                                                                       10230000
        CLI     PARMST2,C''''                                           10240000
        BNE     NQU2                                                    10250000
        DROPQUSR #PARMST2                                               10260000
        JOLRETN  RC=0                                                   10270000
NQU2    DS     0H                                                       10280000
        TNUM    #PARMST2                                                10290000
        LTR     R15,R15                                                 10300000
        BZ      ISNUM2                                                  10310000
        LA      R1,#PARMST2                                             10320000
        CALL    GETSYM                                                  10330000
        FIX 'GETSYM   #PARMST2'                                         10340000
MAXL@OP DS   0H                                                         10350000
        MVC     #PARMST2(L'PARMST2),#OP                                 10360000
        TNUM    #PARMST2                                                10370000
        LTR     R15,R15                                                 10380000
        BZ      ISNUM2                                                  10390000
#5#266  DS      0H                                                      10400000
        LTR     R9,R9        Is a NUMBER PARAMETER NEEDED ?             10410000
        BZ      ISNUM2                                                  10420000
NOTNUM2 DS      0H                                                      10430000
   JOLERR  318,'Characters Found Instead of NUMBERs in Expression'      10440000
        SR      R1,R1                                                   10450000
        ST      R1,PARMBIN2                                             10460000
        JOLRETN RC=4                                                    10470000
ISNUM2  DS      0H                                                      10480000
        ST      R1,PARMBIN2                                             10490000
        JOLRETN  RC=0                                                   10500000
#5#362  DS      0H                                                      10510000
*                                                                       10520000
*       }                                                               10530000
*       if (num!=0)                                                     10540000
*                                                                       10550000
        LTR     R9,R9        Is a NUMBER PARAMETER NEEDED ?             10560000
        BNZ     NOTNUM2                                                 10570000
        SR      R1,R1                                                   10580000
        ST      R1,PARMBIN2                                             10590000
        JOLRETN RC=0                                                    10600000
        LTORG                                                           10610000
*                                                                       10620000
*                                                                       10630000
*       void         get_parm3(int num)                                 10640000
*                                                                       10650000
* new, done on mainframe, oct 29, 1991                            J51   10660000
* copy of getparm2                                              J51     10670000
*                                                                       10680000
         JOLSAVE    CSECT=UJP18GP3                                      10690000
         ORG   UJP18GP3                                           J50   10700000
GETPARM3 EQU        *                                                   10710000
         ENTRY GETPARM3                                           J50   10720000
         ORG                                                            10730000
*                                                                       10740000
* NOTE: On entry, R1 = 1 if a NUMBER needed                             10750000
*                                                                       10760000
        LR      R9,R1              Save the number required indictor    10770000
*                                                                       10780000
*void         get_parm3(int num)   /* Function Get Function Parameter 3 10790000
*{  char *conv_code;                                                    10800000
*  long      converted_num;                                             10810000
*  char     *errpos;                                                    10820000
*  int       i;                                                         10830000
*                                                                       10840000
*   if (*Parm_StrÝ3¨ == '\'')                                           10850000
*   {                                                                   10860000
*       dropquotes(Parm_StrÝ3¨);                                        10870000
*       return ;                                                        10880000
*   }                                                                   10890000
*                                                                       10900000
*  Try for a number.                                                    10910000
*                                                                       10920000
*  We might be trying to get a number for this type of statement:       10930000
*                                                                       10940000
*       no=2;                                                           10950000
*       a=substr(day,no,4);                                             10960000
*                                                                       10970000
*  So, if the parameter "num" is set, it means that we really need a no 10980000
*  In this case, if is is numberic, we convert and return.              10990000
*                                                                       11000000
*  If the parameter is a symbolic, we try to find ir, and then convert  11010000
*  to a number.                                                         11020000
*                                                                       11030000
*  Clear.  I hope so - to me too!                                       11040000
*                                                                       11050000
*/                                                                      11060000
*                                                                       11070000
*  if (isdigit(Parm_StrÝ3¨Ý0¨)  || Parm_StrÝ3¨Ý0¨ == '-')               11080000
*      goto isnum;                                                      11090000
*                                                                       11100000
** Not a number, so get the symbolic. */                                11110000
*                                                                       11120000
*  getsym(Parm_StrÝ3¨);                                                 11130000
*  cpy(Parm_StrÝ3¨ , op);                                               11140000
*                                                                       11150000
*  if (isdigit(Parm_StrÝ3¨Ý0¨)  || Parm_StrÝ3¨Ý0¨ == '-')               11160000
*      goto isnum;                                                      11170000
*                                                                       11180000
*  if (num !=0)                                                         11190000
*  {   conv_err();                                                      11200000
*      return;                                                          11210000
*  }                                                                    11220000
*                                                                       11230000
*isnum:                                                                 11240000
*  converted_num=strtol(Parm_StrÝ3¨, &errpos,10);                       11250000
*  if (*errpos == NULL)                              /*  numeric  */    11260000
*  {                                                                    11270000
*     Parm_BinÝ3¨=converted_num;                                        11280000
*     return;                                                           11290000
*  }                                                                    11300000
*                                                                       11310000
** Not numeric, and maybe it should be.  */                             11320000
*                                                                       11330000
*  if (num!=0)                                                          11340000
*  {                                                                    11350000
*      conv_err();                                                      11360000
*      Parm_BinÝ3¨=0;                                                   11370000
*  }                                                                    11380000
*                                                                       11390000
* /* not lit, or number, so get the value of the symbolic */            11400000
*}                                                                      11410000
*                                                                       11420000
        CLI     PARMST3,C''''                                           11430000
        BNE     NQU3                                                    11440000
        DROPQUSR #PARMST3                                               11450000
        JOLRETN  RC=0                                                   11460000
NQU3    DS     0H                                                       11470000
        TNUM    #PARMST3                                                11480000
        LTR     R15,R15                                                 11490000
        BZ      ISNUM3                                                  11500000
        LA      R1,#PARMST3                                             11510000
        CALL    GETSYM                                                  11520000
        FIX 'GETSYM   #PARMST3'                                         11530000
        MVC     #PARMST3(L'PARMST3),#OP                                 11540000
        TNUM    #PARMST3                                                11550000
        LTR     R15,R15                                                 11560000
        BZ      ISNUM3                                                  11570000
*#5#366  DS     0H                                                      11580000
        LTR     R9,R9        Is a NUMBER PARAMETER NEEDED ?             11590000
        BZ      ISNUM3                                                  11600000
NOTNUM3 DS      0H                                                      11610000
   JOLERR  355,'Characters Found Instead of NUMBERs in Expression'      11620000
        SR      R1,R1                                                   11630000
        ST      R1,PARMBIN3                                             11640000
        JOLRETN RC=4                                                    11650000
ISNUM3  DS      0H                                                      11660000
        ST      R1,PARMBIN3                                             11670000
        JOLRETN  RC=0                                                   11680000
#5#363  DS      0H                                                      11690000
*                                                                       11700000
*       }                                                               11710000
*       if (num!=0)                                                     11720000
*                                                                       11730000
        LTR     R9,R9        Is a NUMBER PARAMETER NEEDED ?             11740000
        BNZ     NOTNUM3                                                 11750000
        SR      R1,R1                                                   11760000
        ST      R1,PARMBIN3                                             11770000
        JOLRETN RC=0                                                    11780000
        LTORG                                                           11790000
*                                                                       11800000
*                                                                       11810000
*       void         PushRand(char *str, int len_str, char strtype)     11820000
*                                                                       11830000
*86   1   0 PUSHRAND:PROC (STRING,TYPE);                                11840000
*                                                                       11850000
*87   2   0 DCL STRING                   CHAR(253) VAR;                 11860000
*88   2   0 DCL TYPE                     BIN FIXED(7);                  11870000
*                                                                       11880000
*                                                                       11890000
*                                                                       11900000
*                                                                       11910000
PUSHRPRM DSECT                                                          11920000
RSTRADDR DS    A                                                        11930000
RSTRLEN  DS    H                                                        11940000
RSTRTYPE DS    C                                                        11950000
XX6           DSECT                                                     11960000
         JOLSAVE    CSECT=UJP18PSR                                      11970000
         ORG   UJP18PSR                                           J50   11980000
PUSHRAND EQU        *                                                   11990000
         ENTRY PUSHRAND                                           J50   12000000
         ORG                                                            12010000
*                                                                       12020000
* R1 points to the string address, R0 contains the type                 12030000
*                                                                       12040000
         LR      R9,R1                                                  12050000
         LR      R10,R0                                                 12060000
*        USING   PUSHRPRM,R9                                            12070000
*       {                                                               12080000
*       static int temp_len;                                            12090000
*                                                                       12100000
*       if (RANDCNTL > 10)                                              12110000
*                                                                       12120000
        CLC     RANDCNTL,=H'10'                                         12130000
        BL      #6#98                                                   12140000
        JOLERR  309,'Too Many Operands - PushRand'                      12150000
        JOLRETN 4                                                       12160000
        B       #6#170                                                  12170000
#6#98   DS      0H                                                      12180000
*       else {                                                          12190000
*       RANDCNTL = RANDCNTL + 1;                                        12200000
*                                                                       12210000
        LH      R1,RANDCNTL                                             12220000
        LA      R1,1(R1)                                                12230000
        STH     R1,RANDCNTL                                             12240000
*       temp_len = len_str;                                             12250000
        LH      R15,0(R9)       Get string length                       12260000
*                                                                       12270000
*       if (temp_len  >         dv_Rand Ý1¨.max_len)                    12280000
*                                                                       12290000
        CH      R15,=AL2(L'RAND+2)                                      12300000
        BL      #6#146                                                  12310000
*                                                                       12320000
*       temp_len  =     dv_Rand Ý1¨.max_len-1;                          12330000
*                                                                       12340000
        LA      R15,L'RAND                                              12350000
#6#146  DS      0H                                                      12360000
*                                                                       12370000
*                                                                       12380000
*       memcpy(dv_Rand ÝRANDCNTL¨.str_addr ,str,temp_len+1);            12390000
*                                                                       12400000
*94   2   0     RAND(RAND_CNTL)=STRING;                                 12410000
         LH     R8,RANDCNTL                                             12420000
         MH     R8,=AL2(L'RAND+2)                                       12430000
         LA     R8,#RAND(R8)              Address the right whole       12440000
         STH    R15,0(R8)                 Save length                   12450000
         MVC    2(L'RAND,R8),2(R9)        Shift the string              12460000
*                                                                       12470000
*95   2   0     RAND_TYPE(RAND_CNTL)=TYPE;                              12480000
*       Rand_TypeÝRANDCNTL¨ = strtype;                                  12490000
*                                                                       12500000
         LH     R1,RANDCNTL                                             12510000
         LA     R1,RANDTYPE(R1)                                         12520000
*        IC     R14,RSTRTYPE                                            12530000
         STC    R10,0(R1)                                               12540000
*                                                                       12550000
*       dv_Rand ÝRANDCNTL¨.curr_len =temp_len;                          12560000
*                                                                       12570000
#6#170   DS     0H                                                      12580000
*                                                                       12590000
*                                                                       12600000
        JOLRETN RC=0                                                    12610000
        LTORG                                                           12620000
*       }                                                               12630000
*                                                                       12640000
*                                                                       12650000
*                                                                       12660000
*       int          PopRand1(void)                                     12670000
*                                                                       12680000
XX7           DSECT                                                     12690000
*        JOLSAVE  CSECT=POPRAND1                                        12700000
         JOLSAVE    CSECT=UJP18PO1                                      12710000
         ORG   UJP18PO1                                           J50   12720000
POPRAND1 EQU        *                                                   12730000
         ENTRY POPRAND1                                           J50   12740000
         ORG                                                            12750000
*                                                                       12760000
*        WTO     'POPRAND1 Entered'                                     12770000
*       {                                                               12780000
*                                                                       12790000
*       if (RANDCNTL < 1) {                                             12800000
*                                                                       12810000
        CLC     RANDCNTL,=H'1'                                          12820000
        BNL     #7#122                                                  12830000
*                                                                       12840000
*                                                                       12850000
        JOLERR  310,'Too Few Operands - PopRand1'                       12860000
        JOLRETN RC=4                                                    12870000
*                                                                       12880000
*       else {                                                          12890000
*       {                                                               12900000
*                                                                       12910000
*103   2   1         OP1=RAND(RAND_CNTL);                               12920000
#7#122   DS     0H                                                      12930000
         LH     R1,RANDCNTL                                             12940000
         MH     R1,=AL2(L'RAND+2)                                       12950000
         LA     R15,#RAND(R1)               Get address of right hole   12960000
         MVC    #OP1(L'OP1+2),0(R15)                                    12970000
*                                                                       12980000
*                                                                       12990000
*104   2   1         OP1TYPE=RAND_TYPE(RAND_CNTL);                      13000000
*       op1type = Rand_TypeÝRANDCNTL¨;                                  13010000
         LH     15,RANDCNTL                                             13020000
         IC     10,RANDTYPE(15)                                         13030000
         STC    10,OP1TYPE                                              13040000
*                                                                       13050000
*                                                                       13060000
*105   2   1         RAND_CNTL=RAND_CNTL-1;                             13070000
         SH     R15,=H'1'                                               13080000
         STH    R15,RANDCNTL                                            13090000
*                                                                       13100000
*                                                                       13110000
*       WTO     'POPPED'                                                13120000
*       WTO      OP1,79                                                 13130000
        JOLRETN RC=0                                                    13140000
        LTORG                                                           13150000
*                                                                       13160000
*                                                                       13170000
XX8           DSECT                                                     13180000
*        JOLSAVE  CSECT=POPRAND2                                        13190000
         JOLSAVE    CSECT=UJP18PO2                                      13200000
         ORG   UJP18PO2                                           J50   13210000
POPRAND2 EQU        *                                                   13220000
         ENTRY POPRAND2                                           J50   13230000
         ORG                                                            13240000
*                                                                       13250000
*       {                                                               13260000
*        WTO     'POPRAND2 Entered'                                     13270000
*                                                                       13280000
*       if (RANDCNTL < 1) {                                             13290000
*                                                                       13300000
        CLC     RANDCNTL,=H'1'                                          13310000
        BNL     #8#122                                                  13320000
*                                                                       13330000
*                                                                       13340000
        JOLERR  311,'Too Few Operands - PopRand2'                       13350000
        JOLRETN RC=4                                                    13360000
*                                                                       13370000
#8#122  DS      0H                                                      13380000
*                                                                       13390000
*                                                                       13400000
*       else {                                                          13410000
*       {                                                               13420000
*                                                                       13430000
*                OP2=RAND(RAND_CNTL);                                   13440000
         LH     R1,RANDCNTL                                             13450000
         MH     R1,=AL2(L'RAND+2)                                       13460000
         LA     R15,#RAND(R1)               Get address of right hole   13470000
         MVC    #OP2(L'OP2+2),0(R15)                                    13480000
*                                                                       13490000
*                                                                       13500000
*                 OP2TYPE=RANDTYPE(RAND_CNTL);                          13510000
*       op2type = Rand_TypeÝRANDCNTL¨;                                  13520000
         LH     15,RANDCNTL                                             13530000
         IC     10,RANDTYPE(15)                                         13540000
         STC    10,OP2TYPE                                              13550000
*                                                                       13560000
*                                                                       13570000
*105   2   1         RAND_CNTL=RAND_CNTL-1;                             13580000
         SH     R15,=H'1'                                               13590000
         STH    R15,RANDCNTL                                            13600000
*                                                                       13610000
*                                                                       13620000
*       WTO     'POPPED'                                                13630000
*       WTO      OP2,79                                                 13640000
        JOLRETN RC=0                                                    13650000
        LTORG                                                           13660000
*                                                                       13670000
*                                                                       13680000
*                                                                       13690000
*       int          PUSHRATR(char *str, int len_str)                   13700000
*                                                                       13710000
* PROCEDURE  PUSHRATR                                                   13720000
PUSHTPRM DSECT                                                          13730000
TSTRADDR DS    A                                                        13740000
TSTRLEN  DS    H                                                        13750000
XX9           DSECT                                                     13760000
*          JOLSAVE CSECT=PUSHRATR                                       13770000
         JOLSAVE    CSECT=UJP18PTR                                      13780000
         ORG   UJP18PTR                                           J50   13790000
PUSHRATR EQU        *                                                   13800000
         ENTRY PUSHRATR                                           J50   13810000
         ORG                                                            13820000
         LR      R9,R1                                                  13830000
*        USING   PUSHTPRM,R9                                            13840000
*        WTO     'PUSH RATOR Entered'                                   13850000
*                                                                       13860000
*121   2   0     IF RATOR_CNTL>PARSE_depth                              13870000
*               THEN DO;                                                13880000
         LH     R14,RATORCNT                                            13890000
         CH     R14,PARSEDEP                                            13900000
         BNH    #9#122                                                  13910000
         JOLERR 312,'Too Many Operators'                                13920000
         JOLRETN RC=4                                                   13930000
#9#122   DS     0H                                                      13940000
*                                                                       13950000
*       else {                                                          13960000
*       Rator_Cntl = Rator_Cntl + 1;                                    13970000
*                                                                       13980000
        LA      R14,1(R14)                                              13990000
        STH     R14,RATORCNT                                            14000000
*                                                                       14010000
*       temp_len = len_str;                                             14020000
*                                                                       14030000
*126   2   0     RATOR(RATOR_CNTL)=STRING;                              14040000
         LH     R5,RATORCNT                                             14050000
         MH     R5,=AL2(L'RATOR+2)                                      14060000
*        STH    R15,#RATOR(R5)                                          14070000
         LA     R8,#RATOR(R5)                                           14080000
         MVC    0(L'RATOR,R8),0(R9)   TSTRADDR                          14090000
*                                                                       14100000
*127   2   0     RATOR_PRTY(RATOR_CNTL)=TKN_PRTY;                       14110000
*                                                                       14120000
*       Rator_PrtyÝRator_Cntl¨ = TKN_prty;                              14130000
*                                                                       14140000
         LH     R5,RATORCNT                                             14150000
         IC     R1,TKNPRTY                                              14160000
         STC    R1,RATORPRT(R5)                                         14170000
*                                                                       14180000
         JOLRETN RC=0                                                   14190000
        LTORG                                                           14200000
*                                                                       14210000
*                                                                       14220000
*       int          PopRator(void)                                     14230000
*                                                                       14240000
XX10          DSECT                                                     14250000
*         JOLSAVE CSECT=POPRATOR                                        14260000
         JOLSAVE    CSECT=UJP18POR                                      14270000
         ORG   UJP18POR                                           J50   14280000
POPRATOR EQU        *                                                   14290000
         ENTRY POPRATOR                                           J50   14300000
         ORG                                                            14310000
*                                                                       14320000
*       if (Rator_Cntl < 1) {                                           14330000
*130   2   0     IF RATORCNT<1                                          14340000
*                THEN DO;                                               14350000
*        WTO     'POPRATOR Entered'                                     14360000
         LH     9,RATORCNT                                              14370000
         CH     9,=H'0'                                                 14380000
         BNL    #10#122                                                 14390000
         JOLERR 313,'Too Few Operators- PopRator'                       14400000
         JOLRETN RC=4                                                   14410000
*134   2   0     ELSE DO;                                               14420000
*135   2   1         OPR=RATOR(RATOR_CNTL);                             14430000
#10#122  DS     0H                                                      14440000
         LH     R1,RATORCNT                                             14450000
         MH     R1,=AL2(L'RATOR+2)                                      14460000
         LA     R9,#RATOR(R1)                                           14470000
         MVC    #OPR(L'OPR),0(R9)                                       14480000
*136   2   1         RATOR_CNTL=RATOR_CNTL-1;                           14490000
*       Rator_Cntl = Rator_Cntl - 1;                                    14500000
         LH     15,RATORCNT                                             14510000
         SH     15,=H'1'                                                14520000
         STH    15,RATORCNT                                             14530000
*       WTO     'POPPED OPR:'                                           14540000
*       WTO      OPR,79                                                 14550000
         JOLRETN RC=0                                                   14560000
        LTORG                                                           14570000
*                                                                       14580000
*                                                                       14590000
XX11          DSECT                                                     14600000
*        JOLSAVE CSECT=TUNSTACK                                         14610000
         JOLSAVE    CSECT=UJP18UNS                                      14620000
         ORG   UJP18UNS                                           J50   14630000
TUNSTACK EQU        *                                                   14640000
         ENTRY TUNSTACK                                           J50   14650000
         ORG                                                            14660000
*        WTO     'TUNSTACK Entered'                                     14670000
*                                                                       14680000
*                                                                       14690000
*Unstack :                                                              14700000
*      if ((*RatorÝRator_Cntl¨ == ',')       /* Last one on stack par   14710000
*      || (*RatorÝRator_Cntl¨ == '('))       /* or function start ?     14720000
*         ;                                                             14730000
*      else                                                             14740000
*      {                                                                14750000
*         if ((Rator_Cntl != 1)                                         14760000
*         && (Rator_PrtyÝRator_Cntl¨ >= Tkn_prty))                      14770000
*         {                                                             14780000
*Pop:                                                                   14790000
*           if (PopRator() != 0) goto error;                            14800000
*           if (PopRand2() != 0) goto error;                            14810000
*           if (PopRand1() != 0) goto error;                            14820000
*                                                                       14830000
*           Add_triple();                                               14840000
*                                                                       14850000
*/* if generating code  call PushRand('#'+ascii(Tnumber+48),20); */     14860000
*                                                                       14870000
*           goto Unstack;                                               14880000
*        }                                                              14890000
*     }                                                                 14900000
*     goto ok;                                                          14910000
*error:                                                                 14920000
*      puts("\nError\n");                                               14930000
*                                                                       14940000
*ok:;                                                                   14950000
* }                                                                     14960000
*                                                                       14970000
P18UNST9 DS     0H                                                      14980000
*       Unstack :                                                       14990000
*       if ((*RatorÝRator_Cntl¨ == ',')                                 15000000
*       || (*RatorÝRator_Cntl¨ == '('))                                 15010000
*         ;                                                             15020000
*                                                                       15030000
        LH      R15,RATORCNT                                            15040000
        LR      R1,R15                                                  15050000
        MH      R1,=AL2(L'RATOR+2)                                      15060000
        LA      R14,RATOR(R1)                                           15070000
        CLI     0(R14),C','                                             15080000
        BE      P18UNRET                                                15090000
        CLI     0(R14),C'('                                             15100000
        BE      P18UNRET                                                15110000
*                                                                       15120000
*       else                                                            15130000
*       {                                                               15140000
*       if ((Rator_Cntl != 1)                                           15150000
*       && (Rator_PrtyÝRator_Cntl¨ >= TKN_prty))                        15160000
***     && (TKNPRTY < Rator_PrtyÝRator_Cntl¨))                          15170000
*                                                                       15180000
        LH      R15,RATORCNT       reload not needed!                   15190000
        CH      R15,=H'1'                                               15200000
        BE      P18UNRET                                                15210000
        LR      R1,R15             Rator_Cntl                           15220000
*       SLL     R1,1                                                    15230000
        SR      R14,R14                                                 15240000
        SR      R15,R15                                                 15250000
        IC      R14,RATORPRT(R1)                                        15260000
        IC      R15,TKNPRTY                                             15270000
        CR      R15,R14             Compare TKNPRTY with RATORPRTY      15280000
        BH      P18UNRET                                                15290000
*                                                                       15300000
*       {                                                               15310000
*       Pop:                                                            15320000
*       if (PopRator() != 0) goto error;                                15330000
*                                                                       15340000
        CALL    POPRATOR                                                15350000
        LTR     R15,R15                                                 15360000
        BNZ     P18UNERR                                                15370000
*                                                                       15380000
*       if (PopRand2() != 0) goto error;                                15390000
*                                                                       15400000
        CALL    POPRAND2                                                15410000
        LTR     R15,R15                                                 15420000
        BNZ     P18UNERR                                                15430000
*                                                                       15440000
*       if (PopRand1() != 0) goto error;                                15450000
*                                                                       15460000
        CALL    POPRAND1                                                15470000
        LTR     R15,R15                                                 15480000
        BNZ     P18UNERR                                                15490000
*                                                                       15500000
*                                                                       15510000
*       Add_triple();                                                   15520000
*                                                                       15530000
        CALL    ADDTRIPL                                                15540000
*                                                                       15550000
        B       P18UNST9                                                15560000
*       goto Unstack;                                                   15570000
*                                                                       15580000
*       }                                                               15590000
*       }                                                               15600000
*       goto ok;                                                        15610000
*                                                                       15620000
        B       P18UNRET                                                15630000
P18UNERR DS     0H                                                      15640000
*                                                                       15650000
*       error:                                                          15660000
*       puts('\nError\n');                                              15670000
*                                                                       15680000
        JOLERR  314,'ERROR'                                             15690000
P18UNRET DS    0H                                                       15700000
*                                                                       15710000
*       ok:;                                                            15720000
*       }                                                               15730000
*                                                                       15740000
        JOLRETN RC=0                                                    15750000
        LTORG                                                           15760000
*                                                                       15770000
*                                                                       15780000
*       int          Add_triple()                                       15790000
*                                                                       15800000
XX12          DSECT                                                     15810000
*        JOLSAVE   CSECT=ADDTRIPL                                       15820000
         JOLSAVE    CSECT=UJP18AD3                                      15830000
         ORG   UJP18AD3                                           J50   15840000
ADDTRIPL EQU        *                                                   15850000
         ENTRY ADDTRIPL                                           J50   15860000
         ORG                                                            15870000
*                                                                       15880000
*        WTO     'ADDTRIPL Entered'                                     15890000
*                                                                       15900000
*int          Add_triple()                          /* Function */      15910000
*{                                                                      15920000
*      if (EvaluateTable() == 4)                                        15930000
*          return 4;                                                    15940000
*      Tkntype = op1type;                                               15950000
* /*   put skip edit ('Evalated to ',op,' Type=',op1type)(a);           15960000
*      put skip edit ('opr=',opr)(A); */                                15970000
*                                                                       15980000
*      if (*opr == ',')                                                 15990000
*          ;                                                            16000000
*      else                                                             16010000
*      PushRand(op, length(op), op1type);                               16020000
*      return 0;                                                        16030000
*}                                                                      16040000
*                                                                       16050000
*       if (EvaluateTable() == 4)                                       16060000
*                                                                       16070000
        CALL    EVALTABL                                                16080000
        LTR     R15,R15                                                 16090000
        BZ      #12#74                                                  16100000
        JOLRETN RC=4                                                    16110000
#12#74  DS     0H                                                       16120000
*                                                                       16130000
*       TKNtype = op1type;                                              16140000
*                                                                       16150000
        MVC     TKNTYPE,OP1TYPE                                         16160000
*                                                                       16170000
*       if (*opr == ',')                                                16180000
*                                                                       16190000
        CLI     OPR,C','                                                16200000
        BNE     #12#122                                                 16210000
        B       #12#146                                                 16220000
#12#122  DS     0H                                                      16230000
*                                                                       16240000
*       else                                                            16250000
*       PushRand(op, dv_op.curr_len, op1type);                          16260000
*                                                                       16270000
        LA      R1,#OP                                                  16280000
        IC      R0,OP1TYPE                                              16290000
        CALL    PUSHRAND                                                16300000
#12#146  DS     0H                                                      16310000
        JOLRETN RC=0                                                    16320000
        LTORG                                                           16330000
*                                                                       16340000
*                                                                       16350000
*       srch_func_tab()                                                 16360000
XX13          DSECT                                                     16370000
*        JOLSAVE CSECT=SRCHFUNC                                         16380000
         JOLSAVE    CSECT=UJP18FUN                                      16390000
         ORG   UJP18FUN                                           J50   16400000
SRCHFUNC EQU        *                                                   16410000
         ENTRY SRCHFUNC                                           J50   16420000
         ORG                                                            16430000
*                                                                       16440000
*        WTO     'SRCHFUNC Entered'                                     16450000
TOOHIIND EQU     R9                                                     16460000
*                                                                       16470000
*       {                                                               16480000
*       static char    toohighind;                                      16490000
*                                                                       16500000
*       static int             r5, r6;                                  16510000
*                                                                       16520000
*       static char    *r4;                                             16530000
*       static char    *r8;                                             16540000
*       static int           memcmp_result;                             16550000
*                                                                       16560000
*       fnswi=0;                                                        16570000
*                                                                       16580000
*       CLEAR   FNRTNADR                                                16590000
        MVC     FNRTNADR,=F'0'                                          16600000
*                                                                       16610000
*       fnparms=0;                                                      16620000
*                                                                       16630000
*       CLEAR   FNPARMS                                                 16640000
        MVC     FNPARMS,=F'0'                                           16650000
        L       R10,=A(FUNCTBL)                                         16660000
        USING   FUNCTBL,R10                                             16670000
*                                                                       16680000
*       r5=  FTABCNT;                                                   16690000
*                                                                       16700000
        LH      R5,FTABCNT                                              16710000
*                                                                       16720000
*       if (r5 < 64)                                                    16730000
*                                                                       16740000
        CH      R5,=H'64'                                               16750000
        BNL     #13#74                                                  16760000
*                                                                       16770000
*       r5=64;                                                          16780000
*                                                                       16790000
        LA      R5,64                                                   16800000
        B       #13#122                                                 16810000
#13#74  DS     0H                                                       16820000
*                                                                       16830000
*       else if (r5 < 128)                                              16840000
*                                                                       16850000
        CH      R5,=H'128'                                              16860000
        BNL     #13#122                                                 16870000
*                                                                       16880000
*       r5 = 128;                                                       16890000
*                                                                       16900000
        LA      R5,128                                                  16910000
#13#122  DS     0H                                                      16920000
*                                                                       16930000
*                                                                       16940000
*       r5 = r5 >> 1;                                                   16950000
*                                                                       16960000
        SRA     R5,1                                                    16970000
*                                                                       16980000
*       r6 = r5;                                                        16990000
*                                                                       17000000
        LR      R6,R5                                                   17010000
*                                                                       17020000
*       r8=func_tableÝFTABCNT-1¨.func_name     ;                        17030000
*                                                                       17040000
*       LH      R1,FTABCNT                                              17050000
*       SH      R1,=H'1'                                                17060000
*       MH      R1,FTABLEN                                              17070000
*       LA      R8,FUNCTBL(R1)                                          17080000
#13#146  DS     0H                                                      17090000
*                                                                       17100000
*       loop:                                                           17110000
*       r6 = r6 >> 1;                                                   17120000
*                                                                       17130000
        SRA     R6,1                                                    17140000
*                                                                       17150000
*       r4=func_tableÝr5-1¨.func_name;                                  17160000
*                                                                       17170000
        LR      R15,R5                                                  17180000
        SH      R15,=H'1'                                               17190000
        MH      R15,FTABLEN                                             17200000
        LA      R4,FUNCTBL(R15)                                         17210000
*                                                                       17220000
*       if (r5 >= FTABCNT)                                              17230000
*           goto toohigh;                                               17240000
*                                                                       17250000
        CH      R5,FTABCNT                                              17260000
        BNL     TOOHIGH                                                 17270000
*                                                                       17280000
*       if (r4 > r8) goto toohigh;                                      17290000
*                                                                       17300000
        C       R4,FTABEND                                              17310000
        BH      TOOHIGH                                                 17320000
*                                                                       17330000
*       memcmp_result =memcmp(r4, op1,dv_op1.curr_len);                 17340000
*                                                                       17350000
        CLC     0(8,R4),OP1                                             17360000
        BE      FOUND                                                   17370000
        BH      TOOHIGH                                                 17380000
*                                                                       17390000
TOOLOW   DS     0H                                                      17400000
*                                                                       17410000
*       toolow:                                                         17420000
*       toohighind = 0;                                                 17430000
*                                                                       17440000
        SR      TOOHIIND,TOOHIIND                                       17450000
*                                                                       17460000
*       r5 = r5 + r6;                                                   17470000
*                                                                       17480000
        AR      R5,R6                                                   17490000
*                                                                       17500000
*       goto testend;                                                   17510000
*                                                                       17520000
        B       TESTEND                                                 17530000
TOOHIGH  DS     0H                                                      17540000
*                                                                       17550000
*       toohigh:                                                        17560000
*       toohighind = 1;                                                 17570000
*                                                                       17580000
        LA      TOOHIIND,1                                              17590000
*                                                                       17600000
*       r5 = r5 - r6;                                                   17610000
*                                                                       17620000
        SR      R5,R6                                                   17630000
*                                                                       17640000
TESTEND  DS     0H                                                      17650000
*                                                                       17660000
        LTR     R6,R6                                                   17670000
        BE      #13#434                                                 17680000
        B       #13#146                                                 17690000
#13#434  DS     0H                                                      17700000
*                                                                       17710000
*notfound:                                                              17720000
*       if (toohighind) r5 = r5 - 1;                                    17730000
*                                                                       17740000
        CH      TOOHIIND,=H'0'                                          17750000
        BE      #13#482                                                 17760000
        SH      R5,=H'1'                                                17770000
#13#482  DS     0H                                                      17780000
*                                                                       17790000
*       r5 = r5 + 1;                                                    17800000
*                                                                       17810000
        LA      R5,1(R5)                                                17820000
*                                                                       17830000
*       return 4;                                                       17840000
*                                                                       17850000
        JOLRETN RC=4                                                    17860000
#13#506  DS     0H                                                      17870000
*                                                                       17880000
FOUND   DS      0H                                                      17890000
*       fnswi   =func_tableÝr5-1¨.switch_number;                        17900000
*                                                                       17910000
        LR      R15,R5                                                  17920000
        SH      R15,=H'1'                                               17930000
        MH      R15,FTABLEN                                             17940000
        L       R4,FUNCADR(R15)      Get Address of routine             17950000
        ST      R4,FNRTNADR                                             17960000
*                                                                       17970000
*       fnparms=func_tableÝr5-1¨.number_of_parms;                       17980000
*                                                                       17990000
        L       R4,FUNCNOP(R15)      Get number of parameters           18000000
        STH     R4,FNPARMS                                              18010000
        JOLRETN RC=0                                                    18020000
        LTORG                                                           18030000
        DROP    R10                                                     18040000
*                                                                       18050000
*       int          EvaluateTable()                                    18060000
XX14          DSECT                                                     18070000
*        JOLSAVE CSECT=EVALTABL,BASE=(R11,R12)                          18080000
         JOLSAVE    CSECT=UJP18EVL,BASE=(R11,R12)                       18090000
         ORG   UJP18EVL                                           J50   18100000
EVALTABL EQU        *                                                   18110000
         ENTRY EVALTABL                                           J50   18120000
         ORG                                                            18130000
*                                                                       18140000
*        WTO     'EVALTABL Entered'                                     18150000
*                                                                       18160000
*       {static char       * conv_code;                                 18170000
*       static int           i, j;                                      18180000
*                                                                       18190000
*       static int           k;                                         18200000
*       static char        * temp_index;                                18210000
*       static char        * temp_quote;                                18220000
*                                                                       18230000
*                                                                       18240000
*       union opr2 {                                                    18250000
*       int  opr_l2_int;                                                18260000
*       char opr_l2_charÝ2¨;                                            18270000
*       }   opr_conv;                                                   18280000
*                                                                       18290000
*       static int           temp_len;                                  18300000
*                                                                       18310000
*       static char          op_posnÝ¨ = {                              18320000
*       '**+ - * / ~ & ->.x,x:== >=<=> < | & ^<^>^=^ '};                18330000
*                                                                       18340000
         B    PASTTBL                                                   18350000
OPPOSN   DC C'**+ - * / ~ && ->.x,x:== >=<=> < | && ^<^>^=^ ' ;         18360000
*         /*  1 3 5 7 9 11  15  19  23  27  31  35  39  43              18370000
*                         13  17  21  25  29  33  37  41  */            18380000
*   Used to get Operator Position (not used ¬)                          18390000
*                                                                       18400000
*       static char *temp_posn;                                         18410000
*                                                                       18420000
*       if (*opr == '(')                                                18430000
*                                                                       18440000
PASTTBL  DS   0H                                                        18450000
        CLI     OPR,C'('                                                18460000
*                                                                       18470000
*       goto dofunc;                                                    18480000
*                                                                       18490000
        BE      DOFUNC                                                  18500000
*                                                                       18510000
*       }                                                               18520000
*                                                                       18530000
*       if (*opr == ',') {                                              18540000
*                                                                       18550000
        CLI     OPR,C','                                                18560000
        BNE     NOTPARM                                                 18570000
*                                                                       18580000
*t_max_parm:                                                            18590000
*                                                                       18600000
*       if (Parm_Cntl + 1 > 3) {                                        18610000
*                                                                       18620000
        LH      R1,PARMCNTL                                             18630000
        LA      R1,1(R1)                                                18640000
        CH      R1,=H'3'                                                18650000
        BNH     P18#PRM                                                 18660000
*                                                                       18670000
*                                                                       18680000
P18315   DS    0H                                                 J51   18690000
        JOLERR  315,'Too many Parameters'                               18700000
        JOLRETN  RC=4                                                   18710000
*                                                                       18720000
P18#PRM  DS     0H                                                      18730000
*                                                                       18740000
*       else {                                                          18750000
*       Parm_Cntl = Parm_Cntl + 1;                                      18760000
*                                                                       18770000
        STH     R1,PARMCNTL                                             18780000
*                                                                       18790000
*       {                                                               18800000
*        cpy ( Parm_StrÝParm_Cntl¨,op1);                                18810000
*                                                                       18820000
        LH      R1,PARMCNTL                                             18830000
        CH      R1,=H'1'               ; do it manually !               18840000
        BNE     P18PTRY2                                                18850000
        MVC     #PARMST1(L'PARMST1),#OP1                                18860000
        MVC     PARMBIN1,OP1BIN                                         18870000
        MVC     PARMTYP1,OP1TYPE                                        18880000
        B       ENDPARM1                                                18890000
P18PTRY2 CH      R1,=H'2'               ; do it manually !              18900000
        BNE     P18PTRY3                                                18910000
        MVC     #PARMST2(L'PARMST2),#OP1                                18920000
        MVC     PARMBIN2,OP1BIN                                         18930000
        MVC     PARMTYP2,OP1TYPE                                        18940000
        B       ENDPARM1                                                18950000
P18PTRY3 CH      R1,=H'3'               ; do it manually !              18960000
        BNE     P18PTRY4                                                18970000
        MVC     #PARMST3(L'PARMST3),#OP1                                18980000
        MVC     PARMBIN3,OP1BIN                                         18990000
        MVC     PARMTYP3,OP1TYPE                                        19000000
        B       ENDPARM1                                                19010000
P18PTRY4 DS     0H                                                      19020000
*       WTO     'Wrong Parameter Subscript'                             19030000
         B     P18315                                             J51   19040000
*       JOLRETN  RC=4                                                   19050000
        MH      R1,=AL2(L'PARMST1+2)                                    19060000
        LA      R1,#PARMST1(R1)                                         19070000
        MVC     0(L'PARMST1,R1),#OP1                                    19080000
*                                                                       19090000
* no    Parm_DecÝParm_Cntl¨=op1dec;                                     19100000
*       Parm_BinÝParm_Cntl¨= op1dec;                                    19110000
*                                                                       19120000
        LH      R1,PARMCNTL                                             19130000
        SLL     R1,1                                                    19140000
        SLL     R1,1                                                    19150000
        L       R1,OP1BIN                                               19160000
        ST      R2,PARMBIN1(R1)                                         19170000
*                                                                       19180000
*       PARMTYPEÝParm_Cntl¨=op1type;                                    19190000
*                                                                       19200000
        LH      R1,PARMCNTL                                             19210000
        IC      R15,OP1TYPE                                             19220000
        STC     R15,PARMTYP1(R1)                                        19230000
*                                                                       19240000
*       }                                                               19250000
*        return 0;           /* End of Parameter Processing for now */  19260000
ENDPARM1 DS     0H                                                      19270000
        JOLRETN RC=0                                                    19280000
*                                                                       19290000
NOTPARM  DS     0H                                                      19300000
*                                                                       19310000
*       }                                                               19320000
*                                                                       19330000
*                                                                       19340000
*       if (op2type != 3)                                               19350000
*                                                                       19360000
        CLI     OP2TYPE,3              Literal ?                        19370000
        BE      #14#458                                                 19380000
*                                                                       19390000
*       {                                                               19400000
*       if ((_ctypeÝ(op2Ý0¨) + 1¨ & 2)  || op2Ý0¨ == '-')               19410000
*                                                                       19420000
        TNUM    #OP2                                                    19430000
        LTR     R15,R15                                                 19440000
        BZ      #14#434                                                 19450000
*                                                                       19460000
*       else                                                            19470000
*       {                                                               19480000
*       getsym(op2);                                                    19490000
*                                                                       19500000
        LA      R1,#OP2                                                 19510000
        CALL    GETSYM                                                  19520000
*                                                                       19530000
        MVC     #OP2(L'OP2),#OP                                         19540000
#14#434  DS     0H                                                      19550000
*                                                                       19560000
*        };                                                             19570000
*       }                                                               19580000
*                                                                       19590000
*       }                                                               19600000
*                                                                       19610000
        B       #14#482                                                 19620000
#14#458  DS     0H                                                      19630000
*                                                                       19640000
*       else                                                            19650000
*       {         dropqusr(&dv_op2.curr_len,op2);                       19660000
*                                                                       19670000
        DROPQUSR #OP2                                                   19680000
*                                                                       19690000
        MVI     QUOTEFND,1                                              19700000
#14#482  DS     0H                                                      19710000
*                                                                       19720000
*       }                                                               19730000
*                                                                       19740000
*                                                                       19750000
*       if (oprÝ0¨==':'                                                 19760000
*       &&  oprÝ1¨=='=')                                                19770000
*                                                                       19780000
        CLC     OPR(2),=C':='                                           19790000
        BNE     NOTASSGN                                                19800000
*                                                                       19810000
*                                                                       19820000
        MVC      SYMBOLIC,OP1                                           19830000
*                                                                       19840000
*        };                                                             19850000
*       i = GETSYMname(symbolic);                                       19860000
*                                                                       19870000
        LA      R1,#OP1                                                 19880000
        CALL    GETSYMNM (#OP1)  cvcdelete NEXT LISTING                 19890000
        STH     R1,I                                                    19900000
*                                                                       19910000
*        asm gencpy op,vtyp_op,vmaxl_op,op2,vtyp_op2,vmaxl_op2;         19920000
*                                                                       19930000
        MVC      #OP(L'OP),#OP2                                         19940000
*                                                                       19950000
*        };                                                             19960000
*                                                                       19970000
*       temp_quote=memchr(op,'\'',dv_op.curr_len);                      19980000
*                                                                       19990000
        LA      R14,1                                                   20000000
        LA      R1,OP                                                   20010000
        LR      R15,R1                                                  20020000
        AH      R15,#OP                                                 20030000
TQU1    CLI     0(R1),C''''                                             20040000
        BE      ##3                                                     20050000
        BXLE    R1,R14,TQU1                                             20060000
*                                                                       20070000
*       if ((temp_quote!=0) || QUOTEFND)                                20080000
*                                                                       20090000
        CLI     QUOTEFND,0                                              20100000
        BE      STORFINL                                                20110000
##3  DS     0H                                                          20120000
*                                                                       20130000
*           cpychar(work_string,'\'');           /* Init to a quote */  20140000
*                                                                       20150000
*           for (j=0; j<length(op); j++)                                20160000
*           {                                                           20170000
*                catchar(work_string,opÝj¨);                            20180000
*                if (opÝj¨ == '\'')                                     20190000
*                    catchar(work_string,'\''); /* Make double quote */ 20200000
*                                                                       20210000
*           }                                                           20220000
*           catchar(work_string,'\'');           /* Add last quote  */  20230000
*           cpy(op,work_string);                                        20240000
*       }                                                               20250000
*       store_sym(symbolic, op,length(op), i);                          20260000
*       return 0;                                                       20270000
*    }                                                                  20280000
*       MVC     #WORK(3),=H'1',C''''      370 Sim Bug                   20290000
         CLC   #OP,ZERO          Zero length string ?             J52   20300000
         BNE   CHKQ                                               J52   20310000
         B     STORFINL                                           J52   20320000
         MVC   #WORK(2),=H'2'                                     J52   20330000
         MVC   WORK(2),=C''''''                                   J52   20340000
         B     STORFINL                                           J52   20350000
CHKQ     DS      0H                                               J52   20360000
        MVC     #WORK(2),=H'1'                                          20370000
        MVI      WORK,C''''                                             20380000
        MVI      WORK+1,0                                               20390000
*                                                                       20400000
*       };                                                              20410000
*                                                                       20420000
         SR      R15,R15                                          J52   20430000
         LA      R1,0                                                   20440000
         LH      R14,#WORK                                              20450000
P18NXCH1 IC      R15,OP(R1)                                             20460000
         STC     R15,WORK(R14)                                          20470000
         CH      R15,=X'007D'    A QUOTE?                               20480000
         BNE     NOEXTRQU                                               20490000
         LA      R14,1(R14)                                             20500000
         STC     R15,WORK(R14)                                          20510000
NOEXTRQU DS      0H                                                     20520000
         LA      R1,1(R1)                                               20530000
         LA      R14,1(R14)                                             20540000
         CH      R1,#OP                                                 20550000
         BL      P18NXCH1                                               20560000
         LA      R15,C''''                                              20570000
         STC     R15,WORK(R14)                                          20580000
         LA    R14,1(R14)        +1 for 2nd quote                 J51   20590000
         STH     R14,#WORK                                              20600000
         MVC     #OP(L'OP),#WORK                                        20610000
*       store_sym(symbolic, op,dv_op.curr_len, i);                      20620000
*                                                                       20630000
STORFINL LA      R1,#OP                                                 20640000
        LH      R0,I                                                    20650000
        CALL    STORESYM             ;OP,I)                             20660000
*                                                                       20670000
        JOLRETN  RC=0                                                   20680000
NOTASSGN  DS     0H                                                     20690000
#14#1250  DS     0H                  cvcvcvc                            20700000
*       }                                                               20710000
*                                                                       20720000
*       if (op1type != 3)                                               20730000
*                                                                       20740000
        CLI     OP1TYPE,3                                               20750000
        BE      #14#1442                                                20760000
*                                                                       20770000
*       {                                                               20780000
*       if ((_ctypeÝ(op1Ý0¨) + 1¨ & 2)  || op1Ý0¨ == '-')               20790000
*                                                                       20800000
        TNUM    #OP1                                                    20810000
        LTR     R15,R15                                                 20820000
        BZ      #14#1418                                                20830000
*                                                                       20840000
*       else                                                            20850000
*       {                                                               20860000
*       getsym(op1);                                                    20870000
*                                                                       20880000
        LA      R1,#OP1                                                 20890000
        CALL    GETSYM     (OP1)                                        20900000
*                                                                       20910000
*                                                                       20920000
        MVC     #OP1(L'OP1),#OP                                         20930000
#14#1418  DS     0H                                                     20940000
*                                                                       20950000
*       }                                                               20960000
*                                                                       20970000
        B       #14#1466                                                20980000
#14#1442  DS     0H                                                     20990000
*                                                                       21000000
*       else                                                            21010000
*       {         dropqusr(&dv_op1.curr_len,op1);                       21020000
*                                                                       21030000
        DROPQUSR #OP1                                                   21040000
*                                                                       21050000
        MVI     QUOTEFND,1                                              21060000
#14#1466  DS     0H                                                     21070000
*                                                                       21080000
*       }                                                               21090000
*                                                                       21100000
*                                                                       21110000
*    if ((clc(opr, '|| ',3))                                            21120000
*        || (*opr == ':')                                               21130000
*        || (*opr == '.'))                                              21140000
*    {                                                                  21150000
*                                                                       21160000
        CLC     OPR(2),=C'||'                                           21170000
        BE      #14#1562                                                21180000
        CLC     OPR,=C': '                                              21190000
        BE      #14#1562                                                21200000
        CLI     OPR,C'.'                                                21210000
        BE      #14#1562                                                21220000
        B       #14#1634                                                21230000
#14#1562  DS     0H                                                     21240000
*                                                                       21250000
*                                                                       21260000
*do_concat:                                                             21270000
*          dropquotes(op1);                                             21280000
*          dropquotes(op2);                                             21290000
*                                                                       21300000
*          cpy(op,quote);                                               21310000
*          cat(op,op1);                                                 21320000
*          cat(op,op2);                                                 21330000
*          cat(op,quote);                                               21340000
*          op1type=3;                  /* Set Character Type   */       21350000
*          return 0;                                                    21360000
* FOLLOWING CODE COULD BE BETTER !! Clem Clarke, May, 1991              21370000
        DROPQUSR #OP1                                                   21380000
        DROPQUSR #OP2                                                   21390000
        MVI     OP,C''''               Set a Quote                      21400000
        LA      R1,1                   Length so far                    21410000
        LA      R15,OP+1               R15 = Move Position              21420000
        LH      R5,#OP1                Get Length of Source 1           21430000
        CH      R5,=AL2(L'OP)          Greater than Destination?        21440000
        BL      LEN1OK                 No                               21450000
        LA      R5,L'OP-2              Yes, Reduce Length               21460000
LEN1OK  EX      R5,*+4                 Shift the string                 21470000
        MVC     0(*-*,R15),OP1          Executed MVC                    21480000
        AR      R1,R5                  Length so Far                    21490000
        STH     R1,#OP                 Not Necessary ?                  21500000
        AR      R15,R5                 Set R15 to next location         21510000
*                                                                       21520000
        LH      R5,#OP2                Get Length of 2nd String         21530000
        AR      R1,R5                  New Length if concatenated       21540000
        CH      R1,=AL2(L'OP)          Will it be too big?              21550000
        BL      LEN2OK                                                  21560000
* Calculate max length left                                             21570000
        LA      R5,L'OP-2                                               21580000
        SH      R5,#OP                                                  21590000
        BCTR    R5,0                                                    21600000
LEN2OK  EX      R5,*+4                                                  21610000
        MVC     0(*-*,R15),OP2                                          21620000
        AR      R15,R5                Point to end of concatenated stri 21630000
        MVI     0(R15),C''''                                            21640000
        AH      R5,#OP                                                  21650000
        LA      R5,1(R5)                                                21660000
        STH     R5,#OP                 Reset the length                 21670000
*       op1type=3;                                                      21680000
*                                                                       21690000
        MVI     OP1TYPE,3                                               21700000
*                                                                       21710000
        JOLRETN  RC=0                                                   21720000
#14#1634  DS     0H                                                     21730000
*                                                                       21740000
*       }                                                               21750000
*                                                                       21760000
        TNUM    #OP1                   Is it a Number ?                 21770000
        ST      R1,OP1BIN                                               21780000
        LA      R0,#OP1                                                 21790000
*       HALT                                                            21800000
        LTR     R15,R15                Test if number returned          21810000
        BNE     P18NOTN1               No, not a number                 21820000
*                                                                       21830000
*       op1type=0;                                                      21840000
*                                                                       21850000
        MVI     OP1TYPE,0              Yes, a number - set type         21860000
        LH      R15,#OP1               Load length                      21870000
        BCTR    R15,0                                                   21880000
        EX      R15,P18PACK1           Pack the number                  21890000
        LA      R1,OP1DEC                                               21900000
        LA      R0,#OP1                                                 21910000
*       HALT                                                            21920000
        B       #14#1730                                                21930000
P18NOTN1  DS     0H                                                     21940000
*                                                                       21950000
*       else op1type=3;                                                 21960000
*                                                                       21970000
        MVI     OP1TYPE,3                                               21980000
#14#1730  DS     0H                                                     21990000
*                                                                       22000000
*                                                                       22010000
*       op2dec=strtol(op2, &conv_code,10);                              22020000
*                                                                       22030000
        TNUM    #OP2                                                    22040000
        ST      R1,OP2BIN                                               22050000
        LTR     R15,R15                                                 22060000
        BNE     #14#1802                                                22070000
*                                                                       22080000
*       op2type = 0;                                                    22090000
*                                                                       22100000
        MVI     OP2TYPE,0                                               22110000
        LH      R15,#OP2                                          75128 22120000
        BCTR    R15,0                                             75128 22130000
        EX      R15,P18PACK2                                      75128 22140000
        B       #14#1826                                                22150000
#14#1802  DS     0H                                                     22160000
*                                                                       22170000
*       else op2type = 3;                                               22180000
*                                                                       22190000
        MVI     OP2TYPE,3                                               22200000
#14#1826  DS     0H                                                     22210000
*                                                                       22220000
*                                                                       22230000
        MVC      OPRL2(2),OPR                                           22240000
*                                                                       22250000
*                                                                       22260000
*       k = 0;                                                          22270000
*K       EQU      R5                                                    22280000
        MVI      K,0                                                    22290000
*                                                                       22300000
        LA       R1,OPPOSN                                              22310000
        LR       R15,R1                                                 22320000
        AH       R15,=AL2(L'OPPOSN)                                     22330000
        LA       R14,2                                                  22340000
P18FPOS CLC      OPRL2,0(R1)                                            22350000
        BE       P18FNDP                                                22360000
        BXLE     R1,R14,P18FPOS                                         22370000
        B       #14#1874                                                22380000
*                                                                       22390000
*       k=temp_posn-op_posn+1;                                          22400000
*                                                                       22410000
P18FNDP DS      0H                                                      22420000
        S        R1,=A(OPPOSN)                                          22430000
        LA       R1,1(R1)                                               22440000
        STC      R1,K                                                   22450000
#14#1874  DS     0H                                                     22460000
*                                                                       22470000
*       op1bit = 0;                                                     22480000
*                                                                       22490000
        MVC      OP1BIT,=F'0'                                           22500000
*                                                                       22510000
*       BITANS = 0;                                                     22520000
*                                                                       22530000
        MVC      BITANS,ZERO                                            22540000
*                                                                       22550000
*       if (k == 0) goto invalid_op;                                    22560000
*                                                                       22570000
        CLI     K,0                                                     22580000
        BE      INVALOP                                                 22590000
*                                                                       22600000
*OPPOSN   DC C'**+ - * / ~ & ->.x,x:== >=<=> < | & ¬<¬>¬=¬ ' ;          22610000
*          /*  1 3 5 7 9 11  15  19  23  27  31  35  39  43             22620000
*       if (k <= 11) {                                                  22630000
*                                                                       22640000
        CLI     K,11                   Less than 11 is **,+,-,*,/       22650000
        BH      P18DOBIT                                                22660000
*                                                                       22670000
*       if ((op1type== 0)  && (op2type == 0)) ;                         22680000
*                                                                       22690000
        CLI     OP1TYPE,0              Check if Operands numeric        22700000
        BNE     #14#2018                                                22710000
        CLI     OP2TYPE,0                                               22720000
        BNE     #14#2018                                                22730000
        B       P18DOBIT                                                22740000
#14#2018  DS     0H                                                     22750000
*                                                                       22760000
        JOLERR  444,'Not Numeric'                                       22770000
        JOLRETN RC=4                                                    22780000
*                                                                       22790000
*cvcvc  B       F14826                                                  22800000
P18DOBIT  DS     0H                                                     22810000
*                                                                       22820000
*       }                                                               22830000
*                                                                       22840000
*                                                                       22850000
*       if (k == 1) {                                                   22860000
*                                                                       22870000
        CLI     K,1                                                     22880000
        BNE     #14#2138                                                22890000
NOTIMPL   DS     0H                                                     22900000
*                                                                       22910000
*                                                                       22920000
*       not_imp:                                                        22930000
        JOLERR 316,'** Not Implemented'                                 22940000
*                                                                       22950000
        JOLRETN  RC=4                                                   22960000
#14#2138  DS     0H                                                     22970000
*                                                                       22980000
*       else if (k == 3)             op1dec=op1dec+op2dec;              22990000
*                                                                       23000000
        CLI     K,3                                                     23010000
        BNE     #14#2186                                                23020000
        AP      OP1DEC,OP2DEC        ADD THE NUMBERS                    23030000
        B       STORNUM                                                 23040000
#14#2186  DS     0H                                                     23050000
*                                                                       23060000
*       else if (k == 5)             op1dec=op1dec-op2dec;              23070000
*                                                                       23080000
        CLI     K,5                                                     23090000
        BNE     #14#2234                                                23100000
*       HALT                                                            23110000
        SP      OP1DEC,OP2DEC                                           23120000
        B       STORNUM                                                 23130000
#14#2234  DS     0H                                                     23140000
*                                                                       23150000
*       else if (k == 7)             op1dec=op1dec*op2dec;              23160000
*                                                                       23170000
        CLI     K,7                                                     23180000
        BNE     #14#2282                                                23190000
* I don't have documentation for the 370 here, and so this              23200000
*   code is copied from the main Jol.                                   23210000
*                                                                       23220000
* I guess it stops 0C6's in MP!                                         23230000
*                                                                       23240000
         ZAP   WORK(15),OP1DEC    LETS NOT 0C7 OK                 91200 23250000
         ZAP   P85NO2,OP2DEC      Reduce Size of number    cvc    91200 23260000
         MP    WORK(15),P85NO2    MULTIPLY THE NUMBERS             DASD 23270000
         MVC   P85NO1,WORK+5      MOVE BACK THE ANSWER             DASD 23280000
         ZAP   OP1DEC,P85NO1      move to recieve area     cvc    91200 23290000
        B       STORNUM                                                 23300000
         B     P85SANS                                                  23310000
        LA      R0,OP1DEC                                               23320000
        LA      R1,OP2DEC                                               23330000
        MP      OP1DEC,OP2DEC    MULTIPLY THE NUMBERS             DASD  23340000
*       M       R1,OP2DEC                                               23350000
*       ST      R1,OP1DEC                                               23360000
*        ZAP    WORK(16),OP1DEC(8)                                      23370000
*        MP     WORK(16),OP2DEC(8)                                      23380000
*        ZAP    WORK+24(8),WORK(16)                                     23390000
*        MVC    OP1DEC(8),WORK.10+24                                    23400000
        B       STORNUM                                                 23410000
#14#2282  DS     0H                                                     23420000
*                                                                       23430000
*       else if (k == 9)             op1dec=op1dec/op2dec;              23440000
*                                                                       23450000
        CLI     K,9                                                     23460000
        BNE     #14#2330                                                23470000
         ZAP   P85NO2,OP2DEC      Reduce Size of number    cvc    91200 23480000
         ZAP   P85NO1,OP1DEC      Reduce Size of number    cvc    91200 23490000
         CP    P85NO2,=P'0'                                             23500000
         BNZ   P85DP                                                    23510000
         JOLERR  239,'ZERO DIVIDE'                                      23520000
P85DP    DP P85NO1,P85NO2      DO THE DIVIDE                            23530000
*******************IGNORE THE REMAINDER FOR NOW                         23540000
* LATER WE MAY LET THE GUY SAY %X=%Y/100 AND %Z = REMAINDER (OR SOME    23550000
*     SUCH RUBISH).                                                     23560000
         SPACE                                                          23570000
* NOW SHIFT THE ANSWER BACK DOWN TO THE RIGHT SPOT                      23580000
         ZAP   P85NO1,P85NO1(L'P85NO1-L'P85NO2)                         23590000
         ZAP   OP1DEC,P85NO1      move to recieve area     cvc    91200 23600000
*P85DIV   CP    P85NO2,=P'0'                                            23610000
*         BZ    P85ZEDIV                                                23620000
*         DP P85NO1,P85NO2      DO THE DIVIDE                           23630000
*        ZAP    WORK(16),OP1DEC(8)                                      23640000
*        DP     WORK(16),OP2DEC(8)                                      23650000
*        MVC    OP1DEC(8),WORK                                          23660000
        B       STORNUM                                                 23670000
#14#2330  DS     0H                                                     23680000
*                                                                       23690000
*       else if (k == 11)            op1dec=-1 * op2dec;                23700000
*                                                                       23710000
        CLI     K,11                                                    23720000
        BNE     #14#2378                                                23730000
         ZAP    WORK(9),OP2DEC(8)                                       23740000
         MP     WORK(9),1555(1,3)                                       23750000
         ZAP    WORK(8),WORK(9)                                         23760000
  FIX  ' MVC    OP1DEC(8),WORK.10+17'                                   23770000
        B       STORNUM                                                 23780000
#14#2378  DS     0H                                                     23790000
*                                                                       23800000
*       else                                                            23810000
*       {                                                               23820000
*                                                                       23830000
*       if ((op1type == 0)                                              23840000
*       && (op2type == 0))                                              23850000
*                                                                       23860000
* Bit or comparison operations here.                                    23870000
*                                                                       23880000
*OPPOSN   DC C'**+ - * / ~ & ->.x,x:== >=<=> < | & ¬<¬>¬=¬ ' ;          23890000
*          /*  1 3 5 7 9 11  15  19  23  27  31  35  39  43             23900000
*                                                                       23910000
        CLI     OP1TYPE,0              Check if Character Ops           23920000
        BNE     P18CHAR                                                 23930000
        CLI     OP2TYPE,0                                               23940000
        BNE     P18CHAR                                                 23950000
*                                                                       23960000
*       {                                                               23970000
*       tempdec = op1dec - op2dec;                                      23980000
*                                                                       23990000
        L       R1,OP1BIN              Do the calculation once !!!      24000000
        S       R1,OP2BIN                                               24010000
        ST      R1,TEMPBIN                                              24020000
*                                                                       24030000
*       temp1 = tempdec;                                                24040000
*                                                                       24050000
        ST      R1,TEMP1                                                24060000
*                                                                       24070000
*       if (k == 23) { if (temp1 == 0) BITANS = 1; }                    24080000
*                                                                       24090000
        CLI     K,23                   =                                24100000
        BNE     #14#2522                                                24110000
        CLC     TEMP1,=F'0'                                             24120000
        BNE     STRBIT           was be                           J51   24130000
        MVI     BITANS+3,1                                              24140000
        B       STRBIT                                                  24150000
#14#2522  DS     0H                                                     24160000
*                                                                       24170000
*       else if (k == 41) { if (temp1 != 0) BITANS = 1; }               24180000
*                                                                       24190000
        CLI     K,41                                                    24200000
        BNE     #14#2618                                                24210000
        CLC     TEMP1,=F'0'                                             24220000
        BE      STRBIT                                                  24230000
        MVI     BITANS+3,1                                              24240000
        B       STRBIT                                                  24250000
#14#2618  DS     0H                                                     24260000
*                                                                       24270000
*       else if (k == 25) { if (temp1 >= 0) BITANS = 1; }               24280000
*                                                                       24290000
        CLI     K,25                                                    24300000
        BNE     #14#2714                                                24310000
*       CLC     TEMP1,=F'0'                                             24320000
        C       R1,=F'0'                                          J52   24321000
        BL      STRBIT                                                  24330000
         DC    X'0700'                                            J52   24331000
        MVI     BITANS+3,1                                              24340000
        B       STRBIT                                                  24350000
#14#2714  DS     0H                                                     24360000
*                                                                       24370000
*       else if (k == 27) { if (temp1 <= 0) BITANS = 1; }               24380000
*                                                                       24390000
        CLI     K,27                                                    24400000
        BNE     #14#2810                                                24410000
*       CLC     TEMP1,=F'0'                                             24420000
        C       R1,=F'0'                                          J52   24421000
        BH      STRBIT                                                  24430000
         DC    X'0700'                                            J52   24431000
        MVI     BITANS+3,1                                              24440000
        B       STRBIT                                                  24450000
#14#2810  DS     0H                                                     24460000
*                                                                       24470000
*       else if (k == 31) { if (temp1 < 0) BITANS = 1;      }           24480000
*                                                                       24490000
        CLI     K,31                                                    24500000
        BNE     #14#2906                                                24510000
*       CLC     TEMP1,=F'0'                                             24520000
        C       R1,=F'0'                                          J52   24521000
        BNL     STRBIT                                            J52   24530000
         DC    X'0700'                                            J52   24530100
* was BH ****                                                     J52   24531000
        MVI     BITANS+3,1                                              24540000
        B       STRBIT                                                  24550000
#14#2906  DS     0H                                                     24560000
*                                                                       24570000
*       else if (k == 29) { if (temp1 > 0) BITANS = 1;      }           24580000
*                                                                       24590000
        CLI     K,29                                                    24600000
        BNE     #14#3002                                                24610000
*       CLC     TEMP1,=F'0'                                             24620000
        C       R1,=F'0'                                          J52   24621000
        BNH     STRBIT                                                  24630000
         DC    X'0700'                                            J52   24631000
        MVI     BITANS+3,1                                              24640000
        B       STRBIT                                                  24650000
#14#3002  DS     0H                                                     24660000
*                                                                       24670000
*       else if (k == 39) { if (!(temp1 > 0)) BITANS = 1;}              24680000
*                                                                       24690000
        CLI     K,39                                                    24700000
        BNE     #14#3098                                                24710000
*       CLC     TEMP1,=F'0'                                             24720000
        C       R1,=F'0'                                          J52   24721000
        BH      STRBIT                                                  24730000
         DC    X'0700'                                            J52   24731000
        MVI     BITANS+3,1                                              24740000
        B       STRBIT                                                  24750000
#14#3098  DS     0H                                                     24760000
*                                                                       24770000
*       else if (k == 37) { if (!(temp1 < 0)) BITANS = 1;}              24780000
*                                                                       24790000
        CLI     K,37                                                    24800000
        BNE     #14#3194                                                24810000
*       CLC     TEMP1,=F'0'                                             24820000
        C       R1,=F'0'                                          J52   24821000
        BL      STRBIT                                                  24830000
         DC    X'0700'                                            J52   24831000
        MVI     BITANS+3,1                                              24840000
        B       STRBIT                                                  24850000
#14#3194  DS     0H                                                     24860000
*                                                                       24870000
*                                                                       24880000
*                                                                       24890000
*       else {                                                          24900000
*       temp1=op1dec;                                                   24910000
*                                                                       24920000
        L       R1,OP1BIN                                               24930000
        ST      R1,TEMP1                                                24940000
*                                                                       24950000
*       op1bit = temp1;                                                 24960000
*                                                                       24970000
        ST      R1,OP1BIT                                               24980000
*                                                                       24990000
*       temp2=op2dec;                                                   25000000
*                                                                       25010000
        L       R1,OP2BIN                                               25020000
        ST      R1,TEMP2                                                25030000
*                                                                       25040000
*       op2bit = temp2;                                                 25050000
*                                                                       25060000
        ST      R1,OP2BIT                                               25070000
*                                                                       25080000
*                                                                       25090000
*       if (k == 13)           BITANS =       op1bit  & op2bit;         25100000
*                                                                       25110000
        CLI     K,13                                                    25120000
        BNE     #14#3242                                                25130000
        L       R1,OP1BIT                                               25140000
        N       R1,OP2BIT                                               25150000
        ST      R1,BITANS                                               25160000
        B       P18MAKEN                                                25170000
#14#3242  DS     0H                                                     25180000
*                                                                       25190000
*       else if (k == 33)     BITANS =       op1bit  | op2bit;          25200000
*                                                                       25210000
        CLI     K,33                                                    25220000
        BNE     #14#3290                                                25230000
        L       R1,OP1BIT                                               25240000
        O       R1,OP2BIT                                               25250000
        ST      R1,BITANS                                               25260000
        B       P18MAKEN                                                25270000
#14#3290  DS     0H                                                     25280000
*                                                                       25290000
*       else if (k == 43)     BITANS = ! op2bit;                        25300000
*                                                                       25310000
        CLI     K,43                                                    25320000
        BNE     #14#3338                                                25330000
        L       R1,OP2BIT                                               25340000
        LNR     R1,R1                                                   25350000
        ST      R1,BITANS                                               25360000
        B       P18MAKEN                                                25370000
#14#3338  DS     0H                                                     25380000
*                                                                       25390000
*       else goto not_imp;                                              25400000
*                                                                       25410000
        B       NOTIMPL                                                 25420000
P18MAKEN  DS     0H                                                     25430000
*                                                                       25440000
*       op1type=0;                                                      25450000
*                                                                       25460000
        MVI     OP1TYPE,0                                               25470000
*                                                                       25480000
*       if (BITANS == 0) goto store_zero;                               25490000
*                                                                       25500000
        CLC     BITANS,=F'0'                                            25510000
        BE      P18FALSE                                                25520000
*#14#3410  DS     0H                                                    25530000
*                                                                       25540000
*       if (this_is_an_if) goto store_minus1;                           25550000
*                                                                       25560000
        CLI     THISIF,0                                                25570000
        BNE     P18TRUE                                                 25580000
*                                                                       25590000
*       temp1 = BITANS;                                                 25600000
        MVC     TEMP1,BITANS                                            25610000
*       op1bin = temp1;                                                 25620000
        MVC     OP1BIN,TEMP1                                            25630000
*                                                                       25640000
*       goto store_bin;                                                 25650000
*                                                                       25660000
        B       STRBIN                                                  25670000
STRBIT  DS     0H                                                       25680000
*                                                                       25690000
*       }                                                               25700000
*                                                                       25710000
*       if (BITANS != 0) goto store_minus1;                             25720000
*                                                                       25730000
        CLC     BITANS,=F'0'                                            25740000
        BNE     P18TRUE                                                 25750000
        B       P18FALSE                                                25760000
*       }                                                               25770000
*                                                                       25780000
        B       #14#4394                                                25790000
P18CHAR   DS     0H                                                     25800000
*                                                                       25810000
*       else {                                                          25820000
*                                                                       25830000
* If %list(1) causes problems  if LIST(1) not there, becuase      J52   25831000
* X'00'  put in to indicate not defined.                          J52   25832000
         CLI   OP1,0                                              J52   25833000
         BNE   OP1THERE                                           J52   25834000
         MVI   OP1,C' '                                           J52   25835000
OP1THERE DS    0H                                                 J52   25836000
         CLI   OP2,0                                              J52   25837000
         BNE   OP2THERE                                           J52   25838000
         MVI   OP2,C' '                                           J52   25839000
OP2THERE DS    0H                                                 J52   25839100
*                                                                       25840000
* Somewhow, we can end up with a zero length and '' in OP1!!!.    J52   25841000
         CLC   #OP1,ZERO         Length Zero?                     J52   25843000
         BNE   OP1NQU01                                           J52   25844000
         MVC   OP1(4),BLANKS                                      J52   25845000
OP1NQU01 DS    0H                                                 J52   25846000
         CLC   #OP2,ZERO         Length Zero?                     J52   25847000
         BNE   OP2NQU01                                           J52   25848000
         MVC   OP2(4),BLANKS                                      J52   25849000
OP2NQU01 DS    0H                                                 J52   25849100
*       if (k == 23)      { if ((gencmp(op1, op2) == 0))                25850000
*                                                                       25860000
        CLI     K,23                                                    25870000
        BNE     P18TCHNE                                                25880000
*       CVCCMP  OP1,OP2                                                 25890000
        CLC     OP1,OP2                                                 25900000
        BNE     P18FALSE                                                25910000
        B       P18TRUE                                                 25920000
*                                                                       25930000
*       else if (k == 41) { if ((gencmp(op1, op2) != 0))                25940000
*                                                                       25950000
P18TCHNE CLI     K,41                                                   25960000
        BNE     P18TCHGE                                                25970000
*       CVCCMP  OP1,OP2                                                 25980000
        CLC     OP1,OP2                                                 25990000
        BNE     P18TRUE                                                 26000000
        B       P18FALSE                                                26010000
*                                                                       26020000
*       else if (k == 25) { if ((gencmp(op1, op2) >= 0))                26030000
*                                                                       26040000
P18TCHGE CLI     K,25                                                   26050000
        BNE     P18TCHLE                                                26060000
*       CVCCMP  OP1,OP2                                                 26070000
        CLC     OP1,OP2                                                 26080000
        BL      P18FALSE                                                26090000
        B       P18TRUE                                                 26100000
*                                                                       26110000
*       else if (k == 27) { if ((gencmp(op1, op2) <= 0))                26120000
*                                                                       26130000
P18TCHLE CLI     K,27                                                   26140000
        BNE     P18TCHLT                                                26150000
*       CVCCMP  OP1,OP2                                                 26160000
        CLC     OP1,OP2                                                 26170000
        BH      P18FALSE                                                26180000
        B       P18TRUE                                                 26190000
*                                                                       26200000
*       else if (k == 31) { if ((gencmp(op1, op2) < 0))                 26210000
*                                                                       26220000
P18TCHLT CLI     K,31                                                   26230000
        BNE     P18TCHGT                                                26240000
*       CVCCMP  OP1,OP2                                                 26250000
        CLC     OP1,OP2                                                 26260000
        BL      P18TRUE                                                 26270000
        B       P18FALSE                                                26280000
*                                                                       26290000
*       else if (k == 29) { if ((gencmp(op1, op2) > 0))                 26300000
*                                                                       26310000
P18TCHGT CLI     K,29                                                   26320000
        BNE     #14#4178                                                26330000
*       CVCCMP  OP1,OP2                                                 26340000
        CLC     OP1,OP2                                                 26350000
        BH      P18TRUE                                                 26360000
        B       P18FALSE                                                26370000
*                                                                       26380000
*       else if (k == 37) { if (!((gencmp(op1, op2) < 0)))              26390000
*1;}                                                                    26400000
*                                                                       26410000
#14#4178 DS     0H                                                      26420000
        CLI     K,37                                                    26430000
        BNE     #14#4274                                                26440000
*       CVCCMP  OP1,OP2                                                 26450000
        CLC     OP1,OP2                                                 26460000
        BL      P18TRUE                                                 26470000
        B       P18FALSE                                                26480000
*                                                                       26490000
*       else if (k == 39) { if (!((gencmp(op1, op2) > 0)))              26500000
*1;}                                                                    26510000
*                                                                       26520000
#14#4274 DS     0H                                                      26530000
        CLI     K,39                                                    26540000
        BNE     NOTIMPL                                                 26550000
*       CVCCMP  OP1,OP2                                                 26560000
        CLC     OP1,OP2                                                 26570000
        BH      P18TRUE                                                 26580000
        B       P18FALSE                                                26590000
*                                                                       26600000
*       else goto not_imp;                                              26610000
*                                                                       26620000
        B       NOTIMPL                                                 26630000
#14#4394  DS     0H                                                     26640000
*                                                                       26650000
*       }                                                               26660000
*                                                                       26670000
*       if (op1bit == 0) goto store_zero;                               26680000
*                                                                       26690000
        CLC     OP1BIT,ZERO                                             26700000
        BNE     #14#4466                                                26710000
        B       P18FALSE                                                26720000
        B       STORNUM                                                 26730000
#14#4466  DS     0H                                                     26740000
*                                                                       26750000
*       else goto store_minus1;                                         26760000
*                                                                       26770000
        B       P18TRUE                                                 26780000
*#14#4490  DS     0H                                                    26790000
*                                                                       26800000
*       }                                                               26810000
*       goto store_num ;                                                26820000
*                                                                       26830000
        B       STORNUM                                                 26840000
DOFUNC  DS     0H                                                       26850000
*                                                                       26860000
*                                                                       26870000
*       dofunc:                                                         26880000
*       {                                                               26890000
*                                                                       26900000
*       if (srch_func_tab() !=0) goto badfunc;                          26910000
*                                                                       26920000
        CALL    SRCHFUNC                                                26930000
        LTR     R15,R15                                                 26940000
        BNZ     #14#4826                                                26950000
*                                                                       26960000
*                                                                       26970000
*       if (fnparms == -1)                                              26980000
*                                                                       26990000
        CLC     FNPARMS,=H'-1'                                          27000000
        BE      #14#4754                                                27010000
P18SWIT DS      0H                                                      27020000
*                                                                       27030000
*                                                                       27040000
*       if (fnparms == 0)                                               27050000
*                                                                       27060000
        CLC     FNPARMS,=H'0'                                           27070000
        BNE     #14#4706                                                27080000
*                                                                       27090000
*       if (Parm_Cntl == 1)                                             27100000
*                                                                       27110000
        CLC     PARMCNTL,=H'1'                                          27120000
        BNE     #14#4706                                                27130000
*                                                                       27140000
*       if (*Parm_StrÝ1¨ == '\0')                                       27150000
*                                                                       27160000
        CLC     #PARMST1,=H'0'                                          27170000
        BNE     #14#4706                                                27180000
*                                                                       27190000
*       goto doswitch;                                                  27200000
*                                                                       27210000
        B       #14#4754                                                27220000
#14#4706  DS     0H                                                     27230000
*                                                                       27240000
*                                                                       27250000
*                                                                       27260000
*       if (Parm_Cntl != fnparms) goto func_err;                        27270000
*                                                                       27280000
        CLC     PARMCNTL,FNPARMS                                        27290000
        BNE     F14682                                                  27300000
*                                                                       27310000
*                                                                       27320000
#14#4754 DS     0H                                                      27330000
*       doswitch:                                                       27340000
*                                                                       27350000
*       switch (fnswi) {                                                27360000
*                                                                       27370000
        L       R1,FNRTNADR                                             27380000
        BR      R1                      ; Set By Lookup Routine         27390000
*                                                                       27400000
#14#4826  DS     0H                                                     27410000
*                                                                       27420000
*                                                                       27430000
* badfunc:                                                              27440000
*                                                                       27450000
        JOLERR 317,'Invalid Function'                                   27460000
*       };                                                              27470000
*       goto bad_return;                                                27480000
        B       BADRETN                                                 27490000
CAPS    DS     0H                                                       27500000
*       case CAPS:                                                      27510000
*                                                                       27520000
*make_caps:  if (Parm_TypeÝ1¨ != 3)       /* literal ?? */              27530000
*                get_parm1(0);            /* no */                      27540000
*                                                                       27550000
*            cpy(op,Parm_StrÝ1¨);                                       27560000
*            strupr(op);                                                27570000
*            goto add_quotes;                                           27580000
*           break;                                                      27590000
*                                                                       27600000
        CLI     PARMTYP1,3                                              27610000
        BE      #14#5090                                                27620000
        GETPARM1 0                                                      27630000
#14#5090  DS     0H                                                     27640000
        MVC     #OP(L'OP),#PARMST1                                      27650000
        OC      OP,BLANKS               ; STRUPR                        27660000
        B       ADDQUOTE                                                27670000
*                                                                       27680000
CARDRTN DS     0H                                                       27690000
*                                                                       27700000
* case CARD:                                                            27710000
*       GETPARM1(1);                                                    27720000
*                                                                       27730000
        GETPARM1 1                                                      27740000
*       MVC     #OP(6),=H'4',C'CARD'      370 Sim Bug                   27750000
        MVC     #OP(2),=H'4'                                            27760000
        MVC      OP(5),=C'CARD '                                        27770000
        B       LISTITEM                                                27780000
*                                                                       27790000
CENTER  DS     0H                                                       27800000
CENTRE  DS     0H                                                       27810000
*                                                                       27820000
*       case CENTER:                                                    27830000
*       case CENTRE:                                                    27840000
*                                                                       27850000
*       if (Parm_TypeÝ2¨ != 3)                                          27860000
*           get_parm2(0);                                               27870000
*                                                                       27880000
*           { int         j;                                            27890000
*                                                                       27900000
*                                                                       27910000
*           if (Parm_TypeÝ2¨ != 3)          /* Get Value of parm(1) */  27920000
*               get_parm2(0);                                           27930000
*                                                                       27940000
*           else                                                        27950000
*           {     dropquotes(Parm_StrÝ2¨);                              27960000
*                 quote_found=1;                                        27970000
*           }                                                           27980000
*                                                                       27990000
*           get_parm1(1);                                               28000000
*           if (Parm_BinÝ1¨ > sizeof(op))                               28010000
*               Parm_BinÝ1¨ = sizeof(op);                               28020000
*                                                                       28030000
*           memset(op,' ', Parm_BinÝ1¨);                                28040000
*           length(op) = Parm_BinÝ1¨;                                   28050000
*           opÝlength(op)¨ = '\0';                                      28060000
*                                                                       28070000
*           j = length(Parm_StrÝ2¨) / 2;                                28080000
*           j = (Parm_BinÝ1¨ / 2) - j;                                  28090000
*                                                                       28100000
*           if (j <=0)                                                  28110000
*           {   cpy(op,Parm_StrÝ2¨);}                                   28120000
*           else memcpy(&opÝj¨,Parm_StrÝ2¨, length(Parm_StrÝ2¨));       28130000
*           goto add_quotes;                                            28140000
*           break;                                                      28150000
*                                                                       28160000
*           }                                                           28170000
*                                                                       28180000
        CLI     PARMTYP2,3                                              28190000
        BE      #14#5330                                                28200000
        GETPARM2 0                                                      28210000
        B       #14#5354                                                28220000
#14#5330  DS     0H                                                     28230000
        DROPQUSR #PARMST2                                               28240000
        MVI     QUOTEFND,1                                              28250000
#14#5354  DS     0H                                                     28260000
        GETPARM1 1                                                      28270000
*       if (Parm_BinÝ1¨ > sizeof(op))                                   28280000
*       Parm_BinÝ1¨ = sizeof(op);                                       28290000
*                                                                       28300000
        CLC     PARMBIN1,=AL2(L'OP)                                     28310000
        BL      #14#5450                                                28320000
*                                                                       28330000
        MVC     PARMBIN1,=AL2(L'OP)                                     28340000
#14#5450  DS     0H                                                     28350000
*       memset(op,' ', Parm_BinÝ1¨);                                    28360000
        MVI     OP,C' '                                                 28370000
        MVC     OP+1(L'OP-1),OP                                         28380000
*       dv_op.curr_len = Parm_BinÝ1¨;                                   28390000
        MVC     #OP(2),PARMBIN1+2                                       28400000
*                                                                       28410000
*       opÝdv_op.curr_len¨ = '\0';                                      28420000
*  Don't Need It (above)                                                28430000
*                                                                       28440000
*       j = dv_Parm_StrÝ2¨.curr_len / 2;                                28450000
*                                                                       28460000
        LH      R1,#PARMST2                                             28470000
        SRL     R1,1                    Halve the old string length     28480000
*       MVI     J,R1                                                    28490000
*                                                                       28500000
*       j = (Parm_BinÝ1¨ / 2) - j;                                      28510000
*                                                                       28520000
        L       R15,PARMBIN1            Load new string length          28530000
        SRL     R15,1                   Halve it                        28540000
        SR      R15,R1                  Calc offset to move string to   28550000
*       STH     R1,J                                                    28560000
*                                                                       28570000
*       if (j <=0)                                                      28580000
*                                                                       28590000
        CH      R15,=H'0'                                               28600000
        BH      #14#5546                                                28610000
*                                                                       28620000
        MVC     #OP(L'OP),#PARMST2       Error, string too big          28630000
*                                                                       28640000
*                                                                       28650000
        B       #14#5570                                                28660000
#14#5546  DS     0H                                                     28670000
*                                                                       28680000
*       else memcpy(&opÝj¨,Parm_StrÝ2¨, dv_Parm_StrÝ2¨.curr_len);       28690000
*                                                                       28700000
        LA      R14,OP                  Get receive area addr           28710000
        AR      R14,R15                 Add Centring offset             28720000
        LH      R1,#PARMST2             Get amount to move              28730000
        EX      R1,CENTSTR                                              28740000
#14#5570  DS     0H                                                     28750000
        B       ADDQUOTE                                                28760000
CENTSTR MVC     0(*-*,R14),PARMST2                                      28770000
*                                                                       28780000
*       break;                                                          28790000
*                                                                       28800000
        B       BREAK                                                   28810000
CHAR    DS     0H                                                       28820000
*                                                                       28830000
*       }                                                               28840000
*                                                                       28850000
*       case CHAR:                                                      28860000
*           if (Parm_TypeÝ1¨ != 3)       /* literal ?? */               28870000
*               GETPARM1(1);             /* no */                       28880000
*                                                                       28890000
*           cpychar(op,' ');                                            28900000
*                                                                       28910000
*           opÝ0¨ = Parm_BinÝ1¨;                                        28920000
*           goto add_quotes;                                            28930000
*           break;                                                      28940000
*                                                                       28950000
        CLI     PARMTYP1,3                                              28960000
        BE      #14#5666                                                28970000
*       get_parm1(1);                                                   28980000
        GETPARM1 1                                                      28990000
#14#5666  DS     0H                                                     29000000
*                                                                       29010000
*       MVC     #OP(3),=H'1',C' '         370 Sim Bug                   29020000
        MVC     #OP(2),=H'1'                                            29030000
        MVC      OP(2),BLANKS                                           29040000
*       opÝ0¨ = Parm_BinÝ1¨;                                            29050000
        MVC     OP(1),PARMBIN1+3          get last byte                 29060000
        B       ADDQUOTE                                                29070000
*                                                                       29080000
*       break;                                                          29090000
*                                                                       29100000
        B       BREAK                                                   29110000
*                                                                       29120000
*                                                                       29130000
*       case DEF:                                                       29140000
*       case DEFINED:                                                   29150000
*       i = getsymname(Parm_StrÝ1¨);                                    29160000
*                                                                       29170000
        LA      R1,#PARMST1                                             29180000
        CALL    GETSYM                                                  29190000
*       if (!(i > 0)) goto store_zero;                                  29200000
        LTR     R15,R15                                                 29210000
        BNE     #14#5834                                                29220000
        B       P18FALSE                                                29230000
#14#5834  DS     0H                                                     29240000
*                                                                       29250000
*       goto store_minus1;                                              29260000
*                                                                       29270000
        B       P18TRUE                                                 29280000
*                                                                       29290000
*                                                                       29300000
EOF     DS     0H                                                       29310000
*                                                                       29320000
*                                                                       29330000
*       case EOF:                                                       29340000
*                                                                       29350000
*       if (ujp18teof(Parm_StrÝ1¨) == 4) goto store_minus1;             29360000
*                                                                       29370000
        LA      R1,PARMST1                                              29380000
*cvc    CALL    P18TEOF                                                 29390000
        LTR     R15,R15                                                 29400000
        BNE     #14#5930                                                29410000
        B       P18TRUE                                                 29420000
#14#5930  DS     0H                                                     29430000
*                                                                       29440000
*       goto store_zero;                                                29450000
*                                                                       29460000
        B       P18FALSE                                                29470000
EXIST   DS     0H                                                       29480000
*                                                                       29490000
*                                                                       29500000
*       case EXIST:                                                     29510000
*                                                                       29520000
*                                                                       29530000
*       goto store_zero;                                                29540000
*                                                                       29550000
        B       P18FALSE                                                29560000
*                                                                       29570000
GETENV  DS     0H                                                       29580000
*                                                                       29590000
*       case GETENV:                                                    29600000
*                                                                       29610000
*       {                                                               29620000
*       char  *envret;                                                  29630000
*       get_parm1(0);                                                   29640000
*                                                                       29650000
        GETPARM1 0                                                      29660000
        DROPQUSR #PARMST1                                               29670000
*       strupr(Parm_StrÝ1¨);                                            29680000
*                                                                       29690000
        OC      PARMST1,BLANKS                                          29700000
*                                                                       29710000
*       envret =getenv(Parm_StrÝ1¨);                                    29720000
*                                                                       29730000
        LA      R1,#PARMST1                                             29740000
        CALL    GETENV                                                  29750000
*                                                                       29760000
*       if (envret==0) envret="";                                       29770000
*                                                                       29780000
        LTR     R15,R15                                                 29790000
        BZ      #14#6026                                                29800000
*       MVC     #OP(3),=H'0',C' '         370 Sim Bug                   29810000
        MVC     #OP(2),=H'0'                                            29820000
        MVI      OP,C' '                                                29830000
#14#6026  DS     0H                                                     29840000
*                                                                       29850000
*                                                                       29860000
        B       ADDQUOTE                                                29870000
*                                                                       29880000
INKEY   DS     0H                                                       29890000
*                                                                       29900000
*       case INKEY:                                                     29910000
*                                                                       29920000
*       {enum {dest_len=(sizeof op)-1};                                 29930000
*       if (vtyp_op & FSTR)                                             29940000
*                                                                       29950000
        B       #14#6098                                                29960000
*                                                                       29970000
*       { dv_op.curr_len=dest_len;                                      29980000
*                                                                       29990000
*       MVI     _dv_op+8,253                                            30000000
*                                                                       30010000
*        memset(op,' ',dest_len);                                       30020000
*                                                                       30030000
*       mov     ax,253                                                  30040000
*       push    ax                                                      30050000
*       mov     ax,32                                                   30060000
*       push    ax                                                      30070000
*       mov     ax,offset DGROUP:_op                                    30080000
*       push    ax                                                      30090000
*       CALL    memset                                                  30100000
*       add     sp,6                                                    30110000
#14#6098  DS     0H                                                     30120000
*                                                                       30130000
*                                                                       30140000
*       }                                                               30150000
*       if (vtyp_op & VSTR)                                             30160000
*       { dv_op.curr_len=0;                                             30170000
*                                                                       30180000
*       MVI     _dv_op+8,0                                              30190000
*                                                                       30200000
*        opÝ0¨=0;                                                       30210000
*                                                                       30220000
        MVI     OP,0                                                    30230000
*                                                                       30240000
*                                                                       30250000
*       }                                                               30260000
*       };                                                              30270000
*       op1type= 3;                                                     30280000
*                                                                       30290000
        MVI     OP1TYPE,3                                               30300000
*                                                                       30310000
*                                                                       30320000
*       if (kbhit()) {                                                  30330000
*                                                                       30340000
*       CALL    kbhit                                                   30350000
*       or      ax,ax                                                   30360000
*       BE      #14#6218                                                30370000
*                                                                       30380000
*                                                                       30390000
*                                                                       30400000
*       {enum {dest_len=(sizeof op)-1};                                 30410000
*       if (vtyp_op & FSTR)                                             30420000
*                                                                       30430000
        B       #14#6194                                                30440000
*                                                                       30450000
*       { dv_op.curr_len=dest_len;                                      30460000
*                                                                       30470000
*       MVI     _dv_op+8,253                                            30480000
*                                                                       30490000
*        opÝ0¨= getche();                                               30500000
*                                                                       30510000
*       CALL    getche                                                  30520000
*       MVI     op,al                                                   30530000
*                                                                       30540000
*        if(dest_len>sizeof getche())                                   30550000
*        memset(&opÝ1¨,' ',dest_len-1);                                 30560000
*                                                                       30570000
*       mov     ax,252                                                  30580000
*       push    ax                                                      30590000
*       mov     ax,32                                                   30600000
*       push    ax                                                      30610000
*       mov     ax,offset DGROUP:_op+1                                  30620000
*       push    ax                                                      30630000
*       CALL    memset                                                  30640000
*       add     sp,6                                                    30650000
#14#6194  DS     0H                                                     30660000
*                                                                       30670000
*                                                                       30680000
*       }                                                               30690000
*       if (vtyp_op & VSTR)                                             30700000
*       { dv_op.curr_len=1;                                             30710000
*                                                                       30720000
*       MVI     _dv_op+8,1                                              30730000
*                                                                       30740000
*        opÝ0¨=getche();                                                30750000
*                                                                       30760000
*       CALL    getche                                                  30770000
*       MVI     op,al                                                   30780000
*                                                                       30790000
*        opÝ1¨='\0';                                                    30800000
*                                                                       30810000
*       MVI     op+1,0                                                  30820000
#14#6218  DS     0H                                                     30830000
*                                                                       30840000
*                                                                       30850000
*       }                                                               30860000
        B       ADDQUOTE                                                30870000
INDEX   DS     0H                                                       30880000
*                                                                       30890000
*case INDEX:                                                            30900000
*                                                                       30910000
*           if (Parm_TypeÝ2¨ != 3)            /* Get Value */           30920000
*               get_parm2(0);                                           30930000
*                                                                       30940000
*           else                                                        30950000
*           {     dropquotes(Parm_StrÝ2¨);                              30960000
*                 quote_found=1;                                        30970000
*           }                                                           30980000
*           if (Parm_TypeÝ1¨ != 3)                   /* Get Value */    30990000
*           get_parm1(0);                                               31000000
*                                                                       31010000
*           else                                                        31020000
*           {     dropquotes(Parm_StrÝ1¨);                              31030000
*                 quote_found=1;                                        31040000
*           }                                                           31050000
*           temp_index = strstr(Parm_StrÝ2¨, Parm_StrÝ1¨);              31060000
*           if (temp_index==NULL) op1bin = 0;                           31070000
*           else op1bin = temp_index - Parm_StrÝ2¨ +1;                  31080000
*                                                                       31090000
*           goto store_bin;                                             31100000
*                                                                       31110000
* i=index('lit','srch-string')                                          31120000
*                                                                       31130000
* Remember that the parameters are REVERSED, so 1 has the srch-string   31140000
*          and 2 has the main string                                    31150000
*                                                                       31160000
        CLI     PARMTYP2,3             Literal ?                        31170000
        BE      #14#6290               Yes                              31180000
        LA      R1,0                                                    31190000
        CALL    GETPARM2               No, Get value                    31200000
        B       #14#6314                                                31210000
#14#6290  DS     0H                                                     31220000
        DROPQUSR #PARMST2                                               31230000
        MVI     QUOTEFND,1                                              31240000
#14#6314  DS     0H                                                     31250000
        CLI     PARMTYP1,3                                              31260000
        BE      #14#6362                                                31270000
        GETPARM1 0                                                      31280000
        B       #14#6386                                                31290000
#14#6362  DS     0H                                                     31300000
        DROPQUSR #PARMST1                                               31310000
        MVI     QUOTEFND,1                                              31320000
#14#6386  DS     0H                                                     31330000
         MVC   #WORK(L'TKN),#TKN       SHIFT STRING TO WORK      A DASD 31340000
         LH    R9,#PARMST2             RELOAD LENGTH AND         A DASD 31350000
         LA    R10,#PARMST2               ADDRESS                A DASD 31360000
* AS USUAL, R10 -> SYMBOLIC                              CHG30011 76200 31370000
*           R9 CONTAINS LENGTH.                          CHG30011 76200 31380000
* NOW SET UP A BXLE LOOP FOR THE INDEX LOOP.             CHG30011 76200 31390000
         LTR   R9,R9          IS R9=0                    CHG30011 76200 31400000
         BE    P85RZERO       YES, THEREFORE LOOP IMPOSS CHG30011 76200 31410000
         CLC   #PARMST1,=H'0' CHECK STRING TOO           CHG30011 76200 31420000
         BE    P85RZERO       EMPTY, -> RETURN ZERO.     CHG30011 76200 31430000
         SPACE 1                                         CHG30011 76200 31440000
         LA    R14,1          SET INCREMENT              CHG30011 76200 31450000
         LA    R15,2(R10,R9)  AND END ADDRESS            CHG30011C DASD 31460000
         BCTR  R15,0          -1                         CHG30011 76200 31470000
         LA    R10,2(R10)                                CHG30011 76200 31480000
         LR    R0,R10         SAVE START ADDRESS         CHG30011 76200 31490000
         LH    R5,#PARMST1    GET LENGTH OF INDEX STRING CHG30011 76200 31500000
         BCTR  R5,0           -1                         CHG30011 76200 31510000
P85INDLP EX    R5,P85CLC                                 CHG30011 76200 31520000
         BE    P85GOTIN                                  CHG30011 76200 31530000
         BXLE  R10,R14,P85INDLP LOOP                     CHG30011 76200 31540000
         LA    R9,0                                                     31550000
         ST    R9,OP1BIN                                                31560000
         B     STRBIN                                                   31570000
         SPACE 1                                         CHG30011 76200 31580000
P85GOTIN EQU   *                                         CHG30011 76200 31590000
* R10 CONTAINS START ADDR OF STRING FOUND, WHILE R0      CHG30011 76200 31600000
*  CONTAINS THE ACTUAL START OF THE STRING PROPER        CHG30011 76200 31610000
         LR    R5,R0          NEED FOR CLI               CHG30011 76200 31620000
         SR    R10,R5                                    CHG30011 76200 31630000
* R10 = START ADDR OFFSET OF FOUND STRING.               CHG30011 76200 31640000
* WE MUST SEE IF STRING HAS QUOTES, BECAUSE IF SO WE     CHG30011 76200 31650000
*  MUST BUMP THE OFFSET BY 1 BECAUSE ANY ATTEMPTED USAGE CHG30011 76200 31660000
*  OF THE STRING WILL REQUIRE THE OFFSET-1               CHG30011 76200 31670000
         CLI   0(R5),C''''                               CHG30011 76200 31680000
         BNE   *+4                                       CHG30011 76200 31690000
         LA    R10,1(R10)                                CHG30011 76200 31700000
         LR    R9,R10                                    CHG30011 76200 31710000
         ST    R9,OP1BIN                                                31720000
        B       STRBIN                                                  31730000
         B     P85STLEN                                  CHG30011 76200 31740000
         SPACE 3                                         CHG30011 76200 31750000
P85CLC   CLC   0(*-*,R10),PARMST1 EXECUTED FOR 'INDEX' FUNC             31760000
*                                                                       31770000
*       if (temp_index==0) op1bin = 0;                                  31780000
*                                                                       31790000
        BNE     #14#6434                                                31800000
        MVC     OP1BIN,=F'0'                                            31810000
        B       #14#6458                                                31820000
#14#6434  DS     0H                                                     31830000
*                                                                       31840000
*       else op1bin = temp_index - Parm_StrÝ2¨ +1;                      31850000
*                                                                       31860000
*cvc    MVI     op1bin,ax                                               31870000
*       MVI     op1bin+2,dx                                             31880000
#14#6458  DS     0H                                                     31890000
*                                                                       31900000
*                                                                       31910000
*       goto store_bin;                                                 31920000
*                                                                       31930000
        B       STRBIN                                                  31940000
*                                                                       31950000
*                                                                       31960000
LEFT    DS     0H                                                       31970000
*                                                                       31980000
*                                                                       31990000
*       case LEFT:                                                      32000000
*                                                                       32010000
*                                                                       32020000
*           if (Parm_TypeÝ2¨ != 3)          /* Get Value of parm(1) */  32030000
*               get_parm2(0);                                           32040000
*                                                                       32050000
*           else                                                        32060000
*           {     dropquotes(Parm_StrÝ2¨);                              32070000
*                 quote_found=1;                                        32080000
*           }                                                           32090000
*                                                                       32100000
*           cpy(Parm_StrÝ3¨,Parm_StrÝ2¨);                               32110000
*                                                                       32120000
*           get_parm1(1);                     /* Get number */          32130000
*                                                                       32140000
*           Parm_BinÝ2¨ = 1;                                            32150000
*           goto do_part_substr;                                        32160000
*           break;                                                      32170000
*                                                                       32180000
        CLI     PARMTYP2,3                                              32190000
        BE      #14#6554                                                32200000
        GETPARM2 0                                                      32210000
        B       #14#6578                                                32220000
#14#6554  DS     0H                                                     32230000
        DROPQUSR #PARMST2                                               32240000
        MVI     QUOTEFND,1                                              32250000
#14#6578  DS     0H                                                     32260000
        MVI     OP,C' '                Clear Receive area               32270000
        MVC     OP+1(L'OP-1),OP                                         32280000
        GETPARM1  1                    Get Number                       32290000
        L       R1,PARMBIN1            Get number specified             32300000
        STH     R1,#OP                                                  32310000
        EX      R1,MVCLEFT                                              32320000
        B       ADDQUOTE                                                32330000
*                                                                       32340000
*                                                                       32350000
MVCLEFT MVC     OP(*-*),PARMST2                                         32360000
*                                                                       32370000
*                                                                       32380000
*                                                                       32390000
LENGTH  DS     0H                                                       32400000
*                                                                       32410000
*                                                                       32420000
*           if (Parm_TypeÝ1¨ != 3)                   /* Get Value */    32430000
*           get_parm1(0);                                               32440000
*                                                                       32450000
*           else                                                        32460000
*           {     dropquotes(Parm_StrÝ1¨);                              32470000
*                 quote_found=1;                                        32480000
*           }                                                           32490000
*           op1bin = length(Parm_StrÝ1¨);                               32500000
*           goto store_bin;                                             32510000
*           break;                                                      32520000
*                                                                       32530000
*                                                                       32540000
* DO LENGTH FUNCTION HERE.                               CHG30011 76200 32550000
         B     REALLEN                                                  32560000
*cvcvc   BAL   R6,P85GETNM    GET THE NAME               CHG30011 76200 32570000
         LTR   R15,R15        DID WE ?                   CHG30011 76200 32580000
         BNZ   P85RZERO       NO, RETURN 0 THEN          CHG30011 76200 32590000
*cvcvc   USING SYMOVLY,R5                                CHG30011 76200 32600000
* ON RETURN, R5 -> SYMOVLY                               CHG30011 76200 32610000
*            R7 -> SYMBOLIC                              CHG30011 76200 32620000
*            R8 CONTAINS LENGTH                          CHG30011 76200 32630000
         LTR   R8,R8          TEST 0 LENGTH              CHG30011 76200 32640000
         BZ    P85STLEN       LENGTH IS 0, STORE IT      CHG30011 76200 32650000
         CLI   2(R7),C''''    GOT QUOTES ?               CHG30011 76200 32660000
         BNE   P85STLEN       NO,SO LENGTH IS OK NOW     CHG30011 76200 32670000
         SH    R8,=H'2'       YES, -2 FOR QUOTES.        CHG30011 76200 32680000
P85STLEN CVD   R8,DBL         CONVERT TO DEC PACKED      CHG30011 76200 32690000
         ZAP   P85NO1,DBL     MOVE TO P85NO1             CHG30011 76200 32700000
         B     P85SANS        STORE ANSWER               CHG30011 76200 32710000
         SPACE 2                                         CHG30011 76200 32720000
P85CAPS  DS    0H                                                 J40B  32730000
*cvcvc   BAL   R6,P85GETNM    GET THE NAME                        J40B  32740000
         LTR   R15,R15        DID WE ?                            J40B  32750000
         BNZ   P85CAP90       NO, FORGET IT                       J40B  32760000
*cvc     USING SYMOVLY,R5                                         J40B  32770000
* ON RETURN, R5 -> SYMOVLY                                        J40B  32780000
*            R7 -> SYMBOLIC                                       J40B  32790000
*            R8 CONTAINS LENGTH                                   J40B  32800000
         LTR   R8,R8          TEST 0 LENGTH                       J40B  32810000
         BZ    P85CAP90       LENGTH IS 0, IGNORE IT              J40B  32820000
         BCTR  R8,0                                               J40B  32830000
         OC    2(0,R7),BLANKS                                     J40B  32840000
         EX    R8,*-6                                             J40B  32850000
*                                                                       32860000
*                                                                       32870000
REALLEN  DS    0H                                                       32880000
*       if (Parm_TypeÝ1¨ != 3)                                          32890000
*                                                                       32900000
        CLI     PARMTYP1,3                                              32910000
        BE      #14#6722                                                32920000
*                                                                       32930000
*       get_parm1(0);                                                   32940000
*                                                                       32950000
        GETPARM1 0                                                      32960000
        B       #14#6746                                                32970000
#14#6722  DS     0H                                                     32980000
*                                                                       32990000
        DROPQUSR #PARMST1                                               33000000
        MVI     QUOTEFND,0              Numeric return                  33010000
#14#6746  DS     0H                                                     33020000
*       op1bin = dv_Parm_StrÝ1¨.curr_len;                               33030000
        LH      R1,#PARMST1                                             33040000
        ST      R1,OP1BIN                                               33050000
        B       STRBIN                                                  33060000
*                                                                       33070000
*                                                                       33080000
*                                                                       33090000
LIST    DS     0H                                                       33100000
*                                                                       33110000
*           get_parm1(1);                                               33120000
*                                                                       33130000
*           cpylit(op,"LIST");                                          33140000
*list_item:                                                             33150000
*           catstr(op, f4(Parm_BinÝ1¨));                                33160000
*           return 0;                                                   33170000
*           break;                                                      33180000
*                                                                       33190000
*                                                                       33200000
*case LIST:                                                             33210000
        GETPARM1 1                                                      33220000
*       MVC     #OP(8),=H'4',C'LIST'       370 Sim Bug                  33230000
        MVC     #OP(2),=H'4'                                            33240000
        MVC      OP(4),=C'LIST'                                         33250000
LISTITEM  DS     0H                                                     33260000
        L       R1,PARMBIN1                                             33270000
        CVD     R1,DBL                                                  33280000
        UNPK    OP+4(4),DBL                                             33290000
        OI      OP+7,C'0'                                               33300000
        MVC     #OP(2),=H'8'                                            33310000
         B     BREAK                                              J52   33320000
*       B       ADDQUOTE                                          J51   33330000
*       JOLRETN RC=0                                                    33340000
*                                                                       33350000
*                                                                       33360000
LOWER   DS     0H                                                       33370000
*                                                                       33380000
*                                                                       33390000
*case LOWER:                                                            33400000
*           if (Parm_TypeÝ1¨ != 3)       /* literal ?? */               33410000
*               get_parm1(0);            /* no */                       33420000
*                                                                       33430000
*           cpy(op,Parm_StrÝ1¨);                                        33440000
*           strlwr(op);                                                 33450000
*           goto add_quotes;                                            33460000
*           break;                                                      33470000
        CLI     PARMTYP1,3                                              33480000
        BE      #14#6986                                                33490000
*       get_parm1(0);                                                   33500000
        GETPARM1 0                                                      33510000
#14#6986  DS     0H                                                     33520000
        MVC     #OP(L'OP),#PARMST1                                      33530000
        LA      R1,OP                    Load Start address of string   33540000
        LR      R15,R1                   Copy to R15                    33550000
        AH      R15,#OP                  Add length to give stop        33560000
        LA      R14,1                    BXLE increment                 33570000
        SR      R0,R0                    Clear R0                       33580000
LOWNEXT CLI     0(R1),C'A'                                              33590000
        BL      LOWBXLE                                                 33600000
        CLI     0(R1),C'Z'                                              33610000
        BH      LOWBXLE                                                 33620000
        IC      R0,0(R1)                    Load character              33630000
TOLOW   EQU     C'A'-C'a'                                               33640000
        SH      R0,=AL2(TOLOW)                                          33650000
        STC     R0,0(R1)                                                33660000
LOWBXLE BXLE    R1,R14,LOWNEXT                                          33670000
*       JOLERR  318,'To Lower Not Down Yet'                             33680000
        B       ADDQUOTE                                                33690000
*                                                                       33700000
*                                                                       33710000
POS     DS     0H                                                       33720000
*                                                                       33730000
*case POS:                                                              33740000
*                                                                       33750000
*           if (Parm_TypeÝ2¨ != 3)            /* Get Value */           33760000
*               get_parm2(0);                                           33770000
*                                                                       33780000
*           else                                                        33790000
*           {     dropquotes(Parm_StrÝ2¨);                              33800000
*                 quote_found=1;                                        33810000
*           }                                                           33820000
*           if (Parm_TypeÝ1¨ != 3)                   /* Get Value */    33830000
*           get_parm1(0);                                               33840000
*                                                                       33850000
*           else                                                        33860000
*           {     dropquotes(Parm_StrÝ1¨);                              33870000
*                 quote_found=1;                                        33880000
*           }                                                           33890000
*           temp_index = strstr(Parm_StrÝ1¨, Parm_StrÝ2¨);              33900000
*           if (temp_index==NULL) op1bin = 0;                           33910000
*           else op1bin = temp_index - Parm_StrÝ1¨ +1;                  33920000
*                                                                       33930000
*           goto store_bin;                                             33940000
*           break;                                                      33950000
*                                                                       33960000
        CLI     PARMTYP2,3                                              33970000
        BE      #14#7130                                                33980000
        GETPARM2 0                                                      33990000
        B       #14#7154                                                34000000
#14#7130  DS     0H                                                     34010000
        DROPQUSR #PARMST2                                               34020000
        MVI     QUOTEFND,1                                              34030000
#14#7154  DS     0H                                                     34040000
        CLI     PARMTYP1,3                                              34050000
        BE      #14#7202                                                34060000
        GETPARM1 0                                                      34070000
        B       #14#7226                                                34080000
#14#7202  DS     0H                                                     34090000
        DROPQUSR #PARMST1                                               34100000
        MVI     QUOTEFND,1                                              34110000
#14#7226  DS     0H                                                     34120000
*                                                                       34130000
        FIX     'INDEX NOT DONE'                                        34140000
*                                                                       34150000
*       if (temp_index==0) op1bin = 0;                                  34160000
*                                                                       34170000
*       cmp     word ptr DGROUP:b#w+43,0                                34180000
*       BNE     #14#7274                                                34190000
        MVI     OP1BIN,0                                                34200000
        MVI     OP1BIN+2,0                                              34210000
        B       #14#7298                                                34220000
#14#7274  DS     0H                                                     34230000
*                                                                       34240000
*       else op1bin = temp_index - Parm_StrÝ1¨ +1;                      34250000
*                                                                       34260000
*cvcv   MVI     op1bin,ax                                               34270000
*cvc    MVI     op1bin+2,dx                                             34280000
#14#7298  DS     0H                                                     34290000
*                                                                       34300000
*                                                                       34310000
*       goto store_bin;                                                 34320000
*                                                                       34330000
        B       STRBIN                                                  34340000
*                                                                       34350000
*                                                                       34360000
PUTENV  DS     0H                                                       34370000
*                                                                       34380000
*                                                                       34390000
*                                                                       34400000
* case PUTENV:                                                          34410000
*                                                                       34420000
*           {char *temp_equ;                                            34430000
*                                                                       34440000
*               get_parm1(0);                                           34450000
*               dropquotes(Parm_StrÝ1¨);                                34460000
*                                                                       34470000
*               temp_equ = strchr(Parm_StrÝ1¨,'=');                     34480000
*               if (temp_equ != NULL)                                   34490000
*               {                                                       34500000
*                   *temp_equ = '\0';                                   34510000
*                   strupr(Parm_StrÝ1¨);                                34520000
*                   *temp_equ = '=';                                    34530000
*               }                                                       34540000
*                                                                       34550000
*               op1bin = putenv(Parm_StrÝ1¨);                           34560000
*               goto store_bin;                                         34570000
*               break;                                                  34580000
*           }                                                           34590000
*                                                                       34600000
        GETPARM1 0                                                      34610000
        DROPQUSR #PARMST1                                               34620000
        FIX     'PUTENV Not Supported'                                  34630000
*       if (temp_equ != 0)                                              34640000
*                                                                       34650000
*       cmp     word ptr DGROUP:b#w+53,0                                34660000
        BE      #14#7394                                                34670000
*                                                                       34680000
*       {                                                               34690000
*       *temp_equ = '\0';                                               34700000
*                                                                       34710000
*       strupr(Parm_StrÝ1¨);                                            34720000
*       *temp_equ = '=';                                                34730000
*                                                                       34740000
#14#7394  DS     0H                                                     34750000
*                                                                       34760000
*       }                                                               34770000
*                                                                       34780000
*       op1bin = putenv(Parm_StrÝ1¨);                                   34790000
*                                                                       34800000
*cvc    MVI     op1bin,ax                                               34810000
*cvc    MVI     op1bin+2,dx                                             34820000
*                                                                       34830000
*       goto store_bin;                                                 34840000
*                                                                       34850000
        B       STRBIN                                                  34860000
*                                                                       34870000
*       break;                                                          34880000
*                                                                       34890000
        B       BREAK                                                   34900000
RIGHT   DS     0H                                                       34910000
*                                                                       34920000
*                                                                       34930000
*       }                                                               34940000
*                                                                       34950000
*case RIGHT:                                                            34960000
*                                                                       34970000
*                                                                       34980000
*           if (Parm_TypeÝ2¨ != 3)          /* Get Value of parm(1) */  34990000
*               get_parm2(0);                                           35000000
*                                                                       35010000
*           else                                                        35020000
*           {     dropquotes(Parm_StrÝ2¨);                              35030000
*                 quote_found=1;                                        35040000
*           }                                                           35050000
*                                                                       35060000
*           cpy(Parm_StrÝ3¨,Parm_StrÝ2¨);                               35070000
*                                                                       35080000
*           get_parm1(1);                     /* Get number */          35090000
*                                                                       35100000
*           Parm_BinÝ2¨ = length(Parm_StrÝ2¨) - Parm_BinÝ1¨ + 1;        35110000
*           if (Parm_BinÝ2¨ <1)                                         35120000
*               Parm_BinÝ2¨ =1;                                         35130000
*                                                                       35140000
*           goto do_part_substr;                                        35150000
*           break;                                                      35160000
*                                                                       35170000
        CLI     PARMTYP2,3                                              35180000
        BE      #14#7490                                                35190000
        GETPARM2 0                                                      35200000
        B       #14#7514                                                35210000
#14#7490  DS     0H                                                     35220000
        DROPQUSR #PARMST2                                               35230000
        MVI     QUOTEFND,1                                              35240000
#14#7514  DS     0H                                                     35250000
*                                                                       35260000
        MVI     OP,C' '                Clear Receive area               35270000
        MVC     OP+1(L'OP-1),OP                                         35280000
        GETPARM1  1                    Get Number                       35290000
        L       R1,PARMBIN1            Get Right Number Specified       35300000
        STH     R1,#OP                                                  35310000
        LTR     R1,R1                                                   35320000
        BZ      ADDQUOTE               Zero                             35330000
        CH      R1,#PARMST2            Over end of string?              35340000
        BH      ADDQUOTE                                                35350000
        LA      R14,PARMST2            Get right hand side address      35360000
        AH      R14,#PARMST2           Point to end of it               35370000
        SR      R14,R1                 Go back required number          35380000
        SH      R1,=H'1'                                                35390000
        EX      R1,MVCRITE                                              35400000
        B       ADDQUOTE                                                35410000
*                                                                       35420000
*                                                                       35430000
MVCRITE MVC     OP(*-*),0(R14)                                          35440000
*                                                                       35450000
*                                                                       35460000
*                                                                       35470000
*                                                                       35480000
STMTSR  DS     0H                                                       35490000
*       case STMT:                                                      35500000
*       {                                                               35510000
*                                                                       35520000
        MVC     #OP,=H'4'                                               35530000
        MVC     OP(4),PRNTSTMT                                          35540000
        B       ADDQUOTE                                                35550000
*                                                                       35560000
*                                                                       35570000
*                                                                       35580000
STRIP   DS     0H                                                       35590000
*       case STRIP:                                                     35600000
*       {                                                               35610000
*                                                                       35620000
*                                                                       35630000
        CLI     PARMTYP1,3                                              35640000
        BE      #ST#5090                                                35650000
        GETPARM1 0                                                      35660000
        B       #ST#7514                                                35670000
#ST#5090  DS     0H                                                     35680000
        DROPQUSR #PARMST1                                               35690000
        MVI     QUOTEFND,1                                              35700000
#ST#7514  DS     0H                                                     35710000
        MVC     #OP(L'OP),#PARMST1                                      35720000
         LA    R1,OP                                              cvc   35730000
         LR    R15,R1                                             cvc   35740000
         AH    R15,#OP                                            cvc   35750000
         LA    R14,1                                              cvc   35760000
FBLANK1  CLI   0(R1),C' '                                         cvc   35770000
         BNE   GBLANK1                                            cvc   35780000
         BXLE  R1,R14,FBLANK1                                     cvc   35790000
         B     DONESTRP                                           cvc   35800000
GBLANK1  DS    0H                                                 cvc   35810000
* R1 points to 1st non-blank character                            cvc   35820000
         LA    R0,OP                                              cvc   35830000
         MVC   OP,0(R1)                                           cvc   35840000
         SR    R1,R0                                              cvc   35850000
         LH    R0,#OP                                             cvc   35860000
         SR    R0,R1                                              cvc   35870000
         STH   R0,#OP                                             cvc   35880000
FLASTB   LA    R15,OP-1                                           cvc   35890000
         AH    R15,#OP                                            cvc   35900000
         CLI   0(R15),C' '                                        cvc   35910000
         BNE   DONESTRP                                           cvc   35920000
         LH    R15,#OP                                            cvc   35930000
         SH    R15,=H'1'                                          cvc   35940000
         BM    DONESTRP                                           cvc   35950000
         STH   R15,#OP                                            cvc   35960000
         B     FLASTB                                             cvc   35970000
DONESTRP B      ADDQUOTE                                                35980000
*                                                                       35990000
*                                                                       36000000
*                                                                       36010000
*                                                                       36020000
SUBSTR  DS     0H                                                       36030000
*                                                                       36040000
*       case SUBSTR:                                                    36050000
*       if (Parm_Cntl < 2) goto func_err;                               36060000
*                                                                       36070000
        CLC     PARMCNTL,=H'2'                                          36080000
        BL      F14682           too few parms                          36090000
        BH      #14#7850         NOP later (leave for fresh listi ngs   36100000
#14#7850  DS     0H                                                     36110000
*                                                                       36120000
*       if (Parm_Cntl == 3)                                             36130000
*                                                                       36140000
        CLC     PARMCNTL,=H'3'                                          36150000
        BE      ##7                                                     36160000
        B       #14#8354                                                36170000
##7  DS     0H                                                          36180000
*                                                                       36190000
*       {                                                               36200000
*       if (Parm_TypeÝ3¨ != 3)                                          36210000
*                                                                       36220000
        CLI     PARMTYP3,3                                              36230000
        BE      #14#7922                                                36240000
*                                                                       36250000
*                                                                       36260000
*        {cpy(Parm_StrÝ3¨,get_value(Parm_StrÝ3¨));}                     36270000
*                                                                       36280000
*       LA      R1,#PARMST3                                             36290000
*       CALL    GETVALUE                                                36300000
*cvc    MVC     #OP,#GOTVALUE                                           36310000
        GETPARM3 0                                                      36320000
        B       #14#7946                                                36330000
#14#7922  DS     0H                                                     36340000
*                                                                       36350000
*       else                                                            36360000
*       {     dropqusr(Parm_StrÝ3¨);                                    36370000
*                                                                       36380000
        DROPQUSR #PARMST3                                               36390000
*                                                                       36400000
        MVI     QUOTEFND,1                                              36410000
#14#7946  DS     0H                                                     36420000
*                                                                       36430000
*       }                                                               36440000
*       get_parm2(1);                                                   36450000
*                                                                       36460000
        GETPARM2 1                                                      36470000
*                                                                       36480000
        GETPARM1 1                                                      36490000
#14#7970  DS     0H                                                     36500000
*                                                                       36510000
*                                                                       36520000
*       do_part_substr:                                                 36530000
*       if (dv_Parm_StrÝ3¨.curr_len >= Parm_BinÝ2¨)                     36540000
*                                                                       36550000
        CLC     #PARMST3,PARMBIN2+2                               J51   36560000
        BL      #14#8258                                                36570000
        BNE     #14#8042                                                36580000
#14#8042  DS     0H                                                     36590000
*                                                                       36600000
*                                                                       36610000
*       {   static char  *temp_substr;                                  36620000
*                                                                       36630000
*       temp_substr = Parm_StrÝ3¨;                                      36640000
*                                                                       36650000
        LA      R1,PARMST3-1                                            36660000
*                                                                       36670000
*       temp_substr = temp_substr + Parm_BinÝ2¨ - 1;                    36680000
*                                                                       36690000
        A       R1,PARMBIN2                                             36700000
*                                                                       36710000
*                                                                       36720000
*        {gencpystr(&dv_op,temp_substr);};                              36730000
*                                                                       36740000
        MVC     OP(L'OP),0(R1)                                          36750000
         LH    R14,#PARMST3      Get Current Length               J51   36760000
         S     R14,PARMBIN2      Subtract start point             J51   36770000
         BM    SUBSERR                                            J51   36780000
         STH   R14,#OP           Store in new area                J51   36790000
*                                                                       36800000
*       if (Parm_BinÝ1¨ > 0                                             36810000
*       &&  Parm_BinÝ1¨ < sizeof ( Parm_StrÝ0¨) )                       36820000
*                                                                       36830000
        L       R14,PARMBIN1     Get 3rd parameter                      36840000
        LTR     R14,R14          =0¨                                    36850000
        BM      #14#8210                                                36860000
        CH      R14,=AL2(L'PARMST1)                                     36870000
        BL      #14#8186                                                36880000
         B     ADDQUOTE                                           J51   36890000
*       B       P85NCALC                                                36900000
#14#8186  DS     0H                                                     36910000
         STH   R14,#OP                                            J51   36920000
         B     ADDQUOTE                                           J51   36930000
*                                                                       36940000
*       opÝParm_BinÝ1¨¨ = '\0';                                         36950000
*                                                                       36960000
*cvc    mov     bx,word ptr DGROUP:_Parm_Bin+4                          36970000
*cvc    MVI     opÝbx¨,0                                                36980000
#14#8210  DS     0H                                                     36990000
*                                                                       37000000
*       dv_op.curr_len = strlen(op);                                    37010000
*                                                                       37020000
*cvc    LA      R1,OP                                                   37030000
*cvc    CALL    STRLEN                                                  37040000
*cvc    STH     R1,#OP                                                  37050000
*                                                                       37060000
*                                                                       37070000
SUBSERR  DS    0H                                                   J51 37080000
         MVC   #OP,ZERO                                           J51   37090000
         B     ADDQUOTE                                           J51   37100000
*        B     P85NCALC        STORE SUBSTR REQUESTED    CHG30011 76200 37110000
         JOLRETN RC=0                                            J51    37120000
         MVC   #TKN(L'TKN+2),0(R7) SHIFT STRING TO TKN   CHG30011 76200 37130000
         BAL   R14,DROPQUOT        AND DROP QUOTES       CHG30011 76200 37140000
         MVC   #WORK(L'TKN+2),#TKN SHIFT TO WORK.        CHG30011 76200 37150000
         SPACE 1                                         CHG30011 76200 37160000
         GETTKN (R1)          GET TOKEN AFTER NAME       CHG30011 76200 37170000
        STH     R1,TKNCURR                                              37180000
         CLI   TKN,C','       IS IT A ','                CHG30011 76200 37190000
         BNE   P85SUBER       NO                         CHG30011 76200 37200000
         GETTKN (R1)          YES, GET START POSN        CHG30011 76200 37210000
        STH     R1,TKNCURR                                              37220000
         STH   R1,TKNCURR     SAVE TOKEN POINTER         CHG30011 76200 37230000
         TNUM  #TKN           CONVERT TO NUMERIC         CHG30011 76200 37240000
         LTR   R15,R15                                   CHG30011 76200 37250000
         BNZ   P85SUBER       ERROR IN CONVERSION        CHG30011 76200 37260000
         LR    R8,R1          SAVE START                 CHG30011 76200 37270000
         LA    R9,2000   **** SET OPTIONAL LENGTH HIGH   CHG30011 76200 37280000
         GETTKN TKNCURR       GET NEXT TOKEN             CHG30011 76200 37290000
        STH     R1,TKNCURR                                              37300000
         CLI   TKN,C','        ','                       CHG30011 76200 37310000
         BNE   P85SUBE1       NOPE, END PART(1) SUBSTR   CHG30011 76200 37320000
         GETTKN (R1)          GET OPTIONAL LENGTH        CHG30011 76200 37330000
        STH     R1,TKNCURR                                              37340000
         TNUM  #TKN           CONVERT TO NUMERIC         CHG30011 76200 37350000
         LTR   R15,R15                                   CHG30011 76200 37360000
         BNZ   P85SUBER                                  CHG30011 76200 37370000
         LR    R9,R1                                     CHG30011 76200 37380000
P85SUBE1 EQU   *                                         CHG30011 76200 37390000
         SPACE 2                                         CHG30011 76200 37400000
* WORK CONTAINS STRING                                   CHG30011 76200 37410000
* R8 CONTAINS START OF STRING                            CHG30011 76200 37420000
* R9 CONTAINS LENGTH TO MOVE OR A VERY HIGH NUMBER       CHG30011 76200 37430000
         SPACE 1                                         CHG30011 76200 37440000
* CALCULATE LENGTH TO MOVE (IE NEW LENGTH AFTER          CHG30011 76200 37450000
*   SUBSTR FUNCTION).                                    CHG30011 76200 37460000
         LH    R1,#WORK       GET CURRENT LENGTH         CHG30011 76200 37470000
         SR    R1,R8          -START POSN OF SUBSTR      CHG30011 76200 37480000
         A     R1,ONE         +1 COS SUBSTR STARTS AT 1 ¬0 C77263  DASD 37490000
         BNP   P85NULLX       <=0, RETURN NULL           CHG30011 76200 37500000
         CR    R1,R9          IS CURRENT LENGTH>L'REQD   CHG30011 76200 37510000
         BL    P85NSWP        YES                        CHG30011 76200 37520000
         LR    R1,R9          NO, SET TO LESSER LENGTH   CHG30011 76200 37530000
P85NSWP  STH   R1,#WORK       STORE IT                   CHG30011 76200 37540000
         LTR   R1,R1          IS LENGTH=0 <0             CHG30011 76200 37550000
         BNP   P85NULLX       YES, STORE NULL            CHG30011 76200 37560000
         BCTR  R1,0           -1 FROM R1                 CHG30011 76200 37570000
         LA    R8,WORK-1(R8)  POINT TO FIRST PART OF SUBSTR       76200 37580000
         EX    R1,P85MVCSU    MOVE                       CHG30011 76200 37590000
         B     P85NCALC        STORE SUBSTR REQUESTED    CHG30011 76200 37600000
         SPACE 3                                                        37610000
*                                                                       37620000
*                                                                       37630000
*       }                                                               37640000
*                                                                       37650000
        B       #14#8330                                                37660000
#14#8258  DS     0H                                                     37670000
*                                                                       37680000
*Here, only2 parms for SUBSTR                                           37690000
*                                                                       37700000
*       else                                                            37710000
*       {enum {dest_len=(sizeof op)-1};                                 37720000
*       if (vtyp_op & FSTR)                                             37730000
*                                                                       37740000
        B       #14#8306                                                37750000
*                                                                       37760000
*       { dv_op.curr_len=dest_len;                                      37770000
*                                                                       37780000
*cvc    MVI     _dv_op+8,253                                            37790000
*                                                                       37800000
*        memset(op,' ',dest_len);                                       37810000
*                                                                       37820000
        MVI     OP,C' '                                                 37830000
        MVC     OP+1(L'OP-1),OP                                         37840000
#14#8306  DS     0H                                                     37850000
*                                                                       37860000
*                                                                       37870000
*       }                                                               37880000
*       if (vtyp_op & VSTR)                                             37890000
*       { dv_op.curr_len=0;                                             37900000
*                                                                       37910000
*cvc    MVI     _dv_op+8,0                                              37920000
*                                                                       37930000
*        opÝ0¨=0;                                                       37940000
*                                                                       37950000
*cvc    MVI     op,0                                                    37960000
#14#8330  DS     0H                                                     37970000
*                                                                       37980000
*                                                                       37990000
        B       ADDQUOTE                                                38000000
#14#8354  DS     0H                                                     38010000
*                                                                       38020000
*       else {                                                          38030000
*       if (Parm_TypeÝ2¨ != 3)                                          38040000
*                                                                       38050000
        CLI     PARMTYP2,3                                              38060000
        BE      #14#8402                                                38070000
*                                                                       38080000
*                                                                       38090000
*        {gencpystr(&dv_Parm_StrÝ2¨,get_value(Parm_StrÝ2¨));}           38100000
*                                                                       38110000
        GETPARM2 0                                                J51   38120000
*       LA      R1,PARMST2                                              38130000
*       CALL    GETVALUE                                                38140000
*cvc    CALL    gencpystr                                               38150000
        B       #14#8426                                                38160000
#14#8402  DS     0H                                                     38170000
*                                                                       38180000
*       else                                                            38190000
*       {     dropqusr(&dv_Parm_StrÝ2¨.curr_len,Parm_StrÝ2¨);           38200000
*                                                                       38210000
        DROPQUSR  #PARMST2                                              38220000
*                                                                       38230000
        MVI     QUOTEFND,1                                              38240000
#14#8426  DS     0H                                                     38250000
*                                                                       38260000
*       }                                                               38270000
*       get_parm1(1);                                                   38280000
*                                                                       38290000
        GETPARM1 1                                                      38300000
*                                                                       38310000
*                                                                       38320000
*       {  static char *temp_substr;                                    38330000
*                                                                       38340000
*       if (dv_Parm_StrÝ2¨.curr_len >= Parm_BinÝ1¨)                     38350000
*                                                                       38360000
*cvc    mov     ax,word ptr DGROUP:dv_Parm_Str+28                       38370000
*cvc    cwd                                                             38380000
*cvc    cmp     dx,word ptr DGROUP:_Parm_Bin+6                          38390000
*cvc    jl      #14#8546                                                38400000
*cvc    BNE     #14#8522                                                38410000
*cvc    cmp     ax,word ptr DGROUP:_Parm_Bin+4                          38420000
*cvc    jb      #14#8546                                                38430000
#14#8522  DS     0H                                                     38440000
*                                                                       38450000
*       {                                                               38460000
*       temp_substr = Parm_StrÝ2¨;                                      38470000
*                                                                       38480000
*cvc    MVI     b#w+57,offset DGROUP:PARMST2                            38490000
*                                                                       38500000
*       temp_substr = temp_substr +  Parm_BinÝ1¨ -1;                    38510000
*                                                                       38520000
*cvc    mov     ax,word ptr DGROUP:b#w+57                               38530000
*cvc    add     ax,word ptr DGROUP:_Parm_Bin+4                          38540000
*cvc    dec     ax                                                      38550000
*cvc    MVI     b#w+57,ax                                               38560000
*                                                                       38570000
*                                                                       38580000
*        {gencpystr(&dv_op,temp_substr);};                              38590000
*                                                                       38600000
*                                                                       38610000
        LA      R1,PARMST2-1                                            38620000
*                                                                       38630000
*       temp_substr = temp_substr + Parm_BinÝ2¨ - 1;                    38640000
*                                                                       38650000
        A       R1,PARMBIN1                                             38660000
*                                                                       38670000
        MVC     OP(L'OP),0(R1)        temp_substr                       38680000
*                                                                       38690000
*       }                                                               38700000
*                                                                       38710000
        B       ADDQUOTE                                                38720000
#14#8546  DS     0H                                                     38730000
*                                                                       38740000
*                                                                       38750000
*       else                                                            38760000
*       {enum {dest_len=(sizeof op)-1};                                 38770000
*       if (vtyp_op & FSTR)                                             38780000
*                                                                       38790000
        B       #14#8594                                                38800000
*                                                                       38810000
*       { dv_op.curr_len=dest_len;                                      38820000
*                                                                       38830000
*cvc    MVI     _dv_op+8,253                                            38840000
*                                                                       38850000
*        memset(op,' ',dest_len);                                       38860000
*                                                                       38870000
*cvc    mov     ax,253                                                  38880000
*cvc    push    ax                                                      38890000
*cvc    mov     ax,32                                                   38900000
*cvc    push    ax                                                      38910000
*cvc    mov     ax,offset DGROUP:_op                                    38920000
*cvc    push    ax                                                      38930000
*cvc    CALL    memset                                                  38940000
*cvc    add     sp,6                                                    38950000
#14#8594  DS     0H                                                     38960000
*                                                                       38970000
*                                                                       38980000
*       }                                                               38990000
*       if (vtyp_op & VSTR)                                             39000000
*       { dv_op.curr_len=0;                                             39010000
*                                                                       39020000
*cvc    MVI     _dv_op+8,0                                              39030000
*                                                                       39040000
*        opÝ0¨=0;                                                       39050000
*                                                                       39060000
        MVI     OP,0                                                    39070000
ADDQUOTE  DS     0H                                                     39080000
*                                                                       39090000
*                                                                       39100000
*add_quotes:                                                            39110000
*       op1type=3;                                                      39120000
*                                                                       39130000
        MVI     OP1TYPE,3                                               39140000
* To make IF etc work easily,  we must add blanks at the          J52   39150000
* end of the string.                                               J52  39160000
         LH    R1,#OP            Get current length of the string J52   39170000
         LA    R15,L'OP          Get maximum length               J52   39180000
         SR    R15,R1            Length on right to blank fill.   J52   39190000
         BNP   RETQUOT           Something wrong.                 J52   39200000
         BCTR  R15,0                                              J52   39210000
         LA    R1,OP(R1)         Starting spot                    J52   39220000
         EX    R15,FILLBLNK                                       J52   39230000
*                                                                       39240000
*       return 0;                                                       39250000
*                                                                       39260000
RETQUOT  DS    0H                                                 J52   39270000
        JOLRETN  RC=0                                                   39280000
        B       F14850                                                  39290000
FILLBLNK MVC   0(*-*,R1),=CL255' '                                J52   39300000
*                                                                       39310000
*       break;                                                          39320000
*                                                                       39330000
        B       BREAK                                                   39340000
*                                                                       39350000
*                                                                       39360000
SYMBOL  DS     0H                                                       39370000
*       case SYMBOL:                                                    39380000
*                                                                       39390000
*       if ((*Parm_StrÝ1¨ == '\'')                                      39400000
*       ||      (Parm_TypeÝ1¨ == 0))                                    39410000
*                                                                       39420000
        CLI     PARMST1,C''''                                           39430000
        BE      #14#8714                                                39440000
        CLI     PARMTYP1,0                                              39450000
        BNE     #14#8786                                                39460000
#14#8714  DS     0H                                                     39470000
*       MVC     #OP(6),=H'3',C'LIT'       370 Sim Bug                   39480000
        MVC     #OP(2),=H'3'                                            39490000
        MVC      OP(3),=C'LIT'                                          39500000
        B       #14#8930                                                39510000
#14#8786  DS     0H                                                     39520000
*                                                                       39530000
*       else {                                                          39540000
*       i = getsymname(Parm_StrÝ1¨);                                    39550000
*                                                                       39560000
        LA      R1,#PARMST1                                             39570000
        CALL    GETSYM                                                  39580000
        LTR     R15,R15                                                 39590000
*                                                                       39600000
*       if (!(i > 0))                                                   39610000
*                                                                       39620000
        BZ      #14#8882                                                39630000
*                                                                       39640000
*                                                                       39650000
*       MVC     #OP(6),=H'3',C'BAD'       370 Sim Bug                   39660000
        MVC     #OP(2),=H'3'                                            39670000
        MVC      OP(3),=C'BAD'                                          39680000
        B       #14#8930                                                39690000
#14#8882  DS     0H                                                     39700000
*                                                                       39710000
*       MVC     #OP(6),=H'3',C'VAR'       370 Sim Bug                   39720000
        MVC     #OP(2),=H'3'                                            39730000
        MVC      OP(3),=C'VAR'                                          39740000
*                                                                       39750000
#14#8930  DS     0H                                                     39760000
*                                                                       39770000
*                                                                       39780000
*        };                                                             39790000
*       }                                                               39800000
        B       ADDQUOTE                                                39810000
*                                                                       39820000
*       break;                                                          39830000
*                                                                       39840000
        B       BREAK                                                   39850000
*                                                                       39860000
TYPE      DS     0H                                                     39870000
*                                                                       39880000
*case TYPE:                                                             39890000
*                                                                       39900000
P85TYPE  DS    0H                                                 J52   39901000
        CLI     PARMST1,C''''                                     J52   39902000
        BE      TYPELITX                                          J52   39903000
        CLI     PARMTYP1,0                                        J52   39904000
        BE      TYPENUMX                                          J52   39905000
*        BAL   R6,P85GETNM    GET NAME                   CHG30011 76200 39910000
         FINDSYM PARMST1       FIND THE SYMBOLIC (BIN SEARCH)     87150 39911000
         LTR   R15,15          DID WE FIND IT?                          39914000
         BNZ   P85NULLX        Didn't get it.                     87150 39915000
         LR    R5,R0           SYMNAME POINTER                          39916000
         USING SYMOVLY,R5                                CHG30011       39917000
* NAME NOT THERE                                         CHG30011       39918000
*        JOLERR 425,'%',#TKN,' NOT FOUND FOR TYPE '      CHG30011       39919000
*        JOLERR '410#TKN NOT FOUND FOR'                                 39919100
         SPACE 3                                                        39919400
*85GETDT DS    0H                                                       39919500
         LR    R5,R0          GET ADDRESS OF SYMBOLIC TABLE             39919600
         L     R1,SYMADDR     GET ADDRESS SYMBOLIC       CHG30011       39919700
         DROP  R5                                                 J52   39919800
         MVC   DBL(2),0(R1)   SHIFT LENGTH SO NO 0C6     CHG30011       39919900
*        LH    R1,DBL         LOAD R8 WITH THE LENGTH    CHG30011       39920000
*        LTR   R15,R15        DID WE GET IT              CHG30011       39920200
         B     P85TYPE2                                  CHG30011       39930000
P85NULLX MVC   #OP,ZERO                                  CHG30011       39940000
         MVI   OP,C' '                                            J52   39941000
         B     ADDQUOTE       STORE BLANK AS RETURN      CHG30011C      39950000
P85TYPE2 EQU   *                                         CHG30011       39960000
         MVC   #WORK(L'TKN),0(R1)   SHIFT SYMBOLIC VALUE JOL30011       39980000
         TNUM  #WORK          TEST NUMERIC               JOL30011       39990000
         LTR   R15,R15         IS IT ?                   JOL30011       40000000
         BNZ   P85TYPNN       NOT NUMERIC                JOL30011       40010000
TYPENUMX MVC   OP(3),=C'NUM'                             JOL30011 J52   40020000
P85SET3  MVC   #OP,=H'3'                                 JOL30011 J52   40030000
         B     ADDQUOTE       GO STORE                   JOL30011 76200 40040000
P85TYPNN CLI   2(R7),C''''    IS IT LITERAL ?            JOL30011 76200 40050000
         BNE   P85NTLIT       NOT A LITERAL              JOL30011 76200 40060000
TYPELITX MVC   OP(3),=C'LIT' SET 'LIT'                   JOL30011 J52   40070000
         B     P85SET3        SET LENGTH TO 3, GO TO STR JOL30011 76200 40080000
P85NTLIT EQU   *                                         JOL30011 76200 40090000
* MUST BE CHAR                                           JOL30011 76200 40100000
         MVC   #OP,=H'4'                                 JOL30011 J52   40110000
         MVC   OP(4),=C'CHAR'                            JOL30011 J52   40120000
         B     ADDQUOTE                                  JOL30011 76200 40130000
         SPACE 3                                         JOL30011 76200 40140000
*                                                                       40150000
*       if (*Parm_StrÝ1¨ == '\'')                                       40160000
*                                                                       40170000
        CLI     PARMST1,C''''                                           40180000
        BNE     #14#9074                                                40190000
*                                                                       40200000
*       MVC     #OP(6),=H'3',C'LIT'       370 Sim Bug                   40210000
        MVC     #OP(2),=H'3'                                            40220000
        MVC      OP(3),=C'LIT'                                          40230000
        B       #14#9674                                                40240000
#14#9074  DS     0H                                                     40250000
*                                                                       40260000
*       else if (Parm_TypeÝ1¨ == 0)                                     40270000
*                                                                       40280000
        CLI     PARMTYP1,0                                              40290000
        BNE     #14#9170                                                40300000
*                                                                       40310000
*                                                                       40320000
*       MVC     #OP(6),=H'3',C'NUM'        370 Sim Bug                  40330000
        MVC     #OP(2),=H'3'                                            40340000
        MVC      OP(3),=C'NUM'                                          40350000
        B       #14#9674                                                40360000
#14#9170  DS     0H                                                     40370000
*                                                                       40380000
*       else                                                            40390000
*       {                                                               40400000
*       i = GETSYMty(Parm_StrÝ1¨);                                      40410000
*                                                                       40420000
        LA      R1,#PARMST1                                             40430000
        CALL    GETSYMTY                                                40440000
*                                                                       40450000
*       if (!(i > 0)) goto store_zero;                                  40460000
*                                                                       40470000
        LTR     R15,R15                                                 40480000
        BP      #14#9242                                                40490000
        B       P18FALSE                                                40500000
        B       #14#9242                                                40510000
#14#9242  DS     0H                                                     40520000
*                                                                       40530000
*       else                                                            40540000
*       {                                                               40550000
*                                                                       40560000
*                                                                       40570000
*       }                                                               40580000
*                                                                       40590000
*       if (*op == '\'')                                                40600000
*                                                                       40610000
        CLI     OP,C''''                                                40620000
        BNE     #14#9482                                                40630000
*                                                                       40640000
*       {                                                               40650000
*       dropqusr(&dv_op.curr_len,op);                                   40660000
*                                                                       40670000
        DROPQUSR #OP                                                    40680000
*                                                                       40690000
*       i=strtol(op, &conv_code,10);                                    40700000
*                                                                       40710000
        TNUM    #OP                                                     40720000
*                                                                       40730000
*       if ((dv_op.curr_len > 0) && (*conv_code == 0))                  40740000
*                                                                       40750000
        LTR     R15,R15                                                 40760000
        BNZ     #14#9386                                                40770000
*       MVC     #OP(5),=H'3',C'NUM'        370 Sim Bug                  40780000
        MVC     #OP(2),=H'3'                                            40790000
        MVC      OP(3),=C'NUM'                                          40800000
        B       #14#9458                                                40810000
#14#9386  DS     0H                                                     40820000
*       MVC     #OP(5),=H'3',C'LIT'         370 Sim Bug                 40830000
        MVC     #OP(2),=H'3'                                            40840000
        MVC      OP(3),=C'LIT'                                          40850000
*       else                                                            40860000
*       {{enum{tlen=sizeof "LIT"};                                      40870000
#14#9458  DS     0H                                                     40880000
*                                                                       40890000
*                                                                       40900000
        B       #14#9674                                                40910000
#14#9482  DS     0H                                                     40920000
*                                                                       40930000
*       else                                                            40940000
*       {                                                               40950000
*       i=strtol(op, &conv_code,10);                                    40960000
*                                                                       40970000
        TNUM    #OP                                                     40980000
*                                                                       40990000
*       if ((dv_op.curr_len > 0) && (*conv_code == 0))                  41000000
*                                                                       41010000
        CLC     #OP,=H'0'                                               41020000
        BNH     #14#9602                                                41030000
        LTR     R15,R15                                                 41040000
        BNZ     #14#9602                                                41050000
*                                                                       41060000
*       MVC     #OP(5),=H'3',C'NUM'         370 Sim Bug                 41070000
        MVC     #OP(2),=H'3'                                            41080000
        MVC      OP(3),=C'NUM'                                          41090000
        B       #14#9674                                                41100000
#14#9602  DS     0H                                                     41110000
*                                                                       41120000
*                                                                       41130000
*                                                                       41140000
*       else                                                            41150000
*       MVC     #OP(6),=H'4',C'CHAR'        370 Sim Bug                 41160000
        MVC     #OP(2),=H'4'                                            41170000
        MVC      OP(4),=C'CHAR'                                         41180000
#14#9674  DS     0H                                                     41190000
*                                                                       41200000
*       }                                                               41210000
        B       ADDQUOTE                                                41220000
*                                                                       41230000
*                                                                       41240000
UPPER   DS     0H                                                       41250000
*                                                                       41260000
*       case UPPER:                                                     41270000
*       goto make_caps;                                                 41280000
*                                                                       41290000
        B      CAPS                                                     41300000
*                                                                       41310000
USERID  DS     0H                                                       41320000
*                                                                       41330000
*       case USERID:                                                    41340000
*       {                                                               41350000
        MVC #OP,=H'7'                                                   41360000
*cvc    MVC  OP(8),SYSUID                                               41370000
        B       ADDQUOTE                                                41380000
*                                                                       41390000
*       break;                                                          41400000
*                                                                       41410000
        B       BREAK                                                   41420000
*                                                                       41430000
WHEREXA DS     0H                                                       41440000
*                                                                       41450000
*       case WHEREX:                                                    41460000
*       op1bin = wherex();                                              41470000
*                                                                       41480000
*       CALL    WHEREX                                                  41490000
*       cwd                                                             41500000
*       MVI     op1bin,ax                                               41510000
*       MVI     op1bin+2,dx                                             41520000
*                                                                       41530000
*       goto store_bin;                                                 41540000
*                                                                       41550000
        B       STRBIN                                                  41560000
*                                                                       41570000
*       break;                                                          41580000
*                                                                       41590000
        B       BREAK                                                   41600000
*                                                                       41610000
WHEREYA DS     0H                                                       41620000
*                                                                       41630000
*       case WHEREY:                                                    41640000
*       op1bin = wherey();                                              41650000
*                                                                       41660000
*       CALL    WHEREY                                                  41670000
*       cwd                                                             41680000
*       MVI     op1bin,ax                                               41690000
*       MVI     op1bin+2,dx                                             41700000
*                                                                       41710000
*       goto store_bin;                                                 41720000
*                                                                       41730000
        B       STRBIN                                                  41740000
*                                                                       41750000
*       break;                                                          41760000
*                                                                       41770000
        B       BREAK                                                   41780000
#14#9914  DS     0H                                                     41790000
*                                                                       41800000
*                                                                       41810000
*                                                                       41820000
*       default:                                                        41830000
*                                                                       41840000
        JOLERR   319,'Function ''',OP1,''' Not Yet Implemented'         41850000
*                                                                       41860000
*                                                                       41870000
        JOLRETN  RC=4                                                   41880000
        B       BADRETN                                                 41890000
BREAK      DS     0H                                                    41900000
*                                                                       41910000
*       }                                                               41920000
*       return 0;                                                       41930000
*                                                                       41940000
        JOLRETN  RC=0                                                   41950000
        B       F14850                                                  41960000
*                                                                       41970000
INVALOP DS     0H                                                       41980000
*                                                                       41990000
*invalid_op:                                                            42000000
*                                                                       42010000
        JOLERR  330,'Expression Has Invalid Operator ''',OPRL2,''''     42020000
*       WTO     OPRL2                                                   42030000
*       HALT                                                            42040000
        JOLRETN RC=4                                                    42050000
STORNUM    DS     0H                                                    42060000
*                                                                       42070000
*       }                                                               42080000
*store_num :                                                            42090000
*       op1type=0;                                                      42100000
*                                                                       42110000
        MVI      OP1TYPE,0                                              42120000
*                                                                       42130000
*       ltoa(op1dec, op, 10);                                           42140000
*                                                                       42150000
*       L       R1,OP1BIN                                               42160000
*       CVD     R1,DBL                                                  42170000
STRDEC  MVC     OP+8(8),BLANKS                                          42180000
        MVI     QUOTEFND,0             don't want quotes on numbers     42190000
        UNPK    OP(8),OP1DEC                                            42200000
        OI      OP+7,X'F0'                                              42210000
        MVC     #OP,=H'8'                                               42220000
        LA      R0,#OP                                                  42230000
        LA      R14,OP1DEC                                              42240000
        LA      R15,OP2DEC                                              42250000
         MVC   WORK(30),BLANKS CLEAR A FEW BYTES OF WORK          75128 42260000
         UNPK WORK(13),OP1DEC                                           42270000
         OI    WORK+12,X'F0'                                            42280000
         LA    R1,WORK                                                  42290000
         LA    R15,WORK+12                                              42300000
         LA    R14,1                                                    42310000
P85FINDN CLI   0(R1),C'0'                                               42320000
         BNE   P85ASTRT                                                 42330000
         BXLE  R1,R14,P85FINDN                                          42340000
         MVI   OP,C'0'                                            75049 42350000
         MVI   OP+1,C' '                                          75049 42360000
         MVI   #OP+1,1         SET LENGTH TO 1                    74303 42370000
        B       STORE                                                   42380000
*        B     P85STOR                                                  42390000
P85ASTRT MVC   #OP+2(13),0(R1)                                          42400000
         SR    R15,R1                                                   42410000
         LA    R15,1(R15)                                               42420000
         STH   R15,#OP                                                  42430000
         SPACE 1                                                  75128 42440000
* NOW, IF THE ANSWER IS -VE, WE MUST PUT A '-' IN THE ANSWER      75128 42450000
*  BEFORE WE STORE IT.                                            75128 42460000
         CP    OP1DEC,=P'0'                                       75128 42470000
         BNM   STORE                                              75128 42480000
         LA    R15,1(R15)     ADD 1 TO LENGTH                     75128 42490000
         STH   R15,#WORK      STORE IN #WORK                      75128 42500000
         MVI   WORK+0,C'-'    SHIFT IN - SIGN                     75128 42510000
         MVC   WORK+1(30),OP  SHIFT IN NUMBER                     75128 42520000
         MVC   #OP(L'OP+2),#WORK                                        42530000
        B       STORE                                                   42540000
*       HALT                                                            42550000
*       TNUM    OP                                                      42560000
STORE   DS     0H                                                       42570000
*                                                                       42580000
*                                                                       42590000
*       store:;                                                         42600000
*       reduce:;                                                        42610000
*                                                                       42620000
*       if (*op == ' ') {                                               42630000
*                                                                       42640000
        CLI     OP,C' '                                                 42650000
        BNE     F14346                                                  42660000
*                                                                       42670000
*       if (*op == ' ')                                                 42680000
*                                                                       42690000
        CLI     OP,C' '                                                 42700000
        BNE     F14322                                                  42710000
*                                                                       42720000
*       {                                                               42730000
*                                                                       42740000
        B       F14274                                                  42750000
*                                                                       42760000
*       { dv_op.curr_len=dest_len;                                      42770000
*                                                                       42780000
*cvcvc  MVI     _dv_op+8,253                                            42790000
*                                                                       42800000
*        memset(op,' ',dest_len);                                       42810000
*                                                                       42820000
*cvcvc  MVC     OP(DEST_LEN),BLANKS                                     42830000
F14274     DS     0H                                                    42840000
*                                                                       42850000
*                                                                       42860000
*       }                                                               42870000
*       if (vtyp_op & VSTR)                                             42880000
*       { dv_op.curr_len=0;                                             42890000
*                                                                       42900000
*cvcvc  MVI     _dv_op+8,0                                              42910000
*                                                                       42920000
*        opÝ0¨=0;                                                       42930000
*                                                                       42940000
        MVI     OP,0                                                    42950000
*                                                                       42960000
*       goto symblank;                                                  42970000
*                                                                       42980000
        B       F14346                                                  42990000
F14322     DS     0H                                                    43000000
*                                                                       43010000
*       }                                                               43020000
*       memcpy(op, &opÝ1¨, dv_op.curr_len);                             43030000
*                                                                       43040000
        MVC     OP(L'OP-1),OP+1                                         43050000
*                                                                       43060000
*       op.curr_len=op.curr_len - 1;                                    43070000
*                                                                       43080000
        LH      R1,#OP                                                  43090000
        SH      R1,=H'1'                                                43100000
        STH     R1,#OP                                                  43110000
*                                                                       43120000
        B       STORE                                                   43130000
F14346     DS     0H                                                    43140000
*                                                                       43150000
*       }                                                               43160000
*       symblank:;                                                      43170000
*       store_char :;                                                   43180000
*       return 0;                                                       43190000
*                                                                       43200000
        SR      R1,R1                                                   43210000
        B       F14850                                                  43220000
STRBIN  DS     0H                                                       43230000
*                                                                       43240000
*       store_bin:;                                                     43250000
*       op1type= 0;                                                     43260000
*                                                                       43270000
        MVI     OP1TYPE,0                                               43280000
*                                                                       43290000
*       ltoa(op1bin, op,10);                                            43300000
*                                                                       43310000
        L       R1,OP1BIN                                               43320000
        CVD     R1,DBL                                                  43330000
        ZAP     OP1DEC,DBL                                              43340000
        B       STRDEC                                                  43350000
*                                                                       43360000
        UNPK    OP(8),DBL                                               43370000
        OI      OP+7,X'F0'                                              43380000
*                                                                       43390000
*       goto store;                                                     43400000
*                                                                       43410000
        B       STORE                                                   43420000
P18FALSE   DS     0H                                                    43430000
*                                                                       43440000
*                                                                       43450000
*store_zero:;                                                           43460000
*                                                                       43470000
        MVC     #OP,=H'1' ,C'0'                                         43480000
        MVI      OP,C'0'                                                43490000
*                                                                       43500000
F14466     DS     0H                                                    43510000
*                                                                       43520000
*       }                                                               43530000
*       };                                                              43540000
*retnum:;                                                               43550000
*       op1type= 0;                                                     43560000
*                                                                       43570000
        MVI     OP1TYPE,0                                               43580000
*                                                                       43590000
*       return 0;                                                       43600000
*                                                                       43610000
        JOLRETN  RC=0                                                   43620000
*                                                                       43630000
*store_one:                                                             43640000
*                                                                       43650000
        MVC     #OP(2),=H'1' ,C'1'                                      43660000
        MVI      OP,C'1'                                                43670000
*       };                                                              43680000
*       goto retnum;                                                    43690000
*                                                                       43700000
        B       F14466                                                  43710000
P18TRUE    DS     0H                                                    43720000
*                                                                       43730000
*       store_minus1:                                                   43740000
*       op1type=0;                                                      43750000
*                                                                       43760000
        MVI     OP1TYPE,0                                               43770000
        MVC     #OP(2),=H'2' ,C'-1'                                     43780000
        MVC      OP(2),=C'-1'                                           43790000
*                                                                       43800000
*                                                                       43810000
*       return 0;                                                       43820000
*                                                                       43830000
        JOLRETN RC=0                                                    43840000
F14682     DS     0H                                                    43850000
*                                                                       43860000
*                                                                       43870000
*                                                                       43880000
*       func_err:                                                       43890000
        JOLERR  321,'Invalid Number of Parameters (',PARMCNTL,         *43900000
               ') for Function ',OP1                                    43910000
        JOLRETN RC=4                                                    43920000
BADRETN    DS     0H                                                    43930000
*                                                                       43940000
F14850     DS     0H                                                    43950000
*                                                                       43960000
*       }                                                               43970000
*                                                                       43980000
        JOLRETN  RC=0                                                   43990000
P18PACK1 PACK OP1DEC,OP1(*-*) PACK 1ST NUMBER,EX SETS 2ND LENGTH        44000000
P18PACK2 PACK OP2DEC,OP2(*-*) PACK 2ND NUMBER,EX SETS 2ND LENGTH        44010000
        LTORG                                                           44020000
        DS   0D                                                         44030000
FUNCTBL DC   CL8'CAPS    '                                              44040000
FUNCNOP DC   F'1'            Could be Half word, but needs to be padded 44050000
*                         anyway for the next address constant, so ..   44060000
FUNCADR DC   A(CAPS)                                                    44070000
        ENTRY CAPS                                                      44080000
        DC   CL8'CARD    ',F'1',A(CARDRTN)                              44090000
        ENTRY CARDRTN                                                   44100000
        DC   CL8'CENTER  ',F'2',A(CENTER)                               44110000
        ENTRY CENTRE                                                    44120000
        DC   CL8'CENTRE  ',F'2',A(CENTRE)                               44130000
        DC   CL8'CHAR    ',F'1',A(CHAR)                                 44140000
        ENTRY CHAR                                                      44150000
*       DC   CL8'CURSOR  ',F'1',A(CURSOR)                               44160000
*       DC   CL8'DEF     ',F'1',A(DEF)                                  44170000
*       DC   CL8'DEFINED ',F'1',A(DEFINED)                              44180000
*       DC   CL8'DOSCD   ',F'1',A(DOSCD)                                44190000
*       DC   CL8'DOSCHDIR',F'1',A(DOSCHDIR)                             44200000
*       DC   CL8'DOSDRIVE',F'1',A(DOSDRIVE)                             44210000
*       DC   CL8'DOSENV  ',F'1',A(DOSENV)                               44220000
*       DC   CL8'DOSVOLUM',F'1',A(DOSVOLUM)                             44230000
        DC   CL8'EOF     ',F'1',A(EOF)                                  44240000
        DC   CL8'EXIST   ',F'1',A(EXIST)                                44250000
        DC   CL8'GETENV  ',F'1',A(GETENV)                               44260000
        DC   CL8'INDEX   ',F'2',A(INDEX)                                44270000
        ENTRY INDEX                                                     44280000
        DC   CL8'INKEY   ',F'0',A(INKEY)                                44290000
        DC   CL8'LEFT    ',F'2',A(LEFT)                                 44300000
        ENTRY LEFT                                                      44310000
        DC   CL8'LENGTH  ',F'1',A(LENGTH)                               44320000
        ENTRY LENGTH                                                    44330000
*       genfunc (LINEIN,1)                                              44340000
*       genfunc (LINEOUT,1)                                             44350000
*       genfunc (LINESIZE,1)                                            44360000
        DC   CL8'LIST    ',F'1',A(LIST)                                 44370000
        ENTRY LIST                                                      44380000
        DC   CL8'LOWER   ',F'1',A(LOWER)                                44390000
        ENTRY LOWER                                                     44400000
*       genfunc (MAX,2)                                                 44410000
*       genfunc (MIN,2)                                                 44420000
        DC   CL8'POS     ',F'2',A(POS)                                  44430000
        ENTRY POS                                                       44440000
        DC   CL8'PUTENV  ',F'1',A(PUTENV)                               44450000
        DC   CL8'RIGHT   ',F'2',A(RIGHT)                                44460000
        ENTRY RIGHT                                                     44470000
*       DC   CL8'SCRSIZE ',F'1',A(SCRSIZE)                              44480000
*       genfunc (SIGN,1)                                                44490000
*       genfunc (SOURCELINE,0)                                          44500000
        DC   CL8'STMT    ',F'0',A(STMTSR)                               44510000
        DC   CL8'STRIP   ',F'-1',A(STRIP)                               44520000
        DC   CL8'SUBSTR  ',F'-1',A(SUBSTR)                              44530000
        ENTRY SUBSTR                                                    44540000
        DC   CL8'SYMBOL  ',F'1',A(SYMBOL)                               44550000
        ENTRY SYMBOL                                                    44560000
*if 0                                                                   44570000
*       genfunc (TRIM,1)                                                44580000
*endif                                                                  44590000
        DC   CL8'TYPE    ',F'1',A(TYPE)                                 44600000
        ENTRY TYPE                                                      44610000
        DC   CL8'UPPER   ',F'1',A(UPPER)                                44620000
        DC   CL8'USERID  ',F'0',A(USERID)                               44630000
        DC   CL8'WHEREX  ',F'0',A(WHEREXA)                              44640000
        DC   CL8'WHEREY  ',F'0',A(WHEREYA)                              44650000
FTABEND DC   A(*)                                                       44660000
FTABLEN DC   AL2(8+4+4)                                                 44670000
FTABCNT DC   AL2((*-FUNCTBL)/12)                                        44680000
*                                                                       44690000
*       END                                                             44700000
*                                                                       44710000
*                                                                       44720000
*XX15          DSECT                                                    44730000
*TEMP85  JOLSAVE                                                        44740000
*                                                                       44750000
*                                                                       44760000
         FIX   'IT ALSO HAS TO DO SOME OTHER THINGS: SEE SUBSTR'  J40B  44770000
P85CAP90 DS    0H             STORE ANSWER               CHG30011 76200 44780000
         JOLRETN RC=0                                                   44790000
P85NFUNC EQU   *                                                        44800000
* NOW REMOVE QUOTES IF THEY ARE ON EITHER STRING                        44810000
           SPACE 1                                                74303 44820000
* THIS NEXT BIT OF CODE PERFORMS THE FOLLOWING:-                  74303 44830000
*  IF WE ARE CONCATENATING 2 STRINGS LIKE 'A'||'B' WE WANT        74303 44840000
*  THE RESULT TO BE STORED WITH QUOTES STILL AROUND THE RESULTANT 74303 44850000
*  STRING. HOWEVER,IN ANY OTHER CASE,WE DON'T CARE.               74303 44860000
* THE REASON FOR THIS IS SO THAT THE TYPE FUNCTION CAN BE USED    74303 44870000
*  TO TEST IF THE STRING IS A LITERAL STRING, EG IF TYPE(%A)='LIT'74303 44880000
*  WILL WORK CORRECTLY.                                           74303 44890000
         CLC   DBL(2),BLANKS NO SECOND PART??                     76200 44900000
         BE    P85NCALC                                           76200 44910000
         CLC   DBL(2),=C'||'    CONCATENATION ?                   74303 44920000
         BE    P85CAT1          NO,->                             74303 44930000
         CLC   DBL(2),=C'!!'    CONCATENATION ?                   74303 44940000
         BNE   P85NOTC1         NO,->                             74303 44950000
P85CAT1  CLI   WORK,C''''                                         74303 44960000
         BNE   P85NOTC1                                           74303 44970000
         CLC   #TKN,ZERO      ANY 2ND ITEM?                 FIX-X 76200 44980000
         BE    P85NCALC                                           76200 44990000
         CLI   TKN,C''''                                          74303 45000000
         BNE   P85NOTC1                                           74303 45010000
* WELL,DROP THE END QUOTE OF THE WORK AREA,AND THE BEGINNING      74303 45020000
*  QUOTE OFF TKN                                                  74303 45030000
         LH    R1,#WORK                                           74303 45040000
         BCTR  R1,0                                               74303 45050000
         STH   R1,#WORK                                           74303 45060000
         LH    R1,#TKN                                            74303 45070000
         BCTR  R1,0                                               74303 45080000
         STH   R1,#TKN                                            74303 45090000
         MVC   TKN(L'TKN-1),TKN+1                                 74303 45100000
         B     P85CONCT        GO DO CONCATENATION                74303 45110000
         SPACE 2                                                  74303 45120000
P85NOTC1 EQU   *                                                  74303 45130000
         CLI   WORK,C''''                                               45140000
         BNE   P85NQU1                                                  45150000
         MVC   WORK(L'TKN),WORK+1 DROP 1ST QUOTE         JOL30035 76200 45160000
         LH    R1,#WORK                                                 45170000
         SH    R1,=H'2'                                                 45180000
         STH   R1,#WORK                                                 45190000
P85NQU1  EQU    *                                                       45200000
         CLI   TKN,C''''                                                45210000
         BNE   P85NQU2                                                  45220000
         MVC   TKN(L'TKN),TKN+1   DROP 1ST QUOTE         JOL30035 76200 45230000
         LH    R1,#TKN                                                  45240000
         SH    R1,=H'2'                                                 45250000
         STH   R1,#TKN                                                  45260000
P85NQU2  EQU    *                                                       45270000
         CLC   DBL(2),BLANKS                                            45280000
         BE    P85NCALC        A STRAIGHT ASSIGNMENT IS REQUIRD         45290000
         CLC   DBL(2),=C'||'   CONCATENATE                              45300000
         BE    P85CONCT        YES,GO DO CONCAT                         45310000
         CLC   DBL(2),=C'!!'   CONCATENATE                              45320000
         BE    P85CONCT        YES,GO DO CONCAT                         45330000
*cvc     JOLERR 308,'INVALID ASSIGN:-STRING IS ''',#TKNSTRG,''''  75128 45340000
         JOLERR 308,'INVALID ASSIGN:-STRING IS ''',#TKNSTRG,''''  75128 45350000
         B     P85SET0        SET ANSWER TO 0                     75128 45360000
         SPACE 2                                                  75128 45370000
P85ARITH EQU   *                                                  75128 45380000
* HERE THE OPERATOR MUST BE A NUMERIC ONE                               45390000
* NOW LOOK AT THE OPERATOR AND PERFORM THE DESIRED ACTION               45400000
         CLI   DBL,C'+'                                                 45410000
         BE    P85PLUS                                                  45420000
         CLI   DBL,C'-'                                                 45430000
         BE    P85MINUS                                                 45440000
         CLI   DBL,C'*'                                                 45450000
         BE    P85MULT                                                  45460000
         CLI   DBL,C'/'                                                 45470000
         BE    P85DIV                                                   45480000
         MVC   TKN(2),DBL      SHIFT OFFENDING <OPERATOR> IN      74303 45490000
         MVI   #TKN+1,2        AND SET LENGTH=2                         45500000
*cvc     JOLERR 301,'''',#TKN,''' IS AN INVALID ARITHMETIC OPERATOR'    45510000
         JOLERR 322,#TKN,''' IS AN INVALID ARITHMETIC OPERATOR'         45520000
P85SET0  EQU   *                                                  75128 45530000
         ZAP   P85NO1,=P'0'    SET ANSWER TO ZERO                       45540000
         B     P85SANS         STORE THE ANSWER                         45550000
P85CONV1 MVC   #TKN(L'TKN+2),#WORK                                74303 45560000
P85CONV2 DS    0H                                                       45570000
*cvc     JOLERR '302ERROR CONVERTING ''' ,#TKN,''' TO ARITHMETIC'       45580000
         JOLERR 302,'ERROR CONVERTING ''',#TKN,''' TO ARITHMETIC'       45590000
         ZAP   P85NO1,=P'0'    SET ANSWER TO ZERO                       45600000
         B     P85SANS         STORE THE ANSWER                         45610000
P85ZEDIV DS    0H                                                       45620000
         JOLERR 304,'ZERO DIVIDE CONDITION'                             45630000
P85RZERO EQU   *                                                  76200 45640000
         ZAP   P85NO1,=P'0'    SET ANSWER TO ZERO                       45650000
         B     P85CONVA                                                 45660000
         SPACE 3                                                        45670000
P85CONCT BAL   R14,CONCAT     CONCATENATE ITEMS TO WORK           75128 45680000
         LTR   R15,R15        DID CONCAT WORK ?                   75128 45690000
         BZ    P85MACRO       GO STORE RESULT NOW                 75128 45700000
         JOLERR 403,'LENGTH ERROR CONCATENATING ''',#TKN,''''           45710000
*        JOLERR '403LENGTH ERROR CONCATENATING ''' ,#TKN,''''           45720000
         B     P85STOR                                                  45730000
P85PLUS  AP    P85NO1,P85NO2   ADD THE NUMBERS                          45740000
         B     P85CONVA        CONVERT ANSWER                           45750000
P85MINUS SP    P85NO1,P85NO2   SUBTRACT THE NUMBERS                     45760000
         B     P85CONVA                                                 45770000
P85MULT  EQU    *                                                  DASD 45780000
         ZAP   WORK(15),P85NO1    LETS NOT 0C7 OK                  DASD 45790000
         MP    WORK(15),P85NO2    MULTIPLY THE NUMBERS             DASD 45800000
         MVC   P85NO1,WORK+5      MOVE BACK THE ANSWER             DASD 45810000
         B     P85SANS                                                  45820000
P85DIV   CP    P85NO2,=P'0'                                             45830000
         BZ    P85ZEDIV                                                 45840000
         DP P85NO1,P85NO2      DO THE DIVIDE                            45850000
*******************IGNORE THE REMAINDER FOR NOW                         45860000
* LATER WE MAY LET THE GUY SAY %X=%Y/100 AND %Z = REMAINDER (OR SOME    45870000
*     SUCH RUBISH).                                                     45880000
         SPACE                                                          45890000
* NOW SHIFT THE ANSWER BACK DOWN TO THE RIGHT SPOT                      45900000
         ZAP   P85NO1,P85NO1(L'P85NO1-L'P85NO2)                         45910000
P85SANS  EQU   *                                                        45920000
P85CONVA EQU    *                                                       45930000
* STORE THE ANSWER.                                                     45940000
P85STOR  EQU   *                                                        45950000
         MVC   #WORK(L'TKN+2),#TKN                                      45960000
P85MACRO EQU   *                                                        45970000
P85NCALC EQU    *                                                       45980000
* NOW TO STORE THE ANSWER                                               45990000
* NOW,INITIALLY,SHIFT THE VALUE IN IF IT WILL FIT.HOWEVER,WE      74303 46000000
*  WON'T SET ANY OF THE POINTERS TILL WE POP THE NAME IN THE      74303 46010000
*  STACK,SO IF WE DON'T PUT THE NAME IN FOR SOME REASON,WE WILL   74303 46020000
*  ONLY HAVE WASTED A MOVE.                                       74303 46030000
         JOLRETN RC=0                                             J51   46040000
         SR    R8,R8            R8=REORG INDICATOR IF VALUE WON'T       46050000
*                               FIT,CALL REORG AND TRY AGAIN IT IT      46060000
*                               STILL WON'T FIT -> ERROR                46070000
P85TVFIT L     R1,ASYMTBL      LOAD THE ADDRESS OF THE TABLE      74303 46080000
         AH    R1,SYMLEN       +LENGTH =LAST USEABLE ADDRESS      74303 46090000
*                              IN THE TABLE                       74303 46100000
         L     R6,ANEXTSYM     LOAD A(NEXTSYM)                    74303 46110000
         LR    R7,R6           SAVE IT FOR A MINUTE               74303 46120000
         LH    R15,#WORK       LOAD LENGTH OF STRING TO GO IN     74303 46130000
         LA    R15,1(R15)      ADD 2-1 (#WORK=2,-1 FOR EXECUTE)   75128 46140000
         AR    R6,R15          ADD IT TO R6                       74303 46150000
         CR    R6,R1           WILL IT FIT ?                      74303 46160000
         BNL   P85REORG        NO,REORG TABLE                     74303 46170000
         EX    R15,P85MVCVA    SHIFT VALUE INTO TABLE             74303 46180000
         LA    R6,1(R7,R15)    SET R6 TO NEXT AVAILABLE SPOT      74303 46190000
*                              WHICH IS (ANEXTSYM+L'VALUE)        74303 46200000
* FIRST LETS SEE IF THE NAME IS ALREADY IN THE STACK.                   46210000
*cvc     FINDSYM SYMBOLIC      FIND THE SYMBOLIC (BIN SEARCH)     87150 46220000
         LA  R1,SYMBOLIC      FIND THE SYMBOLIC (BIN SEARCH)     87150  46230000
         CALL  GETSYM          FIND THE SYMBOLIC (BIN SEARCH)     7150  46240000
         STH   R1,P85TBLPS     SAVE POSITION FOR BINARY LOOKUP TABLE    46250000
         STH   R15,P85WASFN    WAS FOUND INDICATOR                      46260000
         LR    R5,R0           SYMNAME POINTER                          46270000
         LTR   R15,15          DID WE FIND IT?                          46280000
         BNZ   P85NOTFN                                                 46290000
         B     P85GOTNM        WE HAVE IT                         7150  46300000
         L     R5,ASYMTBL      ADDRESS SYMBOLIC TABLE                   46310000
         LH    R1,NOSYMS       NO USED SO FAR.                          46320000
         MH    R1,=H'12'       LENGTH TABLE ENTRIES                     46330000
         LR    R15,R5                                                   46340000
         AR    R5,R1                                                    46350000
         LH    R14,=H'-12'                                              46360000
         USING SYMOVLY,R5                                               46370000
P85FNAME CLC   SYMBOLIC(8),SYMNAME                                      46380000
         BE    P85GOTNM                                                 46390000
         BXH   R5,R14,P85FNAME                                          46400000
* NAME NOT HERE SO ENTER IT INTO THE STACK PROVIDED THAT                46410000
*     THERE IS ROOM TO ENTER THE SYMBOLIC NAME IN THE TABLE       74303 46420000
*     OF SYMBOLIC NAMES.                                          74303 46430000
P85NOTFN EQU   *                                                  74303 46440000
P85STRIT LH    R1,NOSYMS                                                46450000
         LR    R5,R1           PUT NON-INCREMENTED VALUE IN R5    87150 46460000
         LA    R1,1(R1)                                                 46470000
         CH    R1,MAXSYMS                                               46480000
         BH    P85ERR05        CANNOT ENTER NAME IN STACK,TOO MANY74303 46490000
*                              AND NO AMOUNT OF RE-ORGANING WILL  74303 46500000
*                              DROP THE NUMBER OF NAMES (ONLY THE 74303 46510000
*                              PART FOR THE VALUE,AS THE NAMES    74303 46520000
*                              ARE DROPPED AT THE END OF EACH     74303 46530000
*                              MACRO).                            74303 46540000
         STH   R1,NOSYMS       RESET NUMBER OF SYMBOLIC NAMES     74303 46550000
         SPACE                                                          46560000
         MH    R5,=H'12'                                                46570000
         A     R5,ASYMTBL                                               46580000
         MVC   SYMNAME,SYMBOLIC      * NAME STORED                      46590000
         ST    R7,SYMADDR      R7=ANEXTSYM,IE ADDR VALUE WHICH    74303 46600000
*                              HAS ALREADY BEEN MOVED IN          74303 46610000
         MVC   SYMLEVEL(1),LEVEL+1                                      46620000
         ST    R6,ANEXTSYM     RESET ANEXTSYM                     74303 46630000
* STORE THE OFFSET IN THE BINARY LOOKUP TABLE                           46640000
* NOTE, IF THE SYMBOL WAS FOUND, WE WANT TO REPLACE IT RATHER THAN      46650000
*       INSERTING IT SO THAT WE ONLY HAVE THE NAME IN THE TABLE ONCE.   46660000
         CLC   P85WASFN,ZERO   IF ZERO, THE NAME WAS FOUND        87150 46670000
         BNE   P85INS                                                   46680000
*cvc     L     R15,ATBLCNTL                                             46690000
*cvc     USING TABLCNTL,R15                                             46700000
         LH    R1,P85TBLPS     GET TABLE POSITION                       46710000
         BCTR  R1,0                                                     46720000
         AR    R1,R1           DOUBLE IT                                46730000
*cvc     A     R1,ACUROFFS     POINT TO POSITION IN OFFSET TABLE        46740000
         LH    R14,NOSYMS                                               46750000
         BCTR  R14,0                                                    46760000
         MH    R14,=H'12'                                               46770000
         STH   R14,0(R1)                                                46780000
         JOLRETN RC=0                                                   46790000
*        DROP  R15                                                      46800000
P85INS   DS    0H                                                 87150 46810000
         LA    R1,P85TBLPS                                        87150 46820000
*cvc     CALL  UJP02INS                                           87150 46830000
         JOLRETN RC=0                                                   46840000
         SPACE 3                                                        46850000
P85GOTNM EQU   *                                                        46860000
* NOW THE NAME IS ALREADY IN THE SYMBOLIC PARAMETER TABLE ENTRIES.      46870000
*    IF THE LEVEL IN THE STACK IS EXTERNAL OR EQUAL TO THE CURRENT      46880000
*    LEVEL,WE WILL OVERWRITE IT.                                        46890000
*    IF THE CURRENT LEVEL IS > THAN THE LEVEL NOW,WE SHALL CREATE       46900000
*    A NEW ENTRY.                                                       46910000
         CLI   SYMLEVEL,X'FF'  EXTERAL ?                                46920000
         BE    P85USENM        YES,SO DO THE ASSIGN                     46930000
         CLC   SYMLEVEL,LEVEL+1                                         46940000
         BH    P85NOTFN        ENTER SAME NAME AT DIFFERENT LEVEL       46950000
* NAME IS HERE SO WE MUST OVER-WRITE THE INFORMATION (IF THERE IS ROOM) 46960000
P85USENM EQU   *                                                  74303 46970000
* SET UP NEW ADDRESS IN SYMADDR                                         46980000
         MVC   SYMADDR+1(3),ANEXTSYM+1                                  46990000
         ST    R6,ANEXTSYM     RESET NEXT VARIABLE ADDRESS        74303 47000000
         JOLRETN RC=0                                             74303 47010000
P85ERR05 DS     0H                                                      47020000
         JOLERR 425,'SYMBOLIC NAME ''',SYMBOLIC,''' CANNOT BE STORED'   47030000
*        JOLERR '405SYMBOLIC NAME ''' ,SYMBOLIC,''' CANNOT BE STORED'   47040000
P85RETNF JOLRETN RC=16                                                  47050000
P85REORG LTR   R8,R8           HAS REORG ALREADY BEEN CALLED ?    74303 47060000
         BZ    P85RORG2        NO,SO DO IT,AND TEST FIT AGAIN     74303 47070000
P85ERR07 DS     0H                                                      47080000
         ENTRY  P85ERR07                                                47090000
         JOLERR 426,'CANNOT STORE VALUE OF ''',SYMBOLIC,''''            47100000
*        JOLERR '406CANNOT STORE VALUE OF ''' SYMBOLIC,''''             47110000
         JOLRETN RC=16                                            74303 47120000
P85RORG2 LA    R8,1            SET R8 NON-ZERO                    74303 47130000
*cvc     CALL UJS19RSM         RE-ORG THE TABLE NOW               74303 47140000
         B     P85TVFIT        GO TEST IF IT WILL FIT NOW.        74303 47150000
P85PACK1 PACK P85NO1,OP1(*-*) PACK 1ST NUMBER,EX SETS 2ND LENGTH        47160000
P85PACK2 PACK P85NO2,OP2(*-*) PACK 2ND NUMBER,EX SETS 2ND LENGTH        47170000
P85CLRTK MVC   TKNSTRG(*-*),BLANKS  CLEAR A BIT OF TKNSTRG        74303 47180000
P85MVCVA MVC   0(*-*,R7),#WORK SHIFT VALUE OF ASSIGN -> TABLE     74303 47190000
P85MVCSU MVC   WORK(*-*),0(R8) EXECUTED FOR SUBSTR FUNC  CHG30011 76200 47200000
           DROP R5                                                74303 47210000
         SPACE 3                                         CHG30011 76200 47220000
P85SUBER DS     0H                                                      47230000
         JOLERR 429,'SUBSTR IN ERROR :-',#TKNSTRG        CHG30011 76200 47240000
*        JOLERR '409SUBSTR IN ERROR :-' ,#TKNSTRG        CHG30011 76200 47250000
         B     P85NULLX                                  CHG30011 76200 47260000
         SPACE 2                                         CHG30011 76200 47270000
P85GETNM EQU   *                                         CHG30011 76200 47280000
* BAL'D ON R6 FOR INDEX ETC FUNCTIONS                    CHG30011 76200 47290000
         LR    R8,R1           SAVE THE VALUE FOR THE ROUTINES    87150 47300000
         FINDSYM TKN           FIND THE SYMBOLIC (BIN SEARCH)     87150 47310000
*        LA   R1,TKN           FIND THE SYMBOLIC (BIN SEARCH)     87150 47320000
*        CALL GETSYM           FIND THE SYMBOLIC (BIN SEARCH)     87150 47330000
         LTR   R15,15          DID WE FIND IT?                          47340000
         BZ    P85GETDT        WE HAVE IT, GET IT'S DETAILS       87150 47350000
         LR    R5,R0           SYMNAME POINTER                          47360000
         USING SYMOVLY,R5                                CHG30011 76200 47370000
* NAME NOT THERE                                         CHG30011 76200 47380000
         JOLERR 420,'%',#TKN,' NOT FOUND FOR ',#WORK     CHG30011 76200 47390000
*        JOLERR '410#TKN NOT FOUND FOR'                                 47400000
         LR    R15,R6         SOME NON-ZERO VALUE        CHG30011 76200 47410000
         BR    R6                                        CHG30011 76200 47420000
         SPACE 3                                         CHG30011 76200 47430000
P85GETDT DS    0H                                                       47440000
         LR    R5,R0          GET ADDRESS OF SYMBOLIC TABLE       87150 47450000
         L     R7,SYMADDR     GET ADDRESS SYMBOLIC       CHG30011 76200 47460000
         MVC   DBL(2),0(R7)   SHIFT LENGTH SO NO 0C6     CHG30011 76200 47470000
         LR    R1,R8           RESTORE THE ORIGINAL R1 VALUE      87150 47480000
         LH    R8,DBL         LOAD R8 WITH THE LENGTH    CHG30011 76200 47490000
         BR    R6             RETURN TO CALLER           CHG30011 76200 47500000
         SPACE 3                                         CHG30011 76200 47510000
           LTORG                                                        47520000
        END                                                             47530000
