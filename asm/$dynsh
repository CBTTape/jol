$JOLSH40 TITLE 'JOL TRANSIENT SCHEDULER AND INSTRUCTION HANDLER'        00001000
* JOL COPYRIGHT CLARKE COMPUTER SOFTWARE 1971,1972,1973,1974,1975,1976  00002000
* JOL COPYRIGHT CLARKE COMPUTER SOFTWARE 1980,1981,1982.                00003000
* REFER TO INSTRUCTIONS ON COPYRIGHT NOTICE FORM NO CCS-E001.           00004000
         SPACE 3                                                        00005000
*                   J             000000            L                   00006000
*                   J            0      0           L                   00007000
*                   J           0        0          L                   00008000
*                   J          0          0         L                   00009000
*                   J         0            0        L                   00010000
*                   J         0            0        L                   00011000
*                   J         0            0        L                   00012000
*                   J         0            0        L                   00013000
*                   J         0            0        L                   00014000
*                   J         0            0        L                   00015000
*                   J         0            0        L                   00016000
*        J          J         0            0        L                   00017000
*         J        J           0          0         L                   00018000
*          J      J             0        0          L                   00019000
*           J    J               0      0           L                   00020000
*            JJJJ                 000000            LLLLLLLLLLL         00021000
           SPACE 3                                                      00022000
* LAST SOURCE UPDATE MAR 1982 BY J SUMMERFIELD                          00023000
*                                   OF KURRAWANG COMPUTER PROGRAMMING   00024000
*   CHANGES:-                                                           00025000
*     1. OSIV/X8 SUPPORT                                                00026000
* LAST SOURCE UPDATE 26/8/1981   BY CVC.                                00027000
*   CHANGES:-                                                           00028000
*     1. FIX 800 BPI TAPE PROBLEM                                       00029000
*     2. ALLOW JOL TO USE PROGRAMS IN LPALIB                            00030000
* FOLLOWING FIXES CODED, SEPT 7,1976                                    00031000
*                                                                       00032000
*CHG26028      PROVIDE SUPPORT FOR 'IF ERROR'                           00033000
*CHG30002      AS ABOVE                                                 00034000
*CHG30062      HIGHLIGHT ERROR MESSAGES ETC MORE                        00035000
*JOL30112      PROVIDE SUPPORT FOR DELETE GDGALL                        00036000
*JOL30114      ALLOW UP TO 5 LEVELS OF MACROS                           00037000
*JOL30115      CLOSE FILES BEFORE ABENDING                              00038000
*JOL30116      FIX DELETE TEMPORARY DATA-SETS                           00039000
* ALSO UPDATE CAMLIST,SCRATCH ETC MACROS FOR VS RETURN CODES            00040000
********************************************************************    00041000
*                                                                       00042000
*            JOL EXECUTE 'INITIATOR/SCHEDULER'                          00043000
*                                                                       00044000
*                                                                       00045000
*                                                                       00046000
*                                                                       00047000
*                                                                       00048000
*                                                                       00049000
* NOTE: MANY MACRO NAMES ARE THE SAME AS THOSE USED IN THE JOL          00050000
*     COMPILER,BUT THEIR GENERATED CODE DIFFERS VERY SLIGHTLY           00051000
*     FROM THE OTHER MODULES,EVEN THOUGH THE FUNCTION IS THE SAME       00052000
********************************************************************    00053000
           SPACE 1                                                      00054000
*********************************************************************** 00055000
*                                                                       00056000
*                                                                       00057000
* DUE TO THE FAILURE OF IBM JOBQ MANAGEMENT ROUTINES (EITHER TO MY      00058000
*    UNDERSTANGING OR IBM'S DOCUMENTATION) SOME 'EMERGENCY' TYPE        00059000
*    CODE ALTERATION IS GOING ON TO GET JOL TO FUNCTION UNDER           00060000
*    VS1. NOTE THAT MVS USES THE STANDARD IBM CODE.                     00061000
*                                                                       00062000
* CODE MARCH 7,1976: ALL MARKED '*****' IN COLS 67-71                   00063000
*    SEE ALSO  'UJEJOB' CSECT FOR CHANGES                               00064000
*                                                                       00065000
*********************************************************************** 00066000
           SPACE 3                                                      00067000
           MACRO                                                        00068000
           EYEBALL &A                                                   00069000
          DC   0D'0',4CL8'&A'                                           00070000
           MEND                                                         00071000
           SPACE 6                                                      00072000
           MACRO                                                        00073000
&NAME      JOLERR &STMT=STMT                                            00074000
.* THIS MACRO WILL PUT INTO A LOCATION A STRING OF CHARACTERS           00075000
.* THE STRING MAY BE IN A BUFFER OR JOL MAY ITSELF CONTROL              00076000
.*   THE WHERE-ABOUTS OF THE ERROR MESSAGE.                             00077000
.*                                                                      00078000
.* SYSLIST(1) IS TAKEN TO BE THE ERROR SEVERITY AND ALSO THE            00079000
.*   ERROR NUMBER.                                                      00080000
           LCLA &LITPOSN,&LITLEN                                        00081000
           LCLC &CSECT,&ERRNO                                           00082000
           LCLC &JOLERR,&CHAR1                                          00083000
           LCLA &LENGTH,&THIS,&NOVAR,&POSN,&L,&K,&STMTLEN               00084000
&STMTLEN   SETA 4                                                       00085000
&CSECT     SETC '&SYSECT'(3,3)                                          00086000
&ERRNO     SETC '&SYSLIST(1)'(2,K'&SYSLIST(1)-1)                        00087000
&CHAR1     SETC '&SYSLIST(1)'(1,1)                                      00088000
         AIF   ('&STMT' EQ 'STMT').ORDSTMT                              00089000
           MVC S23STMT,&STMT MOVE NON-STANDARD STATEMENT NUMBER IN      00090000
.ORDSTMT   ANOP                                                         00091000
*-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-*   00092000
&NAME      BAL 14,UJS23EP&CHAR1 LINK TO APPROPRIATE ERROR POINT         00093000
&JOLERR    SETC '&CSECT-&ERRNO'                                         00094000
ER&CSECT&ERRNO MVC 0(8,1),=CL8'&JOLERR' ERROR CODE IN CROSS-REF LIST    00095000
E&SYSNDX   EQU   ER&CSECT&ERRNO                                         00096000
&THIS      SETA  2                                                      00097000
.LUP4      ANOP                                                         00098000
         AIF   (&THIS GT N'&SYSLIST).END                                00099000
         AIF   ('&SYSLIST(&THIS)'(1,1) EQ '#').VAR2                     00100000
         AIF   ('&SYSLIST(&THIS)'(1,1) EQ '''').LIT2                    00101000
.* HERE IT SHOULD BE A CHAR VARIABLE                                    00102000
&L         SETA L'&SYSLIST(&THIS)                                       00103000
           MVC 0(&L,1),&SYSLIST(&THIS)         FIXED CHAR STRING        00104000
         AGO   .ADD3                                                    00105000
.LIT2      ANOP                                                         00106000
.* NOW LOOK FOR DOUBLE QUOTES IN STRING TO CALCULATE THE CORRECT        00107000
.*   LENGTH                                                             00108000
&LITPOSN   SETA 2                              START AFTER 1ST QOTE     00109000
&LITLEN    SETA K'&SYSLIST(&THIS)                                       00110000
&LITLEN    SETA &LITLEN-2                                               00111000
.TQUOTE2 AIF   ('&SYSLIST(&THIS)'(&LITPOSN,2) NE '''''').NOTDBL2        00112000
&LITPOSN   SETA &LITPOSN+1                                              00113000
&LITLEN    SETA &LITLEN-1                                               00114000
.NOTDBL2   ANOP                                                         00115000
&LITPOSN   SETA &LITPOSN+1                                              00116000
         AIF   (&LITPOSN LT K'&SYSLIST(&THIS)).TQUOTE2                  00117000
&K         SETA &LITLEN                                                 00118000
           MVC 0(&K,1),=C&SYSLIST(&THIS)       MOVE LITERAL STRING      00119000
&POSN      SETA  &POSN+&K                                               00120000
         AGO   .ADD3                                                    00121000
.VAR2      ANOP                                                         00122000
           LA 15,&SYSLIST(&THIS)           LOAD ADDRESS VARYING STRING  00123000
.ADD3      ANOP                                                         00124000
&THIS      SETA &THIS+1                                                 00125000
         AGO   .LUP4                                                    00126000
.END       DC  H'0'                            END LIST                 00127000
*-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-**-*   00128000
           MEND                                                         00129000
           SPACE 3                                                      00130000
           MACRO                                                        00131000
&NAME      JOLRETN &RC=0                                                00132000
&NAME      L   R13,4(R13)      RESET SAVE ADDRESS                       00133000
         AIF   ('&SYSLIST(1)' EQ '').R1412                              00134000
           RETURN &SYSLIST(1),T,RC=&RC                                  00135000
           MEXIT                                                        00136000
.R1412     RETURN (14,12),T,RC=&RC                                      00137000
           MEND                                                         00138000
           SPACE 3                                                      00139000
           MACRO                                                        00140000
&NAME    JOLSAVE &AREA=,&CSECT=,&BASE=R11                               00141000
         GBLA &REGEQU                                                   00142000
.* SEE IF EQUATES SET UP FOR THIS RUN YET OR NOT                        00143000
         AIF   (&REGEQU NE 0).NOEQU                                     00144000
&CSECT   CSECT                                                          00145000
R0       EQU   0                                                        00146000
R1       EQU   1                                                        00147000
R2       EQU   2                                                        00148000
R3       EQU   3                                                        00149000
R4       EQU   4                                                        00150000
R5       EQU   5                                                        00151000
R6       EQU   6                                                        00152000
R7       EQU   7                                                        00153000
R8       EQU   8                                                        00154000
R9       EQU   9                                                        00155000
R10      EQU   10                                                       00156000
R11      EQU   11                                                       00157000
R12      EQU   12                                                       00158000
R13      EQU   13                                                       00159000
R14      EQU   14                                                       00160000
R15      EQU  15                                                        00161000
&REGEQU  SETA 1                                                         00162000
         AGO   .NOCSECT                                                 00163000
.NOEQU   ANOP                                                           00164000
         AIF   ('&CSECT' EQ '').NOCSECT                                 00165000
         LTORG                                                          00166000
         DS    0D                                                       00167000
&CSECT   CSECT                                                          00168000
.NOCSECT ANOP                                                           00169000
&NAME    SAVE (14,12),,&CSECT.-&SYSDATE.:&SYSTIME                       00170000
         AIF   (N'&BASE EQ 1).ONEBASE                                   00171000
         USING &CSECT,&BASE(1),&BASE(2)                                 00172000
         LR    &BASE(1),R15                                             00173000
         LA    &BASE(2),2048(R15)                                       00174000
         LA    &BASE(2),2048(&BASE(2))                                  00175000
         AGO   .HOUSE                                                   00176000
.ONEBASE ANOP                                                           00177000
         USING &CSECT,&BASE                                             00178000
         LR    &BASE,R15                                                00179000
.HOUSE   AIF   ('&AREA' EQ '').GENAREA                                  00180000
         MNOTE 12,'AREA NOW UNSUPPORTED'                                00181000
         AGO   .HOUSE2                                                  00182000
.GENAREA CNOP 0,4                                                       00183000
         BAL   R15,*+76         BRANCH AROUND SAVE AREA                 00184000
         DC    18F'-1'                                                  00185000
.HOUSE2  ST    R15,8(,R13)                                              00186000
         ST    R13,4(,R15)                                              00187000
         LR    R13,R15                                                  00188000
         MEND                                                           00189000
         EJECT                                                          00190000
* THESE NEXT TWO MACROS ARE USED FOR READING AND WRITING JOBQ.          00191000
*    IF THE SYSTEM IS VS,THE VS JOBQ ROUTINES ARE CALLED,OTHERWISE      00192000
*    A STRAIGHT READ OR WRITE OPERATION IS PERFORMED.                   00193000
         MACRO                                                          00194000
&NAME    GETJOBQ &DECB,&TTR                                             00195000
         GBLC  &JOLOS                                                   00196000
         AIF   ('&JOLOS' NE 'X8').OK                                    00197000
         MNOTE 12,'GETJOBQ IS NOT SUPPORTED ON OSIV/X8'                 00198000
         MEXIT                                                          00199000
.OK      ANOP                                                           00200000
&NAME    LA  R0,&DECB        LOAD 0 WITH DECB ADDRESS                   00201000
         L   R1,&TTR         LOAD ADDRESS OF AREA WITH TTR FOR POINT    00202000
         BAL R14,GETJOBQ     BRANCH AND LINK TO POINT,READ,CHECK RTN    00203000
         MEND                                                           00204000
         SPACE                                                          00205000
         MACRO                                                          00206000
&NAME    PUTJOBQ &DECB,&TTR                                             00207000
         GBLC  &JOLOS                                                   00208000
         AIF   ('&JOLOS' NE 'X8').OK                                    00209000
         MNOTE 12,'PUTJOBQ IS NOT SUPPORTED ON OSIV/X8'                 00210000
         MEXIT                                                          00211000
.OK      ANOP                                                           00212000
&NAME    LA  R0,&DECB        LOAD 0 WITH DECB ADDRESS                   00213000
         AIF   ('&TTR' EQ '').NOTTR                                     00214000
         L   R1,&TTR         LOAD R1 WITH TTR REQUIRED                  00215000
         AGO   .BAL                                                     00216000
.NOTTR     SR  R1,R1           NO TTR,CLEAR REGISTER 1                  00217000
.BAL       BAL R14,PUTJOBQ     BRANCH AND LINK TO POINT,WRITE CHECK RTN 00218000
           MEND                                                         00219000
           MACRO                                                        00220000
&NAME      CLEAR                                                        00221000
.* THIS MACRO WILL CLEAR (SET TO ' ' OR 0) A NUMBER OF LOCATIONS        00222000
.* IF THE AREAS BEING CLEARED ARE CHARACTER,THE MACRO WILL MOVE         00223000
.* THE FIELD 'BLANKS' TO THE AREA.                                      00224000
.* IF THE AREA IS A HALF WORD,FULL WORD THEN RO WILL BE SET TO          00225000
.*   0 AND STORED                                                       00226000
.* IF A DOUBLE WORK IF FOUND,OR A BIT FIELD,THEN AN XC TO ITSELF        00227000
.*   WILL BE GENERATED.                                                 00228000
           LCLA &THISP,&ORIGL,&OFFSET,&L                                00229000
           LCLC &IND,&INST,&LABEL                                       00230000
&LABEL     SETC '&NAME'                                                 00231000
&THISP     SETA 1              START AT FIRST PARAMETER                 00232000
&IND       SETC ' '            SET INDICATOR TO ' '                     00233000
.LUP     AIF   (&THISP LE N'&SYSLIST).CLEAR                             00234000
           MEXIT                                                        00235000
.CLEAR     ANOP                                                         00236000
         AIF   (T'&SYSLIST(&THISP) EQ 'C').CHAR                         00237000
         AIF   (T'&SYSLIST(&THISP) EQ 'B').BIT                          00238000
         AIF   (T'&SYSLIST(&THISP) EQ 'D').DBL                          00239000
         AIF   ('&IND' NE ' ').ST                                       00240000
&LABEL     SR  0,0             CLEAR 0                                  00241000
&IND       SETC '1'                                                     00242000
.ST      AIF   (T'&SYSLIST(&THISP) EQ 'H').HALF                         00243000
         AIF   (T'&SYSLIST(&THISP) EQ 'F').FULL                         00244000
         AGO   .DBL            DO AN XC THEN                            00245000
           USING TKNX,R3                                                00246000
         AGO   .ADD1                                                    00247000
.HALF      ANOP                                                         00248000
           STH 0,&SYSLIST(&THISP)  SET &SYSLIST(&THIS) TO 0             00249000
         AGO   .ADD1                                                    00250000
.FULL      ANOP                                                         00251000
           ST  0,&SYSLIST(&THISP)  SET &SYSLIST(&THIS) TO 0             00252000
         AGO   .ADD1                                                    00253000
.DBL       ANOP                                                         00254000
.BIT       ANOP                                                         00255000
&LABEL     XC  &SYSLIST(&THISP),&SYSLIST(&THISP) SET TO 0               00256000
         AGO   .ADD1                                                    00257000
.CHAR      ANOP                                                         00258000
         AIF   (L'&SYSLIST(&THISP) GT 20).LONG                          00259000
         AIF   (L'&SYSLIST(&THISP) NE 1).MUVBLNK                        00260000
&LABEL     MVI &SYSLIST(&THISP),C' ' MOVE 1 BLANK                       00261000
         AGO   .ADD1                                                    00262000
.MUVBLNK   ANOP                                                         00263000
&LABEL     MVC &SYSLIST(&THISP),BLANKS SHIFT BLANKS IN                  00264000
         AGO   .ADD1                                                    00265000
.LONG      ANOP                                                         00266000
&LABEL     MVI &SYSLIST(&THISP),C' ' SET FIRST BYTE TO ' '              00267000
.* NOW WE MUST MOVE +0 TO +1 ETC TILL ENTIRE STRING IS CLEARED          00268000
&ORIGL     SETA L'&SYSLIST(&THISP)                                      00269000
&L         SETA L'&SYSLIST(&THISP)-1                                    00270000
&OFFSET    SETA 1                                                       00271000
.CLRLUP2 AIF   (&L LE 256).ONEMVC                                       00272000
           MVC &SYSLIST(&THISP)+&OFFSET.(256),&SYSLIST(&THISP)-1+&OFFSE*00273000
               T PROPOGATE                                              00274000
&OFFSET    SETA &OFFSET+256                                             00275000
&L         SETA &L-256                                                  00276000
         AGO   .CLRLUP2                                                 00277000
.ONEMVC    MVC &SYSLIST(&THISP)+&OFFSET.(&ORIGL-&OFFSET),&SYSLIST(&THIS*00278000
               P)-1+&OFFSET                                             00279000
.ADD1      ANOP                                                         00280000
&THISP     SETA &THISP+1                                                00281000
&LABEL     SETC ' '                                                     00282000
         AGO   .LUP                                                     00283000
         MEND                                                           00284000
         SPACE 2                                                        00285000
         MACRO                                                          00286000
&L       $TELL  &FCTADDR                                                00287000
         AIF   (K'&L EQ 0).NL                                           00288000
&L       DS    0H                                                       00289000
.NL      ANOP                                                           00290000
 AGO  .END                                                              00291000
         LA    R10,WORK+4                                               00292000
         CONCAT '&SYSECT ABOUT TO MODIFY FCT FOR FILE '                 00293000
         MVC   0(8,R10),FCTACSN                                         00294000
         LA    R10,8(,R10)                                              00295000
         CONCAT ' AT '                                                  00296000
         IHBINNRA &FCTADDR                                              00297000
         ST    R1,TASKSSI                                               00298000
         UNPK  DBL(9),TASKSSI(5)                                        00299000
         TR    DBL,HEX                                                  00300000
         MVC   0(6,R10),DBL+2                                           00301000
         LA    R10,6(,R10)                                              00302000
         LA    R0,WORK                                                  00303000
         SR    R0,R10    MSG LEN                                        00304000
         LCR   R0,R0                                                    00305000
         STH   R0,WORK                                                  00306000
         MVI   WORK+2,X'80'   MCS FLAG                                  00307000
         MVI   WORK+3,X'00'                                             00308000
         MVC   0(2,R10),=X'00004020' DESC,ROUTCD                        00309000
         LA    R1,WORK+4                                                00310000
         SH    R0,=H'4'                                                 00311000
         TPUT  (1),(0),USERIDL==C'JOLAIF  '                             00312000
         WTO   MF=(E,WORK)                                              00313000
.END     MEND                                                           00314000
         SPACE 3                                                        00315000
         MACRO                                                          00316000
&L       UJE22UPD &P1,&P2                                               00317000
.* P1 IS ADDRESS OF DSNAME                                              00318000
.* P2 IS ADDRESS OF VOLUME SERIAL NUMBER(S)                             00319000
         LA    R0,E22PARM     SET UP PARAMETER LIST                     00320000
         ST    R0,CALLAREA                                              00321000
         MVC   E22DSN,&P1     COPY DSNAME                               00322000
         MVC   E22VOL,&P2      AND VOLUME INFO                          00323000
         LA    R1,CALLAREA    ADDRESS PARAMETER AREA                    00324000
         MVI   0(R1),X'80'    THE FINAL TOUCH                           00325000
         CALL  UJE22UPD       CALL MR FIXIT                             00326000
         MEND                                                           00327000
         TITLE 'JOL SCHEDULER MAIN-LINE'                                00328000
         GBLA  &RSVDRC,&RETNSIZ                                         00329000
         GBLC  &JOLOS                                                   00330000
         GBLC  &TYPE                                                    00331000
         LCLB  &X8                                                      00332000
         LCLC  &C,&C1,&C2,&C3,&C4,&C5,&C6,&DDPRT,&DDINST                00333000
&TYPE    SETC  'SCHED'                                                  00334000
         $UJEPARM                                                       00335000
&RETNSIZ SETA  2560          SIZE OF RETURN-CODE AREA                   00336000
&X8      SETB  ('&JOLOS' EQ 'X8')                                       00337000
&RSVDRC  SETA  4000*(1-&X8)+50*&X8                                      00338000
&DDPRT   SETC  (&X8)'JOLPRINT'.(1-&X8)'$$PRNT'                          00339000
&DDINST  SETC  (&X8)'JOLINST'.(1-&X8)'$$INST'                           00340000
         PRINT DATA                                               75311 00341000
         AIF   (&X8).X8010 BYPASS MISLEADING REMARKS                    00342000
*********************************************************************** 00343000
*                                                                     * 00344000
* CODE FOR IF ERROR IS INCORPORATED IN THIS DESCRIPTION OF THE MAIN-  * 00345000
*  LINE ROUTINE                                                       * 00346000
*                                                                     * 00347000
*        CALL  UJE98INI;      /* IF ANY ERRORS (NO DD'S FOR SCHEDUER, * 00348000
*                                  ETC),                              * 00349000
*                             OR IF PROBLEM PROGRAM RETURNED A VALUE  * 00350000
*                             THAT CAUSES JOB TO BE FLUSHED,          * 00351000
*                             A NON-ZERO RETURN CODE IS GIVEN, AND    * 00352000
*                             THE JOB WILL BE FLUSHED.                * 00353000
*                        NOTE:- ABENDS DO NOT CAUSE AN ERROR HERE.    * 00354000
*                             */                                      * 00355000
*        IF R15,=0 THEN                                               * 00356000
*        DO;                                                          * 00357000
*           SET GOBACK /* TO OS */ ON;                                * 00358000
*           RETURN 4000;                                              * 00359000
*        END;                                                         * 00360000
*                                                                     * 00361000
*        CALL  UJE50RD;       /* READ A STMT FROM 'INSRUCT' FILE */   * 00362000
*        IF R15>=0 GO TO EOF; /* GO TO END OF JOB */                  * 00363000
*                                                                     * 00364000
*        SET  R4=COND(LEVEL*8 + NEST);                                * 00365000
*                                                                     * 00366000
*        IS INSTRUCT='IF' ?                                           * 00367000
*        YES, DO;                                                     * 00368000
*                                                                     * 00369000
*              SET 0(R4)='T';                                         * 00370000
* E00CLIF:     CALL IF;                                               * 00371000
*              IF TRUE        /* CHECKS FOR ABEND, AND IF 'ERROR' */  * 00372000
* NEW          THEN DO;                                               * 00373000
* NEW               CALL UJE50RD;                                     * 00374000
* NEW               IF R15>=0,                                        * 00375000
* NEW               GO TO EOF;                                        * 00376000
* NEW               IF 'IF' GO TO E00CLIF; /* TEST NEXT IF IN CHAIN*/ * 00377000
* NEW               ELSE GO TO E00EXECI;(EXECUTE INSTRUCTION) ;       * 00378000
*              END;                                                   * 00379000
* SKIP:        ELSE SKIP TILL MATCHING END ETC;                       * 00380000
*                                                                     * 00381000
*        END;                                                         * 00382000
*                                                                     * 00383000
* NEW    IF ABEND OCCURED                                             * 00384000
* NEW      AND CURRENT LEVEL,NEST                                     * 00385000
* NEW      <=  ERROR LEVEL,NEST (LEVEL,NEST ABEND OCCURED AT)         * 00386000
* NEW      THEN DO;           /* IE, SKIP INSTRUCTION BECAUSE ABEND*/ * 00387000
* NEW          CLEAR INERROR  /* CLEAR ERROR LOOP INDICATOR*/         * 00388000
* NEW          GO TO SKIP;    /* ALLOWS FOR IF ERROR, DO; */          * 00389000
* NEW      END;               /* ETC */                               * 00390000
*    /* NO ABEND */                                                   * 00391000
* EXECUTE-INSTRUCTION:        /* BRANCHED TO BY 'IF TRUE'             * 00392000
*                             ROUTINE ABOVE, THEREBY SKIPPING         * 00393000
* NEW                         THE 'IF ABEND AND LEVELS' ABOVE.        * 00394000
* NEW                                                                 * 00395000
* NEW                         HENCE, IF ERROR WILL FUNCTION */        * 00396000
*                                                                     * 00397000
*                                                                     * 00398000
*        IF A 'DO'                                                    * 00399000
*        THEN DO;                                                     * 00400000
*              NEST=NEST+1; GO TO READ;                               * 00401000
*        END;                                                         * 00402000
*                                                                     * 00403000
*        IF AN 'END'                                                  * 00404000
*        THEN  DO;                                                    * 00405000
*              NEST=NEST-1;                                           * 00406000
*              IF NEST=0                                              * 00407000
*              THEN LEVEL=LEVEL-1;                                    * 00408000
*              GO TO READ;                                            * 00409000
*        END;                                                         * 00410000
*        IS IT AN 'ELSE' ?                                            * 00411000
*        YES, DO;                                                     * 00412000
*              IS 0(R4)='T'                                           * 00413000
*              YES, ELSE MUST BE FALSE, GO TO SKIPLOOP;               * 00414000
*              NO,GO TO READ;                                         * 00415000
*        END;                                                         * 00416000
*                                                                     * 00417000
*  /* OTHER */                                                        * 00418000
*                                                                     * 00419000
*        BRANCH TO PROCESSING ROUTINE                                 * 00420000
*                                                                     * 00421000
*                                                                     * 00422000
*                                                                     * 00423000
*********************************************************************** 00424000
.X8010     ANOP                                                         00425000
           SPACE                                                        00426000
          EXTRN UJTNUM,UJEJOBQ   HELPS THE LINKAGE EDITOR FIND THINGS   00427000
         JOLSAVE CSECT=UJE00MN,BASE=R12                                 00428000
         ENTRY UJESCHED                                                 00429000
UJESCHED EQU   UJE00MN                                                  00430000
           L  R3,0(R1)                                                  00431000
           USING PARMAREA,R3                                            00432000
           USING  TABLES,R5                                             00433000
           L  R5,=A(TABLES)                                             00434000
E00VSSTR DS    0H                                                 74365 00435000
         CALL UJE98INI         INITIALISE ROUTINES                      00436000
         LTR R15,R15         INIT FAIL OR USER ABEND ?                  00437000
         BZ  E00FIRST                                                   00438000
BADRETN  DS    0H                                                       00439000
         CALL  UJE94CLN            CLEAN UP OUTSTANDING ALLOCATIONS     00440000
         MVI GOBACK,C'1'                                                00441000
         BAL   R11,UJEFILES   GO CLOSE ALL FILES                        00442000
         JOLRETN RC=&RSVDRC  CANCEL JOB NOW                             00443000
E00FIRST DS    0H                                                       00444000
E00READ  DS    0H                                                       00445000
E00MAINL DS    0H              THIS IS THE MAIN-LINE.                   00446000
         CALL UJE50RD        READ NEXT STATEMENT                        00447000
         LTR R15,R15         READ OK (EOF MAYBEE)                       00448000
         BNZ E00EOF          EOF,RETURN AFTER SETTING END JOB           00449000
*                              INDICATORS.                              00450000
         LH  R4,LEVEL        LEVEL INDICATOR                            00451000
         SLL R4,3            *8 (WE ALLOW 8 NESTS PER LEVEL)            00452000
         LH R0,NEST                                                     00453000
         AR R4,R0                                                       00454000
         LA  R4,COND(R4)     THERE,NOW WE CAN LOOK AT 'CONDS'           00455000
           CLI LABEL,C' '                                               00456000
           BNE E00LABOK                                                 00457000
           MVC LABEL(2),=C'$$'                                          00458000
           MVC LABEL+2(4),STMT                                          00459000
E00LABOK DS    0H                                                       00460000
           CLC =C'IF ',ICOMMAND  IF?                                    00461000
           BNE E00TDO          NO,GO TEST FOR A DO                      00462000
* OK,CALL THE IF PROCESSOR AND TEST FOR TRUE OR FALSE                   00463000
           MVI 0(R4),C'T'      SET COND INITIALLY 'TRUE'                00464000
           CALL UJE04IF                                                 00465000
           LTR R15,R15         IF 0,IT WAS A TRUE 'IF'                  00466000
         BNZ   E00IFRD0       FALSE, SKIP INSTRUCTION(S) CHG26028 76200 00467000
* IF IS TRUE HERE                                        CHG26028 76200 00468000
         CALL  UJE50RD        READ NEXT INSTRUCTION      CHG26028 76200 00469000
         LTR   R15,R15        GET IT ?                   CHG26028 76200 00470000
         BNZ   E00EOF         NO, GO TO EOF ROUTINE      CHG26028 76200 00471000
         B     E00EXECI       YES, GO AND PERFORM IT     CHG26028 76200 00472000
           SPACE 3                                                      00473000
* NOW THE 'IF' IS FALSE                                                 00474000
E00IFRD0   MVI 0(R4),C'F'      SET COND TO 'FALSE'                      00475000
E00IFRD1   CALL UJE50RD        READ THE NEXT INSTRUCTION                00476000
           LTR R15,R15                                                  00477000
           BNZ E00EOF                                                   00478000
           SPACE                                                        00479000
E00SKIP  DS    0H                                        CHG26028 76200 00480000
           CLC =C'IF ',ICOMMAND  IF THEN...IF THEN SITUATION?           00481000
           BE  E00IFRD1        YES,SO SKIP THIS ONE NOW                 00482000
           CLC =C'MACRO ',ICOMMAND   IS IT A MACRO HEADER ?             00483000
           BE E00IFLUP         START SKIPPING UNTIL MATCHING 'END'      00484000
           CLC =C'DO ',ICOMMAND IS IT A 'DO;                            00485000
           BE E00IFLUP         START SKIPPING UNTIL MATCHING 'END'      00486000
* HERE IT IS AN ORDINARY INSTRUCTION,AND WE HAVE 'SKIPPED ' IF          00487000
*     WE GO AND READ A NEW ONE NOW                                      00488000
           B  E00READ                                                   00489000
           SPACE 3                                                      00490000
E00IFLUP DS    0H                                                       00491000
* NOW WE HAVE FOUND A MACRO OR A DO                                     00492000
           LA R4,1             SET NUMBER OF OUTSTANDING ENDS TO 1      00493000
E00IFRD    DS    0H                                                     00494000
           CALL UJE50RD        GET THE NEXT INSTRUCTION                 00495000
           LTR R15,R15                                                  00496000
           BNZ E00EOF          END OF INPUT FILE                        00497000
           CLC =C'END ',ICOMMAND                                        00498000
           BNE E00TIFMC        GO TEST IF INNER MACRO OR DO             00499000
           SH R4,=H'1'         -1 FROM END COUNTER                      00500000
           BZ  E00READ         GOOD OH,REACHED END OF FALSE LOOP        00501000
           B  E00IFRD                                                   00502000
           SPACE 3                                                      00503000
E00TIFMC DS    0H                                                       00504000
           CLC =C'MACRO ',ICOMMAND                                      00505000
           BE  E00ADD1                                                  00506000
           CLC =C'DO ',ICOMMAND                                         00507000
           BNE E00IFRD                                                  00508000
E00ADD1    LA R4,1(R4)         UP THE NUMBER OF OUTSTANDING 'ENDS'      00509000
           B  E00IFRD          AND READ A NEW INSTRUCTION               00510000
*  END IF PROCESSING                                                    00511000
           SPACE 3                                                      00512000
E00TDO   DS    0H                                                       00513000
E00TERR  CLI   ERRORIND,0     HAS AN ABEND OCCURED ?     CHG26028 76200 00514000
         BE    E00TDO2        NO, NOT YET                CHG26028 76200 00515000
* AN ABEND HAS BEEN DETECTED SOMEWHERE.                  CHG26028 76200 00516000
*******************************************************************DASD 00517000
*  IF ERROR SWITCH SETTINGS USING FIELD "INERRORL"                *DASD 00518000
*                                                                 *DASD 00519000
*  BYTES 0-3 ON = IF ERROR LOGIC IN PROCRESS                      *DASD 00520000
*           OFF = NO IF ERROR LOGIC REACHED AS YET OR             *DASD 00521000
*                 CURRENTLY RUNNING IF ERROR AT ABEND LEVEL       *DASD 00522000
*  BYTES 4-7 ON = IF ERROR LOGIC REACHED AND ABEND OCCURED        *DASD 00523000
*           OFF = NO ABEND OCCURED WITHIN IF ERROR LOGIC          *DASD 00524000
*******************************************************************DASD 00525000
         TM     INERRORL,X'0F' IF ERROR ON WITH AND ABEND ?        DASD 00526000
         BZ     E00SKIP      NOPE   LETS SKIP ANY RUNNING AFTER ABEDASD 00527000
         CLC   LEVEL(L'LEVEL+L'NEST),ERRLEVEL            CHG26028 76200 00528000
         BH    E00TDO2        OK, IF ERROR THEN DO LOOP  CHG26028 76200 00529000
         MVI   INERRORL,X'0F' TURN OFF 'IN ERROR LOOP'   CHG26028  DASD 00530000
         B     E00SKIP        SKIP INSTRUCTION(S)        CHG26028 76200 00531000
E00TDO2  DS    0H                                        CHG26028 76200 00532000
E00EXECI DS    0H                                        CHG26028 76200 00533000
         SPACE 2                                         CHG26028 76200 00534000
           CLC =C'DO ',ICOMMAND IS IT A 'DO'                            00535000
           BNE E00TMAC         NO,TEST IF 'MACRO'                       00536000
           LH  R1,NEST         ADD                                      00537000
           LA  R1,1(R1)            1 TO                                 00538000
           CH  R1,=H'8'                NEST                             00539000
           BH  E00DOERR            IF NOT                               00540000
           STH R1,NEST         T00 BIG                                  00541000
           B   E00READ         AND READ A NEW RECORD                    00542000
E00DOERR   JOLERR 505,'TOO MANY DOS'   (THIS ABENDS,U0001)              00543000
           SPACE 3                                                      00544000
E00TMAC    CLC =C'MACRO ',ICOMMAND                                      00545000
           BNE E00TEND                                                  00546000
           LH  R1,LEVEL                                                 00547000
           LA  R1,1(R1)                                                 00548000
         CH    R1,=H'7'                                  JOL30114 76200 00549000
           BL  E00MACOK                                                 00550000
           JOLERR 508,'TOO MANY LEVELS'  (ABENDS TOO)                   00551000
E00MACOK   STH R1,LEVEL                                                 00552000
           LA R1,SAVENEST(R1)                                           00553000
           MVC 0(1,R1),NEST+1 SAVE THE NEST SO WE CAN RESET AT MACRO    00554000
*                              END SO AS NOT TO LOSE OURSELVES          00555000
           XC  NEST,NEST                                                00556000
           B   SETMACRO        TRUE 'LOOP',SET UP MACRO START           00557000
           SPACE 3                                                      00558000
E00TEND    CLC =C'END ',ICOMMAND WELL,PERHAPS IT IS AN 'END'            00559000
           BNE E00TELSE        NOPE,GO TEST IF IT IS AN'ELSE' THEN      00560000
           SPACE                                                        00561000
           LH  R1,NEST         NOW REDUCE 'NEST'                        00562000
           SH  R1,=H'1'                                                 00563000
           BM  E00ENDMC        IF <0 IF IS A 'MACRO' END                00564000
           STH R1,NEST                                                  00565000
           B   E00READ        *********************** MARCH 12 76       00566000
           BCTR R4,0           -1 FROM R4                         75311 00567000
           MVI 0(R4),C' '      CLEAR COND                         75311 00568000
           B   E00READ                                                  00569000
           SPACE 3                                                      00570000
E00ENDMC DS    0H                                                       00571000
* NOW THE'MACRO END' REQUIRES SPECIAL ATTENTION BECAUSE WE MUST         00572000
*     STORE THE HIGHEST RETURN CODE FROM THE PROGRAMS EXECUTED          00573000
*     BY THE MACROS.                                                    00574000
           LH R1,LEVEL                                                  00575000
           LA R15,SAVENEST(R1)                                          00576000
           SH R1,=H'1'                                                  00577000
           BNM E00MACEN                                                 00578000
           JOLERR 506,'TOO MANY ENDS'  (ABENDS)                         00579000
           SPACE 3                                                      00580000
E00MACEN  DS    0H                                                      00581000
           STH R1,LEVEL                                                 00582000
           MVC NEST+1(1),0(R15)                                         00583000
           SPACE 3                                                      00584000
** STORE THE HIGHEST RETURN CODE FROM THE MACRO                         00585000
           LA R7,IDSTART                                                00586000
           LH R1,NOIDS                                                  00587000
           MH R1,=H'18'                                                 00588000
           LR R15,R7                                                    00589000
           AR R7,R1                                                     00590000
           LH R14,=H'-18'                                               00591000
           LR R1,R7                                                     00592000
           USING IDOVLY,R1                                              00593000
           MVC DBL,IDRETN                                               00594000
           L R7,DBL                                                     00595000
**** CHECK FOR A DEAD MARCO HEADER WITH A -1 RETURN CODE AND BYPASSDASD 00596000
           CLC  DBL(4),=F'-1'                                      DASD 00597000
           BNE E00LUP10                                                 00598000
           SR R7,R7                                                     00599000
E00LUP10   CLC IDNAME,=CL8'MACRO'                                       00600000
           BE  E00GMAC                                                  00601000
           MVC DBL,IDRETN                                               00602000
**** CHECK FOR A DEAD MARCO HEADER WITH A -1 RETURN CODE AND BYPASSDASD 00603000
           CLC  DBL(4),=F'-1'                                      DASD 00604000
           BE   E00BXH1                                            DASD 00605000
           C R7,DBL                                                     00606000
           BH  E00BXH1                                             DASD 00607000
*          BL  E00BXH1                                             DASD 00608000
           L   R7,DBL                                                   00609000
E00BXH1    BXH R1,R14,E00LUP10                                          00610000
         JOLERR 507,'NO MACRO START'                                    00611000
E00GMAC  ST    R7,CALLAREA                                              00612000
         MVC   IDRETN,CALLAREA                                          00613000
         MVC   IDNAME,=CL8' '  TO GET RIGHT EFFECT FOR NESTED MACROS    00614000
         B     E00READ                                                  00615000
         SPACE 3                                                        00616000
E00TELSE DS    0H                                                       00617000
* NOW THE 'ELSE' MUST BE TESTED                                         00618000
           CLC =C'ELSE ',ICOMMAND                                       00619000
           BNE E00TFALS       NOT ELSE,TEST IF FALSE 'LOOP'             00620000
           CLI 0(R4),C' ' WAS AN 'IF' JUST PRICESSED ?                  00621000
           BNE E00ELSOK                                                 00622000
           JOLERR 402,'ELSE IGNORED'                                    00623000
           SPACE 3                                                      00624000
E00ELSOK DS    0H                                                       00625000
           CLI 0(R4),C'F'      LAST FALS ?                              00626000
           BNE E00TLTRU                                                 00627000
           MVC 0(2,R4),=C'  '      TURN OFF COND CODE ALTOGETHER        00628000
           B  E00READ                                                   00629000
E00TLTRU   B  E00IFRD1    GO JOIN 'IF' FALSE PROCESSOR                  00630000
           SPACE 3                                                      00631000
E00TFALS DS    0H                                                       00632000
E00ORD   DS    0H                                                       00633000
           CLEAR ISRUN                                                  00634000
           L   R1,=A(JE00TBL1) LOAD ADDRESS OF TABLE WITH THE           00635000
*                              INSTRUCTION NAMES AND THE ADDRESSES      00636000
*                              OF THE ROUTINES TO HANDLE THEM.          00637000
           LM  R7,R9,0(R1)     LOAD BXLE ADDRESS CONSTANTS FOR          00638000
*                              THE ABOVE TABLE.                         00639000
E00FINDR DS    0H                                                       00640000
           CLC ICOMMAND,0(R7)   COMPARE INSTRUCTION TO THAT IN TABLE    00641000
           BE  E00GOTRT        GOT THE ROUTINE TO HANDLE IT.            00642000
           BXLE  R7,R8,E00FINDR                                         00643000
E00ERROR DS    0H                                                       00644000
           JOLERR 503,'INVALID INSTRUCTION ''',ICOMMAND,               *00645000
               ''' IN SCHED'                                            00646000
           SPACE 3                                                      00647000
E00GOTRT   L   R15,8(R7)       LOAD ROUTINE ADDRESS                     00648000
           BALR R14,R15                                                 00649000
           CLI ISRUN,C'1'      WAS A RUN JUST PROCESSED ?               00650000
           BE  E00FNDRN        YES,TWAS A RUN                           00651000
           LTR R15,R15         DID PROCESSOR HANDLE NORMAL INSTRUCTION  00652000
*                              (EG TYPE,DELETE ETC??)                   00653000
           BZ  E00MAINL        YES,SO TRY NEXT INSTRUCTION.             00654000
* HERE AN INSTRUCTION WAS EXECUTED,BUT RETURNED A NON-ZERO              00655000
*     CODE.                                                             00656000
           CH  R15,=H'4'       RETURN TO OS AFTER SKIPPING TO           00657000
*                              THE RIGHT JOB STEP ?                     00658000
           BE E00STPON         STEP ON TO A NEW OS STEP.                00659000
           CH R15,=H'&RSVDRC'  STOP ETC EXECUTED ?                      00660000
           BE BADRETN                                                   00661000
E00CLRC    MVC 0(2,R4),=CL2' '                                          00662000
           B  E00MAINL                                                  00663000
           B  *+4                                                       00664000
           B  *+4                                                       00665000
           B  *+4                                                       00666000
           B  *+4                                                       00667000
*     SET THE INDICATOR WHICH TELLS OUR CALLER (THE MONITOR)            00668000
*     TO  RETURN TO OS SO IT CAN SKIP STEPS (OR CANCEL THE JOB)         00669000
           SPACE 3                                                      00670000
           SPACE 3                                                      00671000
RETURN   DS    0H                                                 74365 00672000
E00EOF   DS    0H                                                       00673000
         AIF   (&X8).X8020                                              00674000
* WE HAVE READ AN EOF ON THE INSTRUCTION FILE,SO WE WANT TO             00675000
*     GET TO THE END OF THE JOB                                         00676000
*                                                        CHG26028 76200 00677000
* IF AN ABEND HAS OCCURED, WE SHOULD SET A RETURN OF     CHG26028 76200 00678000
*  4000 SO THAT THE JOB WILL TERMINATE AS QUICKLY AS     CHG26028 76200 00679000
*  POSSIBLE (LETS NOT WASTE TOO MUCH TIME...)            CHG26028 76200 00680000
         SPACE 1                                         CHG26028 76200 00681000
         CLI   ERRORIND,0     DID AN ERROR OCCUR ?       CHG26028 76200 00682000
         BE    E00EOF2        NO, SO TERMINATE NICELY    CHG26028 76200 00683000
*                             (IF SLOWLY...)             CHG26028 76200 00684000
         MVC   LASTCC+2(2),=H'&RSVDRC' FLUSH THE JOB     CHG26028 76200 00685000
         B     RETNNOW        CLOSE FILES, RETURN.       CHG26028 76200 00686000
E00EOF2     LA R11,1            SET EOF INDICATOR ON                    00687000
           MVC GOTOLAB,=XL8'FFFFFFFFFFFFFFFF' SET IMPOSSABLY HIGH LABEL 00688000
*                              NUMBER IN GOTOLAB,SO WE WILL MARK ALL    00689000
*                              THE STEPS UNTIL EOJ WITH COND=ONLY       00690000
           B  E00FINDS         FIND THE NEXT OS STEP                    00691000
           SPACE 3                                                      00692000
E00STPON DS    0H                                                       00693000
         SR  R11,R11         SET EOF INDICATOR OFF                      00694000
* NOW WE HAVE TO ORGANISE FOR OS TO STEP ON TO ANOTHER                  00695000
*     STEP FOR US.                                                      00696000
* WE CAN BE NASTY (SET NEXT STEP SCT TO ANOTHER STEP WAY DOWN           00697000
*     THE QUEUE)                                                        00698000
* OR WE CAN BE KIND,IE SET UP A FEW COND=ONLY'S AND LET OS              00699000
*     GET THERE ITSELF.                                                 00700000
* WE COULD BE LUCKY,I SUPPOSE,AND THE NEXT STEP WE WANT                 00701000
* COULD REALLY BE THE NEXT OS STEP.                                     00702000
          SPACE                                                         00703000
* NOW IF IT WAS A RUN STATEMENT WE WERE TOLD TO STEP ON FOR,            00704000
* THE STEP WE WANT MUST BE THERE.                                       00705000
*     IF IT WAS A CATLG ETC THAT WE HAD TO STEP ON FOR,                 00706000
* WE COULD FIND THAT THE ACTUAL STEP WON'T BE THERE BECAUSE             00707000
* THE GENERATOR MAY HAVE CONBINED SEVERAL STEPS TO CUT DOWN             00708000
* THE NUMBER OF OS STEPS PRODUCED. IN THAT CASE,WE MERELY               00709000
* FIND A STEP THAT IS LESS THAN OR EQUAL,AND BRANCH TO IT               00710000
          SPACE                                                         00711000
E00FINDS DS    0H                                                       00712000
*          MVI SCTANSCT+3,0     ***** SET Z=0 (OK,ONLY READ)            00713000
           CLC SCTANSCT,=A(0)   LAST STEP IN JOB ? (THE NEXT ONE*****)  00714000
            BNE E00PNT         NOT EOF ON JOBQ                          00715000
           LTR R11,R11         EOF ON MY Q?                             00716000
           BNZ E00TEST         YES,SO MERELY RETURN TO OS               00717000
E00NOSTP   JOLERR 504,'CANNOT FIND STEP ',GOTOLAB                       00718000
           SPACE 3                                                      00719000
E00PNT   DS    0H                                                       00720000
           GETJOBQ SCTDECB,SCTANSCT READ THE SCT,AFTER POINTING         00721000
* NOW IS IT THE STEP WE WANT ?                                          00722000
           CLC SCTSNAME,GOTOLAB                                         00723000
           BE  E00GOTRS        GOT RIGHT STEP                           00724000
* NOW AS MENTIONED EARLIER,WE MAY HAVE GONE TOO FAR IT WE WERE          00725000
*     DOING A SCRATCH FOR US.                                           00726000
* HOWEVER (3.0) WE MAY HAVE A REAL STEP NAME ON THE GENERATED JCL 75311 00727000
*  AND IF SO WE MUST CONTINUE EXAMINING THE JOBQ                  75311 00728000
           CLC =C'$$',GOTOLAB  REAL STEP | JOL STEP NAME ?        75311 00729000
           BNE E00REWR         REAL, SO TOSS THIS SCT BACK WITH   75311 00730000
*                              COND=ONLY, AND CONTINUE            75311 00731000
           SPACE 1                                                75311 00732000
           BH E00GOTRS         WELL IT WILL DO ANYWAY EVEN IF IT        00733000
*                              IS A LITTLE HIGH                         00734000
           SPACE                                                        00735000
* NOW THE SCT IN CORE MUST BE REWRITTEN WITH COND=ONLY UNLESS           00736000
*     IT IS THE CURRENT OS STEP                                         00737000
E00REWR  DS    0H                                                 75311 00738000
           CLC JCTSSTR(3),SCT  CURRENT OS STEP ?                        00739000
           BE E00TEST          YES,SO DON'T UPDATE AND OUTPUT           00740000
* SET COND=ONLY SO NEXT STEP (THIS SCT IN CORE) WON'T RUN               00741000
           MVC SCTABCND(3),=X'010000'                                   00742000
           PUTJOBQ SCTDECB     OUTPUT SCT AGAIN                         00743000
           B E00FINDS                                                   00744000
         AGO   .NX8020                                                  00745000
.X8020   ANOP                                                           00746000
E00STPON DS    0H                                                       00747000
.NX8020  ANOP                                                           00748000
         SPACE 3                                                        00749000
E00GOTRS DS    0H                                                       00750000
E00TEST  DS    0H                                                       00751000
         POINT RETN,TTR$RETN                                            00752000
           WRITE E00RET2,SF,RETN,READAREA,'S'                           00753000
           CHECK E00RET2                                                00754000
           SPACE 3                                                      00755000
RETNNOW  DS    0H                                                       00756000
         CALL  UJE94CLN            CLEAN UP OUTSTANDING ALLOCATIONS     00757000
         MVI GOBACK,C'1'                                                00758000
         AIF   (&X8).X8040                                              00759000
           CLI IBMRTN,C' '     ARE WE USING AN IBM ROUTINE TO     ***** 00760000
*                              ACCESS JOBQ ?                      ***** 00761000
           BE  E00NDEL1        NO, SO DON'T TRY TO DELETE IT      ***** 00762000
           DELETE EPLOC=IBMRTN YES, DELETE WHICH EVER ROUTINE     ***** 00763000
E00NDEL1 DS    0H                                                 ***** 00764000
.X8040   ANOP                                                           00765000
*          CLOSE (INSTRUCT,,PRINT,,RETN,,JOBQ)                    *DASD 00766000
           BAL   R11,UJEFILES   GO CLOSE ALL FILES                 DASD 00767000
         AIF   (&X8).X80CVC                                             00768000
           L   R15,LASTCC                                         82200 00769000
           AGO .X80RET                                                  00770000
.X80CVC    L   R15,MAXCC                                          82200 00771000
.X80RET    JOLRETN RC=(15)                                        75311 00772000
E00FNDRN DS    0H                                                       00773000
           LTR R15,R15         DO WE HAVE TO SKIP TO A NEW              00774000
           BNZ E00STPON        OS STEP FOR THIS RUN ?                   00775000
           SPACE 3                                                      00776000
SETMACRO DS    0H                                                       00777000
* RUN IT NOW                                                            00778000
           LH  R1,NOIDS                                                 00779000
           LA  R1,1(R1)                                                 00780000
           CH  R1,MAXIDS                                                00781000
           BL  MUVNAME                                                  00782000
           LH  R1,MAXIDS                                                00783000
           CVD R1,DBL                                                   00784000
           UNPK DDPRIM,DBL                                              00785000
           OI  DDPRIM+L'DDPRIM-1,X'F0'                                  00786000
*******************************************************            DASD 00787000
* NOW BEFORE ABENDING WE WILL TAKE A LOOK AT THE RETN *            DASD 00788000
* TABLE FOR A USED MACRO HEADER AND OVERLAY IT MAKING *            DASD 00789000
* ROOM FOR 1 NEW GUY                                  *            DASD 00790000
*******************************************************            DASD 00791000
         LH    R15,NOIDS      LOOK THIS MANY TIMES                 DASD 00792000
         LA    R1,18                                               DASD 00793000
         LA    R1,IDSTART(R1) START LOOKING HERE                   DASD 00794000
         USING IDOVLY,R1                                           DASD 00795000
SLIDELOP CLC   IDNAME,=CL8'MACRO' IS THIS GUY USED ?               DASD 00796000
         BNE   SLIDEUP        YEA MOVE IT UP                       DASD 00797000
         LA    R1,18(R1)      UP TO NEXT GUY                       DASD 00798000
         BCT   R15,SLIDELOP                                        DASD 00799000
* WELL GUY WHAT NOW ???????                                        DASD 00800000
           JOLERR 501,'MAX ',DDPRIM,' STEPS EXCEEDED'                   00801000
SLIDEUP  MVC   0(18,R1),18(R1) SLIDE THE REST UP 1                 DASD 00802000
         LA    R1,18(R1)      INCR TO NEXT SLOT                    DASD 00803000
         BCT   R15,SLIDEUP    LETS DO EM ALL                       DASD 00804000
         LH    R1,NOIDS       NOW LOAD NO OF IDS AGAIN             DASD 00805000
MUVNAME    STH R1,NOIDS                                                 00806000
           MH  R1,=H'18'                                                00807000
           LA R1,IDSTART(R1)                                            00808000
           USING IDOVLY,R1                                              00809000
           MVC IDSTMT,STMT                                              00810000
           OC IDSTMT,=C'0000'                                           00811000
           MVC IDNAME,TASKLABL                                          00812000
           MVC IDNEST,NEST                                              00813000
           MVC IDLEVEL,LEVEL                                            00814000
           MVC IDRETN,=F'-1'                                            00815000
           CLC =CL8'MACRO',ICOMMAND                                     00816000
           BNE NOTMACH                                                  00817000
           MVC IDNAME,=CL8'MACRO'                                       00818000
           B  E00MAINL                                                  00819000
NOTMACH  DS    0H                                                       00820000
         AIF   (&X8).X8050                                              00821000
* WE MUST NOW WRITE THE PROGRAM NAME IN THE PGM FIELD OF THE SCT        00822000
*    SO THAT SMF WILL BE OK                                             00823000
           GETJOBQ SCTDECB,JCTSSTR GET SCT,AFTER POINT                  00824000
           CLC =C'$JOLMN',SCTPGMNM    FIRST PROGRAM GETS SMF RECORD 3.1 00825000
           BNE E00SMF1                                                  00826000
           MVC SCTPGMNM,RUNNAME                                         00827000
E00SMF1  DS    0H                                                       00828000
           PUTJOBQ SCTDECB     RE-WRITE SCT                             00829000
* OK LET'S XCTL                                                         00830000
         AGO   .NX8050                                                  00831000
.X8050   ANOP                                                           00832000
         FIX   'FIDDLE SMF RECORDS HERE'                                00833000
.NX8050  ANOP                                                           00834000
           POINT  RETN,TTR$RETN                                         00835000
           WRITE DECBRET1,SF,RETN,READAREA,'S'                          00836000
           CHECK  DECBRET1                                              00837000
         AGO   .VS050                                                   00838000
           SPACE 1                                                74365 00839000
           CLI VS,C' '         ARE WE RUNNING UNDER VS ?          74365 00840000
* IF WE ARE,WE WILL ATTACH NOW RATHER THAN XCTLING AND CLOSING    74365 00841000
*          AS THIS IS FASTER AND VS CAN ROLL US OUT QUICKLIY      74365 00842000
           BNE E00ISVS         IS VS,DO THINGS DIFFERENTLY        74365 00843000
           CLI IBMRTN,C' '     ARE WE USING AN IBM ROUTINE TO     ***** 00844000
*                              ACCESS JOBQ ?                      ***** 00845000
           BE  E00NDEL2                                           ***** 00846000
           DELETE EPLOC=IBMRTN YES, DELETE IT                     ***** 00847000
E00NDEL2 DS    0H                                                 ***** 00848000
*          CLOSE (INSTRUCT,,PRINT,,RETN,,JOBQ)                    *DASD 00849000
           BAL   R11,UJEFILES   GO CLOSE ALL FILES                 DASD 00850000
           MVC DBL(4),STMT    SAVE STATEMENT NUMBER WHILE         75128 00851000
*                              PROBLEM PROGRAM IS EXECUTING             00852000
           L   R1,ATASKPRM                     LOAD ADDR OF PARAMETER   00853000
           ST R1,CALLAREA                                               00854000
           MVI CALLAREA,X'80'                                           00855000
           L   R13,4(R13)                      RESET SAVE ADDR          00856000
           L   R14,12(R13)                     RESET RETURN ADDR        00857000
           XCTL (2,12),DE=RUNNAME,DCB=0,MF=(E,CALLAREA)                 00858000
.VS050     SPACE 3                                                75311 00859000
E00ISVS    MVC DBL,STMT        SHIFT STATEMENT NUMBER             75311 00860000
* 3.0 - MVS CODE                                                  75311 00861000
*                                                                 75311 00862000
* FOR 3.0 WE WILL ATTACH THE PROBLEM PROGRAM UNDER THE MONITOR,   75311 00863000
* THAT IS, WE SHALL RETURN AS USUAL.                              75311 00864000
*                                                                 75311 00865000
* LATER, WHEN THIS CODE IS RE-ENTRANT, IT WILL BE MORE            75311 00866000
* EFFICENT TO ATTACH IT HERE, BUT VS1 IS A BIT OF A PROBLEM       75311 00867000
* BECAUSE IT DOESN'T HAVE 16MEGABYTES TO PLAY WITH.               75311 00868000
           BAL   R11,UJEFILES   GO CLOSE ALL FILES                 DASD 00869000
           JOLRETN RC=0        UJEMON WILL LOOK AT 'VS' TOO.      75311 00870000
*  D  *    MVC CALLAREA(4),ATASKPRM                                DASD 00871000
*  E  *    MVI CALLAREA,X'80'                                      DASD 00872000
*  A  *    XC TASK2ECB,TASK2ECB                                    DASD 00873000
*  D  *    LA R1,CALLAREA                                          DASD 00874000
*     *    ATTACH DE=RUNNAME,ECB=TASK2ECB          74365           DASD 00875000
*  M  *    LR  R11,R1          SAVE TCB ADDRESS                    DASD 00876000
*  V  *    WAIT 1,ECB=TASK2ECB                                     DASD 00877000
*  S  *    MVC TASKRETN(1),X'1D'(R11) SHIFT IN ABEND CODE          DASD 00878000
*     *    MVC TASKRETN+1(3),TASK2ECB+1 AND RETURN CODE            DASD 00879000
*  C  *    ST R11,CALLAREA                                         DASD 00880000
*  O  *    DETACH CALLAREA                                         DASD 00881000
*  D  *    B E00VSSTR          BACK TO MAINLINE                    DASD 00882000
*  E  *    B *+4                                                   DASD 00883000
*     *    B *+4                                                   DASD 00884000
*     *    B *+4                                                   DASD 00885000
*************************************************************      DASD 00886000
*  CLOSE ANY OPEN FILES BEFORE RETURNING TO THE MONITOR     *      DASD 00887000
*        MVS  WILL ABEND-C03                                *      DASD 00888000
*************************************************************      DASD 00889000
         FIX 'CLOSE TOGETHER'                                           00890000
UJEFILES DS    0H                                                  DASD 00891000
         ST    R11,CALLAREA+4                                           00892000
         LA    R10,INSTRUCT                                        DASD 00893000
         BAL   R11,UJEFCLSE                                        DASD 00894000
         LA    R10,PRINT                                           DASD 00895000
         BAL   R11,UJEFCLSE                                        DASD 00896000
         LA    R10,RETN                                            DASD 00897000
         BAL   R11,UJEFCLSE                                        DASD 00898000
         AIF   (&X8).X8060                                              00899000
         LA    R10,JOBQ                                            DASD 00900000
         BAL   R11,UJEFCLSE                                        DASD 00901000
.X8060   ANOP                                                           00902000
         L     R11,CALLAREA+4                                           00903000
         BR    R11                                                 DASD 00904000
UJEFCLSE DS    0H                                                  DASD 00905000
         TM    48(R10),X'10'  IS FILE OPEN ??                      DASD 00906000
         BZ    0(R11)         NOPE  RETURN                         DASD 00907000
         JOLCLOSE ((R10)),MF=(E,CALLAREA) CLOSE THIS GUY           DASD 00908000
         BR    R11            RETURN                               DASD 00909000
*                                                                       00910000
         AIF   (&X8).X8080                                              00911000
* THE FOLLOWING LOCATIONS ARE USED FOR READING AND WRITING              00912000
*  THE SYSTEM JOBQ                                                      00913000
*                                                                       00914000
* LOCN 1 CONTAINS THE TTR OF THE RECORD WRITTEN                         00915000
* LOCN 2 CONTAINS THE ADDRESS (IN DISPACEMENT FORM) OF THE AREA         00916000
*  TO BE USED AS THE READ/WRITE AREA                                    00917000
*                                                                       00918000
JCTDECB  DC    F'0'                                                     00919000
         LA    R1,JCT         EXECUTED ***                              00920000
         SPACE                                                          00921000
SCTDECB  DC    F'0'                                                     00922000
         LA    R1,SCT                                                   00923000
         SPACE                                                          00924000
PDQDECB2 DC    F'0'                                                     00925000
         LA    R1,PDQ                                                   00926000
         SPACE                                                          00927000
SIOTDECB DC    F'0'                                                     00928000
         LA    R1,SIOT                                                  00929000
         SPACE                                                          00930000
JFCBDECB DC    F'0'                                                     00931000
         LA    R1,INFMJFCB                                              00932000
         SPACE                                                          00933000
PDQDECB  DC    F'0'                                                     00934000
         LA    R1,PDQBLK                                                00935000
           SPACE 3                                                      00936000
ISINPDQ    DS CL1                                                       00937000
.X8080   ANOP                                                           00938000
ISRUN      DC C' '                                                      00939000
RETNBLKS   DS  H                                                        00940000
PDQDSNNO   DS  H                                                        00941000
GOTOLAB    DS  CL8                                                      00942000
APDQDIR    DS  A                                                        00943000
           SPACE 3                                                      00944000
LABEL      DS  CL8                                                      00945000
COMMAND    DS  CL8                                                      00946000
GETATKN   LA R1,TKNX                                                    00947000
          L  R15,=V(UJCGETKN)                                           00948000
          BR R15                                                  75128 00949000
         AIF   (&X8).X8100                                              00950000
           SPACE 6                                                      00951000
* GET/PUT JOBQ ROUTINES CALLED BY GETJOBQ/PUTJOBQ MACROS                00952000
* ON ENTRY R0-> CONTROL AREA CONTAINING TTR SAVE SPACE, AND A(AREA)5128 00953000
*          R1-> TTR REQUIRED                                      74365 00954000
*                                                                       00955000
* A SEPARATELY ASSEMBLED CSECT CALLED UJEJOBQ IS RESPONIBLE             00956000
*  FOR ACTUALLY CALLING THE IBM MODULE 'IEFQMRAW' TO DO THE             00957000
*  JOBQ TRANSFERS                                                       00958000
*                                                                       00959000
*  THE PARAMETERS 'UJEJOBQ' WANTS ARE :-                                00960000
*  R1-> :-                                                              00961000
*     1. A(RECEIVE/WRITE AREA)                                          00962000
*     2. A(TTR POINTER)                                                 00963000
*     3. TRANSFR TYPE 4=READ ETC                                        00964000
*     4. A(IEFQMRAW)               IBM ROUTINE                          00965000
*                                                                       00966000
GETJOBQ    MVI CALLAREA+11,4   READ INDICATOR TO PUT IN IEFQMRAW        00967000
           B   E00JOBQ                                                  00968000
PUTJOBQ  MVI   CALLAREA+11,X'03'  WRITE INDICATOR FOR QM          75128 00969000
         LR  R15,R0        GET CONTROL AREA ADDRESS                     00970000
         L   R1,0(R15)     GET TTR FROM SAVED AREA                      00971000
E00JOBQ  LR    R15,R0         LOAD R15 A(CONTROL BLOCK)           75128 00972000
         IC    R1,=AL1(0)     SET BOTTOM BYTE TO 0                 3.1  00973000
         ST    R1,0(R15)      STORE TTR REQD IN CONTROL BLOCK     75128 00974000
         ST    R1,CALLAREA+4  AND IN PARM FOR UJEJOBQ             75128 00975000
         EX    R0,4(R15)      EXECUTE LA INSTRUCTION TO FIND      75128 00976000
*                             ADDRESS OF AREA TO READ/WRITE       75128 00977000
         ST    R1,CALLAREA    SET PARM(1)                         75128 00978000
         MVC   CALLAREA+12(4),AQMRAW SHIFT A(IEFQMRAW)            75128 00979000
           B  *+4    ******************************************         00980000
           B  *+4    ******************************************         00981000
           ST  R14,IEFQRETN    SAVE RETURN ADDRESS                      00982000
         LA    R1,CALLAREA    SET R1 UP PROPERLY                  75128 00983000
         L     R15,=V(UJEJOBQ) LOAD JOL'S INTERFACE TO IEFQMRAW   75128 00984000
         BALR  R14,R15         AND BRANCH TO IT                   75128 00985000
         LTR   R2,R15         DID WE MANAGE FUNCTION ?            75128 00986000
           BZ E00RMODE                                                  00987000
         JOLERR 509,'UNABLE TO READ/WRITE JOBQ'                   75128 00988000
           SPACE                                                        00989000
E00RMODE DS    0H                                                 75128 00990000
*        UNSUP      LA R1,X'24' SVC 107                           75128 00991000
         L     R1,CALLAREA+4  RELOAD TTR FOR CALLER IN CASE HE WANT5128 00992000
           L   R14,IEFQRETN    LOAD RETURN ADDRESS                      00993000
           BR  R14             AND GO BACK                              00994000
.X8100    ANOP                                                          00995000
           SPACE 3                                                      00996000
E00FXVOL   MVI   VOL,C' '  CLEAR TO BLANKS                         DASD 00997000
           MVC   VOL+1(L'VOL-1),VOL                                DASD 00998000
           LA R1,VOL-1                                            74365 00999000
           LA R15,DDVOLUME                                        74365 01000000
E00SHFTC   MVI 0(R1),C','     SHIFT IN COMMA TO SEPARATE VOLS    74365  01001000
           MVC 1(6,R1),0(R15)  SHIFT IN A VOLUME                  74365 01002000
           LA  R1,6(R1)        STEP OVER ',VOLUME'                 DASD 01003000
           LA R15,6(R15)       STEP OVER VOLUME                   74365 01004000
           CLI 0(R1),C' '      DROP EXTRA BLANKS (IF L'VOL<6)     74365 01005000
           BNE *+8             NOT BLANK                          74365 01006000
           BCT R1,*-8          IS BLANK,DROP R1 BY 1              74365 01007000
           LA  R1,1(R1)        SKIP TO NEXT POSITION              75311 01008000
           CLI 0(R15),C' '     LAST VOL ?                         74365 01009000
           BE E00SETVL         YEP, OUT WE GO (NEARLY)            74365 01010000
           C R15,=A(DDVOLUME+30)   END LIST                       74365 01011000
           BNH E00SHFTC                                                 01012000
E00SETVL   S  R1,=A(VOL-1)                                       75003  01013000
           STH  R1,#VOL                                                 01014000
           BR R14                                                 74365 01015000
UJS23EP5   LA  R1,5                                                     01016000
           B   UJS23SET                                                 01017000
UJS23EP4   LA  R1,4                                                     01018000
           B   UJS23SET                                                 01019000
UJS23EP3   LA  R1,3                                                     01020000
           B   UJS23SET                                                 01021000
UJS23EP2   LA  R1,2                                                     01022000
           B   UJS23SET                                                 01023000
UJS23EP1   LA  R1,1                                                     01024000
           B   UJS23SET                                                 01025000
UJS23EP0   SR  R1,R1                                                    01026000
UJS23SET DS    0H                                                       01027000
           STC R1,S23SEV                                                01028000
           L   R15,=V(UJS23ER)                                          01029000
           BR  R15                                                      01030000
* WILL EVENTUALLY RETURN TO R14 ADDRESS                                 01031000
#S23MAX  DC    H'92'               MAX WTO OR LREC SIZE           76200 01032000
#S23LNE2 DS    H                   LINE 2 LENGTH                  76200 01033000
S23LNE2  DS    CL100               LINE 2 WORK AREA               76200 01034000
S23SEV     DS  CL1                                                      01035000
S23STMT    DC  XL4'00000000'                                            01036000
#S23BLKS   DS  H                                                        01037000
           DS  H                                                        01038000
#S23LREC   DS  H                                                        01039000
#S23MSSG   DS  H                                                        01040000
S23MSSG    DS  CL150                                              74365 01041000
           DS  F                                                  75003 01042000
#VOL       DC  H'0'                                               75311 01043000
VOL        DC  CL50' '                                            75311 01044000
TASK2ECB   DC  F'0'                                               74365 01045000
           DS  F               SPARE                                    01046000
RUNBLDL    DS  0D                                                       01047000
           DC  H'1'                                                     01048000
           DC  H'68'                                                    01049000
RUNNAME    DS  CL8                                                      01050000
RUNTTRK    DS  CL4                                                      01051000
RUNZ1      DS  CL1                                                      01052000
RUNC1      DS  CL1                                                      01053000
RUNUSDTA   DS  CL68                                                     01054000
UJ00ANS    DS 3F                                                        01055000
UJE00DDM    DC CL8'$$PRNT'                                              01056000
           ENTRY RETN,INSTRUCT,PRINT  ******FOR LINK MAP ******   75128 01057000
RETN       DCB DDNAME=&DDINST,DSORG=PO,MACRF=W,                 80290  *01058000
               DEVD=DA,RECFM=FB,LRECL=80,                              *01059000
               BLKSIZE=&RETNSIZ                                    DASD 01060000
INSTRUCT   DCB DDNAME=&DDINST,DSORG=PO,MACRF=(R,W),DEVD=DA              01061000
PRINT      DCB DDNAME=&DDPRT,DSORG=PS,DEVD=DA,RECFM=VB,LRECL=126,      *01062000
               BLKSIZE=136,MACRF=W                                      01063000
JOLCOIN    DCB DDNAME=JOLCOIN,DSORG=PS,MACRF=PM,                80290  *01064000
               DEVD=DA,RECFM=FB,LRECL=80,                              *01065000
               BLKSIZE=800                                              01066000
         AIF   (&X8).X8120                                              01067000
JOBQ       DCB DDNAME=$$JOBQ,DSORG=PS,MACRF=(WP,RP),DEVD=DA       ***** 01068000
           ENTRY JOBQ                                             ***** 01069000
TEMPDCB  DCB   DDNAME=&DDINST,DSORG=PO,MACRF=R,          JOL30116 76200*01070000
               DEVD=DA,EXLST=TEMPEXIT                    JOL30116 76200 01071000
TEMPEXIT DC    A(JFCBDSNM+X'87000000')                   JOL30116 76200 01072000
ATIOT      DS  A                                                        01073000
.X8120   ANOP                                                           01074000
ATCB       DS  A               ADDRESS OF TCB                           01075000
         AIF   (&X8).X8140                                              01076000
AQMRAW   DS    A(0)           IEFQMRAW JOB Q RTN ADDRESS          75128 01077000
IBMRTN     DC  CL8' '          NAME OF LOADED IBM ROUTINE TO ACCES***** 01078000
*                              THE SYSTEM JOB QUEUE               ***** 01079000
JCTTTR     DC  A(0)            ADDRESS | TTR OF THE JCT (EACH     ***** 01080000
*                              SYSTEM IS A LITTLE DIFFERENT)      ***** 01081000
           SPACE 3                                                      01082000
* THIS TABLE IS USED BY THE SCRATCH AND CATLG ROUTINES                  01083000
*     ALTHOUGH THE JOL PROCESSOR KNOWS WHAT TYPE OF UNIT A 'DD' CARD    01084000
*     IS FOR,TO SAVE SPACE IN THE PROCESSOR IT IS NOT CONVERTED         01085000
*     TO A FULL IBM UNIT (AND OF COURSE THE USER MAY SPECIFY HIS        01086000
*     OWN GENERIC UNIT)                                                 01087000
* THIS TABLE IS USED ONLY WHEN A SCRATCH OR CATALOGUE WAS GIVEN         01088000
*     AND THE USER DID NOT CREATE THE DATA-SET IN THIS JOB,AND          01089000
*     THERE-FORE OS MAY NOT HAVE CONVERTED IT INTO A NICE LOOKING       01090000
*     UMIT FOR US.                                                      01091000
HEXUNITS   DC A(*+12)                                                   01092000
           DC A(5)                                                      01093000
           DC A(HEXUNITE-5)                                             01094000
         COPY  UNITABLE                                            DASD 01095000
HEXUNITE DS    0H                                                       01096000
.X8140   ANOP                                                           01097000
           SPACE 3                                                      01098000
           PRINT GEN                                                    01099000
HEX        EQU *-240                                              75311 01100000
           DC  C'0123456789ABCDEF'                                75311 01101000
#DSNAME    DS 0H                                                        01102000
#DSN       DC  H'10'         INITED ONLY FOR TESTS                      01103000
DSN        DS   0CL44                                                   01104000
DSNAME     DC  CL44'NOT INIT'                                           01105000
RETN8    LA    R15,8                                                    01106000
         B     RETRN                                                    01107000
RETN4    LA    R15,4                                                    01108000
         B     RETRN                                                    01109000
RETN0    SLR   R15,R15                                                  01110000
RETRN    JOLRETN RC=(15)                                                01111000
           SPACE 3                                                      01112000
          DC    80S(*)                                                  01113000
           LTORG                                                        01114000
RETNAREA DS    0D                                                       01115000
READAREA DS    XL&RETNSIZ                                          DASD 01116000
         ORG   READAREA                                                 01117000
TTR$RETN   DS  F               CONSTRUCTED BY BLDL IN UJESCHED          01118000
TTR$INST   DS  F               CONSTRUCTED BY BLDL IN UJESCHED          01119000
NOIDS      DS  H          CURRENT NO OF IDS                             01120000
LEVEL      DC H'0'                                                      01121000
NEST       DC H'0'                                                      01122000
COND       DC  CL50' '                                                  01123000
ERRORIND DC    X'00'          SET ON IF ABEND            CHG26028 76200 01124000
INERRORL DC    X'00'          ON IF CURRENTLY DOING ERRORCHG26028 76200 01125000
* NOTE:- DO NOT SEPARATE NEXT TWO LOCATIONS              CHG26028 76200 01126000
ERRLEVEL DC    H'0'           SET BY 'UJE04IF' WHEN -    CHG26028 76200 01127000
ERRNEST  DC    H'0'           'IF ERROR' FOUND           CHG26028 76200 01128000
SAVENEST   DC  XL6'00'                                                  01129000
         EYEBALL MAXCC                                                  01130000
MAXCC      DC  F'0'                                                     01131000
LASTCC     DC  F'0'                                                     01132000
JOLSVC     DC  X'0A00'         SVC FROM 'OPTION' INSTRUCTION      75311 01133000
IDSTART  DS    0X                                                       01134000
         ORG                                                            01135000
           SPACE 3                                                      01136000
TABLES CSECT                                                            01137000
         COPY  DDDSNDET                                           75128 01138000
         ORG                                                            01139000
DDDETLN  EQU   *-DDDSNDET     LENGTH OF THE AREA                        01140000
         ORG   DDDSNDET                                           75128 01141000
         COPY  PGMDETS                                            75128 01142000
         SPACE 3                                                  75128 01143000
         ORG                                                            01144000
         DS    0H                                                       01145000
MAXIDS   DC    AL2((READAREA+L'READAREA-IDSTART)/18)                    01146000
         DC    AL2(0)                                                   01147000
BLANKS   DC    CL20' '                                                  01148000
         LTORG                                                          01149000
         AIF   (&X8).X8160                                              01150000
         EYEBALL JCT                                                    01151000
JCT      DS    0D                                                       01152000
         IEFAJCTB                                                       01153000
           EYEBALL SCT                                                  01181000
SCT        DS  0D                                                       01182000
         IEFASCTB                                                       01183000
           EYEBALL SIOT                                                 01208000
SIOT     DS    0D                                                       01209000
         IEFASIOT                                                       01210000
         ORG                                                            01261000
         EYEBALL PDQ                                                    01262000
         DS    0D                                                       01263000
PDQ      DS    CL176                                                    01264000
         ORG   PDQ                                                      01265000
PDQDSN1  DS    CL44            DSNAME 1 IN PASSED DATA SET QUEUE        01266000
PDQDSN2  DS    CL44            DSNAME 2 IN PASSED DATA SET QUEUE        01267000
PDQDSN3  DS    CL44            DSNAME 3 IN PASSED DATA SET QUEUE        01268000
PDQENTRY DS    CL1             NUMBER OF ENTRIES IN THIS PDQ            01269000
PDQRESD  DS    CL35            JUNK OR SOMETHING                        01270000
PDQABLK  DS    CL3,CL1         ADDRESS OF ASSOCIATED PDQ BLOCK          01271000
PDQNPDQ  DS    CL3,CL1         ADDRESS OF NEXT PDQ DIRECTORY            01272000
*THESE FIELDS CORRESPOND TO THE MVS PASSED DATA SET INFORMATION         01273000
* BLOCK.                                                                01274000
***** IT IS NOT POSSIBLE TO USE AN MVS MACRO FOR THIS FUNCTION          01275000
* AS ONE DOES NOT EXIST.                                                01276000
*****                                                                   01277000
* THIS IS THE ONLY BLOCK THAT HAS CHANGED FROM                          01278000
* MVT TO MVS ************(SO FAR....) ******                            01279000
          ORG  PDQ                                                      01280000
PDIBLOCK  DS   0X                                                       01281000
PDINPDIP  DS   AL3   ADDRESS OF NEXT PDI SVA                            01282000
PDICTR    DS   AL1   NUMBER OF DSNAMES IN THIS BLOCK                    01283000
PDIBNXTP  DS   A     NEXT PDI BLOCK (DIFFERS FROM PDINPDIP              01284000
*                    ABOVE, AS IT POINTS DIRECTLY AT THE BLOCK,         01285000
*                    NOT -16 AS PDINPDIP).                              01286000
PDIDSNAM  DS   CL44  1ST DSNAME                                         01287000
PDIUNWA   DS   CL1   PASS Q INDICATORS                                  01288000
*                    BIT 0 ON IF INITIAL STATUS=OLD                     01289000
*                    BIT 1 ON IF CURRENT STATUS=OLD                     01290000
*                    BIT 2 ON IF PASS,OFF IF RECIEVED                   01291000
*                    BIT 6 ON IF DSNAME IS A JOBLIB                     01292000
PDIRESVD DS   CL1   RESERVED                                            01293000
PDISTPNO DS   H     STEP NUMBER THAT PASSED                             01294000
PDISIOTA DS   AL3,AL1 SVA OF SIOT THAT PASSED DSN                       01295000
PDISIOTP DS   A     USED FOR SIOT IN ALLOCATION ONLY.                   01296000
* THE ABOVE FIELDS ARE REPEATED THREE TIMES.                            01297000
         ORG  PDIDSNAM                                                  01298000
PDIDSN1  DS   CL44                                                      01299000
PDITERM1 DS   CL1                                                       01300000
PDIRESV1 DS   CL1                                                       01301000
PDISTN1  DS   H                                                         01302000
PDISIOT1 DS   AL3,AL1                                                   01303000
PDISIOW1 DS   A                                                         01304000
PDILEN   EQU   *-PDIDSN1                                                01305000
PDIDSN2  DS   CL44                                                      01306000
PDITERM2 DS   CL1                                                       01307000
PDIRESV2 DS   CL1                                                       01308000
PDISTPN2 DS   H                                                         01309000
PDISIOT2 DS   AL3,AL1                                                   01310000
PDISIOW2 DS   A                                                         01311000
PDIDSN3  DS   CL44                                                      01312000
PDITERM3 DS  CL1                                                        01313000
PDIRESV3 DS   CL1                                                       01314000
PDISTPN3 DS   H                                                         01315000
PDISIOT3 DS   AL3,AL1                                                   01316000
PDISIOW3 DS   A                                                         01317000
         ORG                                                            01318000
         EYEBALL PDQBLOCK                                               01319000
         DS    0D                                                       01320000
PDQBLK   DS    CL176          PASSED DATA SET QUEUE BLOCK               01321000
         ORG   PDQBLK                                                   01322000
PDQCSTEP DS    CL1             CURRENT STEP NUMBER (OR LAST USE         01323000
*                              OF THIS DATA SET)                        01324000
PDQDDNO  DS    CL1             CURRENT DD NUMBER                        01325000
PDQTERM  DS    CL1             PDQ TERMINATION WORK AREA                01326000
*    IF PDQTERM=B'0010' DD-CARD SAID NEW,PASS                           01327000
*    IF PDQTERM=B'0100' DD-CARD SAID OLD,KEEP (IE NOT PASSED NOW)       01328000
*    IF PDQTERM=B'1110' DD-CARD SAID OLD,PASS (OLD,CURRENT STATUS=OLD)  01329000
*    IF PDQTERM=B'1010' DD-CARD SAID OLD,DELETE (OLD,NOT PASSED)        01330000
* IT APPEARS THAT ONCE THE CURRENT STATUS BIT IS 0,ANY REFERENCE        01331000
*    TO THE DATA SET NAME IS IGNORED (I.E AS THOUGH NEVER ON PDQ).      01332000
*                                                                       01333000
*                                                                       01334000
PDQ#UCB  DS    CL1             NUMBER OF UCB'S                          01335000
PDQAJFCB DS    CL3,CL1         QUEUE ADDRESS OF THIS JFCB               01336000
PDQASIOT DS    CL3             QUEUE ADDRESS OF THIS SIOT               01337000
PDQSSTEP DS    CL1             CURRENT STEP NUMBER (WHICH APPEARS       01338000
*                              TO BE ALWAYS THE SAME AS PDQCSTEP ABOVE) 01339000
PDQUCBS  DS    CL40                                                     01340000
PDQUACBO DS    CL3,CL1         ADDRESS OF PDQ OVERFLOW BLOCK            01341000
PDQBLKLN EQU   *-PDQBLK                                                 01342000
* THE ABOVE FIELDS ARE REPEATED TWICE (IE 3 DATA SET DETAILS ALLOWED)   01343000
         ORG                                                            01344000
.X8160   ANOP                                                           01345000
         AIF   (&X8).X8180                                              01346000
         SPACE 3                                                        01347000
         EYEBALL JFCB                                                   01348000
         IEFJFCBN   LIST=YES                                      76200 01349000
         EYEBALL QMPA                                                   01350000
QMPA     DS    0D              USED FOR VS CURRENTLY                    01351000
QMPAJOB  DS    CL8             JOB NAME OR NO-WORK-CHAIN ELEMENT        01352000
QMPAFUNC DS    CL1             FUNCTION CODE                            01353000
QMPAFLTR DS    CL2             NN OF 1ST LOGL TRACK ASSIGNED TO ENTRY   01354000
QMPANOTR DS    CL1             NUMBER OF RECORDS ASSIGNED IN THIS TRACK 01355000
QMPANXTL DS    CL2             NN OF NEXT LOGICAL TRACK                 01356000
QMPANOLT DS    CL1             NUMBER OF LOGICAL TRACKS ASSIGNED        01357000
QMPAJBCD DS    CL1             JOB TYPE CODE                            01358000
QMPAJBST DS    CL1             JOB STATUS CODE                          01359000
QMPAPRTY DS    CL1             JOB PRIORITY                             01360000
QMPANXTQ DS    CL2             NN OF NEXT QUEUE ENTRY                   01361000
QMPAQID  DS    CL2             QUEUE ENTRY IDENTIFICATION               01362000
QMPAORCL DS    CL1             ORIGIN CLASS ID                          01363000
QMPARES1 DS    CL1             RESERVED                                 01364000
QMPATRKS DS    A               ADDRESS TRACK STACKING PARM LIST         01365000
QMPAIND  DS    CL1                                                      01366000
         ORG   QMPAIND                                                  01367000
QMPAAECB DS    A               ADDRESS OF USERS ECB/IOB                 01368000
QMPANORC DS    CL1             1ST 4 BITS=NO OF RECORDS TO ASSIGN       01369000
*                              2ND 4 BITS=NO OF RECORDS TO READ/WRITE   01370000
QMPAAEXT DS    AL3             ADDRESS OF EXTERNAL PARAMETER AREA       01371000
IEFQATCB DS    A               ADDRESS OF TCB                           01372000
IEFQAREC DS    A               ADDRESS OF RECORD BUFFER                 01373000
IEFQAQMP DC    A(QMPA)         ADDRESS OF QMPA                          01374000
IEFQTTR  DS    A               TTR OF REQUESTED RECORD                  01375000
IEFQRCLN DC    AL2(176)                                                 01376000
IEFQFUNC DC    AL2(0)                                                   01377000
IEFQDECB DS    A               WORK AREA(NOT REQUIRED BY IEFQMMAC)      01378000
IEFQRETN DS    A               RETURN ADDRESS                           01379000
.X8180   ANOP                                                           01380000
         EYEBALL INST                                                   01381000
INST     DS    H                               INSTRUCTIONS USE THIS    01382000
*                                              AREA AS WORK AREA AND    01383000
*                                              THEY ARE WRITTEN FROM    01384000
*                                              HERE                     01385000
         ORG   INST                                                     01386000
ILENGTH  DS    H                               LENGTH OF RECORD         01387000
         DC    H'0'                            FOR VB RECORD DESCRIPTOR 01388000
II       DC    C'I'                            RECORD TYPE              01389000
ILABEL   DS    CL8                             STATEMENT LABEL          01390000
ISTMT    DS    CL4                             STATEMENT NUMBER         01391000
ILEVEL   DS    CL1                                                      01392000
INEST    DS    CL1                                                      01393000
ICOMMAND DS    CL8                             INSTRUCTION EG 'TYPE'    01394000
IBODY    EQU   *-ILENGTH                       LENGTH OF FIXED          01395000
*                                              PART OF RECORD           01396000
ITEXT    DS    CL150                                              75128 01397000
         SPACE 3                                                        01398000
         EYEBALL TKNX                                                   01399000
         COPY  TKNX                                                     01400000
         ORG TKNSTRG-IBODY-2                                            01401000
INSTRDA  DS    0C                                                       01402000
         ORG                                                            01403000
         LTORG                                                          01404000
         DS    0D                                                       01405000
INSCSECT CSECT                                                          01406000
JE00TBL1 DC    A(JE00TBL2)                                              01407000
         DC    A(12)                                                    01408000
         DC    A(JE00END2-12)                                           01409000
JE00TBL2 DC    CL8'RUN     ',V(UJE20RUN)                                01410000
         DC    CL8'C       ',V(UJE05CAT)        CATLG                   01411000
         DC    CL8'U       ',V(UJE06UNC)        UNCATLG                 01412000
         DC    CL8'K       ',V(UJE07KEE)        KEEP                    01413000
         DC    CL8'S       ',V(UJE08SCR)        SCRATCH                 01414000
         DC    CL8'D       ',V(UJE09DEL)        DELETE                  01415000
         DC    CL8'RETURN  ',V(UJE23RET)                          74365 01416000
         DC    CL8'TYPE    ',V(UJE10TYP)                                01417000
         DC    CL8'DISPLAY ',V(UJE11DIS)                                01418000
         DC    CL8'SIGNAL  ',V(UJE12SIG)                                01419000
         DC    CL8'STOP    ',V(UJE13STP)                                01420000
         DC    CL8'F       ',V(UJE14FRE)        FREE                    01421000
         DC    CL8'OPTIONS ',V(UJE31OPT)                          75311 01422000
JE00END2 DS    0C                                                       01423000
         EJECT                                                          01424000
PARMAREA DSECT                                                          01425000
         COPY  UJECOMM                                                  01426000
IDOVLY   DSECT                                                          01427000
IDSTMT   DS   CL4                                                       01428000
IDNAME   DS   CL8                                                       01429000
IDRETN   DS   CL4                                                       01430000
IDLEVEL  DS   CL1                                                       01431000
IDNEST   DS   CL1                                                       01432000
********  VOLINFO DSECT USED TO REFERENCE A CAMLST *************   DASD 01433000
VOLINFO  DSECT                                                     DASD 01434000
NOVOLS   DS    H                                                   DASD 01435000
CATDEV   DS    XL4  )                                              DASD 01436000
CATVOL   DS    CL6  )   REPEATS NOVOLS TIMES                       DASD 01437000
CATLABEL DS    H    )                                              DASD 01438000
         AIF   (&X8).X8200                                              01439000
UCBS     DSECT ,                                            FIX-X 76200 01440000
         IEFUCBOB  LIST=YES                                 FIX-X 76200 01441000
.X8200   ANOP                                                           01442000
         TITLE 'UJE04IF: HANDLE EXECUTE IF STATEMENT'                   01443000
         COPY     UJE04IF                                               01444000
         LTORG                                                          01895000
           DROP  R7                                                     01899000
           TITLE 'UJE05CAT:CATALOGUE DATA SET'                          01900000
          JOLSAVE CSECT=UJE05CAT                                        01901000
* THIS ROUTINE DOES THE CATALOGUING                                     01902000
         AIF   (&X8).X8220                                              01903000
* NOW:- WE FACE MANY PROBLEMS WHEN DOING A 'CATLG' (OR A KEEP)          01904000
* FIRST,WE SHALL CALL THE KEEP ROUTINE WHICH READS THE ODD              01905000
*     JFCB,FIXES PDQ'S ETC                                              01906000
           CLI ICOMMAND,C'U'   UNCATALOGUE CALLING ME TO PRINT          01907000
*                              ERROR MESSAGES ?                         01908000
*          BNE E05DOCAT                                                 01909000
           BE E05PRNTE                                                  01910000
           CLI ICOMMAND,C'D'   DELETE CALLING ME TO PRINT ERR?          01911000
           BE E05PRNTE                                                  01912000
E05DOCAT DS    0H                                                       01913000
           SPACE 3                                                      01914000
         CALL UJE07KEE   KEEPS THE DATA SET.                            01915000
         LTR R15,R15                                                    01916000
         BZ  E05TVOLS                                                   01917000
         LR  R2,R15                                                     01918000
         CH  R15,=H'4'       DOES KEEP WANT TO SKIP TO A NEW OS STEP?   01919000
         BNE E05KEEPE        NO,THERE WAS A REAL ERROR                  01920000
         JOLRETN RC=4                                                   01921000
E05KEEPE LA  R2,32                                                      01922000
E05UNSUC DS    0H                                                       01923000
          JOLERR 202,                                                  *01924000
               'DSID ''',DDDSID,''' DSNAME ''',#DSNAME,''' KEPT ON VOL(*01925000
               S) ',#VOL,' BUT NOT CATALOGUED BECAUSE:-'          74365 01926000
         B     E05PRNTE                                                 01927000
E05TVOLS DS    0H                                                       01928000
* AT THIS POINT WE MIGHT HAVE TO DO SOME EXTRA WORK BEFORE WE CAN  DASD 01929000
* CATALOGUE THIS DATASET                                           DASD 01930000
* FIRST IF THE JFCBNVOL (NUMBER OF VOLUMES) EXCEEDS 5              DASD 01931000
* THE REST OF THE VOLUME SERIAL NUMBERS ARE RECORDED IN            DASD 01932000
* A JFCB EXTENSION BLOCK AT 15 A CRACK                             DASD 01933000
* SO IF WE SUPPORT GREATER THAN 5 WE MUST ALLOW FOR THE            DASD 01934000
* O.S. MAXIMUN OF 255.                                             DASD 01935000
         CLC   JFCBNVOL,=AL1(L'JFCBVOLS/6) > 5 VOLUMES ?           DASD 01936000
         BNH   EO5TOLOW             NOPE DO THIS THE OLD WAY       DASD 01937000
         LA    R14,E05UNIT          POINT TO CATALOGUE AREA        DASD 01938000
         SR    R15,R15              CLEAR REG-15                   DASD 01939000
         IC    R15,JFCBNVOL         INSERT VOLUME COUNT            DASD 01940000
EO5STUFF DS    0H                                                  DASD 01941000
         MVC   0(4,R14),SCTUTYPE    PLUG IN UNIT TYPE              DASD 01942000
         MVC   4(6,R14),BLANKS      CLEAR VOLUME SERIAL            DASD 01943000
         MVC   10(2,R14),JFCBFLSQ   PLUG IN FILE SEQ #             DASD 01944000
         LA    R14,12(R14)          POINT TO NEXT AREA             DASD 01945000
         BCT   R15,EO5STUFF         DO THE REST                    DASD 01946000
         XC    0(12,R14),0(R14)     CLEAR NEXT AREA                DASD 01947000
* NOW PLUG IN THE FIRST 5 VOLUMES SERIALS FROM THE JFCB            DASD 01948000
         LA    R15,5                STOP AFTER 5                   DASD 01949000
         LA    R14,E05UNIT          POINT TO CATALOGUE AREA        DASD 01950000
         LA    R1,JFCBVOLS          POINT TO FIRST 5 VOLUMES       DASD 01951000
E05STJ5  DS    0H                                                  DASD 01952000
         MVC   4(6,R14),0(R1)       MOVE IN VOLSER                 DASD 01953000
         LA    R1,6(R1)             POINT TO NEXT VOLUME           DASD 01954000
         LA    R14,12(R14)          POINT TO NEXT AREA             DASD 01955000
         BCT   R15,E05STJ5          RETURN FOR THE REST            DASD 01956000
         ST    R14,E05START         SAVE THIS GUY FOR LATER        DASD 01957000
         SR    R15,R15              CLEAR REG-15                   DASD 01958000
         IC    R15,JFCBNVOL         INSERT # VOLUMES IN R15        DASD 01959000
         SH    R15,=H'5'            BACKOFF 5                      DASD 01960000
         STH   R15,E05#VOLS         SAVE IT                        DASD 01961000
* NOW READ THE JFCB EXTENSION BLOCK POINTER TO BY JFCBEXAD OF THE JDASD 01962000
         MVC   JFCBETTR,JFCBEXAD    PUT ON A WORD BOUNDARY         DASD 01963000
GJFCBX   GETJOBQ JFCXDECB,JFCBETTR  GET EXTENSION BLOCK            DASD 01964000
         MVC   JFCBETTR,JFCBXTTR    MOVE NEXT GUY TO POINTER       DASD 01965000
         LH    R15,E05#VOLS         GET NUMBER OF VOLS LEFT        DASD 01966000
         LA    R1,15                LETS STOP AFTER 15             DASD 01967000
         L     R14,E05START         START MOVING VOLSERS TO HERE   DASD 01968000
         LA    R2,JFCBXVOL          POINT TO EXTRA VOLSER AREA     DASD 01969000
GJFCBXM  MVC   4(6,R14),0(R2)       MOVE HIM IN                    DASD 01970000
         SH    R15,=H'1'            BACKOFF R15 BY 1               DASD 01971000
         BZ    E05DONE              IF ZERO THATS IT               DASD 01972000
         LA    R14,12(R14)          UP TO NEXT AREA                DASD 01973000
         LA    R2,6(R2)             UP TO NEXT VOLSER IS JFCBX     DASD 01974000
         BCT   R1,GJFCBXM           GO BACK FOR THE REST,          DASD 01975000
         STH   R15,E05#VOLS         SAVE THE # OF VOLS LEFT        DASD 01976000
         ST    R14,E05START         SAVE NEXT AREA ADDRESS         DASD 01977000
         B     GJFCBX               GET THE REST OF THE EXTENSION BDASD 01978000
EO5TOLOW DS    0H                                                  DASD 01979000
* NOW LETS DO THE CATALOGUE,SHALL WE ?                                  01980000
         XC    E05VOLS(E05ETBL-E05VOLS),E05VOLS CLEAR TABLE INITIALLY   01981000
         MVC   E05VOLX+(0*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),DDVOLUME+0  01982000
         MVC   E05VOLX+(1*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),DDVOLUME+6  01983000
         MVC   E05VOLX+(2*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),DDVOLUME+12 01984000
         MVC   E05VOLX+(3*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),DDVOLUME+18 01985000
         MVC   E05VOLX+(4*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),DDVOLUME+24 01986000
         MVC   E05UNIT+(0*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),SCTUTYPE    01987000
         MVC   E05UNIT+(1*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),SCTUTYPE    01988000
         MVC   E05UNIT+(2*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),SCTUTYPE    01989000
         MVC   E05UNIT+(3*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),SCTUTYPE    01990000
         MVC   E05UNIT+(4*(L'E05UNIT+L'E05VOLX+L'E05LABEL)),SCTUTYPE    01991000
         MVC   E05LABEL,JFCBFLSQ                                        01992000
         XC    E05#VOLS,E05#VOLS                                        01993000
E05DONE  DS    0H                                                  DASD 01994000
***** TO SUPPORT RECAT, BLDX (AGAIN)                                    01995000
**SEPT 75                                                               01996000
         MVI   E05CAT,100  CATALOGUE INDICATORS                         01997000
         MVI   E05CAT+1,0  TURN OFF BLDX ENTRY                          01998000
           MVC E05#VOLS+1(1),JFCBNVOL SHIFT IN NUMBER OF VOLUMES        01999000
           LA R1,DSNAME                                                 02000000
           ST R1,E05CAT+4                                               02001000
           CLI DDMBR+1,C'+'      GENERATION DATASET ?             75311 02002000
           BE  E05NOBLD        YES,DON'T CATALOGUE WITH BUILD INDEX     02003000
           CLI DDMBR,C'('      GENERATION DATASET ?                     02004000
           BE  E05NOBLD        YES,DON'T CATALOGUE WITH BUILD INDEX     02005000
         CLI VS,C'2'   MVS                                         DASD 02006000
         BE  E05NOBLD  YEP  MVS WILL NOT RECAT WILL BLDX ON        DASD 02007000
         OI  E05CAT+1,X'40'                                       75128 02008000
E05NOBLD DS    0H                                                       02009000
* NOW TEST RE-CATLG FUNCTION                                            02010000
         IFNULL DDLABTYP,E05NALWA                                       02011000
* ALWAYS HERE                                                           02012000
         MVI E05CAT,X'54'  TURN ON RE-CATLG BIT                   75311 02013000
         CATALOG E05CAT                                           75311 02014000
         LTR     R15,R15   DID WE RECATLG IT?                     75311 02015000
         BZ   E05SUCES YES                                        75311 02016000
* NOW RECATLG FAILED, SO ATTEMPT STRAIGHT CATLG THEN              75311 02017000
         MVI   E05CAT,X'64'                                       75311 02018000
E05NALWA DS    0H                                                       02019000
         CATALOG E05CAT                  DO THE CATALOGUE               02020000
         LTR R15,R15                                                    02021000
         BNZ E05ERR                                                     02022000
E05SUCES DS   0H                                                        02023000
* NOW WE MUST CHECK AGAIN FOR GREATER THAN 5 VOLUMES BECAUSE       DASD 02024000
* ALL OF THE VOLUMES MIGHT NOT FIT ON 1 MESSAGE                    DASD 02025000
         LH    R14,E05#VOLS         LOAD VOL COUNT                 DASD 02026000
         XC    E05#VOLS,E05#VOLS    CLEAR VOL COUNT                DASD 02027000
         CH    R14,=H'5'            > 5 VOLUMES                    DASD 02028000
         BNH   E05SUCE2             NO   LETS DOIT THE OLD WAY     DASD 02029000
         SH    R14,=H'5'            SUBTRACT 5                     DASD 02030000
         STH   R14,E05#VOLS         STORE BACK FOR LATER           DASD 02031000
         MVI   DDVOLUME,C' '        MOVE IN JUST THE 1ST FIVE      DASD 02032000
         MVC   DDVOLUME+1(L'DDVOLUME-1),DDVOLUME                   DASD 02033000
         MVC   DDVOLUME(L'JFCBVOLS),JFCBVOLS                       DASD 02034000
         BAL   R14,E00FXVOL         MOVE TO #VOL,VOL EDITTED       DASD 02035000
         L     R15,=A(E05UNIT+60)   POINT TO 6TH VOLSER IN CAMLST  DASD 02036000
         ST    R15,E05START         SAVE FOR LATER                 DASD 02037000
E05SUCE2 DS    0H                                                  DASD 02038000
         JOLERR 101,'DSID ''',DDDSID,''' DSNAME ''',                   *02039000
               #DSNAME,''' CATALOGUED ON VOL(S) ',#VOL            74365 02040000
          LH    R14,E05#VOLS        LOAD NUMBER OF VOLS LEFT       DASD 02041000
          LTR   R14,R14             ALL DONE                       DASD 02042000
          BZ    E05GOODR            YES SIR LETS GO                DASD 02043000
E05LMSGS DS    0H                                                  DASD 02044000
          L     R15,E05START        POINT TO NEXT AREA             DASD 02045000
          MVI   DDVOLUME,C' '       CLEAR CONSTRUCT AREA           DASD 02046000
          MVC   DDVOLUME+1(L'DDVOLUME-1),DDVOLUME                  DASD 02047000
          LA    R1,DDVOLUME         POINT TO CONSTRUCT AREA        DASD 02048000
          LA    R2,5                LETS STOP AFTER 5              DASD 02049000
E05LMSG   MVC   0(6,R1),4(R15)      MOVE IN NEXT VOLUME SERIAL     DASD 02050000
          LA    R1,6(R1)            BUMP DDVOLUME BY 6             DASD 02051000
          LA    R15,12(R15)         BUMP CAMLST BY 12              DASD 02052000
          SH    R14,=H'1'           BACKOFF VOL COUNT BY 1         DASD 02053000
          BZ    E05LMSGD            IF ALL DONE GET OUT EARLY      DASD 02054000
          BCT   R2,E05LMSG          RETURN FOR THE REST            DASD 02055000
E05LMSGD DS    0H                                                  DASD 02056000
          STH   R14,E05#VOLS        SAVE # OF VOLS LEFT            DASD 02057000
          ST    R15,E05START        STORE NEXT AREA ADDRESS        DASD 02058000
          BAL   R14,E00FXVOL        MOVE TO #VOL,VOL EDITTED       DASD 02059000
          B     E05SUCE2            GO PRINT THE  MESSAGE          DASD 02060000
E05GOODR DS    0H                                                  DASD 02061000
          JOLRETN                                                       02062000
E05ERR     LR  R2,R15                                                   02063000
           B   E05UNSUC                                                 02064000
           SPACE 3                                                      02065000
E05PRNTE DS    0H                                                       02066000
           B  E05RETNC(R2)                                              02067000
E05RETNC   B   E05SUCES                                                 02068000
           B   E05RET4                                                  02069000
           B   E05RET8                                                  02070000
           B   E05RET12                                                 02071000
           B   E05RET16                                                 02072000
           B   E05RET20                                                 02073000
           B   E05RET24                                                 02074000
           B   E05RET28                                                 02075000
           B   E05RET32                                                 02076000
           B   E05RET36                                                 02077000
E05RET4    JOLERR 203,'CATALOGUE VOLUME NOT MOUNTED'                    02078000
           B  E05RETN0                                                  02079000
         FIX  'NOTE R0=0 IF C AND ALREADY CATLGD'           FIX-X 76200 02080000
         FIX  'NOTE R0=60 IF U/D AND YSAM'                  FIX-X 76200 02081000
E05RET8    JOLERR 204,'DATA SET NAME FOUND AT LOWER LEVEL'              02082000
           B  E05RETN0                                                  02083000
E05RET12 DS    0H                                                       02084000
           JOLERR 205,'CATLG RETN''D 12'                                02085000
           B  E05RETN0                                                  02086000
E05RET16   JOLERR 206,'NO INDEX LEVEL FOR DATA SET'                     02087000
           B  E05RETN0                                                  02088000
E05RET20   JOLERR 407,'CATALOGUE DATA SET IS FULL'                      02089000
           B  E05RETN0                                                  02090000
E05RET24   JOLERR 208,'INVALID GENERATION NAME'                         02091000
           B  E05RETN0                                                  02092000
E05RET28   JOLERR 409,'PERMANENT I/O ERROR ON CATALOGUE DATA SET'       02093000
           B  E05RETN0                                                  02094000
E05RET32   JOLERR 210,'KEEP FAILED FOR DATA SET'                        02095000
           B  E05RETN0                                                  02096000
E05RET36   JOLERR 211,'NO VOLUMES WERE SUPPLIED'                        02097000
E05RETN0   B    RETN0                                                   02098000
E05CAT     CAMLST CAT,0,,E05VOLS                                        02099000
         AGO   .NX8220                                                  02100000
.X8220   ANOP                                                           02101000
         L     R4,ATCB              ADDRESS MY TCB                      02102000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     02103000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 02104000
         BZ    E05NOFCT              EXIT IF NONE ?!! & SSSSSSSSS       02105000
         SPACE                                                          02106000
*   FOUND THE FCT CHAIN. NOW FIND A DATASET ENTRY                       02107000
         SPACE                                                          02108000
         USING FCT,R4                                                   02109000
E05NXFCT DS    0H                                                       02110000
         CLC   FCTFLN,DSN            Q... IS THIS IT?                   02111000
         BE    E05FFCT               A... YES, GO AND FIX IT            02112000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           02113000
         BNZ   E05NXFCT              BR IF THERE IS ONE                 02114000
         B     E05NOFCT                                                 02115000
E05FFCT  DS    0H    FOUND AN FCT TO "FIX"                              02116000
         $TELL (R4)                                                     02117000
         MODESET  KEY=ZERO                                              02118000
         NI    FCTSTS1,X'FF'-FCTS1DLT  IF CAT, DO NOT DELETE            02119000
         NI    FCTFDST1,X'FF'-FCTFSNFD DITTO                            02120000
         NI    FCTFLG3,X'FF'-FCTF3UCT TURN OFF UNCAT                    02121000
         B     *+8                    SKIP NEXTY INSTRUCTION.  CVC      02122000
         OI    FCTFLG3,FCTF3CAT      TURN CAT BIT ON                    02123000
         SPACE 2                                                        02124000
*  WELL, THAT SHOULD BE ALL                                             02125000
         SPACE                                                          02126000
         MODESET KEY=NZERO    BACK TO MY USUAL PROTECT KEY              02127000
         SPACE 3                                                        02128000
* WHILE HERE, COPY THE VOLUME SERIAL NUMBERS TO RESOLVE FUTURE VOLREFS  02129000
         SPACE 2                                                        02130000
         CLEAR DDVOLUME                                                 02131000
         SLR   R8,R8                                                    02132000
         ICM   R8,1,FCTVOLNO        LOAD VOLUME COUNT                   02133000
         BZ    E05NVCT             EXIT IF THERE ARE NO VOLUMES         02134000
         LA    R0,L'DDVOLUME/6      LOAD NUMBER OF VOLUMES ALLOWED      02135000
         CR    R0,R8                CHECK THAT THE SERIAL NUMBERS FIT   02136000
         BH    E05VOK               BE IF OK                            02137000
         JOLERR 512,'DS ',DDDSID,',',#DSN,                             .02138000
               ' VOLUME REFERENCES CANNOT BE RESOLVED, DATASET RESIDES .02139000
               ON TOO MANY VOLUMES'                                     02140000
E05VOK   DS    0H                                                       02141000
         L     R6,FCTVCT                                                02142000
         LA    R15,DDVOLUME         ADDRESS FOR VOLUMES                 02143000
E05VNXTV DS    0H                                                       02144000
         MVC   0(6,R15),8(R6)       COPY THE VOLUME SERIAL NUMBER       02145000
         LA    R15,6(,R15)          ADDRESS FOR NEXT AREA               02146000
         L     R6,4(,R6)            ADDRESS THE NEXT VCT                02147000
         BCT   R8,E05VNXTV          CONTINUE UNTIL ALL AREA DONE        02148000
         CALL  UJE07KEE       KEEP THE DATASET                          02149000
         SPACE 2                                                        02150000
E05CVC9  BAL   R14,E00FXVOL         COPY VOLS TO #VOLS                  02151000
         SPACE                                                          02152000
         UJE22UPD DDDSNAME,DDVOLUME FIX FUTURE VOLUME REFERENCES        02153000
         OPEN  (JOLCOIN,(OUTPUT))                                       02154000
         MVC   WORK(80),=CL80'/ CATL'                                   02155000
         PUT   JOLCOIN,WORK                                             02156000
         MVC   WORK(6),=C'/ FILE '      SHIFT IN FILE NAME              02157000
         MVC   WORK+7(44),DSN           AND DSNAME                      02158000
         LA    R1,WORK+7                GET ADDRESS OF WORK             02159000
         AH    R1,#DSN                  GET LENGTH OF DSNAME            02160000
         MVI   0(R1),C','               PUT COMMA AT END                02161000
         MVC   1(L'DDVOLUME,R1),VOL     SHIFT IN VOLS                   02162000
         PUT   JOLCOIN,WORK                                             02163000
         CLOSE (JOLCOIN)                                                02164000
         LA    R1,CTFEPARM              GET ADDRESS OF PARAMETER AREA   02165000
         LINK  EP=CTFE                  DO THE CATALOG                  02166000
         CH    R15,=H'10'               GOOD RETURN CODE ?              02167000
         BE    E05X8CAT                                                 02168000
         JOLERR 202,'DATA SET ''',#DSN,''' NOT CATALOGUED - SEE LIST'   02169000
         B     RETN0                                                    02170000
E05X8CAT JOLERR 004,'DATA SET ''',#DSN,''' CATLOGUED ON VOL(S) ',#VOL   02171000
*  WELL, THAT SHOULD BE ALL: NOW FREE THE ORIGINAL DATASET              02172000
*        B     RETN0                                                    02173000
*        JOLERR 004,'DSID ',DDDSID,' MARKED "CATALOGUE"'                02174000
         MVI   DDDISP+1,C'L' LAST USE                                  .02175000
                                (A LIE OF COURSE, BUT HE WON'T KNOW)    02176000
         MVC   DDDDNAME,FCTACSN    ENSURE HE USES THE CORRECT DDNAME    02177000
         CALL  UJE14FRE            FREE THE DATASET                     02178000
         B     RETN0                                                    02179000
E05NVCT  JOLERR 201,                                                   .02180000
               'DSID ',DDDSID,' NOT CATALOGUED, HAS NO VOLUMES  '       02181000
         B     RETN0                                                    02182000
CTFEPARM DS    0F                                                       02183000
         DC    A(NULLP)                                                 02184000
         DC    X'80',AL3(E05ACNMS)                                      02185000
NULLP    DC    H'0'                                                     02186000
E05ACNMS DC    H'16'                                                    02187000
         DC    CL8'JOLCOIN',CL8'JOLUTP'                                 02188000
.NX8220  ANOP                                                           02189000
E05RETN0 B     RETN0                                                    02190000
E05NOFCT CLC   DDVOLUME,=C'     '     DOES IT HAVE A VOLUME             02191000
         BNE   E05CVC9                YES                               02192000
         JOLERR 203,                                                   .02193000
               'DSID ',DDDSID,' NOT CATALOGUED, IS NOT ALLOCATED'       02194000
         B     RETN0                                                    02195000
         LTORG                                                     DASD 02196000
         DC    80S(*)                                              DASD 02197000
         AIF   (&X8).X8240                                              02198000
JFCXDECB DC    F'0'                                                DASD 02199000
          LA       R1,JFCBXTTR                                     DASD 02200000
          SPACE 3                                                  DASD 02201000
          EYEBALL  JFCX                                            DASD 02202000
          IEFJFCBX                                                 DASD 02203000
JFCBETTR  DC       F'0' JFCB EXTENSION POINTER                     DASD 02204000
E05START  DC       F'0' AREA ADDRESS WORK AREA                     DASD 02205000
.X8240   ANOP                                                           02206000
          ENTRY E05VOLS                                            DASD 02207000
E05VOLS   DS 0D                                                         02208000
E05#VOLS  DS H                                                          02209000
E05UNIT   DS CL4                                                        02210000
E05VOLX   DS CL6                                                        02211000
E05LABEL  DS CL2                                                        02212000
          PRINT NODATA SAVE SOME PAPER                                  02213000
          DC    254CL12' '          EXTENDED WORK AREA FOR 255 VOLUDASD 02214000
          PRINT DATA WASTE MORE PAPER FOR CLEM                          02215000
E05ETBL   EQU   E05VOLS+100                                        DASD 02216000
*RECAT B'0001'                                                          02217000
*CAT   B'0010'                                                          02218000
*UNACT B'00001000'                                                      02219000
*BLD   B'0100'                                                          02220000
*DELETE INDEXES B'00001100'                                             02221000
********* ALL THE ABOVE APPLY TO BYTE 0                                 02222000
*  +2  (3RD) B'00000001'=VSAM                                           02223000
* .X8240   ANOP                                                         02224000
           TITLE 'UJE06UNC:UNCATALOGUE DATA SET'                        02225000
           JOLSAVE CSECT=UJE06UNC                                       02226000
*        AIF   (&X8).X8260                                              02227000
         LA    R1,DSNAME                                                02228000
         ST    R1,E06REMUV+4                                            02229000
         ST    R1,E06REMDT+4   REMOVE INDEXES,TOO                       02230000
****************************************************************   DASD 02231000
* NEW 8-1-77 "UNCATLG GDGALL"   NO JCL NEED   ITS ALL DONE HERE*   DASD 02232000
****************************************************************   DASD 02233000
         CLI   DDCATLGS,104    UNCAT GDG ALL ?                     DASD 02234000
         BE    E06GDGAL        GO DO IT                            DASD 02235000
         CLI   DDMBR,C'+'      GDG ?                                    02236000
         BE    E06NODLT        YES,DON'T DELETE INDEX                   02237000
         CLI   DDMBR,C'('      GDG ?                                    02238000
         BE    E06NODLT        YES,DON'T DELETE INDEX                   02239000
         CATALOG E06REMDT    DO THE UNCATALOG AND REMOVE INDEXES        02240000
         LTR   R15,R15         ERROR ?                                  02241000
         BNZ   E06FAIL         YES,PRINT ERROR MESSAGES                 02242000
         B     E06SUCES                                                 02243000
E06NODLT DS    0H                                                       02244000
         CATALOG E06REMUV                                               02245000
         LTR   R15,R15                                                  02246000
          BNZ E06FAIL                                                   02247000
E06SUCES  DS    0H                                                      02248000
           JOLERR 101,'DSID ',DDDSID,' DSNAME ',                       *02249000
               #DSNAME,' UNCATALOGUED'                                  02250000
          B    E06RETN                                                  02251000
E06FAIL  DS    0H                                                       02252000
           LR  R2,R15          SAVE UNCATLG RETURN CODE                 02253000
           JOLERR 202,                                                 *02254000
               'UNCATLG FOR DSID ''',DDDSID,                           *02255000
               ''' NAME ''',#DSNAME,''' FAILED BECAUSE:-'               02256000
         CALL UJE05CAT       LET IT PRINT WHY                           02257000
E06RETN  JOLRETN   RC=0                                            DASD 02258000
E06GDGAL L     R15,=V(E05VOLS)         LOAD CAMLIST ADDRESS        DASD 02259000
         ST    R15,E06LOCAT+12         POINT TO LOCATE AREA        DASD 02260000
         MVC   #DSNAME(2),=H'44'       SET DSNAME TO THE BIGGIE    DASD 02261000
         LA    R6,300(R15)             GO UP A FEW AND SAVE POINTERDASD 02262000
         LA    R1,DSNAME               POINT TO DSNAME             DASD 02263000
         LA    R15,43(R1)              POINT TO END OF DSNAME      DASD 02264000
         LA    R14,1                   INCR BY 1                   DASD 02265000
E06FIND  CLI   0(R1),C' '              END OF DSNAME YET           DASD 02266000
         BE    *+8                     YEP LETS MOVE               DASD 02267000
         BXLE  R1,R14,E06FIND          RETURN                      DASD 02268000
         MVC   0(3,R1),=C'(0)'         LOOK FOR RELATIVE GDG 0     DASD 02269000
         MVC   0(44,R6),DSNAME         MOVE TO LOCATE AREA         DASD 02270000
E06LOOK  MVC   DSNAME,0(R6)            MOVE DSNAME IN              DASD 02271000
         LOCATE E06LOCAT                                           DASD 02272000
         LTR   R15,R15                 DID LOACTE FIND ANYTHING ?? DASD 02273000
         BNZ   E06RETN                 NOPE THAT ALL               DASD 02274000
         CATALOG E06REMUV                                          DASD 02275000
         LTR   R15,R15                 DID THIS WORK OK            DASD 02276000
         BNZ   E06FAIL                 NOPE SOMETHINGS WRONG       DASD 02277000
         JOLERR 103,'DSID ''',DDDSID,''' DSNAME ''',                   *02278000
               #DSNAME,''' GDGALL UNCATALOGED'                     DASD 02279000
         B     E06LOOK                 RETURN TO LOOK FOR MORE GDGADASD 02280000
E06LOCAT CAMLST NAME,DSNAME,,0                                     DASD 02281000
E06REMUV   CAMLST UNCAT,0                                               02282000
E06REMDT   CAMLST UCATDX,0     UNCATLG,REMOVE INDEXES                   02283000
.X8260    ANOP                                                          02284000
         JOLRETN                                                        02285000
         SPACE 2                                                        02286000
         DC    80S(*)                                                   02287000
           TITLE 'UJE07KEE:KEEP DATA SET'                               02288000
           JOLSAVE CSECT=UJE07KEE                                       02289000
* A KEEP INSTRUCTION IS TO BE EXECUTED.                                 02290000
         AIF   (&X8).X8280                                              02291000
* THE KEEP IS A PRETTY EASY INSTRUCTION TO DO,AS IT BASICALLY           02292000
*    MEANS THAT THE PDQ MUST BE FOOLED INTO THINKING THAT THE           02293000
*    DATA SET WAS ORIGINALLY OLD.                                       02294000
* THE ONLY COMPLICATION THAT CAN ARISE IS THAT WE WOULD (ON OCCASIONS)  02295000
*    LIKE THE VOLUME TO BE UNLOADED(OR SET INTO AN UN-LOADABLE          02296000
*    STATUS                                                             02297000
* PERMANENT,RETAINED,'JOL PREFERRED' ETC VOLUMES DO NOT HAVE TO         02298000
*    HAVE THEIR STATUS SET SO THEY MAY BE UNLOADED AND THIS IS          02299000
*    LEFT TO THE OPERATORS DISCRETION.                                  02300000
* IF IT IS A TAPE OR A NON-PREFERRED,(PRIVATE IN OTHER WORDS)           02301000
*    VOLUME AND IT IS NOT RETAINED,IT SHOULD BE DISMOUNTED.             02302000
          CLC DDDSNAME,=C'*DUMMY  '                                     02303000
          BNE  E07NOTDM                           74365                 02304000
          JOLERR 206,'DSID ''',DDDSID,''' DSNAME ''',#DSN,             *02305000
               ''' NOT KEPT:- DUMMY DATA SET'                    75003  02306000
          JOLRETN RC=16                                                 02307000
E07NOTDM DS    0H                                                       02308000
           CALL UJE81PDQ                                                02309000
           LTR R15,R15                                                  02310000
           BZ  E07INPDQ                                                 02311000
           CLI ICOMMAND,C'K'   KEEP ?                                   02312000
           BE  E07ERR1         YES,FLAG IT AS AN ERROR THEN             02313000
           CLC =C'*.',DDVOLUME VOLUME REFERENCE SPECIFIED,BUT DATA SET  02314000
* NOT CREATED ? THIS CAN OCCUR IF THE CREATING STEP WAS BYPASSED        02315000
           BE  E07ERR1         GO FLAG AS AN ERROR                      02316000
           CLI DDVOLUME,C' '   VOL SPECIFIED ?                          02317000
           BE  E07RETNF        NO,SO ERROR                              02318000
           CLI DDUNITYP,C' '   UNIT SPECIFIED ?                         02319000
           BE  E07RETNF        NO,ERROR TOO                             02320000
* WELL A UNIT AND VOLUME WERE SPECIFIED,SO WE SHALL CONVERT             02321000
*     THE UNIT TO AN IBM TYPE OF NAME AND GENTLY RETURN                 02322000
* (THE USER CODED 'CATLG DSN X UNIT Y VOL Z')                           02323000
          SPACE                                                         02324000
E07FIXU   DS    0H                                                      02325000
           NI DDUNITYP,B'10011111' TURN OFF PERM BIT                    02326000
* SPECIAL CODE FOR MVS                                            76200 02327000
         CLI   VS,C' '  IS IT A VS SYSTEM OF ANY SORT?            76200 02328000
         BE    E07NVS9                                             DASD 02329000
* OK, SPECIAL FOR VS AND 3330-1                                   76200 02330000
         CLC   =C'3330-1',DDUNIT                                  76200 02331000
         BNE   E07NVS9                                            76200 02332000
         LA    R1,MVS3330                                         76200 02333000
         B     E07GOTU                                            76200 02334000
         SPACE 2                                                  76200 02335000
E07NVS9  DS    0H                                                 76200 02336000
          L   R1,HEXUNITS                                               02337000
          LM  R14,R15,HEXUNITS+4                                        02338000
E07FINDU   CLC DDUNITYP,4(R1)                                           02339000
           BE  E07GOTU                                                  02340000
           BXLE R1,R14,E07FINDU                                         02341000
           CALL  UJEDEVNM  WELL HOW ABOUT THE DEVICE NAME TABLE    DASD 02342000
           LTR   R15,R15                                           DASD 02343000
           BZ    E07GOTU+6  GREAT                                  DASD 02344000
           JOLERR 403,'INVALID UNIT FOUND IN KEEP'                      02345000
           B   E07RETNF                                                 02346000
E07GOTU    MVC SCTUTYPE,0(R1)                                           02347000
* SET UP NUMBER NUMBER OF VOLUMES IN JFCB,AND VOLUMES                   02348000
           MVC JFCBVOLS,DDVOLUME                                        02349000
           MVI JFCBNVOL,1                                               02350000
           CLI DDVOLUME+06,C' '                                         02351000
           BE E07RETN0                                                  02352000
           MVI JFCBNVOL,2                                               02353000
           CLI DDVOLUME+12,C' '                                         02354000
           BE E07RETN0                                                  02355000
           MVI JFCBNVOL,3                                               02356000
           CLI DDVOLUME+18,C' '                                         02357000
           BE E07RETN0                                                  02358000
           MVI JFCBNVOL,4                                               02359000
           CLI DDVOLUME+24,C' '                                         02360000
           BE E07RETN0                                                  02361000
           MVI JFCBNVOL,5                                               02362000
           B  E07RETN0                                                  02363000
E07ERR1  DS    0H                                                       02364000
           JOLERR 204,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            *02365000
               '''',                                                   *02366000
               ' NOT YET CREATED:-KEEP IGNORED'                         02367000
E07RETNF DS    0H                                                       02368000
           JOLRETN RC=16                                                02369000
           SPACE 3                                                      02370000
E07INPDQ DS    0H                                                       02371000
* NOW JUST BECAUSE THE NAME APPEARS IN THE PDQ DOESN'T MEAN FOR         02372000
*    1 SECOND THAT IT HASN'T :-                                         02373000
*          1.  BEEN SCRATCHED                                           02374000
*          2.  BEEN ALREADY KEPT                                        02375000
           LH  R1,PDQDSNNO     1ST,2ND OR 3RD NAME IN PDQ ?             02376000
          CLI VS,C'2'    IS IT AN MVS SYSTEM?                           02377000
        BNE  E07NMV1S  NO                                          DASD 02378000
* OK, MVS HAS DIFFERENT TYPE OF PASSED DATA SET Q                       02379000
         MH  R1,=AL2(PDILEN)                                            02380000
          LA R14,PDITERM1(R1)                                           02381000
        B   E07NMVS1                                                    02382000
E07NMV1S   MH  R1,=AL2(PDQBLKLN)                                   DASD 02383000
           LA  R14,PDQTERM(R1)                                          02384000
E07NMVS1 DS    0H                                                       02385000
           TM  0(R14),X'C0'    OLD,DELETE ?                             02386000
           B   *+8             ****************                         02387000
           BO  E07DELET                                                 02388000
           SPACE 3                                                      02389000
*** LAST BYTE OF JFCB TTR =0 IN SIOT                                    02390000
           GETJOBQ JFCBDECB,SCTPJFCB  GET THE JFCB                      02391000
           CLI JFCBVOLS,X'FF'  UNOPENED SCRATCH VOLUME ?                02392000
           BNE E07NOTFF        GO WRITE BACK JFCB,SIOT                  02393000
           JOLERR 205,'DSID ''',DDDSID,''' DSNAME ''',#DSNAME,         *02394000
               ''' NOT KEPT:UNOPENED SCRATCH VOLUME'                    02395000
           B   E07RETNF                                                 02396000
E07NOTFF  DS    0H                                                      02397000
           NI JFCBIND2,B'01111111' TELL OS AN OLD DATA SET              02398000
           OI JFCBIND2,B'01000000'                                      02399000
           PUTJOBQ JFCBDECB                                             02400000
           MVC CALLAREA,SIOT                                            02401000
           MVI CALLAREA+3,0                                             02402000
           GETJOBQ SIOTDECB,CALLAREA                                    02403000
*                                                           FIX-X 76200 02404000
* THE NEXT FEW LINES ARE NEW IN 3.1 AND ARE CODED IN        FIX-X 76200 02405000
*  THE HOPE THAT WE CAN HAVE THE OPERATING SYSTEM UNLOAD    FIX-X 76200 02406000
*  THE VOLUME FOR US AT STEP TERM.                          FIX-X 76200 02407000
* IN ADDITION, THE DSNAME SHOULD BE TAKEN OFF THE PASSED    FIX-X 76200 02408000
*  DATA SET QUEUE. CURRENTLY, AT JOB TERMINATION, A NUMBER  FIX-X 76200 02409000
*  OF UNNECESSARY MESSAGES ARE DISPLAYED INDICATING THAT    FIX-X 76200 02410000
*  DATA SETS HAVE BEEN KEPT. THESE SHOULD NO LONGER OCCUR.  FIX-X 76200 02411000
*                                                           FIX-X 76200 02412000
*                                                           FIX-X 76200 02413000
         CLI   DDDISP+1,C'L'  LAST USE OF DATA SET ?        FIX-X 76200 02414000
*                             IF WE CAN LET OS UNLOAD ?     FIX-X 76200 02415000
         BNE   E07NLAST       NOT LAST USE                  FIX-X 76200 02416000
* MARK SIOT AND LET IT THINK WE HAVE FINISHED WITH          FIX-X 76200 02417000
*  THE DATASET (WHICH WE HAVE, OF COURSE).                  FIX-X 76200 02418000
         NI    SCTSDISP,X'FF'-SIOTRETN-S3400DSP-PRIVATE     FIX-X 76200 02419000
         OI    SCTSDISP,8     TURN KEEP ON                  FIX-X 76200 02420000
         OI    SCTSBYT2,SCTRECVD MARK RECIEVED              FIX-X 76200 02421000
         B     E07MAKOL       MAKE IT OLD, RE-WRITE SIOT    FIX-X 76200 02422000
E07NLAST DS    0H                                           FIX-X 76200 02423000
         OI  SCTSDISP,B'00001000'   SIOT = KEEP                         02424000
E07MAKOL OI    SCTSBYT4,1     MARK OLD                      FIX-X 76200 02425000
           PUTJOBQ SIOTDECB                                             02426000
           SPACE 3                                                      02427000
           MVC DDVOLUME,JFCBVOLS                                        02428000
           BAL R14,E00FXVOL    SET UP VOLUME(S) IN #VOL           74365 02429000
* NOW TO MARK THE PDQ                                                   02430000
* TEST IF MVS, DIFFERENT...                                             02431000
         CLI  VS,C'2'   MVS?                                            02432000
         BNE E07NMVS2  NOPE ->                                          02433000
* MVS SIOT CONTAINS THE UCB POINTER, MVT THE PDG DOES                   02434000
          LH R14,SCTUTYPE                                               02435000
          B    E07TUNIT                                                 02436000
E07NMVS2  DS    0H                                                      02437000
           MVC CALLAREA,PDQABLK                                         02438000
           MVI CALLAREA+3,0                                             02439000
           GETJOBQ PDQDECB,CALLAREA                                     02440000
           LH R1,PDQDSNNO                                               02441000
           MH R1,=AL2(PDQBLKLN)                                         02442000
           L   R14,PDQUCBS(R1) GET UCB POINTER FOR DEVICE TYPE    74365 02443000
           MVC SCTUTYPE,16(R14) MOVE IN UCB DEVICE TYPE                 02444000
E07TUNIT DS    0H                                                       02445000
*                                                                       02446000
* THIS FIXES A PROBLEM WHEN A TAPE IS WRITTEN ON A DUAL     FIX-X 76200 02447000
*  DENSITY DRIVE, AND A CATALOGUE IS PERFORMED              FIX-X 76200 02448000
* WE SHALL (AS OS DOES), MAKE THE UNIT IN THE CATALOGUE ONE FIX-X 76200 02449000
*  WHICH WILL ALLOW THE TAPE TO BE MOUNTED ON A NON-DUAL    FIX-X 76200 02450000
*  DENSITY DRIVE IF THE TAPE WAS WRITTEN IF HIGH DENSITY    FIX-X 76200 02451000
*  MODE.                                                    FIX-X 76200 02452000
         CLI   SCTUTYPE+2,UCB3TAPE TAPE DEVICE ?            FIX-X 76200 02453000
         BNE   E07DA          NO->                          FIX-X 76200 02454000
* TAPE DEVICE HERE.                                         FIX-X 76200 02455000
         TM    SCTUTYPE+1,UCBDUDN1+UCBDUDN2 DUAL DENSITY?   FIX-X 76200 02456000
         BZ    E07UOK         UNIT IS OK, LEAVE IT.         FIX-X 76200 02457000
* THE UCB THAT THE DATA SET IS ON IS A DUAL DENSITY UCB,    FIX-X 76200 02458000
*  BUT NOW WE MUST CHECK THE DENSITY OF THE DATA SET.       FIX-X 76200 02459000
*                                                                       02460000
*  FOR 800 BPI, WE WANT TO SET UP UNIT AS 30,00,80,XX                   02461000
*  FOR 1600 BPI, WE WANT TO SET UP UNIT AS 34,00,80,XX                  02462000
*  FOR 6250 BPI, WE WANT TO SET UP UNIT AS 32,00,80,XX                  02463000
         CLI   JFCDEN,JFC800  IS IT 800 BPI ?               CVC   81220 02464000
         BNE   E07T1600       TEST IF 1600 BPI.             CVC   81220 02465000
         MVC   SCTUTYPE(2),=X'3000'   SET 800 BPI NOW       CVC   81220 02466000
         B     E07UOK                                       CVC   81220 02467000
         SPACE 2                                                        02468000
E07T1600 CLI   JFCDEN,JFC1600 IS IT 1600 BPI ?              CVC   81220 02469000
         BNE   E07T6250       TEST IF 6250 BPI.             CVC   81220 02470000
         MVC   SCTUTYPE(3),=X'3400'   SET 1600 BPI NOW      CVC   81220 02471000
         B     E07UOK                                       CVC   81220 02472000
         SPACE 2                                                        02473000
E07T6250 CLI   JFCDEN,JFC6250 IS IT 6250 BPI ?              CVC   81220 02474000
         BNE   E07UOK         LEAVE IT, DON'T KNOW WHAT IT ISVC   81220 02475000
         MVC   SCTUTYPE(3),=X'3200'   SET 6250 BPI NOW      CVC   81220 02476000
         B     E07UOK                                       CVC   81220 02477000
         SPACE 2                                                        02478000
E07DA    NI    SCTUTYPE+1,X'FF'-UCBRR TURN OFF 'SHARE'      FIX-X 76200 02479000
         SPACE 2                                                        02480000
E07UOK  CLI  VS,C'2'  MVS AGAIN?                                        02481000
         BNE   E07NMVS3                                                 02482000
         LH    R1,PDQDSNNO                                              02483000
         MH    R1,=AL2(PDILEN)                                          02484000
         LA    R14,PDITERM1(R1)                                         02485000
         B     E07MARK9                                                 02486000
E07NMVS3 DS    0H                                                       02487000
           LA R14,PDQTERM(R1)                                           02488000
E07MARK9 DS    0H                                                       02489000
         NI    0(R14),X'0F'     TURN OFF TOP 4 BITS                     02490000
         CLI   DDDISP+1,C'L'   LAST USE,IE OLD,KEEP ?                   02491000
         BNE   E07PASS                                                  02492000
         OI    0(R14),B'01000000' OLD,KEEP                              02493000
         NI    0(R14),B'11000000'  INDICATE RECIEVED        FIX-X 76200 02494000
         B     E07MARKD                                                 02495000
E07PASS  OI    0(R14),B'11100000' OLD,PASS                              02496000
E07MARKD DS    0H                                                       02497000
         CLI   VS,C'2'    MVS AGAIN?????                                02498000
         BNE   E07NMVS4                                                 02499000
         SH    R14,=H'44'         BACKUP TO DSNAME              DASD    02500000
         MVI   0(R14),C' '        WIPE OUT THE NAME IN PDQ      DASD    02501000
         PUTJOBQ PDQDECB2                                               02502000
         B    E07RETN0                                                  02503000
E07NMVS4 DS    0H                                                       02504000
         PUTJOBQ PDQDECB                                                02505000
         SPACE 3                                                        02506000
E07RETN0  DS    0H                                                      02507000
           CLI ICOMMAND,C'K'   IS THIS A KEEP INSTRUCTION?        74365 02508000
           BNE E07RETNO W      NO,SO NO MESSAGE,JUST RETURN       74365 02509000
           JOLERR 101,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            *02510000
               ''' KEPT ON VOL(S) ',#VOL                          74365 02511000
E07RETNO  TM    JFCDSRG1,JFCORGIS  IS THIS A ISAM FILE             DASD 02512000
          BNO   E07RTN        NOPE LETS LEAVE                      DASD 02513000
           CALL UJEISPDQ   GO SAVE THE DUPLICATE PDQ DSNS          DASD 02514000
E07RTN     JOLRETN RC=0                                            DASD 02515000
E07LETOS DS    0H                                                       02516000
           JOLRETN RC=4                                                 02517000
           SPACE 3                                                      02518000
E07DELET DS    0H                                                       02519000
           JOLERR 202,'DSID ''',DDDSID,''' DSNAME ',                   *02520000
               ''' PREVIOUSLY DELETED :- KEEP IGNORED'                  02521000
           JOLRETN RC=16                                                02522000
         AGO   .NX8280                                                  02523000
.X8280   ANOP                                                           02524000
         SLR   R2,R2                 COUNT THE FCTS FOUND               02525000
         L     R4,ATCB              ADDRESS MY TCB                      02526000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     02527000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 02528000
         BZ    E07NOFCT              EXIT IF NONE ?!! & SSSSSSSSS       02529000
         SPACE                                                          02530000
*   FOUND THE FCT CHAIN. NOW FIND A DATASET ENTRY                       02531000
         SPACE                                                          02532000
         USING FCT,R4                                                   02533000
E07NXFCT DS    0H                                                       02534000
         CLC   FCTFLN,DSN            Q... IS THIS IT?                   02535000
         BNE   E07NOTIT              A... NO                            02536000
         BAL   R2,E07FFCT            GO AND FIX THE BITS                02537000
E07NOTIT DS    0H                                                       02538000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           02539000
         BNZ   E07NXFCT              BR IF THERE IS ONE                 02540000
         B     E07NOFCT                                                 02541000
E07FFCT  DS    0H    FOUND AN FCT TO "FIX"                              02542000
         $TELL (R4)                                                     02543000
         MODESET  KEY=ZERO                                              02544000
         NI    FCTSTS1,X'FF'-FCTS1DLT  IF KEEP, DO NOT DELETE           02545000
         NI    FCTFDST1,X'FF'-FCTFSNFD DITTO                            02546000
         OI    FCTFLG2,FCTF2KEP      TURN KEEP ON                       02547000
         SPACE 2                                                        02548000
*  WELL, THAT SHOULD BE ALL                                             02549000
         SPACE                                                          02550000
         MODESET KEY=NZERO    BACK TO MY USUAL PROTECT KEY              02551000
         BR    R2             GO AND SEE IF THERE AREA ANY MORE         02552000
E07NOFCT DS    0H                                                       02553000
         LTR   R2,R2                                                    02554000
         BZ    E07NOKPT                                                 02555000
         CLI   ICOMMAND,C'K' Q... IS THIS A GENUINE KEEP?               02556000
         BNE   E07RETN0      A... NO, PROBABLY A CATLG: SKIP MSG        02557000
         JOLERR 003,'DSID ',DDDSID,' ',#DSN,' MARKED "KEEP"'            02558000
E07RETN0 DS    0H                                                       02559000
         B     RETN0                                                    02560000
E07NOKPT DS    0H   NO ENTRIES MARKED KEEP                              02561000
         JOLERR 202,'DSID ',DDDSID,' NOT KEPT, IS NOT ALLOCATED'        02562000
         B     RETN0                                                    02563000
.NX8280  ANOP                                                           02564000
         SPACE 3                                                        02565000
         DC    80S(*)                                                   02566000
         TITLE 'UJE08SCR:SCRATCH DATA SET'                              02567000
         JOLSAVE CSECT=UJE08SCR                                         02568000
* SCRATCH INSTRUCTION IS TO BE EXECUTED.                                02569000
         AIF   (&X8).X8300                                              02570000
*    NOW IF IT IS A DISC,WE ISSUE A SCRATCH.                            02571000
*          IF THE VOLUME IS NOT MOUNTED,WE GO AND FIND THE STEP         02572000
*          WHICH WE WANT TO EXECUTE (IT HAS A DD-CARD WHICH MOUNTS      02573000
*          THE VOLUME).                                                 02574000
           SPACE                                                        02575000
*    IF IT IS A TAPE,AND IT CAN BE FREED NOW (NOT RETAINED)             02576000
*          IT MUST BE GIVEN A DISPOSITION OF DELETE                     02577000
*          THIS MUST BE DONE BY JCL AT THE MOMENT                       02578000
*    IF IT IS RETAINED,THE PDQ IS MARKED DELETE,UNLESS WE HAVE          02579000
*          TIOT ENTRY,IN WHICH CASE IT IS MARKED DELETE,AND OS WILL     02580000
*          PROBABLY REMOVE THE VOLUME.                                  02581000
*    IF IT IS NOT RETAINED,WE MUST STEP DOWN TO THE CORRECT             02582000
*          STEP AND HAVE IT REMOVED FROM THE SYSTEM FOR US.             02583000
           SPACE 3                                                      02584000
* PUT INTO LOGICAL TERMS,THE CODE COES LIKE THIS:-                      02585000
*                                                                       02586000
*          IF INPDQ                                                     02587000
*          THEN DO;                                                     02588000
* ERROR2:      IF ^STILL_IN_PDQ,ERROR AND RETURN; /*ALREADY GONE*/      02589000
*              IF ALLOCATED_TO_THIS_STEP                                02590000
*              THEN DO;                                                 02591000
*                  TURN ON DELETE_BITS IN SIOT;                         02592000
*                  REWRITE SIOT;                                        02593000
*                  RETURN;                                              02594000
*              END;                                                     02595000
*              GO TO E08_NOT_IN_THIS_STEP_MAYBE;                        02596000
*          END;                                                         02597000
*  /* NOT IN PDQ */                                                     02598000
*                                                                       02599000
*          IF VOL & UNIT ^=''                                           02600000
*          THEN DO;                                                     02601000
*              SET UP DSNAME,VOL,UNIT;                                  02602000
*              GO TO E08_NOT_IN_THIS_STEP_MAYBE;                        02603000
*          END;                                                         02604000
*          GO TO ERROR2;                                                02605000
* NOT_HERE?:                                                            02606000
*                                                                       02607000
*                                                                       02608000
*          IF IS MAG TAPE THEN GO TO E08MAGTP                           02609000
* /* DISC HERE */                                                       02610000
*          SCRATCH;                                                     02611000
*          VOL_NOT_MOUNTED,GO TO LETOS;                                 02612000
*          RETURN;                                                      02613000
* LETOS:   SET UP STEP NAME TO SKIP TO FOR OS STEP                      02614000
*          RETURN(4);                                                   02615000
* E08MAGTP:                                                             02616000
*          MARK DELETE; /* IF OLD,MARK NEW,DELETE*/                     02617000
*          IF VOLUME TO BE RETAINED                                     02618000
*          THEN RETURN;                                                 02619000
*          GO TO LETOS;        /*UNLESS IN THIS STEP*/                  02620000
*                                                                       02621000
*                                                                       02622000
* THE SITUATION THEN BASICALLY MEANS THAT IF A SCRATCH IS ISSUED        02623000
*    FOR A DISC,AND THE DISC/IS NOT MOUNTED,A NEW OS STEP OCCURRS       02624000
*                                                                       02625000
* IF A TAPE IS TO BE SCRATCHED,AND IT CAN BE UNLOADED (IE OTHER         02626000
*    DATA SETS ARE STILL BEING USED ON IT) NO REAL ACTION OCCURRS       02627000
*    BUT IF IT CAN BE UNLOADED A NEW OS STEP IS INITIATED.              02628000
********** UNTIL I CAN FOOL OS ***********                              02629000
           SPACE 3                                                      02630000
* NOW IF THE NAME IS A TEMPORARY DSNAME,WE MUST FIDDLE AROUND UNTIL WE  02631000
*    HAVE THE PART OF THE NAME THAT OS PUT IN FRONT OF OURS,AND PUT     02632000
*    OURS AT THE BACK. THIS THEN GIVES US A REAL DSNAME WHICH SHOULD    02633000
*    BE IN THE PASSED DATA SET QUEUE.                                   02634000
*                                                        JOL30112 76200 02635000
* DELETE GDGALL PROCESSING IS HANDLED BY OS.             JOL30112 76200 02636000
* IF THE CATLG INDICATOR HAS 104,IT MEANS THAT THE       JOL30112 76200 02637000
* COMPILER FOUND GDGALL. ALL WE HAVE TO DO IS            JOL30112 76200 02638000
* RETURN A 4, AND THAT WILL EXECUTE THE SCRATCH STEP     JOL30112 76200 02639000
*                                                        JOL30112 76200 02640000
         CLI   DDCATLGS,104   GDGALL ?                   JOL30112 76200 02641000
         BNE   E08TTEMP       NO,TEST TEMPORARY THEN     JOL30112 76200 02642000
           JOLERR 112,'DSID ',DDDSID,' DSNAME ',#DSN,                  *02643000
               ' IS GDGALL, THE OPERATING SYSTEM WILL DELETE IT'        02644000
         JOLRETN RC=4                                    JOL30112 76200 02645000
E08TTEMP CLI   DDDSNAME,C'&&' TEMPORARY ?                JOL30112 76200 02646000
           BNE E08NTEMP        NO,SO FORGET THIS BIT OF PROCESSING      02647000
*                                                        JOL30116 76200 02648000
* NOW READ THE JFCB OF THE $$INST FILE AND               JOL30116 76200 02649000
* FIND OUT WHAT DSN HAS BEEN GIVEN TO                    JOL30116 76200 02650000
* TEMPORARY DATA SETS                                    JOL30116 76200 02651000
*                                                        JOL30116 76200 02652000
         RDJFCB TEMPDCB       GET DSNAME                 JOL30116 76200 02653000
* NOW FIND LAST DOT,AND SHIFT IN OUR TEMP NAME (&&WORK000I FOR EXAMPLE) 02654000
         LA    R15,JFCBDSNM+43 GET END OF DSNAME         JOL30116 76200 02655000
E08FSTOP   CLI 0(R15),C'.'     GOT THE LAST '.' ?                       02656000
           BE  E08GOTST        YES                                      02657000
           BCT R15,E08FSTOP    FIND STOP LOOP                           02658000
           JOLERR 508,'INTERNAL ERROR:NO ''.'' IN TEMP DSN'             02659000
           SPACE                                                        02660000
E08GOTST CLI   DDDSNAME+1,C'&&' DOUBLE & CODED ?         JOL30116 76200 02661000
         BNE   E08ONEA                                   JOL30116 76200 02662000
         MVC   DDDSNAME+1(8),DDDSNAME+2 DROP 2ND         JOL30116 76200 02663000
E08ONEA  MVC   1(8,R15),DDDSNAME+1 SET UP REAL DSNAME    JOL30116 76200 02664000
         MVC   DDDSNAME,JFCBDSNM   SHIFT BACK            JOL30116 76200 02665000
E08NTEMP DS    0H                                                       02666000
           CALL UJE81PDQ       SEE IF NAME IN PDQ                       02667000
*                              NOTE,IT ALSO READS IN SIOT AND JFCB      02668000
           LTR R15,R15                                                  02669000
           BNZ E08NOTHR        NOT IN PDQ                               02670000
* NOW IT WAS IN THE PDQ HERE.                                           02671000
* A QUICK CHECK TO SEE IF IT HAS ALREADY BEEN DELETED                   02672000
*************** FAILURE HERE,JUST ATTEMPT TO SCRATCH                    02673000
           LH  R1,PDQDSNNO     1ST,2ND,3RD DSNAME IN PDQ ?              02674000
             CLI  VS,C'2'   MVS???                                      02675000
           BNE E08NMVS1                                                 02676000
            MH  R1,=AL2(PDILEN)                                         02677000
            LA  R14,PDITERM1(R1)                                        02678000
            B  E08TDEL                                                  02679000
E08NMVS1 DS    0H                                                       02680000
           MH R1,=AL2(PDQBLKLN)                                         02681000
           LA  R14,PDQTERM(R1)                                          02682000
E08TDEL   DS   0H                                                       02683000
           TM  0(R14),X'C0'    HAS IT BEEN (OLD,DELETED) ?              02684000
           B  E08TSTP                                                   02685000
           BO E08ERR2          ALREADY GONE MY FRIEND                   02686000
* OK,IT IS STILL PASSED SUCCESSFULLY APPARENTLY                         02687000
*    HOWEVER,NOW WE MUST SEE IF THE DATA SET IS BEING USED BY           02688000
*    THIS STEP,IF SO,MERELY MARK THE SIOT DELETE AND THAT'S THAT        02689000
E08TSTP  DS    0H                                                       02690000
          CLI   VS,C'2'                                                 02691000
         BNE   E08MARKD                                                 02692000
           LA  R14,PDQCSTEP(R1) CURRENT STEP NUMBER ADDRESS IN PDQ      02693000
           CLC 0(1,R14),JCTSNUMB CURRENT STEPS EQUAL                    02694000
           BNE E08RJFCB        READ THE JFCB                            02695000
* NOW MARK THE SIOT TO DELETE AND OUTPUT A MESSAGE SAYING               02696000
*    WILL BE SCRATCHED.                                                 02697000
E08MARKD DS    0H                                                       02698000
           MVC CALLAREA,SIOT                                            02699000
           MVI CALLAREA+3,0                                             02700000
           GETJOBQ SIOTDECB,CALLAREA                                    02701000
           OI  SCTSDISP,B'00000100' TURN ON DELETE BIT                  02702000
           OI  SIOTALTD,B'00000100' TURN ON DELETE BIT IN CONDITION     02703000
*                                   DISPOSITION PROCESSING              02704000
           PUTJOBQ SIOTDECB                                             02705000
E08RJFCB   DS 0H                                                        02706000
E08TEST  DS    0H                                                       02707000
           GETJOBQ JFCBDECB,SCTPJFCB GET CORRESPONDING JFCB             02708000
           LH  R1,PDQDSNNO     DATA SET NUMBER IN PDQ                   02709000
           MH  R1,=AL2(PDQBLKLN)                                        02710000
           L   R14,PDQUCBS(R1) GET UCB ADDRESS FOR DEVICE TYPE    74365 02711000
            CLI  VS,C'2'   MVS AGAIN??                                  02712000
          BNE   E08NMVS2                                                02713000
* THE SIOT IN MVS CONTAINS THE UCB POINTER, NOT THE PDQ                 02714000
          LH   R14,SCTUTYPE                                             02715000
       B  E08NOSTP                                                      02716000
E08NMVS2 DS    0H                                                       02717000
           MVC SCTUTYPE,16(R14) MOVE IN UCB UNIT TYPE                   02718000
           B  E08NOSTP         DO THE SCRATCH                           02719000
           SPACE 3                                                      02720000
E08NOTHR DS    0H              NOT IN PDQ                               02721000
* THE DATA SET WAS NOT IN THE PASS QUEUE,AND THEREFORE IT SHOULD        02722000
*    (MUST?) HAVE A VOL & UNIT,AND WILL HAVE A DDCARD SOMEWHERE         02723000
*    FOR IT TO BE MOUNTED IF ITS NOT NOW.                               02724000
           CLI DDVOLUME,C' '   VOL SPECIFIED ?                          02725000
           BE  E08NOPDQ        NOPE                                     02726000
           CLI DDUNITYP,C' '   UNIT GIVEN ?                             02727000
           BE  E08NOPDQ        NOPE                                     02728000
* OK,NOW SET UP THE JFCBDSN,AND THE VOLUME & UNIT AND                   02729000
*    GO TO THE SCRATCH ROUTINES.                                        02730000
           MVC JFCBDSNM,DDDSNAME                                        02731000
           MVC JFCBVOLS,DDVOLUME                                        02732000
           NI DDUNITYP,B'10011111' DROP PERM BIT                        02733000
           MVI JFCBNVOL,1                                               02734000
           CLI DDVOLUME+06,C' '                                         02735000
           BE  E08FIXUN                                                 02736000
           MVI JFCBNVOL,2                                               02737000
           CLI DDVOLUME+12,C' '                                         02738000
           BE  E08FIXUN                                                 02739000
           MVI JFCBNVOL,3                                               02740000
           CLI DDVOLUME+18,C' '                                         02741000
           BE  E08FIXUN                                                 02742000
           MVI JFCBNVOL,4                                               02743000
           CLI DDVOLUME+24,C' '                                         02744000
           BE  E08FIXUN                                                 02745000
           MVI JFCBNVOL,5                                               02746000
           BE  E08FIXUN                                                 02747000
E08FIXUN DS    0H                                                       02748000
         NI DDUNITYP,B'10011111'                                        02749000
* SPECIAL CODE FOR MVS,VS1                                        76200 02750000
         CLI   VS,C' ' IS IT A VS SYSTEM OF SOME SORT?            76200 02751000
         BE    E08NVS9                                             DASD 02752000
* OK SPECIAL FOR VS AND 3330-1                                    76200 02753000
         CLC   =C'3330-1',DDUNIT                                  76200 02754000
         BNE   E08NVS9                                            76200 02755000
         LA    R7,MVS3330                                         76200 02756000
         B     E08GOTUN                                           76200 02757000
E08NVS9  DS    0H                                                 76200 02758000
           L   R1,=A(HEXUNITS)                                          02759000
           LM  R7,R9,0(R1)                                              02760000
E08FHEXU   CLC DDUNITYP,4(R7)  UNIT WE WANT ?                           02761000
           BE  E08GOTUN                                                 02762000
           BXLE R7,R8,E08FHEXU                                          02763000
           CALL UJEDEVNM   HOW ABOUT THE DEVICE NAME TABLE         DASD 02764000
           LTR  R15,R15                                            DASD 02765000
           BZ   E08NOSTP   SUPER   SAVED AGAIN                     DASD 02766000
           JOLERR 402,'SCRATCH REQUIRES UNIT ''',DDUNIT,''' UNKNOWN TO *02767000
               JOL'                                                     02768000
           B   E08RETNF                                                 02769000
           SPACE 3                                                      02770000
E08GOTUN   MVC SCTUTYPE,0(R7)  SHIFT IN IBM UNIT TYPE                   02771000
           B   E08NOSTP        DO THE SCRATCH ETC                       02772000
E08ERR2  DS    0H              NOT IN PDQ AND NO VOL/UNIT SPECIFIED     02773000
           JOLERR 209,'DSID ''',DDDSID,''' DSNAME ''',#DSN,''' ALREADY *02774000
               SCRATCHED'                                               02775000
           JOLRETN RC=16                                                02776000
           SPACE 3                                                      02777000
E08NOSTP DS    0H              NOT USED IN THIS STEP                    02778000
* NOW THIS SITUATION IS JUST A FRACTION MORE DIFFICULT THAN THE         02779000
*    OTHERS.                                                            02780000
* IF THE DATA SET IS ON DISK,ISSUE A SCRATCH                            02781000
           CLI SCTUTYPE+2,X'80' MAG TAPE ?                              02782000
           BE  E08MAGTP                                                 02783000
* DISK,LETS ISSUE THE SCRATCH AFTER SETTING THINGS UP                   02784000
           CLC JFCBNVOL,=AL1(L'JFCBVOLS/6)                              02785000
           BH  E08LETOS        HELP,TOO MANY VOLUMES,LET                02786000
*                              OS DO ALL THE SCRATCHING IT LIKES        02787000
*                              THANKS                                   02788000
           XC E08NOVOL(E08SCREN-E08NOVOL),E08NOVOL                      02789000
           MVC E08NOVOL+1(1),JFCBNVOL                                   02790000
           MVI E08NOVOL,0                                               02791000
           MVC E08UNIT+(0*(L'E08UNIT+L'E08VOL+L'E08SEQ)),SCTUTYPE       02792000
           MVC E08UNIT+(1*(L'E08UNIT+L'E08VOL+L'E08SEQ)),SCTUTYPE       02793000
           MVC E08UNIT+(2*(L'E08UNIT+L'E08VOL+L'E08SEQ)),SCTUTYPE       02794000
           MVC E08UNIT+(3*(L'E08UNIT+L'E08VOL+L'E08SEQ)),SCTUTYPE       02795000
           MVC E08UNIT+(4*(L'E08UNIT+L'E08VOL+L'E08SEQ)),SCTUTYPE       02796000
           MVC  E08VOL+(0*(L'E08UNIT+L'E08VOL+L'E08SEQ)),JFCBVOLS+0     02797000
           MVC  E08VOL+(1*(L'E08UNIT+L'E08VOL+L'E08SEQ)),JFCBVOLS+6     02798000
           MVC  E08VOL+(2*(L'E08UNIT+L'E08VOL+L'E08SEQ)),JFCBVOLS+12    02799000
           MVC  E08VOL+(3*(L'E08UNIT+L'E08VOL+L'E08SEQ)),JFCBVOLS+18    02800000
           MVC  E08VOL+(4*(L'E08UNIT+L'E08VOL+L'E08SEQ)),JFCBVOLS+24    02801000
           CLEAR DDVOLUME                                         74365 02802000
           MVC DDVOLUME(L'JFCBVOLS),JFCBVOLS                      74365 02803000
           BAL R14,E00FXVOL    SET UP VOLUME LIST IN #VOL         74365 02804000
           SR  R0,R0                                                    02805000
           MVI   E08SCRA+2,X'40'  RESET SCRATCH (LAST ALWAYS?)          02806000
           IFNULL DDLABTYP,E08NALWA                                     02807000
* ALWAYS                                                                02808000
           MVI   E08SCRA+2,X'50'  OVER-RIDE PURGE DATE                  02809000
E08NALWA DS    0H                                                       02810000
           SCRATCH E08SCRA                                              02811000
           LTR R15,R15                                                  02812000
           BNZ E08WHAT                                                  02813000
           JOLERR 101,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            *02814000
               ''' SCRATCHED FROM ',#VOL                          74365 02815000
E08MAGTP DS    0H                                                       02816000
           CLI ISINPDQ,C' '    WELL,IS IT?                              02817000
           BNE E08INPDQ                                                 02818000
           JOLRETN                                                      02819000
E08INPDQ DS    0H                                                       02820000
* THE NAME IN THE PDQ MUST BE SET TO OLD,DELETED SO THAT OS             02821000
*   WON'T BOTHER DELETING  THE THING AGAIN AT JOB TERMINATION           02822000
         CLI  VS,C'2'   VS2                                             02823000
         BE    E08MVS5                                                  02824000
           MVC CALLAREA,PDQABLK                                         02825000
           MVI CALLAREA+3,0                                             02826000
           GETJOBQ PDQDECB,CALLAREA                                     02827000
E08MVS5  DS    0H                                                       02828000
           LH R1,PDQDSNNO                                               02829000
            CLI  VS,C'2'                                                02830000
           BNE  E08NMVS4                                                02831000
           MH   R1,=AL2(PDILEN)                                         02832000
           LA   R14,PDITERM1(R1)                                        02833000
            MVI   0(R14),0           OLD,DELETE FLAGS              DASD 02834000
            SH    R14,=H'44'         BACKUP TO DSNAME              DASD 02835000
            MVI   0(R14),C' '        WIPE OUT THE NAME IN PDQ      DASD 02836000
            PUTJOBQ PDQDECB2  OP PDI BLOCK                              02837000
            JOLRETN  RC=0                                               02838000
E08NMVS4  DS    0H                                                      02839000
           MH R1,=AL2(PDQBLKLN)                                         02840000
           LA R14,PDQTERM(R1)                                           02841000
           OI 0(R14),B'10100000'  OLD,DELETE FLAGS                      02842000
           PUTJOBQ PDQDECB                                              02843000
           JOLRETN                                                      02844000
           SPACE 3                                                      02845000
E08WHAT  DS    0H                                                       02846000
* SCRATCH FAILED                                                        02847000
* WHY ??                                                                02848000
         CH   R15,=H'8'  DID WE BUILD A BAD CAMLIST ENTRY ??       DASD 02849000
         BH   E08BADCM   BETTER TELL SOMEONE ABOUT THIS            DASD 02850000
           SPACE 2                                                      02851000
* IF FAILURE OCCURRED BECAUSE THE VOLUMES WEREN'T MOUNTED,              02852000
*    I KNOW THAT THERE IS A JCL STEP BELOW WHICH WILL MOUNT             02853000
*    THE VOLUMES AND PERFORM THE SCRATCHES,SO LETS GO.                  02854000
           LA  R1,E08SEQ+1+(0*(L'E08UNIT+L'E08VOL+L'E08SEQ))            02855000
           BAL R2,E08ERR                                                02856000
           LA  R1,E08SEQ+1+(1*(L'E08UNIT+L'E08VOL+L'E08SEQ))            02857000
           BAL R2,E08ERR                                                02858000
           LA  R1,E08SEQ+1+(2*(L'E08UNIT+L'E08VOL+L'E08SEQ))            02859000
           BAL R2,E08ERR                                                02860000
           LA  R1,E08SEQ+1+(3*(L'E08UNIT+L'E08VOL+L'E08SEQ))            02861000
           BAL R2,E08ERR                                                02862000
           LA  R1,E08SEQ+1+(4*(L'E08UNIT+L'E08VOL+L'E08SEQ))            02863000
           BAL R2,E08ERR                                                02864000
           B   E08RETNF                                                 02865000
E08ERR   DS    0H                                                       02866000
* CALLED BECAUSE WE HAVE TO ANALYSE THE REASON WHY A SCRATCH FAILED     02867000
           CLI 0(R1),0         IS THIS ONE A ZERO ?                     02868000
           BE  0(R2)           YES,SO JUST RETURN TO CALLER.            02869000
           CLI 0(R1),5         UNABLE TO MOUNT COS NO DEVICE ?          02870000
           BE  E08NPACK        LET OS DO SCRATCH (STEP DOWN TO RIGHDASD 02871000
*                              STEP)                                    02872000
           CLI 0(R1),6         DIDN'T OPERATOR WANT TO MOUNT VOL ?      02873000
           BE  E08NPACK                                            DASD 02874000
           CLI 0(R1),1         NOT IN VTOC ?                            02875000
         BNE   E08TRET2                                     FIX-X 76200 02876000
           JOLERR 204,'DSID ''',DDDSID,''' DSNAME ''',                 *02877000
               #DSN,''' NOT FOUND IN VOLUME :-SCRATCH IGNORED'          02878000
           BR  R2                                                       02879000
E08TRET2 CLI   0(R1),2                                      FIX-X 76200 02880000
         BNE   E08TRET3                                     FIX-X 76200 02881000
         JOLERR 410,'DSID ''',DDDSID,''' DSNAME ''',#DSN,   FIX-X 76200*02882000
               ''' IS A VSAM DATA SPACE OR ',               FIX-X 76200*02883000
               'INCORRECT PASSWORD SUPPLIED'                FIX-X 76200 02884000
         BR    R2                                           FIX-X 76200 02885000
E08TRET3   CLI 0(R1),3         RETENTION PERIOD ?                       02886000
           BNE E08TRET4                                                 02887000
           JOLERR 205,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            *02888000
               ''' NOT SCRATCHED,CONTAINS RETENTION DATE'               02889000
         BR    R2                                           FIX-X 76200 02890000
E08TRET4   CLI 0(R1),4         I/O ERROR ?                              02891000
         BNE   E08TRET7                                     FIX-X 76200 02892000
           JOLERR 406,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            *02893000
               ''' NOT SCRATCHED,I/O ERROR ON VTOC'                     02894000
         BR    R2                                           FIX-X 76200 02895000
E08TRET7 CLI   0(R1),7                                      FIX-X 76200 02896000
         BNE   E08ERRXY                                     FIX-X 76200 02897000
         JOLERR 411,'DSID ''',DDDSID,''' DSNAME ''',#DSN,   FIX-X 76200*02898000
               ''' IS BEING USED BY SOMEONE ELSE:-'         FIX-X 76200*02899000
               'TRY AGAIN LATER'                            FIX-X 76200 02900000
         BR    R2                                           FIX-X 76200 02901000
E08ERRXY SR    R2,R2                                        FIX-X 76200 02902000
         IC    R2,0(R1)                                     FIX-X 76200 02903000
         JOLERR 507,'SCRATCH RETURNED INVALID CODE;SEE REG 2'   X 76200 02904000
E08BADCM DS    0H                                                  DASD 02905000
         JOLERR 213,'DSID ''',DDDSID,'''DSNAME ''',#DSN,               *02906000
               ''' ON VOLS ',#VOL,' NOT SCRATCHED',                    *02907000
               'CATALOGUE INVALID DEVICE UNIT=',                       *02908000
               DDUNIT                                              DASD 02909000
          B   E08LETOS                                             DASD 02910000
E08NPACK  DS    0H                                                 DASD 02911000
         JOLERR 214,'DSID ''',DDDSID,'''DSNAME ''',#DSN,               *02912000
               ''' ON VOLS ',#VOL,' NOT SCRATCHED',                    *02913000
               'PACK NOT MOUNTED, UNIT=',                              *02914000
               DDUNIT                                              DASD 02915000
           SPACE 3                                                      02916000
E08LETOS  DS    0H                                                      02917000
* IT HAS BEEN DECIDED THAT,FOR NO DOUBT AN EXTREMELY GOOD REASON,       02918000
*    WE MUST STEP DOWN TO THE STEP THAT SHOULD BE THERE TO              02919000
*    HAVE THE VOLUME MOUNTED SO THE SCRATCH MAY BE PERFORMED.           02920000
           JOLRETN RC=4                                                 02921000
E08RETNF  DS    0H JOLRETN RC=16                                   DASD 02922000
*******************************************************            DASD 02923000
*    PDQ RECORDS NOT DELETED IF SCRATCH FAILS         *            DASD 02924000
*******************************************************            DASD 02925000
* WHEN A PROGRAMMER SAYS TO DELETE A DATASET BEFORE   *            DASD 02926000
* THE FIRST STEP OF THE JOB,  JOL WILL GENERATE A STEP*            DASD 02927000
* WITH A DDCARD REFERENCE TO THE DATASET TO BE DELETED*            DASD 02928000
* IF THE DATASET IS CATALOGED BUT NOT ON THE PACK THE *            DASD 02929000
* THIS SCRATCH ROUTINE WILL RETURN WITHOUT REMOVING   *            DASD 02930000
* THE PDQ RECORD.     ANY REFERENCE TO THIS DATASET   *            DASD 02931000
* LATER ON WILL ADD NEW PDQ RECORDS BUT WILL POINT    *            DASD 02932000
* TO THE FIRST ENTRY RESULTING IN ABEND=213           *            DASD 02933000
*******************************************************            DASD 02934000
         CLI   ISINPDQ,C' '    IS BAD GUY IN PDQ                   DASD 02935000
         BE    E08NFRPQ        NOPE  BETTER GO NOW                 DASD 02936000
* THE NAME IN THE PDQ MUST BE SET TO OLD,DELETED SO THAT OS        DASD 02937000
*   WON'T BOTHER DELETING  THE THING AGAIN AT JOB TERMINATION      DASD 02938000
           MVC CALLAREA,SIOT                                       DASD 02939000
           MVI CALLAREA+3,0                                        DASD 02940000
           GETJOBQ SIOTDECB,CALLAREA                               DASD 02941000
           OI  SCTSDISP,B'00000100' TURN ON DELETE BIT             DASD 02942000
           OI  SIOTALTD,B'00000100' TURN ON DELETE BIT IN CONDITIONDASD 02943000
*                                   DISPOSITION PROCESSING         DASD 02944000
           PUTJOBQ SIOTDECB                                        DASD 02945000
         CLI   VS,C'2'   VS2                                       DASD 02946000
         BE    E08MVS6                                             DASD 02947000
         MVC   CALLAREA,PDQABLK                                    DASD 02948000
         MVI   CALLAREA+3,0                                        DASD 02949000
         GETJOBQ PDQDECB,CALLAREA                                  DASD 02950000
E08MVS6  DS    0H                                                  DASD 02951000
         LH    R1,PDQDSNNO                                         DASD 02952000
         CLI   VS,C'2'                                             DASD 02953000
         BNE   E08NMVS5                                            DASD 02954000
         MH    R1,=AL2(PDILEN)                                     DASD 02955000
         LA    R14,PDITERM1(R1)                                    DASD 02956000
         MVI   0(R14),0           OLD,DELETE FLAGS                 DASD 02957000
         SH    R14,=H'44'         BACKUP TO DSNAME                 DASD 02958000
         MVI   0(R14),C' '        WIPE OUT THE NAME IN PDQ         DASD 02959000
         PUTJOBQ PDQDECB2  OP PDI BLOCK                            DASD 02960000
         B     E08NFRPQ                                            DASD 02961000
E08NMVS5 DS    0H                                                  DASD 02962000
         MH    R1,=AL2(PDQBLKLN)                                   DASD 02963000
         LA    R14,PDQTERM(R1)                                     DASD 02964000
         MVI   0(R14),B'10100000'  OLD,DELETE FLAGS                DASD 02965000
         PUTJOBQ PDQDECB                                           DASD 02966000
E08NFRPQ JOLRETN RC=16                                             DASD 02967000
****************************************************************   DASD 02968000
* IF DOING A DELETE CHECK THE CATALOGUE TO SEE IF THE DATASET  *   DASD 02969000
* IS CATALOGUED AND IF SO REUTRN TO THE SCRATCH                *   DASD 02970000
*                                                              *   DASD 02971000
* THE FOLLOWING MESSSAGE IS ONLY ISSUED WHEN THE DATASET       *   DASD 02972000
* IS NOT ON THE PDQ                                            *   DASD 02973000
*                                                              *   DASD 02974000
* HERE AT STANDARD OIL A MODIFICATION EXISTS WHERE IF THE      *   DASD 02975000
* SCRATCH FAILED THE UNCATLG WILL STILL RUNS                   *   DASD 02976000
****************************************************************   DASD 02977000
E08NOPDQ NOP   E08PDQMG    TURN THIS ON TO SHUT OFF THIS CODE      DASD 02978000
         CLI   ICOMMAND,C'D'     DELETE STMT ?                     DASD 02979000
         BNE   E08PDQMG          NO---ISSUE THE MESSAGE            DASD 02980000
         CALL  UJELOCAT          CALL LOCATE MODULE                DASD 02981000
         LTR   R15,R15           ARE WE IN LUCK ?                  DASD 02982000
         BNZ   E08PDQMG          NOPE NOT TODAY                    DASD 02983000
         MVC   JFCBDSNM,DSNAME  COPY DATA SET NAME TO JFCB         DASD 02984000
         L     R15,=V(E05VOLS)  POINT TO CAMLST                    DASD 02985000
         USING VOLINFO,R15       GET SOME ADDDRESSILITY            DASD 02986000
         MVC   JFCBNVOL,NOVOLS+1 # VOLUMES                         DASD 02987000
         MVC   SCTUTYPE,CATDEV   UNIT TYPE                         DASD 02988000
         LH    R1,NOVOLS         # VOLUMES AGAIN                   DASD 02989000
         CH    R1,=H'5'          MORE THAN WE CAN HANDLE ?         DASD 02990000
         BNH   *+8               NO                                DASD 02991000
         LA    R1,5              ADJUST # VOLUMES FOR US           DASD 02992000
         LA    R14,JFCBVOLS      MOVE TO HERE                      DASD 02993000
         MVI   JFCBVOLS,C' '                                       DASD 02994000
         MVC   JFCBVOLS+1(L'JFCBVOLS-1),JFCBVOLS   CLEAR JFCB      DASD 02995000
E08LPVOL DS    0H                                                  DASD 02996000
         MVC   0(6,R14),CATVOL   MOVE VOL SER                      DASD 02997000
         LA    R15,12(R15)       POINT TO NEW CAMLST ENTRY         DASD 02998000
         LA    R14,6(R14)        UP TO NEXTBUCKET IN JFCB          DASD 02999000
         BCT   R1,E08LPVOL       GET ALL OF THE VOLUMES            DASD 03000000
         B     E08NOSTP          LETS DO THE SCRATCH AGAIN         DASD 03001000
         DROP  R15                                                 DASD 03002000
E08PDQMG   JOLERR 203,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            *03003000
               ''' NOT YET CREATED:-SCRATCH IGNORED'                    03004000
           B  E08RETNF                                                  03005000
           SPACE 3                                                      03006000
E08SCRA    CAMLST SCRATCH,JFCBDSNM,,E08NOVOL                            03007000
E08NOVOL   DS  H                                                        03008000
E08UNIT    DS  CL4                                                      03009000
E08VOL     DS  CL6                                                      03010000
E08SEQ     DS  H                                                        03011000
         DS  ((L'JFCBVOLS/6)*12)C                                       03012000
E08SCREN DS    0H                                                       03013000
         AGO   .NX8300                                                  03014000
.X8300   ANOP                                                           03015000
E08FRST  DS    0H                                                       03016000
         L     R4,ATCB              ADDRESS MY TCB                      03017000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     03018000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 03019000
         BZ    E08NOFCT              EXIT IF NONE ?!! & SSSSSSSSS       03020000
         SPACE                                                          03021000
*   FOUND THE FCT CHAIN. NOW FIND A DATASET ENTRY                       03022000
         SPACE                                                          03023000
         USING FCT,R4                                                   03024000
E08NXFCT DS    0H                                                       03025000
         CLC   FCTFLN,DSN            Q... IS THIS IT?                   03026000
         BNE   E08NOTIT              A... NO                            03027000
         BAL   R2,E08FFCT            GO AND FIX THE BITS                03028000
         MVC   DDDDNAME,FCTACSN      DDNAME TO MY AREA                  03029000
         MVI   DDDISP+1,C'L'         LAST USE                           03030000
         CALL  UJE14FRE              FREE THE FILE                      03031000
         B     E08FRST               GO AND START AGAIN                 03032000
E08NOTIT DS    0H                                                       03033000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           03034000
         BNZ   E08NXFCT              BR IF THERE IS ONE                 03035000
E08NOFCT DS    0H                                                       03036000
         LTR   R2,R2                                                    03037000
         BZ    E08NOKPT                                                 03038000
         JOLERR 003,'DSID ',DDDSID,' ',#DSN,' SCRATCHED'                03039000
E08RETN0 DS    0H                                                       03040000
         B     RETN0                                                    03041000
E08NOKPT DS    0H   NO ENTRIES MARKED                                   03042000
         SPACE 3                                                        03043000
* IT SEEMS WE NEED TO ALLOCATE THE DATASET                              03044000
         SPACE 1                                                        03045000
         TM    DDUNITYP,X'80'  IF IT'S A TAPE, FORGET IT                03046000
         BZ    E08NOSCR                                                 03047000
         SPACE 1                                                        03048000
         MVC   DDDDNAME,=C'JOL00000' HOPE NOBODY ELSE USES THIS         03049000
         OI    E21FLAG,E21CONT       TELL ALLOC NOT TO ABEND US         03050000
         CALL  UJE21ALL              ALLOC THE DATASET                  03051000
         LTR   R15,R15                                                  03052000
         BZ    E08ALLOK             IT WENT WELL                        03053000
         JOLERR 301,'DATASET ',#DSN,' IS NOT SCRATCHED'                 03054000
         B     E08NOSCR                                                 03055000
E08ALLOK DS    0H                                                       03056000
         B     E08FRST              NOW IT'S ALLOCATED, GO BACK         03057000
*                                    AND FIDDLE THE FCT                 03058000
E08NOSCR DS    0H                                                       03059000
         B     RETN0                                                    03060000
         SPACE 3                                                        03061000
E08FFCT  DS    0H    FOUND AN FCT TO "FIX"                              03062000
         $TELL (R4)                                                     03063000
         MODESET  KEY=ZERO                                              03064000
         OI    FCTSTS1,FCTS1DLT            TURN DELETE ON               03065000
         OI    FCTFDST1,X'FF'-FCTFSNFD      "    "    "                 03066000
         NI    FCTFLG2,X'FF'-FCTF2KEP      TURN KEEP OFF                03067000
*        OI    FCTFLG3,FCTF3UCT+FCTF3CTR   UNCAT + CAT REF              03068000
         NI    FCTFLG3,X'FF'-FCTF3CAT      SINCE WE ARE SCRATCHING,     03069000
*                                           DON'T CATALOGUE IT          03070000
         SPACE 2                                                        03071000
*  WELL, THAT SHOULD BE ALL                                             03072000
         SPACE                                                          03073000
         MODESET KEY=NZERO    BACK TO MY USUAL PROTECT KEY              03074000
         BR    R2             GO AND SEE IF THERE AREA ANY MORE         03075000
         SPACE 3                                                        03076000
.NX8300  ANOP                                                           03077000
         SPACE 3                                                        03078000
         DC    80S(*)                                                   03079000
         TITLE 'UJE09DEL:DELETE DATA SET'                               03080000
         AIF   (&X8).X8320                                              03081000
JSCBOFFS   EQU 180                                                      03082000
CVT        EQU 16                                                       03083000
JCTTTRA    EQU 261                                                      03084000
.X8320   ANOP                                                           03085000
         JOLSAVE CSECT=UJE09DEL                                         03086000
         CALL  UJE08SCR                                                 03087000
         LTR   R15,R15                                                  03088000
         BZ    E09UNCAT  O.K. GUYS THE SCRATCH WORKED KEEP GOING   DASD 03089000
* STANDARD OIL REQUESTED THIS MOD                                  DASD 03090000
* THEY WANTED THE UNCATLG TO ALWAYS RUN EVEN IF THE SCRATCH FAILED DASD 03091000
         CLI   DDCATLGS,104   GDGALL ?                             DASD 03092000
         BNE   E09UNCAT   LET THE UNCATLG RUN THEN                 DASD 03093000
         JOLRETN RC=(15)                                                03094000
E09UNCAT DS    0H                                                 76200 03095000
*        CLI   #DSN+2,C'&&'   TEMPORARY DATA SET ?                76200 03096000
*        BE    E09RETN0                                           76200 03097000
         CLI   DDTYPE,DDREALDS    Q... TEMPORARY DATASET?               03098000
         BL    E09RETN0           A... YES                              03099000
         CALL  UJE06UNC                                           76200 03100000
E09RETN0 B     RETN0                                              76200 03101000
         TITLE 'UJE10TYP:TYPE A MESSAGE'                                03102000
         JOLSAVE CSECT=UJE10TYP                                         03103000
* THIS ROUTINE DOES THE TYPING                                          03104000
           L   R7,=A(#TKN)                                              03105000
           USING #TKN,R7                                                03106000
           JOLERR 301,#TKN                                              03107000
           JOLRETN                                                      03108000
          TITLE 'UJE11DIS:DISPLAY A MESSAGE'                            03109000
           JOLSAVE CSECT=UJE11DIS                                       03110000
           L   R7,=A(#TKN)                                              03111000
           USING #TKN,R7                                                03112000
* DISPLAY HANDLER                                                       03113000
           JOLERR 101,#TKN                                              03114000
           JOLRETN                                                      03115000
          TITLE 'UJE12SIG:SIGNAL AN ERROR MESSAGE'                      03116000
           JOLSAVE CSECT=UJE12SIG                                       03117000
* SIGNAL ERROR ROUTINE                                                  03118000
           L   R7,=A(#TKN)                                              03119000
           USING #TKN,R7                                                03120000
           SR R2,R2                                                     03121000
           NI TKN,X'0F'        DROP 'F' FROM SEVERITY NUMBER            03122000
           IC R2,TKN           AND SAVE SEVERITY NUMBER                 03123000
           GETTKN 3            GET MESSAGE TEXT                         03124000
           CH R2,=H'3'                                                  03125000
           BL  SIGONLY                         ONLY WARNINGS            03126000
           BE  SIGWTOR                         WTOR                     03127000
* HERE A TERMINAL ERROR TO BE RASIED                                    03128000
           JOLERR 407,'TERMINAL ERROR ',#TKN,' SIGNALLED'               03129000
SIG&RSVDRC MVC TASKRETN,=F'&RSVDRC'                                     03130000
           MVI  GOBACK,C'1'                                             03131000
         CALL  UJE94CLN            CLEAN UP OUTSTANDING ALLOCATIONS     03132000
SIGTERM    JOLERR 406,'JOB TERMINATING'                                 03133000
           JOLRETN RC=&RSVDRC                                           03134000
           SPACE 3                                                      03135000
SIGONLY  DS    0H                                                       03136000
           CH R2,=H'2'                                                  03137000
           BL SIGERR1                                                   03138000
         JOLERR 202,'SEVERE ERROR ',#TKN,'SIGNALLED'        FIX-X 76200 03139000
           B  SIGRETN                                                   03140000
SIGERR1  JOLERR 101,'MINOR ERROR ',#TKN,' SIGNALLED'        FIX-X 76200 03141000
SIGRETN    JOLRETN                                                      03142000
           SPACE 3                                                      03143000
SIGWTOR  DS    0H                                                       03144000
*          JOLERR 403,'MAJOR ERROR ',#TKN,' SIGNALLED'                  03145000
         CLC   #TKN,=H'70'     IS MESSAGE TOO LONG                      03145010
         BNH   E12WTOR1        NO                                       03145020
         MVC   #TKN,=H'70'     YES SO ADJUST LENGTH                     03145030
E12WTOR1 EQU   *               JOLERR WONT ACCEPT A LABEL??             03145040
         JOLERR 403,#TKN,': REPLY GO OR STOP '                          03145050
*  JOLERR SETS JOBNAME ETC UP IN #S23LREC                               03145060
         LA    R1,#S23LREC-8                                            03145070
         MVI   0(R1),4         LENGTH OF REPLY                          03145080
         MVC   1(3,R1),=AL3(SIGREPLY) ADDRESS OF REPLY AREA             03145090
         MVC   4(4,R1),=A(SIGECB) ADDR OF ECB TO WAIT ON                03145100
SIGRETRY   CLEAR SIGREPLY                                               03146000
           XC  SIGECB,SIGECB                                            03147000
*ERE1204  DS    0H                                                      03148000
*     WTOR 'JOLE12-04 REPLY GO OR STOP',SIGREPLY,4,SIGECB,DESC=(2)      03149000
         LA    R1,#S23LREC-8                                            03149010
         SVC   35                  ISSUE WTOR                           03149100
           WAIT ECB=SIGECB                                              03150000
         OC    SIGREPLY(4),=C'    '     TO UP CASE                      03150100
           CLC =C'GO  ',SIGREPLY                                        03151000
           BE  SIGCONT                                                  03152000
           CLC =C'STOP',SIGREPLY                                        03153000
           BE  SIGTERM                                                  03154000
           B   SIGRETRY                                                 03155000
           SPACE 3                                                      03156000
SIGECB     DS  F                                                        03157000
SIGREPLY   DS CL4                                                       03158000
           SPACE 3                                                      03159000
SIGCONT  DS    0H                                                       03160000
         JOLERR 405,'JOB CONTINUING'                                    03161000
         B   SIGRETN                                                    03162000
         TITLE 'UJE13STP:STOP HANDLER'                                  03163000
         JOLSAVE CSECT=UJE13STP                                         03164000
* STOP EXECUTER                                                         03165000
         L     R7,=A(#TKN)                                              03166000
         USING #TKN,R7                                                  03167000
         JOLERR 401,'STOP ''',#TKN,''' EXECUTED'                        03168000
STPRETN  MVI   GOBACK,C'1'                                              03169000
         CALL  UJE94CLN            CLEAN UP OUTSTANDING ALLOCATIONS     03170000
         MVC   TASKRETN,=F'&RSVDRC'                                     03171000
         JOLRETN RC=&RSVDRC                                             03172000
         TITLE 'UJE14FRE:FREE (MARK NOT IN USE) DATASETS'               03173000
         JOLSAVE CSECT=UJE14FRE                                         03174000
         CLI   DDTYPE,DDPUNCH   Q... SYSIN, SYSOUT OF SOME KIND?        03175000
         BNH   E14FREE          A... YES, FREE IT NOW                   03176000
         TM    DDUNITYP,X'80'  IF IT'S A TAPE, FREE FILE ALWAYS         03176100
         BO    E14TDISP                                                 03176200
* PROPOGATE THE TAPE VOLUME NOW, AS IT MAY BE USED LATER                03176400
*  IN VOLUME REFERENECES OR CATALOGUE STATEMENTS.                       03176500
         CALL  UJE30VOL       PROPOGATE VOLS DOWN JOL 'JOBQ'            03176600
         B     E14FREE                    FREE IT NOW                   03176700
*        CLI   DDDISP+1,C'L'  LAST USE?                                 03177000
E14TDISP CLI   DDDISP+1,C'P'  LAST USE?                                 03178000
         BE    E14DISUS        NO, JUST MAKE MARKS                      03179000
E14FREE  DS    0H                                                       03181000
         XC    CALLAREA(12),CALLAREA   CLEAR PARAMETER AREA             03182000
         MVI   CALLAREA,C'F'   INDICATE FREEFILE                        03183000
         MVI   CALLAREA+1,12   TABLE SIZE                               03184000
         MVC   CALLAREA+4(8),DDDDNAME  DDNAME TO THE AREA               03185000
         FREEFL MF=(E,CALLAREA)                                         03186000
         LTR   R1,R15                                                   03187000
         BZ    E14FREED                                                 03188000
         CVD   R15,DBL                                                  03189000
         CALL  UJS46FER                                                 03190000
         MVC   TASKSSI(4),=X'40202120'                                  03191000
         ED    TASKSSI,DBL+6                                            03192000
         JOLERR 102,'DSID ',DDDSID,''',DDNAME ',                       .03193000
               DDDDNAME,' NOT UNALLOCATED DUE TO RETURN CODE ',        .03194000
               TASKSSI                                                  03195000
         B     E14RETN                                                  03196000
E14FREED DS    0H                                                       03197000
         JOLERR 003,'DSID ',DDDSID,' DDNAME ',                         .03198000
               DDDDNAME,' UNALLOCATED'                                  03199000
E14RETN  DS    0H                                                       03200000
         B     RETN0                                                    03201000
E14DISUS DS    0H    MARK DATASET NOT IN USE                            03202000
         L     R4,ATCB              ADDRESS MY TCB                      03203000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     03204000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 03205000
         BZ    E14NOFCT              EXIT IF NONE ?!! & SSSSSSSSS       03206000
         CLC   =CL8' ',DDDDNAME      Q... CONCATENATED FILE?            03207000
         BE    E14NXFCT              A... YES                           03208000
         MVC   SAVEDD,DDDDNAME       COPY THE DDNAME                    03209000
         SPACE                                                          03210000
*   FOUND THE FCT CHAIN. NOW FIND THE DATASET ENTRY                     03211000
         SPACE                                                          03212000
         USING FCT,R4                                                   03213000
E14NXFCT DS    0H                                                       03214000
         CLC   FCTACSN,SAVEDD        Q... IS THIS IT?                   03215000
         BE    E14FFCT               A... YES, GO AND FIX IT            03216000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           03217000
         BNZ   E14NXFCT              BR IF THERE IS ONE                 03218000
E14NOFCT JOLERR 104,                                                   .03219000
               'DSID ',DDDSID,                                         .03220000
               ' DDNAME ',DDDDNAME,                                    .03221000
               ' NOT MARKED NOT IN USE: NO FCT FOUND'                   03222000
         B     RETN0                                                    03223000
E14FFCT  DS    0H    FOUND AN FCT TO "FIX"                              03224000
         AP    DDCTR,=P'1'          ADD TO MY COUNTER                   03225000
         $TELL (R4)                                                     03226000
         MODESET  KEY=ZERO                                              03227000
*        NI    FCTACSN,X'BF'        MAKE MY MARK FOR "NOT IN USE"       03228000
         MVC   FCTACSN(4),=C'$JOL'  MAKE MY MARK FOR "NOT IN USE"       03229000
         UNPK  FCTACSN+4(4),DDCTR                                       03230000
         SPACE                                                          03231000
* WHILE I AM HERE, LET'S HAVE A LOOK AT SOME OTHER BITS                 03232000
         SPACE                                                          03233000
         LR    R2,R4                 SAVE THIS ADDRESS                  03234000
         TM    FCTFLG6,FCTF6CF       Q... CONCATENATED?                 03235000
         BZ    E14NOCAT              A... NO                            03236000
         NI    FCTFLG6,X'FF'-FCTF6CF TURN THAT OFF                      03237000
E14NXTCF DS    0H                                                       03238000
         L     R1,FCTCFNO            ADDRESS NEXT IN THIS CHAIN         03239000
         XC    FCTCFNO(4),FCTCFNO    CLEAR THIS FIELD                   03240000
         LA    R4,0(,R1)             CLEAR THE HIGH ORDER BYTE          03241000
         LTR   R4,R4                 Q... ANYTHING THERE?               03242000
         BZ    E14NOCAT              A... NO                            03243000
         CLC   FCTACSN,DDDDNAME      CHECK THIS, JUST IN CASE           03244000
         BNE   E14NOCAT              UM, ER, I'LL SEE YOU LATER         03245000
         NI    FCTFLG6,X'FF'-FCTF6CF TURN OFF CONCAT FLAG               03246000
         B     E14NXTCF              LET'S PLAY WITH THE NEXT ONE TOO   03247000
E14NOCAT DS    0H                                                       03248000
         LR    R4,R2                 ADDRESS OF THE ORIGINAL            03249000
         SPACE 2                                                        03250000
*  WELL, THAT SHOULD BE ALL                                             03251000
         SPACE                                                          03252000
         MODESET KEY=NZERO    BACK TO MY USUAL PROTECT KEY              03253000
         SPACE 3                                                        03254000
         JOLERR 005,                                                   .03255000
               'DSID ',DDDSID,                                         .03256000
               ' DDNAME ',DDDDNAME,                                    .03257000
               ' MARKED NOT IN USE'                                     03258000
         B     RETN0                                                    03259000
         TITLE 'UJ20RUN:PERFORM A RUN INSTRUCTION'                      03260000
         JOLSAVE CSECT=UJE20RUN                                         03261000
* HANDLE RUN STATEMENT                                                  03262000
           MVI ISRUN,C'1'                                               03263000
           MVC RUNNAME,PGM                                              03264000
           MVC TASKNAME,PGM                                             03265000
           MVC TASKLABL,PGMLABEL                                        03266000
* NOW LETS SEE IF WE EXECUTE IN THIS STEP,OR IN THE NEXT,               03267000
*     AND IF A PARM IS USED IN THIS RUN                                 03268000
* NOW BEFORE XCTL TO THE USER PROGRAM,WE MUST DETERMINE WHETHER         03269000
*     OR NOT THERE ARE ANY DD-CARDS REFERRING TO THIS PROGRAM           03270000
*     OR IF THERE IS A PARM FIELD OR NOT.                               03271000
* IF THERE ARE NO DD-CARDS,WE MAY XCTL NOW,OTHERWISE WE                 03272000
*     MUST CHECK THAT THIS IS THE CORRECT OS STEP OR NOT                03273000
*          L  R2,TTR$INST      SAVE TTR OF NEXT INSTRUCTION             03274000
*                              BECAUSE IF WE DECIDE NOT TO DO           03275000
*                              THE USERS PROGRAM HERE WE WILL           03276000
*                              HAVE TO RESET THE TTR SO THE             03277000
*                              NEXT OS STEP THAT IS EXECUTED            03278000
*                              WILL START AT THE CORRECT STEP           03279000
*          CLC PGMNODDS,=A(0)    ARE THERE ANY DDCARDS?           75128 03280000
*        BNE   E20AREDD        YES                                      03281000
         CALL  UJE50RD        READ NEXT STATEMENT                       03282000
         LTR   R15,R15        EOF PERHAPS ?                             03283000
         BZ    E20TPARM                                                 03284000
* NO DD'S  AND NO PARM,RETURN A 0,SO WE WILL XCTL TO                    03285000
*     PROBLEM PROGRAM.                                                  03286000
         NOTE  INSTRUCT                                                 03287000
         ST    R1,TTR$INST                                              03288000
         MVI   TTR$INST+3,0    SO WE RE-READ THE LAST STATEMENT         03289000
E20RETN0 DS    0H                                                       03290000
         BLDL  0,RUNBLDL                                                03291000
         B     RUNBLD(R15)                                              03292000
RUNBLD   B     RUNBLD0                                                  03293000
         B     RUNBLD4                                                  03294000
         B     RUNBLD8                                                  03295000
RUNBLD4  DS    0H                                                       03296000
*        JOLERR 001,'PROGRAM ''',RUNNAME,''' ABSENT:- TRYING LPALIB'    03297000
         MVC   TASKSSI,=X'00000000'         CLEAR THE SSI INFO          03298000
         B     E20RETN                                                  03299000
RUNBLD8  JOLERR 402,'PERM I/O ERR FINDING ',RUNNAME                     03300000
E20806   DS    0H                                                       03301000
         MVI   ISRUN,C' '                                               03302000
         JOLRETN RC=&RSVDRC                                             03303000
         SPACE 3                                                        03304000
RUNBLD0  SR    R8,R8                                                    03305000
         IC    R8,RUNC1                                                 03306000
         LA    R9,X'1F'                                                 03307000
         NR    R8,R9                                                    03308000
         ALR   R8,R8                                                    03309000
         LA    R9,RUNUSDTA-4                                            03310000
         AR    R9,R8                                                    03311000
         MVC   TASKSSI,0(R9)                                            03312000
         AGO   .NTIOT                                                   03313000
         B     E20NTIOT     *************************             75002 03314000
*  NOW SET PROGRAM NAME UP IN TIOT.                                     03315000
         LA    R1,TASKNAME       LOAD THE ADRESS OF PGM NAME      75002 03316000
         ST    R1,INST           STORE IN WORK AREA               75002 03317000
         MVI   INST,8       SET LENGTH OF PARM TO 8               75002 03318000
         LA    R1,INST      LOAD A(PARM)                          75002 03319000
         L     R0,ATIOT    -> TIOT                                75002 03320000
         AH    R0,=H'16'    ->PGM NAME SPOT                       75002 03321000
         SVC   255          POP PGM NAME IN TIOT                  75002 03322000
E20NTIOT DS    0H                                                 75002 03323000
.NTIOT   ANOP                                                           03324000
E20RETN  JOLRETN RC=0                                                   03325000
E20TPARM DS    0H                                                       03326000
         NOTE  INSTRUCT      SAVE THIS ADDRESS, TO REPROCESS THE DDS    03327000
         ST    R1,TTR$INST                                              03328000
         MVI   TTR$INST+3,0       CONTINUE WITH THIS RECORD IF NOT PARM 03329000
         CLC   =C'PARM ',ICOMMAND                                       03330000
         BNE   E20TDD            NOT PARM, TRY DD                       03331000
         MVI   TTR$INST+3,1       CONTINUE WITH THE NEXT RECORD         03332000
* FIX UP USER'S PARM FIELD                                              03333000
         L     R1,ATASKPRM                                              03334000
         L    R15,=A(#TKNSTRG)                                          03335000
         USING  #TKNSTRG,R15                                            03336000
         MVC   0(256,R1),#TKNSTRG                                       03337000
         CLC   =X'00027D7D',0(R1)  FIX FOR BUG IN COMPILER              03338000
         BNE   E20T10                                                   03339000
         XC    0(6,R1),0(R1)                                            03340000
E20T10   DS    0H                                                       03341000
         DROP  R15                                                      03342000
         SPACE  3                                                       03343000
E20AREDD DS    0H                                                       03344000
* THE USER'S PROGRAM HAS DD-CARDS AND WE MUST DILIGENTLY                03345000
         AIF   (&X8).X8340                                              03346000
*     CHECK WHETHER OR NOT WE ARE IN THE CORRECT OS JOB-STEP            03347000
*     (I.E DO WE HAVE THE DD-CARDS NECESSARY FOR THIS PROGRAM)          03348000
           CLC  SCTSNAME(8),PGMSTEP RIGHT OS JOB STEP ?           75311 03349000
           BE  E20TPM2         TEST IF THIS HAS A PARM NOW              03350000
           BH  E20TOOHI        ERROR,GONE TOO FAR                       03351000
* RIGHTO,MUST CHANGE OS STEPS OLD BOY.                                  03352000
E20CHNG    ST R2,TTR$INST                                               03353000
           MVI TTR$INST+3,0    RESET 'Z' IN TTR                         03354000
           B  *+4                                                       03355000
           B  *+4                                                       03356000
           B  *+4                                                       03357000
           JOLRETN RC=4        TELL US TO GO TO ANOTHER OS STEP         03358000
E20TPM2  DS    0H                                                       03359000
           CALL UJE50RD                                                 03360000
           LTR R15,R15                                                  03361000
           BNZ E20RETN0                                                 03362000
           B   E20TPARM                                                 03363000
E20TOOHI CLC   =C'$$',PGMSTEP                                     75311 03364000
         B     E20CHNG  **********************LET MAIN FIX IT *** 75311 03365000
         BNE   E20CHNG                                            75311 03366000
         JOLERR 503,'CANNOT FIND STEP FOR ',PGMESTMT                    03367000
         AGO   .NX8340                                                  03368000
.X8340   ANOP                                                           03369000
*   ALLOCATE THEM                                                       03370000
         SPACE                                                          03371000
E20READD DS    0H                                                       03372000
         CALL  UJE50RD                                                  03373000
         LTR   R15,R15                                                  03374000
         BNZ   E20RETN0                                                 03375000
E20TDD   DS    0H           TEST FOR DD                                 03376000
         CLI   DDDD1,C'D'                                               03377000
         BNE   E20NOTDD                                                 03378000
         CALL  UJE21ALL     ALLOCATE THE DD                             03379000
         B     E20READD                                                 03380000
E20NOTDD DS    0H                                                       03381000
         POINT INSTRUCT,TTR$INST                                        03382000
         B     E20RETN0        TO XCTL                                  03383000
         SPACE 3                                                        03384000
.NX8340  ANOP                                                           03385000
         DC    80S(*)                                                   03386000
         TITLE 'UJE21ALL: HANDLE DATASET ALLOCATION'                    03387000
         JOLSAVE CSECT=UJE21ALL                                         03388000
         FIX   'IF DATASET IS TO BE RE-WRITTEN, CALL DELETE NEAR HERE'  03389000
*            AND THEN ALLOCATE AS A NEW DATASET                         03390000
         LA    R0,WORK                                                  03391000
         LA    R1,L'WORK                                                03392000
         SLR   R15,R15                                                  03393000
         MVCL  R0,R14                                                   03394000
         CLC   =CL8' ',DDDDNAME      Q... CONCATENATED FILE?            03395000
         BE    E21NOTCT              A... NO                            03396000
         MVC   SAVEDD,DDDDNAME       COPY THE DDNAME                    03397000
E21NOTCT DS    0H                                                       03398000
         CLC   =C'PRGLIB  ',DDDDNAME Q... PRGLIB?                       03399000
         BE    E21MVDDN              A... YES                           03400000
         CLC   =C'STEPLIB ',DDDDNAME Q... STEPLIB?                      03401000
         BNE   E21X8A                A... NO                            03402000
E21MVDDN MVC   STEPLBDD,DDDDNAME      MOVE IN THE DDNAME                03403000
E21X8A   DS    0H                                                       03404000
         CLI   DDTYPE,DDSYSIN      Q... SYSIN DATASET?                  03405000
         BNE   E21NSSIN            A.. NO                               03406000
         MVC   DDMBR,DDDSNAME+2    ESTABLISH MEMBER NAME                03407000
         CLEAR DDDSNAME,DSN                                             03408000
         MVC   DDDSNAME(L'FCTFLN),SYSINDSN   COPY DSN                   03409000
         MVC   #DSN(28),#SYSINDS                                        03410000
         CLEAR DDVOLUME                                                 03411000
         MVC   DDVOLUME(6),SYSINVOL                                     03412000
         MVI   DDUSE,B'00001000'   DISP=(SHR,KEEP)                      03413000
         MVI   DDTYPE,DDMEMSPC                                          03414000
         MVI   DDUNITYP,X'80'         TELL ALLOC THAT IT IS A DISK.     03414100
         B     E21X8A4                                                  03415000
E21NSSIN DS    0H                                                       03416000
         SPACE 2                                                        03417000
*  BEFORE GOING ANY FURTHER, WHY NOT HAVE A LOOK AROUND TO SEE          03418000
*   WHAT IS ALREADY AVAILABLE?                                          03419000
* ****** UNLESS THIS IS A CONCATENATED FILE, IN WHICH CASE WE SHALL     03420000
*        DO A PROPER ALLOCATION      CVC                                03421000
         CLC   =CL8' ',DDDDNAME     CONCATENATED ?                      03422000
         BE    E21NOFCT             YES, GO THROUGH NORMAL ALLOC        03423000
         SPACE 2                                                        03424000
         L     R4,ATCB              ADDRESS MY TCB                      03425000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     03426000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 03427000
         BZ    E21NOFCT              EXIT IF NONE ?!! & SSSSSSSSS       03428000
         SPACE                                                          03429000
*   FOUND THE FCT CHAIN. NOW FIND THE DATASET ENTRY                     03430000
         SPACE                                                          03431000
         USING FCT,R4                                                   03432000
E21NXFCT DS    0H                                                       03433000
         CLC   FCTFLN,DDDSNAME       Q... IS THIS IT?                   03434000
         BNE   E21NTDS               A... NO, GO AND TRY THE NEXT       03435000
         CLC   =C'$JOL',FCTACSN      Q... NOT IN USE?                   03436000
         BNE   E21NTDS               A... NO                            03437000
         SPACE                                                          03438000
* NOT IN USE, BUT ONLY USE IT IF:                                       03439000
*     A)   ALLOCATION REQUEST INCLUDES MEMBER AND FCT HAS MEMBER        03440000
*  OR                                                                   03441000
*     B)   NEITHER HAS MEMBER SPECIFIED                                 03442000
         SPACE                                                          03443000
         TM    FCTFLG1,FCTF1MEB     Q... MEMBER IN FCT?                 03444000
         BO    E21MEB1              A... YES, GO AND CHECK DDDET        03445000
         CLI   DDMBR,C' '           Q... MEMBER HERE?                   03446000
         BE    E21FFCT              A... NO, NEITHER HAS                03447000
         B     E21NTDS              CONTINUE THE SEARCH                 03448000
         SPACE                                                          03449000
E21MEB1  DS    0H                   MEMBER IN FCT, CHECK DDDET          03450000
         CLI   DDMBR,C' '           Q... MEMBER HERE?                   03451000
         BNE   E21FFCT              A... YES, THEY BOTH HAVE            03452000
E21NTDS  DS    0H                                                       03453000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           03454000
         BNZ   E21NXFCT              GO AND TEST THE NEXT ONE           03455000
         B     E21NOFCT              END OF CHAIN, AND NOT FOUND        03456000
E21FFCT  DS    0H    FOUND AN FCT TO "FIX"                              03457000
         $TELL (R4)                                                     03458000
         MODESET  KEY=ZERO                                              03459000
         TM    FCTFLG1,FCTF1MEB     Q... MEMBER IN FCT?                 03460000
         BZ    E21NMEB              A... NO, GO AND FIX THE DDNAME      03461000
         L     R15,FCTFFBT          ADDRESS FBT                         03462000
         MVC   028(8,R15),DDMBR     COPY THE MEMBER NAME                03463000
E21NMEB  DS    0H                                                       03464000
 FIX 'ONE SHOULD ALSO FIX LRECL,BLKSIZE ETC HERE'                       03465000
         MVC   FCTACSN,DDDDNAME     CHANGE THE DDNAME                   03466000
         SPACE 2                                                        03467000
*  WELL, THAT SHOULD BE ALL                                             03468000
         SPACE                                                          03469000
         MODESET KEY=NZERO    BACK TO MY USUAL PROTECT KEY              03470000
         MVC   #DSN,=H'26'                                              03470100
         MVC   #VOL,=H'12'                                              03470200
         MVC   VOL(12),DDVOLUME                                         03470300
         JOLERR 005,                                                   .03470400
               'DSID ',DDDSID,                                         .03470500
               ' DDN ',DDDDNAME,' DSN ',#DSN,                          .03470600
               ' VOL ',#VOL,' ALLOC '                                   03470700
         SPACE 3                                                        03471000
         B     E21RETN                                                  03476000
         SPACE 5                                                        03477000
E21NOFCT DS    0H                                                       03478000
E21X8A4  DS    0H                                                       03479000
         SPACE 2                                                        03480000
*  NOW CHECK FOR VOLREF                                                 03481000
         SPACE                                                          03482000
         CLI   DDVOLUME,C'*'         VOLREF USED?                       03483000
         BNE   E21X8A5             NO                                   03484000
         BAL   R14,E21VREF         GO AND FIX VOLREF                    03485000
E21X8A5  DS    0H                                                       03486000
         CALL UJE03X8A,(DDOSVB,CALLARE2),VL,MF=(E,CALLAREA)             03487000
         ST    R15,TASKRETN                                             03488000
         LTR   R1,R15                                                   03489000
         BZ    E21DDOK          ALLOCATED PROPERLY                      03490000
         CH    R15,=H'172'      FAIL BECAUSE OF NO DEVICE AVAIL?        03491000
         BNE   U21CVCAF         NO, GIVE FAILURE MESSAGE                03492000
         XC    ALLOCECB,ALLOCECB                                        03493000
   WTOR  'WHEN A TAPE DRIVE IS AVAILABLE, PLEASE REPLY GO',ALLOCREP,   *03494000
               2,ALLOCECB                                               03495000
         WAIT  ECB=ALLOCECB                                             03496000
         B     E21X8A5          TRY AGAIN                               03497000
U21CVCAF CVD   R15,DBL                                                  03498000
         MVC   TASKSSI,=X'40202120'                                     03499000
         ED    TASKSSI,DBL+6                                            03500000
         JOLERR 406,'DSID ',DDDSID,', DDNAME ',                        .03501000
               DDDDNAME,', DS ',#DSN,' FAILED WITH RETURN CODE',       .03502000
               TASKSSI                                                  03503000
         CLEAR DPDATA                                                   03504000
         LA    R0,DPBLKL                                                03505000
         SLL   R0,16                                                    03506000
         ST    R0,DPBLOCK                                               03507000
         LA    R0,DPLINEL                                               03508000
         SLL   R0,16                                                    03509000
         ST    R0,DPLINE                                                03510000
         L     R2,CALLARE2     ADDRESS OF AREA TO DUMP                  03511000
E21LP0   DS    0H                                                       03512000
         ST    R2,CALLAREA                                              03513000
         UNPK  DBL(9),CALLAREA(5)                                       03514000
         TR    DBL,HEX                                                  03515000
         MVC   DPADDR,DBL+2                                             03516000
         MVC   DPCHARS,0(R2)   COPY DATA IN CHARACTERS                  03517000
         TR    DPCHARS,TRTAB   REMOVE SOME HARD-TO-PRINT DATA           03518000
         LA    R14,DPHEX       ADDRESS FOR HEX DATA                     03519000
         LA    R1,2                                                     03520000
E21LP1   DS    0H                                                       03521000
         LA    R0,4            4 SEGMENTS                               03522000
E21LP2   DS    0H                                                       03523000
         UNPK  DBL(9),0(5,R2)  CONVERT SOME TO HEX                      03524000
         TR    DBL,HEX                                                  03525000
         MVC   0(8,R14),DBL    INTO THE PRINT LINE                      03526000
         LA    R14,9(,R14)     NEXT FOR OUTPUT                          03527000
         LA    R2,4(,R2)       NEXT FOR INPUT                           03528000
         BCT   R0,E21LP2                                                03529000
         LA    R14,1(,R14)    AN EXTRA SKIP IN PAGE CENTRE              03530000
         BCT   R1,E21LP1                                                03531000
         L     R1,=A(S23DECB)                                           03532000
         WRITE (1),SF,,DPBLOCK,MF=E                                     03533000
         L     R1,=A(S23DECB)                                           03534000
         CHECK (1)                                                      03535000
         C     R2,CALLARE2+4   Q... ANY MORE?                           03536000
         BNH   E21LP0          A... YES                                 03537000
         L     R1,TASKRETN                                              03538000
         CALL  UJS45AER                                                 03539000
         TM    E21FLAG,E21CONT                                          03540000
         BO    E21RETN                                                  03541000
         JOLERR 500,'RUN TERMINATED DUE TO ALLOCATION ERROR'            03542000
         ABEND 2 ,,STEP                                                 03543000
E21DDOK  DS    0H                                                       03544000
         CLI   DDTYPE,DDSYSOUT    IS IT A SYSOUT FILE                   03544010
         BE    E21SYSO            YES SO ADJUST MSG                     03544020
         CLC   =CL6' ',DDVOLUME   IS THERE A VOLSER?                    03544030
         BE    E21PIV             NO SO PUT IN VOLUME                   03544040
E21DDOK2 MVC   VOL(12),DDVOLUME                                         03544041
E21DDOK1 EQU   *                                                        03544050
         MVC   #DSN,=H'28'                                              03545000
         MVC   #VOL,=H'12'                                              03545100
         JOLERR 003,                                                   .03546000
               'DSID ',DDDSID,                                         .03547000
               ' DDN ',DDDDNAME,' DSN ',#DSN,                          .03548000
               ' VOL ',#VOL,' ALLOC '                                   03549000
         B     E21RETN                                                  03549100
E21PIV   EQU   *                                                        03549200
         L     R4,ATCB           POINT AT TCB                           03549201
         L     R4,TCBJSCB-TCB(,R4) POINT AT JSCB                        03549202
         ICM   R4,7,JSCBFCTA-JSCB(R4) POINT AT FCT CHAIN                03549203
         USING FCT,R4             MAP FCT                               03549204
E21PIV1  EQU   *                                                        03549205
         CLC   FCTFLN,DDDSNAME    IS IT THIS ONE?                       03549206
         BE    E21PIV2            DO WHAT IS REQUIRED                   03549207
         ICM   R4,7,FCTNFCTA      POINT AT NEXT FCT                     03549208
         BNZ   E21PIV1            LOOK AT NEXT FCT                      03549209
         B     E21DDOK2           IMPOSSIBLE TO GET HERE..BUT FOR       03549210
*                                  SAFETY SAKE                          03549211
E21PIV2  EQU   *                                                        03549212
         L     R4,FCTVCT           POINT AT VCT                         03549213
         MVC   VOL(6),8(R4)        PLUG IN VOL                          03549214
         B     E21DDOK1            AND ISSUE MESSAGE                    03549224
E21SYSO  EQU   *                                                        03549300
         MVC   #DSN,=H'1'                                               03549310
         JOLERR 004,                                                   .03549340
               'DSID ',DDDSID,                                         .03549350
               ' DDN ',DDDDNAME,' SYSOUT=',#DSN,' ALLOC '               03549360
E21RETN  DS    0H                                                       03550000
         TM    DDUNITYP,X'80'                                           03551000
         BZ    E21NPROP       DON'T PROPOGATE VOLUME AS IT MAY          03552000
*                             BE A SCRATCH TAPE (IE NO VOLUME YET)      03553000
         CALL  UJE30VOL       PROPOGATE VOLS DOWN JOL 'JOBQ'            03555000
E21NPROP MVI   E21FLAG,0                                                03602000
         L     R15,TASKRETN                                             03603000
         B     RETRN                                                    03604000
         SPACE 3                                                        03605000
*  IT IS NECESSARY TO LOCATE THE FCT FOR THE DATASET WHOSE NAME IS      03606000
*    IN DDVOLUME, TO FIND THE CURRENT VOLUMES AND COPY THE LIST TO      03607000
*    THE ALLOCATION REQUEST FOR THIS DATASET                            03608000
E21VREF  DS    0H                                                       03609000
         LR    R10,R14              SAVE RETURN ADDRESS                 03610000
         L     R4,ATCB              ADDRESS MY TCB                      03611000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     03612000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 03613000
         BZ    E21VNFCT              EXIT IF NONE ?!! & SSSSSSSSS       03614000
         SPACE                                                          03615000
*   FOUND THE FCT CHAIN. NOW FIND THE DATASET ENTRY                     03616000
         SPACE                                                          03617000
         USING FCT,R4                                                   03618000
E21VNXTF DS    0H                                                       03619000
         CLC   FCTFLN,DDVOLUME+1   Q... IS THIS IT?                     03620000
         BE    E21VFFCT            A... YES, GO AND GET THE VOLUME INFO 03621000
         SPACE                                                          03622000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           03623000
         BNZ   E21VNXTF              GO AND TEST THE NEXT ONE           03624000
E21VNFCT DS    0H                    END OF CHAIN, AND NOT FOUND        03625000
         JOLERR 507,'DSID ',DDDSID,',DS ',#DSN,                        .03626000
               ' IS NOT ALLOCATED,',' VOLREF COULD NOT BE RESOLVED'     03627000
E21VFFCT DS    0H                                                       03628000
         SPACE 3                                                        03629000
* NOW I HAVE FOUND THE FCT, COPY THE VOLUME SERIAL NUMBERS              03630000
         SPACE 2                                                        03631000
         CLEAR DDVOLUME                                                 03632000
         SLR   R8,R8                                                    03633000
         ICM   R8,1,FCTVOLNO        LOAD VOLUME COUNT                   03634000
         BZ    E21VNFCT             EXIT IF THERE ARE NO VOLUMES        03635000
         LA    R0,L'DDVOLUME/6      LOAD NUMBER OF VOLUMES ALLOWED      03636000
         CR    R0,R8                CHECK THAT THE SERIAL NUMBERS FIT   03637000
         BH    E21VOK               BE IF OK                            03638000
         JOLERR 512,'DS ',DDDSID,',',#DSN,                             .03639000
               ' IS NOT ALLOCATED,',' REFERS TO TOO MANY VOLUMES'       03640000
E21VOK   DS    0H                                                       03641000
         L     R6,FCTVCT                                                03642000
         LA    R15,DDVOLUME         ADDRESS FOR VOLUMES                 03643000
E21VNXTV DS    0H                                                       03644000
         MVC   0(6,R15),8(R6)       COPY THE VOLUME SERIAL NUMBER       03645000
         LA    R15,6(,R15)          ADDRESS FOR NEXT AREA               03646000
         L     R6,4(,R6)            ADDRESS THE NEXT VCT                03647000
         BCT   R8,E21VNXTV          CONTINUE UNTIL ALL AREA DONE        03648000
         SPACE 2                                                        03649000
*  WELL, THAT SHOULD BE ALL: NOW FREE THE ORIGINAL DATASET              03650000
         SPACE                                                          03651000
         MVC   SAVEDDET,DDDSNDET                                        03652000
         MVC   DDDDNAME,FCTACSN                                         03653000
         MVI   DDDISP+1,C'L'      LAST USE                              03654000
         CALL  UJE14FRE           FREE THE FILE, ASSUME IT WORKED       03655000
         MVC   DDDSNDET(DDLEN),SAVEDDET RESTORE THE ORIGINAL            03656000
         UJE22UPD FCTFLN,DDVOLUME FIX FUTURE VOLUME REFERENCES          03657000
         DROP  R4                                                       03658000
         BR    R10                  RETURN                              03659000
         SPACE 5                                                        03660000
         DC    20S(*)   FOR PATCHES                                     03661000
TRTAB    DC    256AL1(*-TRTAB) ALL THINGS TO ALL THINGS                 03662000
         ORG   TRTAB                                                    03663000
         DC    64X'40'         FIX THE FIRST ONES                       03664000
         ORG   TRTAB+C'9'+1                                             03665000
         DC    6C' '           AND THE LAST ONES                        03666000
         ORG                                                            03667000
ALLOCREP DC C'   ' FOR ALLOCATION REPLIES                               03668000
ALLOCECB DC  F'0'  FOR ALLOCATION REPLIES                               03669000
         TITLE 'UJE23RET: HANDLE RETURN INSTRUCTION'                    03670000
           JOLSAVE CSECT=UJE23RET                                 74365 03671000
           L   R7,=A(#TKN)                                              03672000
           USING #TKN,R7                                                03673000
         JOLERR 101,'RETURN ',#TKN,' EXECUTED'              FIX-X 76200 03674000
           L R14,=A(RETURN)                                       74365 03675000
           JOLRETN (15,12),RC=0                                   74365 03676000
         DC  10S(*)                                                     03677000
           SPACE 3                                                75311 03678000
           JOLSAVE CSECT=UJE31OPT                                 75311 03679000
           MVI JOLSVC,X'0A'    SVC INSTRUCTION CODE               75311 03680000
           MVC JOLSVC+1(1),ITEXT+2 SVC NUMBER                     75311 03681000
           JOLRETN  RC=0                                          75311 03681400
         DC  10S(*)                                                     03681401
           LTORG                                                        03681410
         TITLE 'PROPOGATE VOLUMES IN JOL JOBQ'                          03682000
           JOLSAVE CSECT=UJE30VOL                                 74365 03682001
* THIS ROUTINE IS CALLED TO FIND THE VOLUME THAT A DATA SET             03682003
*  WAS ALLOCATED ON, AND THEN PROPOGATES THIS INFORMATION               03682004
*  DOWN THE JOL QUEUES. IT ALSO FIXES UP VOLREFS WHEN REQD.             03682005
*                                                                       03682006
* IT IS CALLED LINK  :-                                                 03682007
*                                                                       03682008
*        CALL  UJE30VOL       PROPOGATE VOLS DOWN JOL 'JOBQ'            03682020
*                                                                       03682022
         CLI   DDTYPE,DDPUNCH   Q... SYSIN, SYSOUT OF SOME KIND?        03682030
         BNH   E30RETN4       DON'T PROPOGATE SYSOUT VOLS               03682040
         CLC   =C'*DUMMY ',DDDSNAME                                     03682050
         BE    E30RETN4       DON'T PROPOGATE DUMMY VOLS                03682060
*  IT IS NECESSARY TO LOCATE THE FCT FOR THE DATASET WHOSE NAME IS      03682070
*    IN DDDSNDET, TO FIND THE CURRENT VOLUMES AND COPY THE LIST TO      03682080
*    THE ALLOCATION REQUEST FOR THIS DATASET                            03682090
         L     R4,ATCB              ADDRESS MY TCB                      03682100
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     03682110
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 03682120
         BZ    E30RETN4              EXIT IF NONE ?!! & SSSSSSSSS       03682130
         SPACE                                                          03682140
*   FOUND THE FCT CHAIN. NOW FIND THE DATASET ENTRY                     03682150
         SPACE                                                          03682160
         USING FCT,R4                                                   03682170
E30TNXTF DS    0H                                                       03682180
         CLC   FCTFLN,DDDSNAME     Q... IS THIS IT?                     03682190
         BE    E30TFFCT            A... YES, GO AND GET THE VOLUME INFO 03682200
         SPACE                                                          03682210
         ICM   R4,7,FCTNFCTA         NEXT FCT                           03682220
         BNZ   E30TNXTF              GO AND TEST THE NEXT ONE           03682230
E30TNFCT DS    0H                    END OF CHAIN, AND NOT FOUND        03682240
         JOLERR 301,'DSID ',DDDSID,',DS ',#DSN,                        .03682250
               ' IS NOT ALLOCATED,',' VOLUMES FOR DATA SET IN ERROR'    03682260
         B     E30RETN4       PRESS ON IN ANY CASE                      03682270
E30TFFCT DS    0H                                                       03682280
         SPACE 3                                                        03682290
* NOW I HAVE FOUND THE FCT, COPY THE VOLUME SERIAL NUMBERS              03682300
         SPACE 2                                                        03682310
         CLEAR DDVOLUME                                                 03682320
         SLR   R8,R8                                                    03682330
         ICM   R8,1,FCTVOLNO        LOAD VOLUME COUNT                   03682340
         BZ    E30TNFCT             EXIT IF THERE ARE NO VOLUMES        03682350
         LA    R0,L'DDVOLUME/6      LOAD NUMBER OF VOLUMES ALLOWED      03682360
         CR    R0,R8                CHECK THAT THE SERIAL NUMBERS FIT   03682370
         BH    E30TOK               BE IF OK                            03682380
         JOLERR 509,'DS ',DDDSID,',',#DSN,                             .03682390
               ' IS NOT ALLOCATED,',' REFERS TO TOO MANY VOLUMES'       03682400
E30TOK   DS    0H                                                       03682410
         L     R6,FCTVCT                                                03682420
         LA    R15,DDVOLUME         ADDRESS FOR VOLUMES                 03682430
E30TNXTV DS    0H                                                       03682440
         MVC   0(6,R15),8(R6)       COPY THE VOLUME SERIAL NUMBER       03682450
         LA    R15,6(,R15)          ADDRESS FOR NEXT AREA               03682460
         L     R6,4(,R6)            ADDRESS THE NEXT VCT                03682470
         BCT   R8,E30TNXTV          CONTINUE UNTIL ALL AREA DONE        03682480
         SPACE 2                                                        03682490
         UJE22UPD FCTFLN,DDVOLUME FIX FUTURE VOLUME REFERENCES          03682500
S30RETN0 DS    0H                                                       03682600
E30RETN0 DS    0H                                                       03682610
           JOLRETN  RC=0                                                03682700
E30RETN4 DS    0H                                                       03682710
           JOLRETN  RC=4                                                03682720
         DC  10S(*)                                                     03682800
           LTORG                                                        03682900
           TITLE 'UJE50RD:READ A STATEMENT FROM JOL INSTRUCT FILE'      03683000
           JOLSAVE CSECT=UJE50RD                                        03684000
* THIS CSECT IS CALLED WHEN A NEW INSTRUCTION HAS TO BE                 03685000
*    READ FROM THE INSTRUCT FILE.                                       03686000
           MVC #VOL,=H'0'     STOP SPURIOUS 0C4                  75311  03687000
           CLC TTR$INST,=A(0)  FIRST TIME IN,I.E. WE HAVEN'T            03688000
*                              EVEN REALLY STARTED YET ?                03689000
           BNE E50NOTF                                                  03690000
           MVC RUNNAME,=CL8'$$INST'                                     03691000
           BLDL INSTRUCT,RUNBLDL                                        03692000
           B   E5002R(R15)                                              03693000
E5002R     B   E50GOTIT                                                 03694000
           B   E5002R4                                                  03695000
           B   E5002R8                                                  03696000
E5002R4    JOLERR 501,'MEMBER $$INST ABSENT'                            03697000
E5002R8    JOLERR 502,'I/O ERROR READING DIRECTORY'                     03698000
           DS 0D                                                        03699000
E50GOTIT DS    0H                                                       03700000
         MVC TTR$INST,RUNTTRK                                           03701000
         MVI TTR$INST+3,0     SET Z=0 FIRST                             03702000
         FIND  INSTRUCT,TTR$INST,C                                      03703000
         B     E50RD                                                    03704000
E50NOTF  DS    0H                                                       03705000
*        POINT INSTRUCT,TTR$INST                                        03706000
E50RD    DS    0H                                                       03707000
           MVC INSTRUCT+33(3),=AL3(EOF)                                 03708000
           L  R15,=A(#TKNSTRG)                                          03709000
           USING  #TKNSTRG,R15                                          03710000
           CLEAR TKNSTRG                                                03711000
           DROP  R15                                                    03712000
           L  R2,=A(INSTRDA)                                            03713000
           USING    INSTRDA,R2                                          03714000
           READ E50DECB,SF,INSTRUCT,(R2)                                03715000
           CHECK E50DECB                                                03716000
* IF EOF WOULD HAVE GONE ELSE-WHERE                                     03717000
*******************************************************************DASD 03718000
*   THIS CALL TO MODULE $$JOLBUG WILL PRINT THE INSTRUCTION        DASD 03719000
*   JUST READ TO DDNAME '$JOL$BUG$' IF IT'S PRESENT                DASD 03720000
*   -----MAYBE A GOOD TRACE FACILITY----                           DASD 03721000
*   YOU MIGHT DO A JOLOPT CARD1='//JOLBUG DD SYSOUT=A'             DASD 03722000
*   IN THE COMPILE TO GET THIS DD IN EVERY STEP                    DASD 03723000
****************************************************02-23-78*******DASD 03724000
      CALL   $$JOLBUG,((2))     CALL PRINT MODULE                  DASD 03725000
           DROP  R2                                                     03726000
           SPACE 3                                                      03727000
           L   R7,=A(#TKN)                                              03728000
           USING #TKN,R7                                                03729000
*          NOTE INSTRUCT                                                03730000
*          ST  R1,TTR$INST                                              03731000
*          MVI TTR$INST+3,1    SET Z TO 1 SO NEXT READ GETS NEW BLK     03732000
           MVC INST(IBODY),INSTRDA                                      03733000
           MVC DDDSNDET(DDLEN),INSTRDA                                  03734000
           MVC STMT,ISTMT                                               03735000
           MVC GOTOLAB,=CL8'$$'                                         03736000
           CLI DDDD1,C'E'      EXEC PGM ?                               03737000
           BNE E50TDD                                                   03738000
           MVC ICOMMAND,=CL8'RUN'                                       03739000
           MVC STMT,PGMESTMT                                            03740000
           MVC GOTOLAB,PGMSTEP SHIFT STEPNAME FOR 'REAL' STEPNAME 75311 03741000
           JOLRETN                                                      03742000
E50TDD    DS    0H                                                      03743000
          CLI DDDD1,C'D'      DD-CARD TYPE ENTRY?                       03744000
          BNE ISALABEL                                                  03745000
* NOW FOR DD-CARD TYPE ENTRIES,WE DON'T SPLIT INTO TOKENS.              03746000
* SET UP SHORT DSNAME FOR ERROR MESSAGES                                03747000
          MVC DSNAME,DDDSNAME                                           03748000
          LA  R15,L'DDDSNAME-1                                          03749000
E50TEDSN DS    0H                                                       03750000
          LA  R14,DDDSNAME(R15)                                         03751000
          CLI 0(R14),C' '                                               03752000
          BNE E50DSNOK                                                  03753000
          BCT R15,E50TEDSN                                              03754000
E50DSNOK DS    0H                                                       03755000
          LA  R15,1(R15)                                                03756000
          STH R15,#DSN                                                  03757000
       FIX 'JCS DID NOT SEE ANY USE FOR THE FOLLOWING LINE'             03758000
*          MVC STMT,DDDDNAME+2                                          03759000
          MVC GOTOLAB(2),=C'$$'                                         03760000
          MVC GOTOLAB+2(6),DDDDNAME+2                                   03761000
          MVC #TKN,=H'8'                                                03762000
           MVC TKN(8),BLANKS                                            03763000
           MVC TKN(1),DDDDNAME+1                                        03764000
           MVC ICOMMAND,TKN                                             03765000
          CLI   DDDDNAME,C'%'                                           03766000
          BE    E50RETN0                                                03767000
          MVI   TKN,C'F'     INDICATE FREE COMMAND                      03768000
          MVI   ICOMMAND,C'F'                                           03769000
E50RETN0  DS    0H                                                      03770000
          JOLRETN                                                       03771000
ISALABEL  DS    0H                                                      03772000
          CLC INST,=AL2(IBODY+1)                                        03773000
           BH  E50SPLIT                                                 03774000
           L  R15,=A(#TKNSTRG)                                          03775000
           USING  #TKNSTRG,R15                                          03776000
           XC #TKNSTRG,#TKNSTRG                                         03777000
           DROP  R15                                                    03778000
E50SPLIT DS    0H                                                       03779000
* THE DOUBLE QUOTE ROUTINE IN THE COMPILER NOW REMOVES            76200 03780000
* ALL QUOTES FROM THE STRING, AND THEREFORE IF                    76200 03781000
* SOMEONE HAS QUOTES IN A STRING FOR A PARM, THERE                76200 03782000
* WILL NOW ONLY BE ONE. THIS CAUSES ALL SORTS OF                  76200 03783000
* PROBLEMS WHEN THE TOKEN SPLITTER GETS IT.                       76200 03784000
         CLC   ICOMMAND,=CL8'PARM' PARM?                          76200 03785000
         BNE   E50SPL2                                            76200 03786000
         JOLRETN RC=0                                             76200 03787000
E50SPL2  DS    0H                                                 76200 03788000
           CALL UJCTKN,TKNX                                             03789000
*           B *+4                                                  DASD 03790000
*           B *+4                                                  DASD 03791000
*           LTR R15,R15                                            DASD 03792000
*           BZ  GOTINSTR                                           DASD 03793000
            B  *+4(R15)                                            DASD 03794000
            B  GOTINSTR  SUPER INSTRUCTION IS CLEAN                DASD 03795000
            B  E50BINST  STMT > 1000 BYTES   CANN"T HANDLE THIS    DASD 03796000
            B  GOTINSTR  TOO MANY TOKENS > 150                     DASD 03797000
            B  GOTINSTR  TOKEN > 120 BYTES                         DASD 03798000
            B  GOTINSTR  NO ENDING QUOTE                           DASD 03799000
E50BINST   JOLERR 503,'ERROR IN INSTRUCTION'                       DASD 03800000
GOTINSTR DS    0H                                                       03801000
           GETTKN 1                                                     03802000
           JOLRETN                                                      03803000
EOF        JOLRETN RC=4                                                 03804000
         DC    80S(*)                                                   03805000
          LTORG                                                         03806000
         AIF   (&X8).X8400                                              03807000
           TITLE 'UJE81PDQ:READ PASSED DATA SET QUEUE'                  03808000
           JOLSAVE CSECT=UJE81PDQ                                       03809000
* THIS CSECT MUST FIND THE PDQ ENTRY THAT REFERS TO THE DSNAME          03810000
*    IN THE DSNAME FIELD. A 4 IS RETURNED IF IT CAN'T                   03811000
*                                                                       03812000
******                                                                  03813000
* CHECK IF JCTPDIP = 0 (MAY BE IF RUNNING UNDER                         03814000
*                       TSO).                                           03815000
******                                                                  03816000
           MVI ISINPDQ,C' '                                        DASD 03817000
         SPACE 1                                                  76200 03818000
         CLC   JCTPDIP,=F'0'                                      76200 03819000
         BNE   E81GO                                              76200 03820000
         JOLRETN RC=4                                             76200 03821000
E81GO    DS    0H                                                 76200 03822000
           GETJOBQ PDQDECB2,JCTPDIP                                     03823000
           B  E81GOTRD                                                  03824000
E81READ1 GETJOBQ PDQDECB2,CALLAREA                                      03825000
E81GOTRD DS   0H                                                        03826000
         CLI  VS,C'2'   MVS?                                            03827000
         BNE   E81NMVS1                                                 03828000
E81MVDS1 CLC   DDDSNAME,PDIDSN1                                         03829000
         BE    E81PASS1                                                 03830000
         CLC   DDDSNAME,PDIDSN2                                         03831000
         BE    E81PASS2                                                 03832000
         CLC  DDDSNAME,PDIDSN3                                          03833000
         BE    E81PASS3                                                 03834000
* NOT IN PDI, GET NEXT                                                  03835000
         CLC  =AL3(0),PDINPDIP  IS THIS THE LAST BLOCK?                 03836000
         BE   E81RETN4    YES, NOT FOUND THEN                           03837000
         GETJOBQ  PDQDECB2,PDINPDIP                                     03838000
         B    E81MVDS1                                                  03839000
E81NMVS1 DS    0H                                                       03840000
         CLC DDDSNAME,PDQDSN1                                           03841000
         BE  E81PASS1                                                   03842000
         CLC DDDSNAME,PDQDSN2                                           03843000
         BE  E81PASS2                                                   03844000
         CLC DDDSNAME,PDQDSN3                                           03845000
         BE  E81PASS3                                                   03846000
* NOT IN THAT BLOCK,GET THE NEXT                                        03847000
         CLC =AL3(0),PDQNPDQ LAST BLOCK IN PDQ ?                        03848000
         BE  E81RETN4        YES,THERE-FORE COULDN'T FIND DSET          03849000
         MVC CALLAREA,PDQNPDQ                                           03850000
         MVI CALLAREA+3,0                                               03851000
*                                                                       03852000
         B   E81READ1                                                   03853000
E81PASS1 MVC PDQDSNNO,=H'0'                                             03854000
         B   E81PDQB                                                    03855000
E81PASS2 MVC PDQDSNNO,=H'1'                                             03856000
         B   E81PDQB                                                    03857000
E81PASS3 MVC PDQDSNNO,=H'2'                                             03858000
E81PDQB  DS   0H                                                        03859000
* THERE USED TO BE A NOTE FOR JOBQ HERE, NOT NEC NOW              75128 03860000
         ST R1,APDQDIR       AND SAVE IT                                03861000
         CLI  VS,C'2'     MVS                                           03862000
         BNE   E81NMVS2                                                 03863000
* GET SIOT FOR MVS SYSTEMS                                              03864000
         LH  R1,PDQDSNNO                                                03865000
         MH  R1,=AL2(PDILEN)                                            03866000
         LA  R14,PDISIOT1(R1)   GET SIOT ADDRESS LOCN                   03867000
         MVC  CALLAREA,0(R14)                                           03868000
         B   E81GETSI         GO GET THE SIOT                           03869000
E81NMVS2 DS   0H                                                        03870000
         MVC CALLAREA,PDQABLK                                           03871000
         MVI CALLAREA+3,0                                               03872000
         GETJOBQ PDQDECB,CALLAREA                                       03873000
* NOW GET THE SIOT AS WELL                                              03874000
         LH  R1,PDQDSNNO     DATA SET NUMBER                            03875000
         MH  R1,=AL2(PDQBLKLN) LENGTH OF BLOCK                          03876000
         LA  R1,PDQASIOT(R1)   ABSOLUTE ADDRESS                         03877000
         MVC CALLAREA(3),0(R1) SIOT TTR                                 03878000
         MVI CALLAREA+3,0                                               03879000
E81GETSI DS    0H                                                       03880000
         GETJOBQ SIOTDECB,CALLAREA                                      03881000
         MVI ISINPDQ,C'1'                                               03882000
         JOLRETN                                                        03883000
E81RETN4 DS    0H                                                       03884000
         JOLRETN RC=4                                                   03885000
         DC   80S(*)                                                    03886000
.X8400   ANOP                                                           03887000
         TITLE 'UJE94CLN:CLEANUP ROUTINE'                               03888000
         JOLSAVE CSECT=UJE94CLN                                         03889000
         MVC   STMT,=C'99999'                                           03890000
E94#010  DS    0H                                                       03891000
         L     R4,ATCB      TCB ADDRESS                                 03892000
         L     R4,TCBJSCB-TCB(,R4)  ADDRESS MY JSCB                     03893000
         ICM   R4,7,JSCBFCTA-JSCB(R4)                                   03894000
         BZ    E94DONE                                                  03895000
         USING FCT,R4                                                   03896000
         SPACE 2                                                        03897000
*  FOUND THE START OF THE FCT CHAIN: NOW SCAN CHAIN FOR A FILE TO FREE  03898000
         SPACE 2                                                        03899000
E94NXTF  DS    0H                                                       03900000
         CLC   =C'$JOL',FCTACSN  Q... ONE I MARKED?                     03901000
         BNE   E94NXTF1          A... NO                                03902000
         BAL   R14,E94FREE                                              03903000
         B     E94#010                                                  03904000
E94NXTF1 DS    0H                                                       03905000
         ICM   R4,7,FCTNFCTA   ADDRESS THE NEXT                         03906000
         BNZ   E94NXTF                                                  03907000
E94DONE  DS    0H                                                       03908000
         B     RETN0                                                    03909000
         SPACE 4                                                        03910000
E94FREE  DS    0H                                                       03911000
         ST    R14,CALLAREA+12                                          03912000
         XC    CALLAREA(12),CALLAREA                                    03913000
         MVI   CALLAREA,C'F'   FREE FILE                                03914000
         MVI   CALLAREA+1,12   TABLE SIZE                               03915000
         MVC   CALLAREA+4(8),FCTACSN ACCESS NAME                        03916000
         MVC   STEPLBDD,FCTACSN FOR MESSAGES B LOW                      03917000
         FREEFL MF=(E,CALLAREA)                                         03918000
         LTR   R1,R15                                                   03919000
         BZ    E94FREE5                                                 03920000
         CVD   R15,DBL                                                  03921000
         CALL  UJS46FER                                                 03922000
         MVC   TASKSSI(4),=X'40202120'                                  03923000
         ED    TASKSSI,DBL+6                                            03924000
         JOLERR 102,'DDNAME ',                                         .03925000
               STEPLBDD,' NOT UNALLOCATED DUE TO RETURN CODE',         .03926000
               TASKSSI                                                  03927000
         B     E94FREE9                                                 03928000
E94FREE5 DS    0H                                                       03929000
         JOLERR 001,'DDNAME ',                                         .03930000
               STEPLBDD,' UNALLOCATED'                                  03931000
E94FREE9 DS    0H                  RETURN                               03932000
         L     R14,CALLAREA+12                                          03933000
         BR    R14                                                      03934000
         JOLSAVE CSECT=UJE97SPC                                         03935000
           TM  PRINT+48,X'10'                                           03936000
           BZ  E97RET                                                   03937000
           WRITE E97DECB,SF,PRINT,E97SPC                                03938000
           CHECK E97DECB                                                03939000
E97RET     JOLRETN                                                      03940000
E97SPC   DC   AL2(L'E97SPCC+8)                                          03941000
         DC   H'0'                                                      03942000
         DC   AL2(L'E97SPCC+4)                                          03943000
         DC   H'0'                                                      03944000
E97SPCC  DC   C'                    '                                   03945000
         LTORG                                                          03946000
         TITLE 'UJE98INI:INITIALISATION ROUTINES'                       03947000
         JOLSAVE CSECT=UJE98INI                                         03948000
* THIS CSECT IS CALLED IMMEDIATELY AFTER THE JOL SCHEDULER GETS CONTROL 03949000
*    AND IT  OPENS THE FILES ETC                                        03950000
* SECOND DETERMINE WHETHER WE ARE RUNNING UNDER 'HASP' OR 'OS'          03951000
*    IF THERE IS A DD-CARD FOR '$$PRINT' THEN THE SYSOUT FILE           03952000
*    ASSOCIATED WITH THAT FILE WILL BE USED SIMILIARLY TO THE           03953000
*    'HASP' SYSTEM LOG,I.E ALL COMMENTS WILL GO OUT TO IT.              03954000
         SPACE 3                                                        03955000
* NOTE *** UNDER VS, WE ATTACH RATHER THAN XCTL TO THE USER PROGRAM     03956000
*     AS WE SAVE TIME THEN BY NOT CLOSING AND RE-OPENING OUR FILES.     03957000
*     SO, LET'S SEE IF THEY ARE OPEN, AS TO OPEN AGAIN WOULD DEFEAT     03958000
*     THE WHOLE EXERCISE, WOULDN'T IT?                                  03959000
         SPACE 1                                                        03960000
         TM INSTRUCT+48,X'10'                                     74365 03961000
         BO  SCHEDGO                                              74365 03962000
         SPACE 1                                                        03963000
         MVC STMT,=CL4'   0'                                            03964000
&C1      SETC  (1-&X8)'AQMRAW'                                          03965000
&C2      SETC  (1-&X8)'IBMRTN'                                          03966000
&C3      SETC  (1-&X8)'JOBQ'                                            03967000
&C4      SETC  (1-&X8)'JCTTTR'                                          03968000
         CALL  UJE70OPN,(&C1,&C2,INSTRUCT,PRINT,RETN,&C3,         ******03969000
               &C4,VS,ATCB),MF=(E,CALLAREA)                       ***** 03970000
*** ABOVE OPENS REQUIRED FILES, AND :-                            ***** 03971000
*    1. SETS 'JCTTTR' TO CORE ADDRESS, OR TTR ON JOBQ.            ***** 03972000
*    2. LOADS (MAYBE) AN IBM ROUTINE TO ACCESS JOBQ.              ***** 03973000
*    3. OPENS 'INSTRUCT'                                          ***** 03974000
*    4. OPENS 'PRINT' IF $$PRNT DD CARD PRESENT                   ***** 03975000
*    5. OPENS 'JOBQ'  IF $$JOBQ DD CARD PRESENT AND ^MFT |MVT|MVS ***** 03976000
*    6. SETS 'VS' TO ' ' | '1' | '2' | 'M'                        ***** 03977000
*    7. SETS 'ATCB' = A(OUR TCB)                                  ***** 03978000
           SPACE 3                                                ***** 03979000
         L     R4,ATCB               ADDRESS MY TCB                     03980000
         L     R14,TCBJSCB-TCB(,R4)           MY JSCB                   03981000
         ICM   R14,7,JSCBCSCA-JSCB(R14)       MY CSCB                   03982000
         MVC   JBNAME,CSCBUJNM-CSCB(R14)      WOT IME CALLED            03983000
SCHEDGO  DS    0H                                                       03984000
         CALL  UJE97SPC                SPACE UP PRINTING A BIT          03985000
         L     R1,ATASKPRM      CLEAR USER'S PARM                       03986000
         XC    0(2,R1),0(R1)                                            03987000
       SPACE                                                            03988000
* NOW CHECK THAT THE INSTRUCT AND RETNCODE FILES ARE OPEN               03989000
         SR    R8,R8                                                    03990000
         TM    INSTRUCT+48,X'10'                                        03991000
         BO    FILE1OK                                                  03992000
         LA    R8,1                                                     03993000
         JOLERR 501,'NO DD CARD FOR $$INST'                             03994000
FILE1OK  DS    0H                                                 75128 03995000
         L     R4,TCBJSCB-TCB(,R4)          MY JSCB                     03996000
         ICM   R4,7,JSCBFCTA-JSCB(R4)         FIRST FCT                 03997000
         BZ    E98NOFCT              EXIT IF NONE ?!! & SSSSSSSSS       03998000
         SPACE                                                          03999000
*   FOUND THE FCT CHAIN. NOW FIND A DATASET ENTRY                       04000000
         SPACE                                                          04001000
         USING FCT,R4                                                   04002000
E98NXFCT DS    0H                                                       04003000
         CLC   FCTACSN,=CL8'&DDINST' Q... IS THIS MY INSTRUCTION FILE?  04004000
         BE    E98FFCT               A... YES, GO AND FIX IT            04005000
         ICM   R4,7,FCTNFCTA         NEXT FCT                           04006000
         BNZ   E98NXFCT              BR IF THERE IS ONE                 04007000
E98NOFCT JOLERR 500,'NO FCT FOR THE INSTRUCTION FILE'                   04008000
E98FFCT  DS    0H    FOUND THE FCT, NOW COPY THE DSNAME                 04009000
         MVC   SYSINDSN(L'FCTFLN),FCTFLN   COPY THE FILE NAME           04010000
         LA    R1,SYSINDSN+L'FCTFLN-1 ADDR LAST BYTE                    04011000
         CLI   0(R1),C' '           TRUNCATE TRAILING BLANKS            04012000
         BNE   *+8                                                      04013000
         BCT   R1,*-8                                                   04014000
         LA    R0,SYSINDSN                                              04015000
         SR    R1,R0                                                    04016000
         STH   R1,#SYSINDS            STORE LENGTH                      04017000
         L     R15,FCTVCT            ADDRESS VOLUME INFORMATION         04018000
         MVC   SYSINVOL,8(R15)       COPY THE VOLUME SERIAL NUMBER      04019000
         ZAP   DDCTR,=P'0'           INITIALISE DD COUNTER              04020000
         SPACE 2                                                        04021000
         FIND  INSTRUCT,MBRRETN,D                                       04022000
         B     E98INITR(R15)                                            04023000
E98INITR B     E98GOTMB                                                 04024000
         B     E98FIND4                                                 04025000
         B     E98FIND8                                                 04026000
MBRRETN  DC    CL8'$$RETN'                                              04027000
         SPACE 3                                                        04028000
E98FIND8 JOLERR 504,'I/O ERROR READING DIRECTORY'                       04029000
         SPACE 3                                                        04030000
E98FIND4 DS    0H                                                       04031000
* THE $$RETN MEMBER HASN'T BEEN SET UP APPARENTLY                       04032000
         JOLERR 109,'JOL MONITOR VERSION IS ',                   74365 *04033000
               '4.0-B  '                                         76200  04034000
         CALL  UJE97SPC                SPACE UP PRINTING A BIT          04035000
*          LA R1,READAREA                                               04036000
*          USING READAREA,R1                                            04037000
*          CLEAR READAREA  ****** FOR TESTS ONLY ?????                  04038000
         LA    R0,READAREA                                              04039000
         L     R1,=A(L'READAREA)                                        04040000
         SLR   R15,R15        ZEROES TO ALL THE AREA                    04041000
         MVCL  R0,R14                                                   04042000
*          DROP R1                                                      04043000
*          XC TTR$RETN(100),TTR$RETN                              75311 04044000
           MVI   COND,C' ' CLEAR COND TO BLANKS                    DASD 04045000
           MVC   COND+1(L'COND-1),COND                             DASD 04046000
           WRITE E98DEC9,SF,RETN,READAREA,'S'                           04047000
           CHECK E98DEC9                                                04048000
           NOTE RETN                                                    04049000
           ST  R1,TTR$RETN                                              04050000
           STOW RETN,STOWBLK,A                                          04051000
           LTR R15,R15                                                  04052000
           BZ  E98RDJCT                                                 04053000
           JOLERR 503                                                   04054000
E98GOTMB DS    0H                                                       04055000
* WE HAVE NOW FOUND THE $$RETN MEMBER OF THE DATA SET                   04056000
           LH R2,INSTRUCT+X'3E'                                         04057000
           MVC INSTRUCT+X'3E',=Y(&RETNSIZ)                         DASD 04058000
           READ E98DECBX,SF,INSTRUCT,RETNAREA                           04059000
           CHECK E98DECBX                                               04060000
           STH R2,INSTRUCT+X'3E'                                        04061000
           NOTE INSTRUCT                                                04062000
           ST  R1,TTR$RETN     FOR REWRITING                            04063000
* FIND OUT HOW MUCH DATA WE READ (ALSO USED FOR REWRITING)              04064000
           L  R1,E98DECBX+16   IOB ADDRESS                              04065000
           LH R14,INSTRUCT+X'3E'  BLOCKSIZE                             04066000
           SH R14,14(R1)  MINUS RESIDUAL COUNT                          04067000
           STH R14,RETNBLKS    LENGTH OF RETN BLOCK                     04068000
           SPACE 3                                                      04069000
           MVC STMT,DBL                                                 04070000
         POINT INSTRUCT,TTR$INST                                        04071000
E98RDJCT DS    0H                                                       04072000
           AIF   (&X8).X8420                                            04073000
           SPACE 3                                                      04074000
* BETTER SET UP THE JOBNAME ETC                                         04075000
           LA  R4,CALLAREA                                              04076000
           EXTRACT (4),'S',FIELDS=(TIOT)                                04077000
           L   R1,CALLAREA                                              04078000
           ST  R1,ATIOT        SAVE ADDRESS OF TIOT                     04079000
* NOW READ IN JCT AND SCT                                               04080000
           GETJOBQ JCTDECB,JCTTTR                                 ***** 04081000
           MVC CALLAREA(3),JCTSSTR  POINT TO CURRENT SCT                04082000
E80RDSCT DS    0H                                                       04083000
           MVI CALLAREA+3,0                                             04084000
           GETJOBQ SCTDECB,CALLAREA                                     04085000
*****************************************************************       04086000
* NOW BECAUSE OS DOES NOT UPDATE THE CURRENT JCT                        04087000
*     SCT POINTER AFTER A STEP HAS BEEN BYPASSED,I MUST                 04088000
*     CHECK THAT THE SCT I'VE JUST READ IN IS THE RIGHT ONE             04089000
*     FOR THIS OS STEP.                                                 04090000
*     IF ITS NOT,I STEP ON TO THE CORRECT ONE.                          04091000
* ALSO THE CURRENT OS STEP COUNTER MUST BE UPDATED COS I USE            04092000
*     IT IN THE SCRATCH ROUTINE                                         04093000
******************************************************************      04094000
* WE'LL USE THE TIOT STEP NUMBER,COS THAT MUST BE RIGHT ?????           04095000
           SPACE                                                        04096000
           ST R1,CALLAREA                                               04097000
           MVC  JCTSSTR(3),CALLAREA                                     04098000
* NOW CHECK THAT THE STEPS ARE RIGHT                                    04099000
           L R1,ATIOT          GET TIOT ADDTRESS                        04100000
           CLC SCTSNAME,8(R1)   RIGHT STEP ?                            04101000
           BE E98T1ST          TEST IF 1ST TIME IN THIS OS STEP         04102000
* OK THEN,STEP ON TO READ NEXT SCT,AND ADD 1 TO CURRENT                 04103000
*     JCT STEP COUNTER                                                  04104000
           SR R1,R1                                                     04105000
           IC R1,JCTSNUMB                                               04106000
           LA R1,1(R1)                                                  04107000
           STC R1,JCTSNUMB                                              04108000
           MVC CALLAREA(4),SCTANSCT  NEXT SCT ADDRESS                   04109000
           B  E80RDSCT                                                  04110000
E98T1ST  DS   0H                                                        04111000
.X8420     ANOP                                                         04112000
           SPACE 6                                                      04113000
           CLI TASKIND,C' '    IS THIS THE FIRST TIME I'VE BEEN CALLED  04114000
*                              THIS OS STEP ?                           04115000
           BE  E98RETN0        YES,SO NOW FILES ETC INITIALISED,GO BACK 04116000
*                              TO THE MAIN-LINE LIKE A GOOD BOY.        04117000
           SPACE 3                                                      04118000
* THE SCHEDULER HAS BEEN RE-ATTACHED AFTER AN XCTL TO A PROBLEM         04119000
*    PROGRAM. THEREFORE WE MUST DO NICE THINGS LIKE PRINT OUT           04120000
*    THE RETURN CODES ETC,                                              04121000
* WE HAD BETTER STORE ITS RETURN CODE IN THE TABLE ANYWAY               04122000
           LH R1,NOIDS                                                  04123000
           MH R1,=H'18'                                                 04124000
           LA R1,IDSTART(R1)                                            04125000
           USING IDOVLY,R1                                              04126000
           MVC IDRETN,TASKRETN                                          04127000
           MVI IDRETN,0        TURN OFF HIGH ORDER BITS FOR COMPARISONS 04128000
*                              IN THE 'IF' STATEMENT LATER              04129000
******* MORE FOR  MAXCC,LASTCC   SEPT 75                                04130000
         TM    TASKRETN,TCBFA   DID AN ABEND OCCUR?      CHG26028 76200 04131000
         BO    E98LMAX        YES, SO LEAVE LASTCC AND MACHG26028 76200 04132000
         MVC  LASTCC,IDRETN   LASTCC DONE                               04133000
         CLC   MAXCC,LASTCC                                             04134000
         BH    E98LMAX                                                  04135000
         MVC   MAXCC,LASTCC   MAXCC DONE                                04136000
         DROP  R1                                                       04137000
E98LMAX  UNPK  CALLAREA(9),TASKSSI(5)                                   04138000
         TR    CALLAREA(8),HEX                                          04139000
         MVC   ENDMSSI,CALLAREA 3(5)                                    04140000
*        OI    ENDMSSI+7,X'F0'                                          04141000
* NOW SEE IF TASK ABENDED OR RETURNED PROPERLY.                         04142000
         TM    TASKRETN,TCBFA                  ABEND ?                  04143000
         BZ    NOTABND                                                  04144000
         MVI   ERRORIND,1     TURN ON ABEND INDICATOR    CHG26028 76200 04145000
* WAS IT A USER ABEND OR A SYSTEM ABEND ?                               04146000
         L     R1,TASKRETN                                              04147000
         N     R1,=X'00FFF000'                                          04148000
         BZ    USERABND                                                 04149000
         UNPK  CALLAREA(9),TASKRETN(5)                                  04150000
         TR    CALLAREA(8),HEX                                          04151000
         MVC   ENDMRETC(4),CALLAREA+1                                   04152000
         MVC   ENDMRETC+5(3),CALLAREA+5                                 04153000
         MVI   ENDMRETC,C'S'                                            04154000
         MVI   ENDMRETC+4,C'-'                                          04155000
           JOLERR 307,'STEP ',TASKLABL,' LM ',TASKNAME,' SSI ',   74365*04156000
               ENDSSI,' SYSTEM ABEND ',ENDRETC                    74365 04157000
E98CLRAB CLEAR TASKRETN    CLEAR ABEND                   CHG26028 76200 04158000
*        B     E20R16       TAKE BRANCH TO COND CODE TERMINATE   C DASD 04159000
         B     E98RETN0                                          A DASD 04160000
           SPACE 3                                                      04161000
NOTABND    XC TASKRETN(2),TASKRETN                                      04162000
USERABND DS    0H                                                       04163000
         L   R0,=X'0000FFFF'  IF NEGATIVE NUMBER LETS SHOW IT      DASD 04164000
         N   R0,TASKRETN                                                04165000
         CVD R0,DBL                                                     04166000
         OI  DBL+7,X'0F'                                           DASD 04167000
         UNPK ENDRETB,DBL                                          DASD 04168000
         CLI ENDRETB,C'0'                                          DASD 04169000
         BNE ENDMSSOK  ITS A BIG ONE                               DASD 04170000
         MVI ENDRETB,C' '  PRINT AS BEFORE (4 BYTE RETN CODE)      DASD 04171000
ENDMSSOK DS    0H                                                       04172000
         TM  TASKRETN,TCBFA  ABEND ?                                    04173000
         BO  E98TYPER                                                   04174000
         JOLERR 105,'STEP ',TASKLABL,' LM ',TASKNAME,' SSI ',     74365*04175000
               ENDSSI,' RETURNED ',ENDRETB                         DASD 04176000
         AIF   (&X8).X8440                                              04177000
*                                                                 76200 04178000
* TO HANDLE THE STOP WHEN, WE MUST EXAMINE THE JCT JOB TERMINATION76200 04179000
* INDICATORS, AND COMPARE THIS RETURN CODE AND IF NECESSARY,      76200 04180000
* TERMINATE THE RUN.                                              76200 04181000
*                                                                 76200 04182000
* WE HAVE RESERVED TO US 1 JOB COND OF 'EQ,4000', AND SO WE CAN   76200 04183000
* FLUSH THE JOB BY SETTING 4000 ANY TIME WE WISH.                 76200 04184000
*                                                                 76200 04185000
*                                                                 76200 04186000
         LA    R1,JCTJDPCD                                        76200 04187000
         LA    R15,JCTJDPCD+4+28-1 END LOOP INDIC                 76200 04188000
         LA    R14,4               LENGTH OF TABLE                76200 04189000
E98DEPL  CLI   2(R1),0       ANY COND (END LOOP)            76200       04190000
         BE    E98RETN0            END -> RETURN                  76200 04191000
         IC    R6,2(R1)            GET DEPENDENCY CODE AND        76200 04192000
*                                  GET REDY FOR EXECUTE           76200 04193000
         CLC   0(2,R1),TASKRETN+2 COMPARE                        76200  04194000
         EX    R6,E98GO40          BRANCH IF TRUE                 76200 04195000
         BXLE  R1,R14,E98DEPL      LOOP THEN ...                  76200 04196000
.X8440   ANOP                                                           04197000
         B     E98RETN0                                           76200 04198000
         AIF   (&X8).X8460                                              04199000
E98GO40  BC    0,E98R16       EXECUTED  *****                     76200 04200000
E98R16   DS    0H                                                       04201000
E20R16   DS    0H                                                       04202000
* DUE TO USING MVS MACRO, MUST MOVE JOBNAME BEFORE 'JOLERRINR'          04203000
            MVC  TASKLABL,JCTJNAME                                      04204000
           JOLERR 408,'JOB ',TASKLABL,                                 *04205000
               ' TERMINATED DUE TO CONDITION CODES'                     04206000
           B   E98RET4K                                                 04207000
.X8460   ANOP                                                           04208000
         FIX   '"STOP WHEN ANY" NEEDS TO BE HANDLED: I SUGGEST PASSING .04209000
               THE INFO FROM THE COMPILER AS FIRST INSTRUCTION'         04210000
E98TYPER   JOLERR 306,'STEP ',TASKLABL,' LM ',TASKNAME,' SSI ',   74365*04211000
               ENDSSI,' USER ABEND ',ENDRETB                       DASD 04212000
         B     E98CLRAB                                  CHG26028 76200 04213000
E98RET4K  DS    0H                                                      04214000
           XC TASKRETN(2),TASKRETN                                      04215000
* THE NEXT MVC WILL STOP MVS FROM RUNNING AFTER A ABEND            DASD 04216000
* THIS PROBLEM IS BEING WORKED ON AS OF 4/1/77                     DASD 04217000
* SORRY ABOUT THE "IF ERROR LOGIC"                                 DASD 04218000
*          MVC TASKRETN(4),=F'&RSVDRC'                             DASD 04219000
* THIS PROBLEM IS NOW FIXED IN THE MONTOR AS OF 7/10/77            DASD 04220000
           MVI TASKIND,C'1'                                             04221000
           JOLRETN RC=&RSVDRC                                           04222000
E98RETN0 DS    0H                                                       04223000
         CALL  UJE97SPC                SPACE UP PRINTING A BIT          04224000
           MVI TASKIND,C'1'                                             04225000
           JOLRETN                                                      04226000
STOWBLK    DC  CL8'$$RETN'                                              04227000
STOWTTR    DC  XL3'00'                                                  04228000
STOWC      DC  X'00'                                                    04229000
           DS CL50                                                      04230000
ENDSSI     DS 0CL8                                                      04231000
ENDMSSI    DS  CL8                                                      04232000
ENDRETB    DS 0CL5            FOR MINUS RETURN CODES               DASD 04233000
ENDRETC    DS 0CL8                                                      04234000
ENDMRETC   DS CL8                                                       04235000
           DS H                                                         04236000
           DC   80S(*)                                                  04237000
           LTORG                                                        04238000
           TITLE 'UJS23ER:WTP,WTO ERROR MESSAGES'                       04239000
UJS23ER    CSECT                                                        04240000
           USING *,R15                                                  04241000
           STM R14,R12,12(R13)                                          04242000
           LA  R0,SAVEAREA                                              04243000
           ST  R0,8(R13)                                                04244000
           ST  R13,SAVEAREA+4                                           04245000
           BAL R13,STARTERR                                             04246000
SAVEAREA   DS  18F                                                      04247000
STARTERR   DS    0H                                                     04248000
           DROP R15                                                     04249000
           USING SAVEAREA,R13                                           04250000
* R14 IS THE RETURN ADDRESS BUT IT ALSO POINTS TO A LIST OF INSTRUCTION 04251000
*    S WHICH ARE TO BE EXECUTED                                         04252000
* THEY CAN BE :-                                                        04253000
*    MVC   CONSTANT                                                     04254000
*    LA    VARYING STRING                                               04255000
           CLEAR S23MSSG       CLEAR MESSAGE AREA                       04256000
* NEW, END DEC 1974. IF AN ERROR MESSAGE IS BEING ISSUED, THEN OFFSET   04257000
*    THE MESSAGE AND PUT '***' IN IT.                                   04258000
           LA  R1,S23MSSG                                         74365 04259000
         CLC   =C'DISPLAY ',ICOMMAND                     CHG30062 76200 04260000
         BE    S23OFF10                                  CHG30062 76200 04261000
         CLC   =C'TYPE ',ICOMMAND                        CHG30062 76200 04262000
         BE    S23OFF10                                  CHG30062 76200 04263000
         CLC   =C'RETURN ',ICOMMAND                      CHG30062 76200 04264000
         BE    S23OFF10       PUT 10 BLANKS IN START     CHG30062 76200 04265000
         B     S23TSEV                                   CHG30062 76200 04266000
S23OFF10 MVC   0(10,R1),BLANKS OFFSET MESSAGE BY 10      CHG30062 76200 04267000
         LA    R1,10(R1)      SKIP BLANKS                CHG30062 76200 04268000
         B     S23START       GO FORM UP MESSAGE         CHG30062 76200 04269000
S23TSEV  CLI   S23SEV,2                                  CHG30062 76200 04270000
         BNL   S23REALE       REAL ERROR, PUT JOB NAME   CHG30062 76200 04271000
         MVC   0(5,R1),BLANKS                            CHG30062 76200 04272000
         LA    R1,5(R1)                                  CHG30062 76200 04273000
         B     S23START                                  CHG30062 76200 04274000
S23REALE MVC   0(4,R1),=C'***('  PUT '***('              CHG30062 76200 04275000
&C       SETC  (&X8)'JBNAME'.(1-&X8)'JCTNAME'                           04276000
         MVC   4(8,R1),&C        + JOBNAME               CHG30062 76200 04277000
         MVI   12(R1),C')'       + ')'                   CHG30062 76200 04278000
         LA    R1,13(R1)         SKIP ABOVE              CHG30062 76200 04279000
S23START   MVC 0(3,R1),=C'JOL' SHIFT IN 'JOL'                     74365 04280000
           LA  R1,3(R1)        SKIP OVER IT SO WE WON'T OVER-WRITE IT   04281000
S23LUP1  DS    0H                                                       04282000
           CLI 0(R14),X'D2'    MOVE ?                                   04283000
           BE  S23MUV1                                                  04284000
           CLI 0(R14),X'41'    LA ?                                     04285000
           BE  S23LA1                                                   04286000
           B   S23END1         SHOULD BE '00'                           04287000
           SPACE                                                        04288000
S23MUV1    EX  R0,0(R14)        EXECUTE THE MOVE                        04289000
           SR  R0,R0                                                    04290000
           IC  R0,1(R14)       LENGTH MOVED                             04291000
           AR  R1,R0           ADD TO OUTPUT POSN                       04292000
           LA  R1,1(R1)        COS ASSMBLR REMOVED 1                    04293000
           LA  R14,6(R14)      SKIP MVC                                 04294000
           B   S23LUP1                                                  04295000
           SPACE                                                        04296000
S23LA1   DS    0H                                                       04297000
           EX  0,0(R14)        EXECUTE THE LA R15,VARYING STRING        04298000
           ST  R14,0(R13)      SAVE REGISTER 14 IN SAVE AREA            04299000
           LH  R14,0(R15)      LOAD LENGTH OF THE STRING                04300000
           LTR  R14,R14        SEE IF STRING LENGTH = 0                 04301000
           BZ  RESET14         NO DATA TO MOVE                          04302000
           BCTR R14,0                                                   04303000
           EX  R14,ERRMUV                                               04304000
           LA  R1,1(R14,R1)    STEP 1 SO NEXT MOVE GOES ONTO RIGHT      04305000
*                              SPOT IN BUFFER                           04306000
RESET14  DS    0H                                                       04307000
           L   R14,0(R13)      RELOAD R14                               04308000
           LA  R14,4(R14)      STEP OVER THE LA                         04309000
           B   S23LUP1                                                  04310000
* OOPS   WTO   'JOLE00-99 CANNOT ALLOCATE ERROR AREA'                   04311000
*        ABEND 16,DUMP,STEP                                             04312000
ERRMUV   MVC   0(*-*,R1),2(R15) **** EXECUTED                           04313000
         SPACE                                                          04314000
S23END1  DS    0H                                                       04315000
         LA    R14,2(R14)      BRANCH AROUND '0' AT END OF LIST         04316000
         L     R15,4(R13)       LOAD OLD SAVE ADDRESS                   04317000
         ST    R14,12(R15)     RESET OLD RETURN ADDRESS                 04318000
         MVC   0(3,R1),=C' AT'  SHIFT IN 'AT'                           04319000
         MVC   4(4,R1),S23STMT                                    75003 04320000
         OC    S23STMT,S23STMT                                          04321000
         BNZ   S23SETL                                                  04322000
         MVC   4(4,R1),STMT                                       75003 04323000
*        OC    4(4,R1),=C'0000' JCS NOTICED BINARY ZEROES IN THERE      04324000
S23SETL  LA    R14,S23MSSG-12 THE -8 IS FOR THE 'AT STMT'         75128 04325000
S23TEST0 CLI   4(R1),C'0'     LEADING ZERO?                       75003 04326000
         BNH   S23SR          -> NO                               75003 04327000
         MVC   4(4,R1),5(R1)  DROP ZERO                           75003 04328000
         BCT   R1,S23TEST0                                        75003 04329000
S23SR    DS    0H                                                 75003 04330000
         SR    R1,R14                                                   04331000
         XC    #S23LNE2,#S23LNE2   CLEAR LENGTH                   76200 04332000
         CH    R1,#S23MAX          CHECK FOR A BIG MESSAGE        76200 04333000
         BNH   S23SHORT            ITS OK, KEEP GOING             76200 04334000
* NOW WE HAVE A MESSAGE THATS GREATER THAN 96 BYTES AND IF        76200 04335000
* WE DONT MAKE TWO LINES OUT OF IT, THE OS WRITER OR HASP...ECT   76200 04336000
* WILL CHOP IT OFF                                                76200 04337000
* SO WE ARE NOW GOING TO TAKE A LOOK AT THE MESSAGE FORM +96 BACK       04338000
* AND WHEN WE FIND A COMMA OR A BLANK THAT WILL END LINE 1 AND          04339000
* START LINE 2                                                          04340000
         STH   R1,#S23LNE2         SAVE OLD LENGTH FOR LATER      76200 04341000
         LA    R15,S23MSSG         POINT TO THE START OF THE MSG  76200 04342000
         AH    R15,#S23MAX         GET TO +96                     76200 04343000
         LA    R1,30               STOP LOOKING AFTER 30 BYTES    76200 04344000
S23LOOK  DS    0H                                                 76200 04345000
         CLI   0(R15),C' '         IS IT A BLANK                  76200 04346000
         BE    S23ENDLK                                           76200 04347000
         CLI   0(R15),C','         HOW ABOUT A COMMA              76200 04348000
         BE    S23ENDLK                                           76200 04349000
         BCTR  R15,0               BACKUP,1 BYTE                  76200 04350000
         BCT   R1,S23LOOK          RETURN                         76200 04351000
S23ENDLK DS    0H                                                 76200 04352000
         LR    R1,R15              R1 = NEW END FOR LINE 1        76200 04353000
         LA    R14,#S23LREC   POINT TO START OF MESSAGE           76200 04354000
         SR    R1,R14              CALC NEW LENGTH FOR LINE 1     76200 04355000
         AH    R14,#S23LNE2        POINT R14 TO END OF MESSAGE    76200 04356000
         SR    R14,R15             CALC LENGTH FOR LINE 2         76200 04357000
         LA    R14,19(R14) LEAVE SOME BLANKS ON CONT LINE         76200 04358000
         STH   R14,#S23LNE2        SAVE IT FOR LATER              76200 04359000
         CLEAR S23LNE2                                            76200 04360000
         MVC   S23LNE2+15(L'S23LNE2-16),1(R15)      SAVE LINE 2   76200 04361000
S23SHORT DS    0H                                                 76200 04362000
         XC    #S23BLKS(8),#S23BLKS CLEAR VB DESCRIPTOR ETC       76200 04363000
           STH R1,#S23LREC                                              04364000
           LA  R1,4(R1)                                                 04365000
           STH R1,#S23BLKS                                              04366000
           XC S23STMT,S23STMT                                           04367000
* GREAT,NOW WHERE ARE WE GOING TO PUT THIS FANTASTIC PIECE OF           04368000
*    INFORMATION ?                                                      04369000
           TM  PRINT+48,X'10'                                           04370000
           BZ  S23WTO                                                   04371000
           WRITE S23DECB,SF,PRINT,#S23BLKS                              04372000
           CHECK S23DECB                                                04373000
S23WTO   DS    0H                                                       04374000
* NOW IF THE SEVERITY IS >=12 THE MESSAGE IS TYPED ON THE CONSOLE,      04375000
*    OTHERWISE A WTO WITH ROUTCDE=11 IS QUITE SATISFACTORY,UNLESS       04376000
*    WE HAVE A PRINT DD CARD,IF WHICH CASE WE CAN RETURN NOW            04377000
           CLI S23SEV,3                                                 04378000
           BL  S23TPRNT                                                 04379000
* HERE A REAL WTO IS REQUIRED,SO SET UP ROUTE-CODES 2 & 11              04380000
           MVC #S23MSSG,=XL2'8000'                                      04381000
           LH  R15,#S23LREC                                             04382000
           LA  R15,#S23LREC(R15)                                        04383000
           MVC 0(4,R15),=X'04004020' DESC 6 RTE 11,2              75311 04384000
           CLI  VS,C'2'    MVS ?                                   DASD 04385000
           BNE  S23TNMVS   NOPE                                    DASD 04386000
           MVC 0(4,R15),=X'04004004' DESC 6 RTE 2,14 JESMSG        DASD 04387000
S23TNMVS DS    0H                                                  DASD 04388000
         WTO   MF=(E,#S23LREC)                                          04389000
           B  S23GOBAK                                                  04390000
           SPACE 3                                                      04391000
S23TPRNT DS    0H                                                 75311 04392000
         TM    PRINT+48,X'10' DID WE PUT MESSAGE ON PRINTER FIX-X 76200 04393000
         BO    S23GOBAK       YES, DON'T FILL WTP ON JCL LOGFIX-X 76200 04394000
* SET UP A WTO WITH ROUTCDE=11                                          04395000
           MVC #S23MSSG,=XL2'8000'                                      04396000
           LH  R15,#S23LREC                                             04397000
           LA  R15,#S23LREC(R15)                                        04398000
           MVC 0(4,R15),=X'00000020' ROUTCODE   11                75128 04399000
           CLI  VS,C'2'   MVS ??                                   DASD 04400000
           BNE  S23NMVS   NOPE                                     DASD 04401000
           MVC 0(4,R15),=X'00000004' ROUTCODE 14 FOR JESMSG        DASD 04402000
S23NMVS  DS    0H                                                  DASD 04403000
*          LA  R1,#S23LREC                                              04404000
         WTO   MF=(E,#S23LREC)                                          04405000
S23GOBAK DS    0H                                                       04406000
         CLC   #S23LNE2,=X'0000'   DO WE HAVE A SECOND LINE       76200 04407000
         BE    S23GOBK2            NOPE                           76200 04408000
         LH    R1,#S23LNE2         LOAD LENGTH OF LINE2           76200 04409000
         XC    #S23LNE2,#S23LNE2   CLEAR                          76200 04410000
         MVC   S23MSSG,S23LNE2     OVERLAY OLD WITH NEW           76200 04411000
        CLI  S23LNE2,C' '  CHECK FOR BLANK SECOND LINE             DASD 04412000
        BNE  S23SHORT                                              DASD 04413000
        LR   R15,R1        LOAD LENGTH OF MESSAGE                  DASD 04414000
        BCTR R15,0         SUBTRACT 1 FOR EXECUTE INST             DASD 04415000
        EX   R15,S23CLCBL                                          DASD 04416000
        BE   S23GOBK2      ITS BLANK  LETS NOT PRINT IT            DASD 04417000
         B     S23SHORT            RETURN AND WRITE LINE2         76200 04418000
S23CLCBL CLC  S23LNE2+1(*-*),S23LNE2                              DASD  04419000
S23GOBK2 DS    0H                                                 76200 04420000
         CLI S23SEV,5           JOL TERMINAL ERROR ?                    04421000
         BNE  S23LMRET                                                  04422000
         AIF   (&X8).X8480                                              04423000
         JOLCLOSE (INSTRUCT,,PRINT,,RETN,,JOBQ),MF=(E,CALLAREA)         04424000
         AGO   .NX8480                                                  04425000
.X8480   ANOP                                                           04426000
         JOLCLOSE (INSTRUCT,,PRINT,,RETN),MF=(E,CALLAREA)               04427000
.NX8480  ANOP                                                           04428000
         ABEND 1,DUMP STEP                                              04429000
S23LMRET DS    0H                                                       04430000
         JOLRETN                                                        04431000
         LTORG                                                          04432000
         DC   80S(*)                                                    04433000
         AIF   (&X8).X8500                                              04434000
         TITLE 'UJEISPDQ:KEEP EXTRA PDQ ISAM ENTRYS'               DASD 04435000
* THIS LITTLE CSECT WILL KEEP THE 2ND AND 3RD ENTRIES       *      DASD 04436000
* WHICH ARE IN THE PDQ FROM A ISAM DATASET                  *      DASD 04437000
*                                                           *      DASD 04438000
* NOW ALL A J.O.L. PROGRAMMER HAS TO DO IS SAY              *      DASD 04439000
* CATLG ON ANY 1 OF THE 3 DCLS WHICH DEFINE                 *      DASD 04440000
* INDEX, PRIME OR OVFLOW                                    *      DASD 04441000
*                                                           *      DASD 04442000
* AND THE KEEP MODULE WILL CALL THIS GUY AND                *      DASD 04443000
* HE WILL SEARCH THE PDQ FOR MORE ENTRIES AND               *      DASD 04444000
* HANDLE THEM THE SAME WAY                                  *      DASD 04445000
*                                                           *      DASD 04446000
* ALSO THE JFCB VOL COUNT WILL BE UPDATED TO A MAX OF 3     *      DASD 04447000
* SO WHEN THE CATALOGUE MODULE GETS CONTROL THE VOL COUNT   *      DASD 04448000
* AND VOLUMES ARE IN GOOD SHAPE                             *      DASD 04449000
*                                                           *      DASD 04450000
*                                                           *      DASD 04451000
* SO CLEM IF YOUR READING THESE COMMENTS ALL I DID          *      DASD 04452000
* WAS COPY YOUR WORK IN THE UJE81PDQ MODULE                 *      DASD 04453000
* AND ADDED A FEW THINGS HERE AND THERE                     *      DASD 04454000
*                                                           *      DASD 04455000
* J.O.L. IS NOW BETTER THAN JCL WHEN IT COMES TO ISAM       *      DASD 04456000
*                                                           *      DASD 04457000
         JOLSAVE CSECT=UJEISPDQ                                    DASD 04458000
* THIS CSECT MUST FIND THE PDQ ENTRY THAT REFERS TO THE DSNAME     DASD 04459000
*    IN THE DSNAME FIELD. A 4 IS RETURNED IF IT CAN'T              DASD 04460000
*                                                                  DASD 04461000
******                                                             DASD 04462000
* CHECK IF JCTPDIP = 0 (MAY BE IF RUNNING UNDER                    DASD 04463000
*                       TSO).                                      DASD 04464000
******                                                             DASD 04465000
         SPACE 1                                                   DASD 04466000
         CLC   JCTPDIP,=F'0'                                       DASD 04467000
         BE    EISRTN                                              DASD 04468000
         MVI   EISDSN,0      SET DSN SERCH ARG TO ZERO             DASD 04469000
         MVI   ISINPDQ,2     SET SERCH NO. TO 2                    DASD 04470000
         CLI   VS,C'2'       MVS                                   DASD 04471000
         BNE   EISGO         NO START LOOKING FOR SECOND CONCAT    DASD 04472000
         MVI   ISINPDQ,1     SET SERCH NO. TO 1                    DASD 04473000
*REMEMBER THAT THE KEEP GOT RID OF THE 1ST ENTRY ALREADY--MVS ONLY-DASD 04474000
EISGO    DS    0H                                                  DASD 04475000
         GETJOBQ PDQDECB2,JCTPDIP                                  DASD 04476000
         B     EISGOTRD                                            DASD 04477000
EISREAD1 GETJOBQ PDQDECB2,CALLAREA                                 DASD 04478000
EISGOTRD DS    0H                                                  DASD 04479000
         CLI   VS,C'2'   MVS?                                      DASD 04480000
         BNE   EISNMVS1                                            DASD 04481000
EISMVDS1 LA    R14,*+4       POINT TO MVS CLC AREA                 DASD 04482000
         CLC   DDDSNAME,PDIDSN1                                    DASD 04483000
         BE    EISPASS1                                            DASD 04484000
         CLC   DDDSNAME,PDIDSN2                                    DASD 04485000
         BE    EISPASS2                                            DASD 04486000
         CLC   DDDSNAME,PDIDSN3                                    DASD 04487000
         BE    EISPASS3                                            DASD 04488000
* NOT IN PDI, GET NEXT                                             DASD 04489000
         CLC   =AL3(0),PDINPDIP  IS THIS THE LAST BLOCK?           DASD 04490000
         BE    EISRTN    YES, NOT FOUND THEN                       DASD 04491000
         GETJOBQ  PDQDECB2,PDINPDIP                                DASD 04492000
         B     EISMVDS1                                            DASD 04493000
EISNMVS1 DS    0H                                                  DASD 04494000
         LA     R14,*+4         POINT TO NEXT CLC                  DASD 04495000
         CLC   DDDSNAME,PDQDSN1                                    DASD 04496000
         BE    EISPASS1                                            DASD 04497000
         CLC   DDDSNAME,PDQDSN2                                    DASD 04498000
         BE    EISPASS2                                            DASD 04499000
         CLC   DDDSNAME,PDQDSN3                                    DASD 04500000
         BE    EISPASS3                                            DASD 04501000
* NOT IN THAT BLOCK,GET THE NEXT                                   DASD 04502000
         CLC   =AL3(0),PDQNPDQ LAST BLOCK IN PDQ ?                 DASD 04503000
         BE    EISRTN        YES,THERE-FORE COULDN'T FIND DSET     DASD 04504000
         MVC   CALLAREA,PDQNPDQ                                    DASD 04505000
         MVI   CALLAREA+3,0                                        DASD 04506000
*                                                                  DASD 04507000
         B     EISREAD1                                            DASD 04508000
EISPASS1 MVC   PDQDSNNO,=H'0'                                      DASD 04509000
         B     EISPDQB                                             DASD 04510000
EISPASS2 MVC   PDQDSNNO,=H'1'                                      DASD 04511000
         B     EISPDQB                                             DASD 04512000
EISPASS3 MVC   PDQDSNNO,=H'2'                                      DASD 04513000
EISPDQB  DS    0H                                                  DASD 04514000
* THERE USED TO BE A NOTE FOR JOBQ HERE, NOT NEC NOW               DASD 04515000
         ST    R1,APDQDIR       AND SAVE IT                        DASD 04516000
         ST    R14,EISR14       SAVE RETURN POINTER                DASD 04517000
         SR    R1,R1            CLEAN UP R1                        DASD 04518000
         IC    R1,EISDSN        LOAD SEARCH ARG                    DASD 04519000
         LA    R1,1(R1)         UP IT BY 1                         DASD 04520000
         STC   R1,EISDSN        PUT THE BUGGER BACK                DASD 04521000
         CLC   EISDSN,ISINPDQ   DO WE HAVE A HIT                   DASD 04522000
         BE    EISGOOD          ...YEP                             DASD 04523000
EISTRYA  DS    0H                                                  DASD 04524000
         L     R14,EISR14       RELOAD R14 WITH GOOOOD STUFF       DASD 04525000
* NOW RETURN TO THE NEXT COMPARE INSTRUCTION  HOPEFULLY            DASD 04526000
         CLC   PDQDSNNO,=H'0'                                      DASD 04527000
         BE    10(R14)                                             DASD 04528000
         CLC   PDQDSNNO,=H'1'                                      DASD 04529000
         BE    20(R14)                                             DASD 04530000
*        CLC   PDQDSNNO,=H'2'                                      DASD 04531000
         B     30(R14)                                             DASD 04532000
EISGOOD  DS    0H                                                  DASD 04533000
         CLI   VS,C'2'     MVS                                     DASD 04534000
         BNE   EISNMVS2                                            DASD 04535000
* GET SIOT FOR MVS SYSTEMS                                         DASD 04536000
         LH    R1,PDQDSNNO                                         DASD 04537000
         MH    R1,=AL2(PDILEN)                                     DASD 04538000
         LA    R14,PDISIOT1(R1)   GET SIOT ADDRESS LOCN            DASD 04539000
         MVC   CALLAREA,0(R14)                                     DASD 04540000
         B     EISGETSI         GO GET THE SIOT                    DASD 04541000
EISNMVS2 DS    0H                                                  DASD 04542000
         MVC   CALLAREA,PDQABLK                                    DASD 04543000
         MVI   CALLAREA+3,0                                        DASD 04544000
         GETJOBQ PDQDECB,CALLAREA                                  DASD 04545000
* NOW GET THE SIOT AS WELL                                         DASD 04546000
         LH    R1,PDQDSNNO     DATA SET NUMBER                     DASD 04547000
         MH    R1,=AL2(PDQBLKLN) LENGTH OF BLOCK                   DASD 04548000
         LA    R1,PDQASIOT(R1)   ABSOLUTE ADDRESS                  DASD 04549000
         MVC   CALLAREA(3),0(R1) SIOT TTR                          DASD 04550000
         MVI   CALLAREA+3,0                                        DASD 04551000
EISGETSI DS    0H                                                  DASD 04552000
         GETJOBQ SIOTDECB,CALLAREA                                 DASD 04553000
EISINPDQ DS    0H                                                  DASD 04554000
* NOW JUST BECAUSE THE NAME APPEARS IN THE PDQ DOESN'T MEAN FOR    DASD 04555000
*    1 SECOND THAT IT HASN'T :-                                    DASD 04556000
*          1.  BEEN SCRATCHED                                      DASD 04557000
*          2.  BEEN ALREADY KEPT                                   DASD 04558000
         LH    R1,PDQDSNNO     1ST,2ND OR 3RD NAME IN PDQ ?        DASD 04559000
         CLI   VS,C'2'    IS IT AN MVS SYSTEM?                     DASD 04560000
         BNE   EISNMV3S  NO                                        DASD 04561000
* OK, MVS HAS DIFFERENT TYPE OF PASSED DATA SET Q                  DASD 04562000
         MH    R1,=AL2(PDILEN)                                     DASD 04563000
         LA    R14,PDITERM1(R1)                                    DASD 04564000
         B     EISNMVS3                                            DASD 04565000
EISNMV3S MH    R1,=AL2(PDQBLKLN)                                   DASD 04566000
         LA    R14,PDQTERM(R1)                                     DASD 04567000
EISNMVS3 DS    0H                                                  DASD 04568000
         TM    0(R14),X'C0'    OLD,DELETE ?                        DASD 04569000
         B     *+8             ****************                    DASD 04570000
         BO    EISAGN                                              DASD 04571000
         SPACE 3                                                   DASD 04572000
*** LAST BYTE OF JFCB TTR =0 IN SIOT                               DASD 04573000
         GETJOBQ JFCBDECB,SCTPJFCB  GET THE JFCB                   DASD 04574000
         CLI   JFCBVOLS,X'FF'  UNOPENED SCRATCH VOLUME ?           DASD 04575000
         BNE   EISNOTFF        GO WRITE BACK JFCB,SIOT             DASD 04576000
*          JOLERR 205,'DSID ''',DDDSID,''' DSNAME ''',#DSNAME,     DASD 04577000
*              ''' NOT KEPT:UNOPENED SCRATCH VOLUME'               DASD 04578000
         B     EISAGN                                              DASD 04579000
EISNOTFF DS    0H                                                  DASD 04580000
         NI    JFCBIND2,B'01111111' TELL OS AN OLD DATA SET        DASD 04581000
         OI    JFCBIND2,B'01000000'                                DASD 04582000
         PUTJOBQ JFCBDECB                                          DASD 04583000
         MVC   CALLAREA,SIOT                                       DASD 04584000
         MVI   CALLAREA+3,0                                        DASD 04585000
         GETJOBQ SIOTDECB,CALLAREA                                 DASD 04586000
         CLI   DDDISP+1,C'L'  LAST USE OF DATA SET ?               DASD 04587000
*                             IF WE CAN LET OS UNLOAD ?            DASD 04588000
         BNE   EISNLAST       NOT LAST USE                         DASD 04589000
* MARK SIOT AND LET IT THINK WE HAVE FINISHED WITH                 DASD 04590000
*  THE DATASET (WHICH WE HAVE, OF COURSE).                         DASD 04591000
         NI    SCTSDISP,X'FF'-SIOTRETN-S3400DSP-PRIVATE            DASD 04592000
         OI    SCTSDISP,8     TURN KEEP ON                         DASD 04593000
         OI    SCTSBYT2,SCTRECVD MARK RECIEVED                     DASD 04594000
         B     EISMAKOL       MAKE IT OLD, RE-WRITE SIOT           DASD 04595000
EISNLAST DS    0H                                                  DASD 04596000
         OI    SCTSDISP,B'00001000'   SIOT = KEEP                  DASD 04597000
EISMAKOL OI    SCTSBYT4,1     MARK OLD                             DASD 04598000
         PUTJOBQ SIOTDECB                                          DASD 04599000
         SPACE 3                                                   DASD 04600000
* NOW PUT THE VOLSERS INTO DDVOLUME    NO DUPS OFCOURCE            DASD 04601000
         SR    R14,R14        CLEAR REG14                          DASD 04602000
         IC    R14,JFCBNVOL   INSERT JFCB VOLUME COUNT             DASD 04603000
         LA    R1,JFCBVOLS    POINT TO JFCB VOLSERS                DASD 04604000
EISLOADV LA    R15,DDVOLUME   POINT TO JOL VOLSER AREA             DASD 04605000
         CLC   0(6,R15),0(R1) EQUAL VOLUMES ?                      DASD 04606000
         BE    EISNMOVE       YEP DONT BOTHER TO ADD IT            DASD 04607000
EISLUP   CLC   0(6,R15),BLANKS BUCKET EMPTY FOR NEW GUY ?          DASD 04608000
         BE    EISMOVE        YEP GO DO IT                         DASD 04609000
         LA    R15,6(R15)     BUMP TO NEXT ENTRY                   DASD 04610000
         C     R15,=A(DDVOLUME+30) HOPE WE DONT HAVE TO MANY       DASD 04611000
         BNH   EISLUP         NOPE                                 DASD 04612000
         B     EISCVOL        ERROR HERE BETTER TELL SOMEONE       DASD 04613000
EISMOVE  MVC   0(6,R15),0(R1) INSERT NEW VOLSER                    DASD 04614000
EISNMOVE LA    R1,6(R1)       UP TO NEXT JFCB VOLSER               DASD 04615000
         BCT   R14,EISLOADV   RETURN TO LOOK                       DASD 04616000
EISCVOL  LA    R15,DDVOLUME   POINT TO JOL VOLSER AREA AGAIN       DASD 04617000
         LA    R14,5          STOP AFTER FIVE                      DASD 04618000
         SR    R1,R1          CLEAR COUNTER                        DASD 04619000
EISJFVOL CLC   0(6,R15),BLANKS END OF VOLSER LIST ?                DASD 04620000
         BE    EISTJFCB       YES SIR                              DASD 04621000
         LA    R1,1(R1)       UP COUNTER                           DASD 04622000
         LA    R15,6(R15)     UP POINTER                           DASD 04623000
         BCT   R14,EISJFVOL    RETURN                              DASD 04624000
EISTJFCB STC   R1,JFCBNVOL    STORE NEW VOLCOUNT IN JFCB VOL COUNT DASD 04625000
EISDVOL  DS    0H                                                  DASD 04626000
         BAL   R14,E00FXVOL    SET UP VOLUME(S) IN #VOL            DASD 04627000
* NOW TO MARK THE PDQ                                              DASD 04628000
* TEST IF MVS, DIFFERENT...                                        DASD 04629000
         CLI   VS,C'2'   MVS?                                      DASD 04630000
         BNE   EISNMVS4  NOPE ->                                   DASD 04631000
* MVS SIOT CONTAINS THE UCB POINTER, MVT THE PDG DOES              DASD 04632000
         LH    R14,SCTUTYPE                                        DASD 04633000
         B     EISTUNIT                                            DASD 04634000
EISNMVS4 DS    0H                                                  DASD 04635000
         MVC   CALLAREA,PDQABLK                                    DASD 04636000
         MVI   CALLAREA+3,0                                        DASD 04637000
         GETJOBQ PDQDECB,CALLAREA                                  DASD 04638000
         LH    R1,PDQDSNNO                                         DASD 04639000
         MH    R1,=AL2(PDQBLKLN)                                   DASD 04640000
         L     R14,PDQUCBS(R1) GET UCB POINTER FOR DEVICE TYPE     DASD 04641000
         MVC   SCTUTYPE,16(R14) MOVE IN UCB DEVICE TYPE            DASD 04642000
EISTUNIT DS    0H                                                  DASD 04643000
EISDA    NI    SCTUTYPE+1,X'FF'-UCBRR TURN OFF 'SHARE'             DASD 04644000
EISNOTDU DS    0H                                                  DASD 04645000
         SPACE 2                                                   DASD 04646000
         CLI   VS,C'2'  MVS AGAIN?                                 DASD 04647000
         BNE   EISNMVS5                                            DASD 04648000
         LH    R1,PDQDSNNO                                         DASD 04649000
         MH    R1,=AL2(PDILEN)                                     DASD 04650000
         LA    R14,PDITERM1(R1)                                    DASD 04651000
         B     EISMARK9                                            DASD 04652000
EISNMVS5 DS    0H                                                  DASD 04653000
         LA    R14,PDQTERM(R1)                                     DASD 04654000
EISMARK9 DS    0H                                                  DASD 04655000
         NI    0(R14),X'0F'     TURN OFF TOP 4 BITS                DASD 04656000
         CLI   DDDISP+1,C'L'   LAST USE,IE OLD,KEEP ?              DASD 04657000
         BNE   EISPASS                                             DASD 04658000
         OI    0(R14),B'01000000' OLD,KEEP                         DASD 04659000
         NI    0(R14),B'11000000'  INDICATE RECIEVED               DASD 04660000
         B     EISMARKD                                            DASD 04661000
EISPASS  OI    0(R14),B'11100000' OLD,PASS                         DASD 04662000
EISMARKD DS    0H                                                  DASD 04663000
         CLI   VS,C'2'    MVS AGAIN?????                           DASD 04664000
         BNE   EISNMVS6                                            DASD 04665000
         SH    R14,=H'44'         BACKUP TO DSNAME                 DASD 04666000
         MVI   0(R14),C' '        WIPE OUT THE NAME IN PDQ         DASD 04667000
         PUTJOBQ  PDQDECB2                                         DASD 04668000
         B     EISRETN0                                            DASD 04669000
EISNMVS6 DS    0H                                                  DASD 04670000
         PUTJOBQ PDQDECB                                           DASD 04671000
         SPACE 3                                                   DASD 04672000
EISRETN0 DS    0H                                                  DASD 04673000
         CLI   ICOMMAND,C'K'   IS THIS A KEEP INSTRUCTION?         DASD 04674000
         BNE   EISAGN       NO,SO NO MESSAGE,JUST RETURN           DASD 04675000
         JOLERR 101,'DSID ''',DDDSID,''' DSNAME ''',#DSN,            * :04676000
               ''' KEPT ON VOL(S) ',#VOL                           DASD 04677000
EISAGN   CLI   VS,C'2'        MVS                                  DASD 04678000
         BE    EISAGNVS       YEP                                  DASD 04679000
         CLI   ISINPDQ,3        ARE WE ALL DONE HERE               DASD 04680000
         BE    EISRTN           .....YOU BETCHYA                   DASD 04681000
         MVI   ISINPDQ,3        SET SERCH TO DSN # 3               DASD 04682000
         B     EISTRYA        GO BACK TO GET EM                    DASD 04683000
EISAGNVS CLI   ISINPDQ,2        ARE WE ALL DONE HERE               DASD 04684000
         BE    EISRTN           .....YOU BETCHYA                   DASD 04685000
         MVI   ISINPDQ,2        SET SERCH TO DSN # 2               DASD 04686000
         B     EISTRYA        GO BACK TO GET EM                    DASD 04687000
EISRTN   MVI   ISINPDQ,C'1'     SET THIS GUY BACK TO A ONE         DASD 04688000
         JOLRETN RC=0                                              DASD 04689000
EISR14   DS    F                                                   DASD 04690000
EISDSN   DS    1C                                                  DASD 04691000
         LTORG                                                     DASD 04692000
.X8500   ANOP                                                           04693000
         AIF   (&X8).X8520                                              04694000
     TITLE 'UJEDEVNM:SEARCH DEVNAMET'                              DASD 04695000
          JOLSAVE CSECT=UJEDEVNM                                   DASD 04696000
*******************************************************************DASD 04697000
*  SEARCH THE SYSTEMS DEVICE NAME TABLE TO OBTAIN THE             *DASD 04698000
*  THE DEVICE TYPE NEEDED FOR A CAMLST FOR A SCRATCH              *DASD 04699000
*  OR  KEEP                                                       *DASD 04700000
*                                                                 *DASD 04701000
*  SEARCH ARGUMENT = DDUNIT IN INSTRUCT FILE                      *DASD 04702000
*  DEVNAMET FORMAT                                                *DASD 04703000
*  EACH ENTRY IS 12 BYTES                                         *DASD 04704000
*  BYTES 1-8 = UNIT NAME  ECT '3330-1' OR 'TAPE'                  *DASD 04705000
*  BYTES 9-12 = CODE    X'3070200D'                               *DASD 04706000
*                                                                 *DASD 04707000
*******************************************************************DASD 04708000
          LOAD EP=DEVNAMET   LOAD THE KNOW IT ALL                  DASD 04709000
          LTR  R1,R0         GET ADDRESS OF HIM                    DASD 04710000
          BZ   EDVDEAD       SORRY                                 DASD 04711000
          L    R15,0(R1)     LOAD NUMBER OF ENTRIES IN TABLE       DASD 04712000
          MH   R15,=H'12'    MULT BY TABLE ENTRRY SIZE             DASD 04713000
          LA   R1,4(R1)      ADD 4 TO START ADDRESS OF TABLE       DASD 04714000
          AR   R15,R1        CALC ENDD OF TABLE                    DASD 04715000
          LA   R14,12        INCREMENT                             DASD 04716000
          CLC  DDUNIT,0(R1)  HOPE ITS HERE                         DASD 04717000
          BE   EDVALIVE      GO DO THE SCRATCH NOW                 DASD 04718000
          BXLE R1,R14,*-10   ROUND ROBIN                           DASD 04719000
EDVDEAD   JOLRETN RC=4                                             DASD 04720000
EDVALIVE DS    0H                                                  DASD 04721000
          MVC  SCTUTYPE,8(R1) MOVE IN THE DEVICE TYPE              DASD 04722000
          JOLRETN RC=0                                             DASD 04723000
.X8520   ANOP                                                           04724000
         TITLE 'UJS45AER  ISSUE GET-FILE ERROR MESSAGE'                 04725000
         JOLSAVE CSECT=UJS45AER                                         04726000
         SPACE 3                                                        04727000
         CH    R1,=H'184'                                               04728000
         BH    X8GETINV                                                 04729000
         B     X8GETERR(R1)                                             04730000
X8GETERR B     X8GET0        0                                          04731000
         B     X8GET4        4                                          04732000
         B     X8GET8        8                                          04733000
         B     X8GET12      12                                          04734000
         B     X8GET16      16                                          04735000
         B     X8GET20      20                                          04736000
         B     X8GET24      24                                          04737000
         B     X8GET28      28                                          04738000
         B     X8GETINV     32                                          04739000
         B     X8GETINV     36                                          04740000
         B     X8GETINV     40                                          04741000
         B     X8GETINV     44                                          04742000
         B     X8GETINV     48                                          04743000
         B     X8GETINV     52                                          04744000
         B     X8GETINV     56                                          04745000
         B     X8GET60      60                                          04746000
         B     X8GET64      64                                          04747000
         B     X8GETINV     68                                          04748000
         B     X8GET72      72                                          04749000
         B     X8GET76      76                                          04750000
         B     X8GET80      80                                          04751000
         B     X8GET84      84                                          04752000
         B     X8GET88      88                                          04753000
         B     X8GET92      92                                          04754000
         B     X8GETINV     96                                          04755000
         B     X8GET100    100                                          04756000
         B     X8GET104    104                                          04757000
         B     X8GET108    108                                          04758000
         B     X8GETINV    112                                          04759000
         B     X8GETINV    116                                          04760000
         B     X8GET120    120                                          04761000
         B     X8GETINV    124                                          04762000
         B     X8GET128    128                                          04763000
         B     X8GET132    132                                          04764000
         B     X8GET136    136                                          04765000
         B     X8GET140    140                                          04766000
         B     X8GET144    144                                          04767000
         B     X8GET148    148                                          04768000
         B     X8GET152    152                                          04769000
         B     X8GET156    156                                          04770000
         B     X8GET160    160                                          04771000
         B     X8GET164    164                                          04772000
         B     X8GET168    168                                          04773000
         B     X8GET172    172                                          04774000
         B     X8GET176    176                                          04775000
         B     X8GET180    180                                          04776000
         B     X8GETINV    184                                          04777000
X8GET0   JOLERR 000,'DATA SET ',#DSN,' ALLOCATED ON *******'            04778000
         B     X8GETRET                                                 04779000
X8GET4   JOLERR 504,'DATA SET ',#DSN,' HAS INVALID PARAMETERS'          04780000
         B     X8GETRET                                                 04781000
X8GET8   JOLERR 508,'DATA SET ',#DSN,' HAS INVALID PARAMETERS'          04782000
         B     X8GETRET                                                 04783000
X8GET12  JOLERR  312,'DATA SET ',#DSN,' IS A FILE OTHER THAN A DUMMY FI*04784000
               LE FOR ACCESS NAME ',DDDDNAME                            04785000
         B     X8GETRET                                                 04786000
X8GET16  JOLERR  216,'DATA SET ',#DSN,' HAD RXV,DIAG OR NSL SPECIFIED A*04787000
               ND NO MKEY WAS SPECIFIED'                                04788000
         B     X8GETRET                                                 04789000
X8GET20  JOLERR  320,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- OPERATOR*04790000
                WOULD NOT MOUNT THE VOLUME'                             04791000
         B     X8GETRET                                                 04792000
X8GET24  JOLERR 524,'INSUFFICENT WORK AREA FOR GETFL MACRO'             04793000
         B     X8GETRET                                                 04794000
X8GET28  JOLERR 328,'FILE NOT CONCATENATED BECAUSE:-'                   04795000
         JOLERR 329,'A) AN ATTEMPT WAS MADE TO CONCAT TO AN OPEN FILE'  04796000
         JOLERR 330,'B) INVALID ACNAME WAS SPECIFIED'                   04797000
         JOLERR 331,'C) SOUT,ISF,CONT,DB,DC,DT,DD,DZ OR SAME WAS SPECIF*04798000
               IED'                                                     04799000
         B     X8GETRET                                                 04800000
X8GET60  JOLERR  360,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- ERROR IN*04801000
                THE CATALOGUE'                                          04802000
         B     X8GETRET                                                 04803000
X8GET64  JOLERR  364,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- CATALOGU*04804000
               E LOCKED'                                                04805000
         B     X8GETRET                                                 04806000
X8GET72  JOLERR  372,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- DATA SET*04807000
                WAS NOT IN CATALOGUE - SEARCH FAILED'                   04808000
         B     X8GETRET                                                 04809000
X8GET76  JOLERR  376,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- FILE NAM*04810000
               E AGREES WITH THE GROUP NAME OF ALREADY CATALOGUED GENER*04811000
               ATION DATA SET (DURING CATALOGUING)'                     04812000
         B     X8GETRET                                                 04813000
X8GET80  JOLERR  380,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- FILE NAM*04814000
               E AGREES WITH THE GROUP NAME OF ALREADY CATALOGUED GENER*04815000
               ATION DATA SET (DURING REFERENCE TO THE CATALOGUE)'      04816000
         B     X8GETRET                                                 04817000
X8GET84  JOLERR  384,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- FILE NAM*04818000
               E IS ALREADY CATALOGUED (GDG ONLY)'                      04819000
         B     X8GETRET                                                 04820000
X8GET88  JOLERR  388,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- FILE NAM*04821000
               E IS ALREADY CATALOGUED'                                 04822000
         B     X8GETRET                                                 04823000
X8GET92  JOLERR  392,'DATA SET ',#DSN,' WAS NOT ALLOCATED  --- A HARWAR*04824000
               E ERROR OCCURRED WHEN READING THE CATALOGUE'             04825000
         B     X8GETRET                                                 04826000
X8GET100 JOLERR  3100,'DATA SET ',#DSN,' WAS NOT ALLOCATED  SYNTAX ERRO*04827000
               R IN DATA SET NAME'                                      04828000
         B     X8GETRET                                                 04829000
X8GET104 JOLERR  3104,'DATA SET ',#DSN,' WAS NOT ALLOCATED  CATALOGUE H*04830000
               AS NO SPACE'                                             04831000
         B     X8GETRET                                                 04832000
X8GET108 JOLERR  3108,'DATA SET ',#DSN,' WAS NOT ALLOCATED - PLSQA FULL*04833000
                '                                                       04834000
         B     X8GETRET                                                 04835000
X8GET120 JOLERR  3120,'DATA SET ',#DSN,' WAS NOT ALLOCATED  - SYSTEM HA*04836000
               S NO CATALOGUE'                                          04837000
         B     X8GETRET                                                 04838000
X8GET128 JOLERR 3128,'DATA SET ',#DSN,' WAS NOT ALLOCATED  BECAUSE:-'   04839000
         JOLERR 3129,'A) THE VOLUME WAS NOT MOUNTED'                    04840000
         JOLERR 3130,'B) THE SAME VOLUME IS REQUIRED TWICE IN THE SAME *04841000
               JOB'                                                     04842000
         JOLERR 3131,'C) THE VOLUME IS BEING USED BY ANOTHER JOB'       04843000
         JOLERR 3132,'D) A PARAMETER CONTAINS AN ERROR'                 04844000
         B     X8GETRET                                                 04845000
X8GET132 JOLERR  3133,'DATA SET ',#DSN,' WAS NOT ALLOCATED - DATA SET I*04846000
               S LOCKED'                                                04847000
         B     X8GETRET                                                 04848000
X8GET136 JOLERR  3136,'DATA SET ',#DSN,' WAS NOT ALLOCATED - UNIT IS OF*04849000
               F LINE'                                                  04850000
         B     X8GETRET                                                 04851000
X8GET140 JOLERR  3140,'DATA SET ',#DSN,' WAS NOT ALLOCATED ',          *04852000
               'DATA SET IS READ ONLY, AND CANNOT BE WRITTEN INTO'      04853000
         B     X8GETRET                                                 04854000
X8GET144 JOLERR  3144,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04855000
               'IT WAS REQUESTED AS NEW, BUT ALREADY EXISTS'            04856000
         B     X8GETRET                                                 04857000
X8GET148 JOLERR  3148,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04858000
               'VTOC IS FULL'                                           04859000
         B     X8GETRET                                                 04860000
X8GET152 JOLERR  3152,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04861000
               'NO SPACE ON VOLUME ',DDVOLUME                           04862000
         B     X8GETRET                                                 04863000
X8GET156 JOLERR  3156,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04864000
               'DATA SET IS NOT ON VOLUME'                              04865000
         B     X8GETRET                                                 04866000
X8GET160 JOLERR  3160,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04867000
               'INCORRECT PASSWORD'                                     04868000
         B     X8GETRET                                                 04869000
X8GET164 JOLERR  3164,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04870000
               'A HARDWARE ERROR ERROR OCCURRED'                        04871000
         B     X8GETRET                                                 04872000
X8GET168 JOLERR  3168,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04873000
               'THE FILE IS ALREADY LOCKED'                             04874000
         B     X8GETRET                                                 04875000
X8GET172 JOLERR  3172,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04876000
               'SHORTAGE OF IO DEVICES'                                 04877000
         B     X8GETRET                                                 04878000
X8GET176  JOLERR 3176,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04879000
               'NO SPACE LEFT ON WORK VOLUMES'                          04880000
         B     X8GETRET                                                 04881000
X8GET180  JOLERR 3180,'DATA SET ',#DSN,' WAS NOT ALLOCATED - ',        *04882000
               'A CANCEL COMMAND WAS ISSUED WHILE WAITING FOR A MOUNT'  04883000
         B     X8GETRET                                                 04884000
X8GETINV  JOLERR 5999,'UNRECOGNISED RETURN CODE FROM GETFL '            04885000
X8GETRET B    RETN0                                                     04886000
         TITLE 'ISSUE FREE-FILE ERROR MESSAGE'                          04887000
         JOLSAVE CSECT=UJS46FER                                         04888000
    SPACE 3                                                             04889000
         CH    R1,=H'188'                                               04890000
         BH    X8FREINV                                                 04891000
         B     X8FREERR(R1)                                             04892000
X8FREERR B     X8FRE0        0                                          04893000
         B     X8FRE4        4                                          04894000
         B     X8FRE8        8                                          04895000
         B     X8FRE12      12                                          04896000
         B     X8FRE16      16                                          04897000
         B     X8FRE20      20                                          04898000
         B     X8FREINV     24                                          04899000
         B     X8FREINV     28                                          04900000
         B     X8FREINV     32                                          04901000
         B     X8FREINV     36                                          04902000
         B     X8FREINV     40                                          04903000
         B     X8FREINV     44                                          04904000
         B     X8FREINV     48                                          04905000
         B     X8FREINV     52                                          04906000
         B     X8FREINV     56                                          04907000
         B     X8FRE60      60                                          04908000
         B     X8FRE64      64                                          04909000
         B     X8FRE68      68                                          04910000
         B     X8FRE72      72                                          04911000
         B     X8FRE76      76                                          04912000
         B     X8FREINV     80                                          04913000
         B     X8FRE84      84                                          04914000
         B     X8FRE88      88                                          04915000
         B     X8FRE92      92                                          04916000
         B     X8FREINV     96                                          04917000
         B     X8FREINV    100                                          04918000
         B     X8FRE104    104                                          04919000
         B     X8FREINV    108                                          04920000
         B     X8FRE112    112                                          04921000
         B     X8FREINV    116                                          04922000
         B     X8FRE120    120                                          04923000
         B     X8FREINV    124                                          04924000
         B     X8FREINV    128                                          04925000
         B     X8FREINV    132                                          04926000
         B     X8FREINV    136                                          04927000
         B     X8FREINV    140                                          04928000
         B     X8FREINV    144                                          04929000
         B     X8FRE148    148                                          04930000
         B     X8FRE152    152                                          04931000
         B     X8FRE156    156                                          04932000
         B     X8FRE160    160                                          04933000
         B     X8FREINV    164                                          04934000
         B     X8FREINV    168                                          04935000
         B     X8FREINV    172                                          04936000
         B     X8FREINV    176                                          04937000
         B     X8FRE180    180                                          04938000
         B     X8FRE184    184                                          04939000
X8FRE0   JOLERR 000,'DATA SET ',#DSN,' FREED'                           04940000
         B     X8FRERET                                                 04941000
X8FRE4   JOLERR 504,'DATA SET ',#DSN,' HAS INVALID PARAMETERS'          04942000
         B     X8FRERET                                                 04943000
X8FRE8   JOLERR 508,'DATA SET ',#DSN,' HAS INVALID PARAMETERS'          04944000
         B     X8FRERET                                                 04945000
X8FRE12  JOLERR  312,'DATA SET ',#DSN,' IS A DUMMY FILE... CANNOT BE FR*04946000
                EED'                                                    04947000
         B     X8FRERET                                                 04948000
X8FRE16  JOLERR  216,'DATA SET ',#DSN,' IS A SYSTEM FILE AND CANNOT BE *04949000
               FREED WITHOUT SPECIAL PRIVILEGES'                        04950000
         B     X8FRERET                                                 04951000
X8FRE20  JOLERR 420,'DATA SET ',#DSN,' IS NOT FREED: JOB STACK IS FULL' 04952000
         B     X8FRERET                                                 04953000
X8FRE60  JOLERR  360,'DATA SET ',#DSN,' WAS NOT CATALOGUED - NULLIFIED *04954000
               BECAUSE OF ABEND ??????'                                 04955000
         B     X8FRERET                                                 04956000
X8FRE64  JOLERR  364,'DATA SET ',#DSN,' WAS NOT CATALOGUED --- CATALOGU*04957000
               E LOCKED'                                                04958000
         B     X8FRERET                                                 04959000
X8FRE68  JOLERR  368,'DATA SET ',#DSN,' WAS NOT UNCATLOGUED -- FILE NAM*04960000
               E AGREES WITH THE GROUP NAME OF ALREADY CATALOGUED GENER*04961000
               ATION DATA SET'                                          04962000
         B     X8FRERET                                                 04963000
X8FRE72  JOLERR  372,'DATA SET ',#DSN,' WAS NOT FREED --- DATA SET WAS *04964000
                NOT IN CATALOGUE'                                       04965000
         B     X8FRERET                                                 04966000
X8FRE76  JOLERR  376,'DATA SET ',#DSN,' WAS NOT CATALOGUED --- FILE NAM*04967000
               E AGREES WITH THE GROUP NAME OF ALREADY CATALOGUED GENER*04968000
               ATION DATA SET (DURING CATALOGUING)'                     04969000
         B     X8FRERET                                                 04970000
X8FRE84  JOLERR  384,'DATA SET ',#DSN,' WAS NOT CATALOGUED --- FILE NAM*04971000
               E AGREES WITH THE GROUP NAME OF ALREADY CATALOGUED GENER*04972000
               ATION DATA SET'                                          04973000
         B     X8FRERET                                                 04974000
X8FRE88  JOLERR  388,'DATA SET ',#DSN,' WAS NOT CATALOGUED --- FILE NAM*04975000
               E IS ALREADY CATALOGUED'                                 04976000
         B     X8FRERET                                                 04977000
X8FRE92  JOLERR  392,'DATA SET ',#DSN,' WAS NOT FREED  --- A HARWARE ER*04978000
               ROR OCCURRED WHEN USING THE CATALOGUE'                   04979000
         B     X8FRERET                                                 04980000
X8FRE104 JOLERR  3104,'DATA SET ',#DSN,' WAS NOT FREED CATALOGUE HAS NO*04981000
                SPACE'                                                  04982000
         B     X8FRERET                                                 04983000
X8FRE112 JOLERR  3112,'DATA SET ',#DSN,' IS CURRENTLY BEING CATALOGUED *04984000
                (GENERATION DATA SET)'                                  04985000
         B     X8FRERET                                                 04986000
X8FRE120 JOLERR  3120,'DATA SET ',#DSN,' WAS NOT FREED - SYSTEM HAS NO *04987000
               CATALOG'                                                 04988000
         B     X8FRERET                                                 04989000
X8FRE148 JOLERR 4148,'DATA SET ',#DSN,' CANNOT BE DELETED BECAUSE ',   *04990000
               'IT IS BEING USED BY ANOTHER JOB'                        04991000
         B     X8FRERET                                                 04992000
X8FRE152 JOLERR  3152,'DATA SET ',#DSN,' WAS NOT DELETED ASS IT IS ON A*04993000
                READ ONLY VOLUME'                                       04994000
         B     X8FRERET                                                 04995000
X8FRE156 JOLERR  3156,'DATA SET ',#DSN,' WAS NOT FREED - A HARDWARE ERR*04996000
               OR OCCURRED ON THE VTOC'                                 04997000
         B     X8FRERET                                                 04998000
X8FRE160 JOLERR  3160,'ACNAME ',DDDDNAME,' WAS NOT FREED',             *04999000
               ' - COULD NOT BE LOCATED'                                05000000
         B     X8FRERET                                                 05001000
X8FRE180 JOLERR  3180,'ACNAME ',DDDDNAME,' WAS NOT FREED',             *05002000
               ' - SAME FILE SPECIFIED'                                 05003000
         B     X8FRERET                                                 05004000
X8FRE184 JOLERR  3184,'ACNAME ',DDDDNAME,' WAS NOT FREED',             *05005000
               ' OPEN COUNTER IS NOT ZERO'                              05006000
         B     X8FRERET                                                 05007000
X8FRERET B     RETN0                                                    05008000
X8FREINV JOLERR 5999,'FREE-FILE HAS GIVEN AN UNRECOGNISED RETURN CODE'  05009000
       TITLE 'UJELOCAT:LOCATE CATALOGUED DATASETS'                 DASD 05010000
         JOLSAVE CSECT=UJELOCAT                                    DASD 05011000
*        AIF   (&X8).X8540                                              05012000
         L     R15,=V(E05VOLS)         LOAD CAMLIST ADDRESS        DASD 05013000
         USING VOLINFO,R15                                         DASD 05014000
         ST    R15,ELOLOCAT+12         POINT TO LOCATE AREA        DASD 05015000
         LA    R6,300(R15)             GO UP A FEW AND SAVE POINTERDASD 05016000
         MVC   0(44,R6),DSNAME         MOVE TO LOCATE AREA         DASD 05017000
         MVC   DSNAME,0(R6)            MOVE DSNAME IN              DASD 05018000
         LOCATE ELOLOCAT                                           DASD 05019000
         LTR   R15,R15                 DID LOACTE FIND ANYTHING ?? DASD 05020000
         BNZ   ELORETN4                NOPE                        DASD 05021000
         JOLRETN RC=0  WE FOUND OUR STIFF LETS LEAVE               DASD 05022000
ELORETN4 DS    0H                                                  DASD 05023000
         MVC  DSNAME,0(R6)            MOVE BACK ORGINAL DATA SET NADASD 05024000
         B    RETN4                   TELL THE CALLER WE FAILED    DASD 05025000
ELOLOCAT CAMLST NAME,DSNAME,,0                                     DASD 05026000
.X8540   ANOP                                                           05027000
*        B    RETN4                                                     05028000
         DC C'COMPILE DATE=&SYSDATE.,TIME=&SYSTIME.'               DASD 05029000
         LTORG                                                     DASD 05030000
         DS    0D                                                       05031000
         PRINT GEN,NODATA                                               05032000
         AIF  (NOT &X8).NOX8MAC                                         05033000
         TITLE 'FIXED LOW CORE'                                         05034000
         XAMFLC  DSECT=YES                                              05035000
PSA      EQU   FLC                                                      05036000
PSATOLD  EQU   FLCTOLD            FOR MVS,F4 COMPATIBILITY              05037000
         TITLE 'COMMUNICATIONS VECTOR TABLE'                            05038000
         XAMCVT  DSECT=YES                                              05039000
         TITLE 'TASK CONTROL BLOCK    '                                 05040000
         XAMTCB  DSECT=YES                                              05041000
TCBFLGS1 EQU   TCBFLAG1       EQUIVALENT FIELDS ON F4,X8                05042000
         TITLE 'REQUEST BLOCK         '                                 05043000
         XAMRB   DSECT=YES                                              05044000
         TITLE 'FILE CONTROL TABLE    '                                 05045000
         XDDFCT                                                         05046000
         TITLE 'JOB-STEP CONTROL BLOCK'                                 05047000
         XDDJSCB                                                        05048000
JSCBLEN  EQU   *-JSCB         MY NAME FOR ITS LENGTH                    05049000
JSCBDISP EQU   0              MVS,F4 NAME FOR DISPLACEMENT TO START     05050000
JSCBOPTS EQU   JSCBSTS                                                  05051000
         TITLE 'COMMAND SCHEDULER CONTROL BLOCK'                        05052000
         XDDCSCB                                                        05053000
.NOX8MAC ANOP                                                           05054000
           END                                                          05055000
